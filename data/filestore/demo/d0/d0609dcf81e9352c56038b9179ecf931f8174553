
/* /web/static/lib/jquery.scrollTo/jquery.scrollTo.js defined in bundle 'web.assets_backend' */
;(function(define){'use strict';define(['jquery'],function($){var $scrollTo=$.scrollTo=function(target,duration,settings){return $(window).scrollTo(target,duration,settings);};$scrollTo.defaults={axis:'xy',duration:0,limit:true};$scrollTo.window=function(scope){return $(window)._scrollable();};$.fn._scrollable=function(){return this.map(function(){var elem=this,isWin=!elem.nodeName||$.inArray(elem.nodeName.toLowerCase(),['iframe','#document','html','body'])!=-1;if(!isWin)
return elem;var doc=(elem.contentWindow||elem).document||elem.ownerDocument||elem;return/webkit/i.test(navigator.userAgent)||doc.compatMode=='BackCompat'?doc.body:doc.documentElement;});};$.fn.scrollTo=function(target,duration,settings){if(typeof duration=='object'){settings=duration;duration=0;}
if(typeof settings=='function')
settings={onAfter:settings};if(target=='max')
target=9e9;settings=$.extend({},$scrollTo.defaults,settings);duration=duration||settings.duration;settings.queue=settings.queue&&settings.axis.length>1;if(settings.queue)
duration/=2;settings.offset=both(settings.offset);settings.over=both(settings.over);return this._scrollable().each(function(){if(target==null)return;var elem=this,$elem=$(elem),targ=target,toff,attr={},win=$elem.is('html,body');switch(typeof targ){case'number':case'string':if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(targ)){targ=both(targ);break;}
targ=win?$(targ):$(targ,this);if(!targ.length)return;case'object':if(targ.is||targ.style)
toff=(targ=$(targ)).offset();}
var offset=$.isFunction(settings.offset)&&settings.offset(elem,targ)||settings.offset;$.each(settings.axis.split(''),function(i,axis){var Pos=axis=='x'?'Left':'Top',pos=Pos.toLowerCase(),key='scroll'+Pos,old=elem[key],max=$scrollTo.max(elem,axis);if(toff){attr[key]=toff[pos]+(win?0:old-$elem.offset()[pos]);if(settings.margin){attr[key]-=parseInt(targ.css('margin'+Pos))||0;attr[key]-=parseInt(targ.css('border'+Pos+'Width'))||0;}
attr[key]+=offset[pos]||0;if(settings.over[pos])
attr[key]+=targ[axis=='x'?'width':'height']()*settings.over[pos];}else{var val=targ[pos];attr[key]=val.slice&&val.slice(-1)=='%'?parseFloat(val)/100*max:val;}
if(settings.limit&&/^\d+$/.test(attr[key]))
attr[key]=attr[key]<=0?0:Math.min(attr[key],max);if(!i&&settings.queue){if(old!=attr[key])
animate(settings.onAfterFirst);delete attr[key];}});animate(settings.onAfter);function animate(callback){$elem.animate(attr,duration,settings.easing,callback&&function(){callback.call(this,targ,settings);});}}).end();};$scrollTo.max=function(elem,axis){var Dim=axis=='x'?'Width':'Height',scroll='scroll'+Dim;if(!$(elem).is('html,body'))
return elem[scroll]-$(elem)[Dim.toLowerCase()]();var size='client'+Dim,html=elem.ownerDocument.documentElement,body=elem.ownerDocument.body;return Math.max(html[scroll],body[scroll])-Math.min(html[size],body[size]);};function both(val){return $.isFunction(val)||$.isPlainObject(val)?val:{top:val,left:val};}
return $scrollTo;})}(typeof define==='function'&&define.amd?define:function(deps,factory){if(typeof module!=='undefined'&&module.exports){module.exports=factory(require('jquery'));}else{factory(jQuery);}}));;

/* /web/static/lib/nvd3/d3.v3.js defined in bundle 'web.assets_backend' */
!function(){var d3={version:"3.5.6"};var d3_arraySlice=[].slice,d3_array=function(list){return d3_arraySlice.call(list);};var d3_document=this.document;function d3_documentElement(node){return node&&(node.ownerDocument||node.document||node).documentElement;}
function d3_window(node){return node&&(node.ownerDocument&&node.ownerDocument.defaultView||node.document&&node||node.defaultView);}
if(d3_document){try{d3_array(d3_document.documentElement.childNodes)[0].nodeType;}catch(e){d3_array=function(list){var i=list.length,array=new Array(i);while(i--)array[i]=list[i];return array;};}}
if(!Date.now)Date.now=function(){return+new Date();};if(d3_document){try{d3_document.createElement("DIV").style.setProperty("opacity",0,"");}catch(error){var d3_element_prototype=this.Element.prototype,d3_element_setAttribute=d3_element_prototype.setAttribute,d3_element_setAttributeNS=d3_element_prototype.setAttributeNS,d3_style_prototype=this.CSSStyleDeclaration.prototype,d3_style_setProperty=d3_style_prototype.setProperty;d3_element_prototype.setAttribute=function(name,value){d3_element_setAttribute.call(this,name,value+"");};d3_element_prototype.setAttributeNS=function(space,local,value){d3_element_setAttributeNS.call(this,space,local,value+"");};d3_style_prototype.setProperty=function(name,value,priority){d3_style_setProperty.call(this,name,value+"",priority);};}}
d3.ascending=d3_ascending;function d3_ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN;}
d3.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN;};d3.min=function(array,f){var i=-1,n=array.length,a,b;if(arguments.length===1){while(++i<n)if((b=array[i])!=null&&b>=b){a=b;break;}
while(++i<n)if((b=array[i])!=null&&a>b)a=b;}else{while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>=b){a=b;break;}
while(++i<n)if((b=f.call(array,array[i],i))!=null&&a>b)a=b;}
return a;};d3.max=function(array,f){var i=-1,n=array.length,a,b;if(arguments.length===1){while(++i<n)if((b=array[i])!=null&&b>=b){a=b;break;}
while(++i<n)if((b=array[i])!=null&&b>a)a=b;}else{while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>=b){a=b;break;}
while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>a)a=b;}
return a;};d3.extent=function(array,f){var i=-1,n=array.length,a,b,c;if(arguments.length===1){while(++i<n)if((b=array[i])!=null&&b>=b){a=c=b;break;}
while(++i<n)if((b=array[i])!=null){if(a>b)a=b;if(c<b)c=b;}}else{while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>=b){a=c=b;break;}
while(++i<n)if((b=f.call(array,array[i],i))!=null){if(a>b)a=b;if(c<b)c=b;}}
return[a,c];};function d3_number(x){return x===null?NaN:+x;}
function d3_numeric(x){return!isNaN(x);}
d3.sum=function(array,f){var s=0,n=array.length,a,i=-1;if(arguments.length===1){while(++i<n)if(d3_numeric(a=+array[i]))s+=a;}else{while(++i<n)if(d3_numeric(a=+f.call(array,array[i],i)))s+=a;}
return s;};d3.mean=function(array,f){var s=0,n=array.length,a,i=-1,j=n;if(arguments.length===1){while(++i<n)if(d3_numeric(a=d3_number(array[i])))s+=a;else--j;}else{while(++i<n)if(d3_numeric(a=d3_number(f.call(array,array[i],i))))s+=a;else--j;}
if(j)return s/j;};d3.quantile=function(values,p){var H=(values.length-1)*p+1,h=Math.floor(H),v=+values[h-1],e=H-h;return e?v+e*(values[h]-v):v;};d3.median=function(array,f){var numbers=[],n=array.length,a,i=-1;if(arguments.length===1){while(++i<n)if(d3_numeric(a=d3_number(array[i])))numbers.push(a);}else{while(++i<n)if(d3_numeric(a=d3_number(f.call(array,array[i],i))))numbers.push(a);}
if(numbers.length)return d3.quantile(numbers.sort(d3_ascending),.5);};d3.variance=function(array,f){var n=array.length,m=0,a,d,s=0,i=-1,j=0;if(arguments.length===1){while(++i<n){if(d3_numeric(a=d3_number(array[i]))){d=a-m;m+=d/++j;s+=d*(a-m);}}}else{while(++i<n){if(d3_numeric(a=d3_number(f.call(array,array[i],i)))){d=a-m;m+=d/++j;s+=d*(a-m);}}}
if(j>1)return s/(j-1);};d3.deviation=function(){var v=d3.variance.apply(this,arguments);return v?Math.sqrt(v):v;};function d3_bisector(compare){return{left:function(a,x,lo,hi){if(arguments.length<3)lo=0;if(arguments.length<4)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)<0)lo=mid+1;else hi=mid;}
return lo;},right:function(a,x,lo,hi){if(arguments.length<3)lo=0;if(arguments.length<4)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)>0)hi=mid;else lo=mid+1;}
return lo;}};}
var d3_bisect=d3_bisector(d3_ascending);d3.bisectLeft=d3_bisect.left;d3.bisect=d3.bisectRight=d3_bisect.right;d3.bisector=function(f){return d3_bisector(f.length===1?function(d,x){return d3_ascending(f(d),x);}:f);};d3.shuffle=function(array,i0,i1){if((m=arguments.length)<3){i1=array.length;if(m<2)i0=0;}
var m=i1-i0,t,i;while(m){i=Math.random()*m--|0;t=array[m+i0],array[m+i0]=array[i+i0],array[i+i0]=t;}
return array;};d3.permute=function(array,indexes){var i=indexes.length,permutes=new Array(i);while(i--)permutes[i]=array[indexes[i]];return permutes;};d3.pairs=function(array){var i=0,n=array.length-1,p0,p1=array[0],pairs=new Array(n<0?0:n);while(i<n)pairs[i]=[p0=p1,p1=array[++i]];return pairs;};d3.zip=function(){if(!(n=arguments.length))return[];for(var i=-1,m=d3.min(arguments,d3_zipLength),zips=new Array(m);++i<m;){for(var j=-1,n,zip=zips[i]=new Array(n);++j<n;){zip[j]=arguments[j][i];}}
return zips;};function d3_zipLength(d){return d.length;}
d3.transpose=function(matrix){return d3.zip.apply(d3,matrix);};d3.keys=function(map){var keys=[];for(var key in map)keys.push(key);return keys;};d3.values=function(map){var values=[];for(var key in map)values.push(map[key]);return values;};d3.entries=function(map){var entries=[];for(var key in map)entries.push({key:key,value:map[key]});return entries;};d3.merge=function(arrays){var n=arrays.length,m,i=-1,j=0,merged,array;while(++i<n)j+=arrays[i].length;merged=new Array(j);while(--n>=0){array=arrays[n];m=array.length;while(--m>=0){merged[--j]=array[m];}}
return merged;};var abs=Math.abs;d3.range=function(start,stop,step){if(arguments.length<3){step=1;if(arguments.length<2){stop=start;start=0;}}
if((stop-start)/step===Infinity)throw new Error("infinite range");var range=[],k=d3_range_integerScale(abs(step)),i=-1,j;start*=k,stop*=k,step*=k;if(step<0)while((j=start+step*++i)>stop)range.push(j/k);else while((j=start+step*++i)<stop)range.push(j/k);return range;};function d3_range_integerScale(x){var k=1;while(x*k%1)k*=10;return k;}
function d3_class(ctor,properties){for(var key in properties){Object.defineProperty(ctor.prototype,key,{value:properties[key],enumerable:false});}}
d3.map=function(object,f){var map=new d3_Map();if(object instanceof d3_Map){object.forEach(function(key,value){map.set(key,value);});}else if(Array.isArray(object)){var i=-1,n=object.length,o;if(arguments.length===1)while(++i<n)map.set(i,object[i]);else while(++i<n)map.set(f.call(object,o=object[i],i),o);}else{for(var key in object)map.set(key,object[key]);}
return map;};function d3_Map(){this._=Object.create(null);}
var d3_map_proto="__proto__",d3_map_zero="\x00";d3_class(d3_Map,{has:d3_map_has,get:function(key){return this._[d3_map_escape(key)];},set:function(key,value){return this._[d3_map_escape(key)]=value;},remove:d3_map_remove,keys:d3_map_keys,values:function(){var values=[];for(var key in this._)values.push(this._[key]);return values;},entries:function(){var entries=[];for(var key in this._)entries.push({key:d3_map_unescape(key),value:this._[key]});return entries;},size:d3_map_size,empty:d3_map_empty,forEach:function(f){for(var key in this._)f.call(this,d3_map_unescape(key),this._[key]);}});function d3_map_escape(key){return(key+="")===d3_map_proto||key[0]===d3_map_zero?d3_map_zero+key:key;}
function d3_map_unescape(key){return(key+="")[0]===d3_map_zero?key.slice(1):key;}
function d3_map_has(key){return d3_map_escape(key)in this._;}
function d3_map_remove(key){return(key=d3_map_escape(key))in this._&&delete this._[key];}
function d3_map_keys(){var keys=[];for(var key in this._)keys.push(d3_map_unescape(key));return keys;}
function d3_map_size(){var size=0;for(var key in this._)++size;return size;}
function d3_map_empty(){for(var key in this._)return false;return true;}
d3.nest=function(){var nest={},keys=[],sortKeys=[],sortValues,rollup;function map(mapType,array,depth){if(depth>=keys.length)return rollup?rollup.call(nest,array):sortValues?array.sort(sortValues):array;var i=-1,n=array.length,key=keys[depth++],keyValue,object,setter,valuesByKey=new d3_Map(),values;while(++i<n){if(values=valuesByKey.get(keyValue=key(object=array[i]))){values.push(object);}else{valuesByKey.set(keyValue,[object]);}}
if(mapType){object=mapType();setter=function(keyValue,values){object.set(keyValue,map(mapType,values,depth));};}else{object={};setter=function(keyValue,values){object[keyValue]=map(mapType,values,depth);};}
valuesByKey.forEach(setter);return object;}
function entries(map,depth){if(depth>=keys.length)return map;var array=[],sortKey=sortKeys[depth++];map.forEach(function(key,keyMap){array.push({key:key,values:entries(keyMap,depth)});});return sortKey?array.sort(function(a,b){return sortKey(a.key,b.key);}):array;}
nest.map=function(array,mapType){return map(mapType,array,0);};nest.entries=function(array){return entries(map(d3.map,array,0),0);};nest.key=function(d){keys.push(d);return nest;};nest.sortKeys=function(order){sortKeys[keys.length-1]=order;return nest;};nest.sortValues=function(order){sortValues=order;return nest;};nest.rollup=function(f){rollup=f;return nest;};return nest;};d3.set=function(array){var set=new d3_Set();if(array)for(var i=0,n=array.length;i<n;++i)set.add(array[i]);return set;};function d3_Set(){this._=Object.create(null);}
d3_class(d3_Set,{has:d3_map_has,add:function(key){this._[d3_map_escape(key+="")]=true;return key;},remove:d3_map_remove,values:d3_map_keys,size:d3_map_size,empty:d3_map_empty,forEach:function(f){for(var key in this._)f.call(this,d3_map_unescape(key));}});d3.behavior={};function d3_identity(d){return d;}
d3.rebind=function(target,source){var i=1,n=arguments.length,method;while(++i<n)target[method=arguments[i]]=d3_rebind(target,source,source[method]);return target;};function d3_rebind(target,source,method){return function(){var value=method.apply(source,arguments);return value===source?target:value;};}
function d3_vendorSymbol(object,name){if(name in object)return name;name=name.charAt(0).toUpperCase()+name.slice(1);for(var i=0,n=d3_vendorPrefixes.length;i<n;++i){var prefixName=d3_vendorPrefixes[i]+name;if(prefixName in object)return prefixName;}}
var d3_vendorPrefixes=["webkit","ms","moz","Moz","o","O"];function d3_noop(){}
d3.dispatch=function(){var dispatch=new d3_dispatch(),i=-1,n=arguments.length;while(++i<n)dispatch[arguments[i]]=d3_dispatch_event(dispatch);return dispatch;};function d3_dispatch(){}
d3_dispatch.prototype.on=function(type,listener){var i=type.indexOf("."),name="";if(i>=0){name=type.slice(i+1);type=type.slice(0,i);}
if(type)return arguments.length<2?this[type].on(name):this[type].on(name,listener);if(arguments.length===2){if(listener==null)for(type in this){if(this.hasOwnProperty(type))this[type].on(name,null);}
return this;}};function d3_dispatch_event(dispatch){var listeners=[],listenerByName=new d3_Map();function event(){var z=listeners,i=-1,n=z.length,l;while(++i<n)if(l=z[i].on)l.apply(this,arguments);return dispatch;}
event.on=function(name,listener){var l=listenerByName.get(name),i;if(arguments.length<2)return l&&l.on;if(l){l.on=null;listeners=listeners.slice(0,i=listeners.indexOf(l)).concat(listeners.slice(i+1));listenerByName.remove(name);}
if(listener)listeners.push(listenerByName.set(name,{on:listener}));return dispatch;};return event;}
d3.event=null;function d3_eventPreventDefault(){d3.event.preventDefault();}
function d3_eventSource(){var e=d3.event,s;while(s=e.sourceEvent)e=s;return e;}
function d3_eventDispatch(target){var dispatch=new d3_dispatch(),i=0,n=arguments.length;while(++i<n)dispatch[arguments[i]]=d3_dispatch_event(dispatch);dispatch.of=function(thiz,argumentz){return function(e1){try{var e0=e1.sourceEvent=d3.event;e1.target=target;d3.event=e1;dispatch[e1.type].apply(thiz,argumentz);}finally{d3.event=e0;}};};return dispatch;}
d3.requote=function(s){return s.replace(d3_requote_re,"\\$&");};var d3_requote_re=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;var d3_subclass={}.__proto__?function(object,prototype){object.__proto__=prototype;}:function(object,prototype){for(var property in prototype)object[property]=prototype[property];};function d3_selection(groups){d3_subclass(groups,d3_selectionPrototype);return groups;}
var d3_select=function(s,n){return n.querySelector(s);},d3_selectAll=function(s,n){return n.querySelectorAll(s);},d3_selectMatches=function(n,s){var d3_selectMatcher=n.matches||n[d3_vendorSymbol(n,"matchesSelector")];d3_selectMatches=function(n,s){return d3_selectMatcher.call(n,s);};return d3_selectMatches(n,s);};if(typeof Sizzle==="function"){d3_select=function(s,n){return Sizzle(s,n)[0]||null;};d3_selectAll=Sizzle;d3_selectMatches=Sizzle.matchesSelector;}
d3.selection=function(){return d3.select(d3_document.documentElement);};var d3_selectionPrototype=d3.selection.prototype=[];d3_selectionPrototype.select=function(selector){var subgroups=[],subgroup,subnode,group,node;selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);subgroup.parentNode=(group=this[j]).parentNode;for(var i=-1,n=group.length;++i<n;){if(node=group[i]){subgroup.push(subnode=selector.call(node,node.__data__,i,j));if(subnode&&"__data__"in node)subnode.__data__=node.__data__;}else{subgroup.push(null);}}}
return d3_selection(subgroups);};function d3_selection_selector(selector){return typeof selector==="function"?selector:function(){return d3_select(selector,this);};}
d3_selectionPrototype.selectAll=function(selector){var subgroups=[],subgroup,node;selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i]){subgroups.push(subgroup=d3_array(selector.call(node,node.__data__,i,j)));subgroup.parentNode=node;}}}
return d3_selection(subgroups);};function d3_selection_selectorAll(selector){return typeof selector==="function"?selector:function(){return d3_selectAll(selector,this);};}
var d3_nsPrefix={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};d3.ns={prefix:d3_nsPrefix,qualify:function(name){var i=name.indexOf(":"),prefix=name;if(i>=0){prefix=name.slice(0,i);name=name.slice(i+1);}
return d3_nsPrefix.hasOwnProperty(prefix)?{space:d3_nsPrefix[prefix],local:name}:name;}};d3_selectionPrototype.attr=function(name,value){if(arguments.length<2){if(typeof name==="string"){var node=this.node();name=d3.ns.qualify(name);return name.local?node.getAttributeNS(name.space,name.local):node.getAttribute(name);}
for(value in name)this.each(d3_selection_attr(value,name[value]));return this;}
return this.each(d3_selection_attr(name,value));};function d3_selection_attr(name,value){name=d3.ns.qualify(name);function attrNull(){this.removeAttribute(name);}
function attrNullNS(){this.removeAttributeNS(name.space,name.local);}
function attrConstant(){this.setAttribute(name,value);}
function attrConstantNS(){this.setAttributeNS(name.space,name.local,value);}
function attrFunction(){var x=value.apply(this,arguments);if(x==null)this.removeAttribute(name);else this.setAttribute(name,x);}
function attrFunctionNS(){var x=value.apply(this,arguments);if(x==null)this.removeAttributeNS(name.space,name.local);else this.setAttributeNS(name.space,name.local,x);}
return value==null?name.local?attrNullNS:attrNull:typeof value==="function"?name.local?attrFunctionNS:attrFunction:name.local?attrConstantNS:attrConstant;}
function d3_collapse(s){return s.trim().replace(/\s+/g," ");}
d3_selectionPrototype.classed=function(name,value){if(arguments.length<2){if(typeof name==="string"){var node=this.node(),n=(name=d3_selection_classes(name)).length,i=-1;if(value=node.classList){while(++i<n)if(!value.contains(name[i]))return false;}else{value=node.getAttribute("class");while(++i<n)if(!d3_selection_classedRe(name[i]).test(value))return false;}
return true;}
for(value in name)this.each(d3_selection_classed(value,name[value]));return this;}
return this.each(d3_selection_classed(name,value));};function d3_selection_classedRe(name){return new RegExp("(?:^|\\s+)"+d3.requote(name)+"(?:\\s+|$)","g");}
function d3_selection_classes(name){return(name+"").trim().split(/^|\s+/);}
function d3_selection_classed(name,value){name=d3_selection_classes(name).map(d3_selection_classedName);var n=name.length;function classedConstant(){var i=-1;while(++i<n)name[i](this,value);}
function classedFunction(){var i=-1,x=value.apply(this,arguments);while(++i<n)name[i](this,x);}
return typeof value==="function"?classedFunction:classedConstant;}
function d3_selection_classedName(name){var re=d3_selection_classedRe(name);return function(node,value){if(c=node.classList)return value?c.add(name):c.remove(name);var c=node.getAttribute("class")||"";if(value){re.lastIndex=0;if(!re.test(c))node.setAttribute("class",d3_collapse(c+" "+name));}else{node.setAttribute("class",d3_collapse(c.replace(re," ")));}};}
d3_selectionPrototype.style=function(name,value,priority){var n=arguments.length;if(n<3){if(typeof name!=="string"){if(n<2)value="";for(priority in name)this.each(d3_selection_style(priority,name[priority],value));return this;}
if(n<2){var node=this.node();return d3_window(node).getComputedStyle(node,null).getPropertyValue(name);}
priority="";}
return this.each(d3_selection_style(name,value,priority));};function d3_selection_style(name,value,priority){function styleNull(){this.style.removeProperty(name);}
function styleConstant(){this.style.setProperty(name,value,priority);}
function styleFunction(){var x=value.apply(this,arguments);if(x==null)this.style.removeProperty(name);else this.style.setProperty(name,x,priority);}
return value==null?styleNull:typeof value==="function"?styleFunction:styleConstant;}
d3_selectionPrototype.property=function(name,value){if(arguments.length<2){if(typeof name==="string")return this.node()[name];for(value in name)this.each(d3_selection_property(value,name[value]));return this;}
return this.each(d3_selection_property(name,value));};function d3_selection_property(name,value){function propertyNull(){delete this[name];}
function propertyConstant(){this[name]=value;}
function propertyFunction(){var x=value.apply(this,arguments);if(x==null)delete this[name];else this[name]=x;}
return value==null?propertyNull:typeof value==="function"?propertyFunction:propertyConstant;}
d3_selectionPrototype.text=function(value){return arguments.length?this.each(typeof value==="function"?function(){var v=value.apply(this,arguments);this.textContent=v==null?"":v;}:value==null?function(){this.textContent="";}:function(){this.textContent=value;}):this.node().textContent;};d3_selectionPrototype.html=function(value){return arguments.length?this.each(typeof value==="function"?function(){var v=value.apply(this,arguments);this.innerHTML=v==null?"":v;}:value==null?function(){this.innerHTML="";}:function(){this.innerHTML=value;}):this.node().innerHTML;};d3_selectionPrototype.append=function(name){name=d3_selection_creator(name);return this.select(function(){return this.appendChild(name.apply(this,arguments));});};function d3_selection_creator(name){function create(){var document=this.ownerDocument,namespace=this.namespaceURI;return namespace?document.createElementNS(namespace,name):document.createElement(name);}
function createNS(){return this.ownerDocument.createElementNS(name.space,name.local);}
return typeof name==="function"?name:(name=d3.ns.qualify(name)).local?createNS:create;}
d3_selectionPrototype.insert=function(name,before){name=d3_selection_creator(name);before=d3_selection_selector(before);return this.select(function(){return this.insertBefore(name.apply(this,arguments),before.apply(this,arguments)||null);});};d3_selectionPrototype.remove=function(){return this.each(d3_selectionRemove);};function d3_selectionRemove(){var parent=this.parentNode;if(parent)parent.removeChild(this);}
d3_selectionPrototype.data=function(value,key){var i=-1,n=this.length,group,node;if(!arguments.length){value=new Array(n=(group=this[0]).length);while(++i<n){if(node=group[i]){value[i]=node.__data__;}}
return value;}
function bind(group,groupData){var i,n=group.length,m=groupData.length,n0=Math.min(n,m),updateNodes=new Array(m),enterNodes=new Array(m),exitNodes=new Array(n),node,nodeData;if(key){var nodeByKeyValue=new d3_Map(),keyValues=new Array(n),keyValue;for(i=-1;++i<n;){if(nodeByKeyValue.has(keyValue=key.call(node=group[i],node.__data__,i))){exitNodes[i]=node;}else{nodeByKeyValue.set(keyValue,node);}
keyValues[i]=keyValue;}
for(i=-1;++i<m;){if(!(node=nodeByKeyValue.get(keyValue=key.call(groupData,nodeData=groupData[i],i)))){enterNodes[i]=d3_selection_dataNode(nodeData);}else if(node!==true){updateNodes[i]=node;node.__data__=nodeData;}
nodeByKeyValue.set(keyValue,true);}
for(i=-1;++i<n;){if(nodeByKeyValue.get(keyValues[i])!==true){exitNodes[i]=group[i];}}}else{for(i=-1;++i<n0;){node=group[i];nodeData=groupData[i];if(node){node.__data__=nodeData;updateNodes[i]=node;}else{enterNodes[i]=d3_selection_dataNode(nodeData);}}
for(;i<m;++i){enterNodes[i]=d3_selection_dataNode(groupData[i]);}
for(;i<n;++i){exitNodes[i]=group[i];}}
enterNodes.update=updateNodes;enterNodes.parentNode=updateNodes.parentNode=exitNodes.parentNode=group.parentNode;enter.push(enterNodes);update.push(updateNodes);exit.push(exitNodes);}
var enter=d3_selection_enter([]),update=d3_selection([]),exit=d3_selection([]);if(typeof value==="function"){while(++i<n){bind(group=this[i],value.call(group,group.parentNode.__data__,i));}}else{while(++i<n){bind(group=this[i],value);}}
update.enter=function(){return enter;};update.exit=function(){return exit;};return update;};function d3_selection_dataNode(data){return{__data__:data};}
d3_selectionPrototype.datum=function(value){return arguments.length?this.property("__data__",value):this.property("__data__");};d3_selectionPrototype.filter=function(filter){var subgroups=[],subgroup,group,node;if(typeof filter!=="function")filter=d3_selection_filter(filter);for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);subgroup.parentNode=(group=this[j]).parentNode;for(var i=0,n=group.length;i<n;i++){if((node=group[i])&&filter.call(node,node.__data__,i,j)){subgroup.push(node);}}}
return d3_selection(subgroups);};function d3_selection_filter(selector){return function(){return d3_selectMatches(this,selector);};}
d3_selectionPrototype.order=function(){for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=group.length-1,next=group[i],node;--i>=0;){if(node=group[i]){if(next&&next!==node.nextSibling)next.parentNode.insertBefore(node,next);next=node;}}}
return this;};d3_selectionPrototype.sort=function(comparator){comparator=d3_selection_sortComparator.apply(this,arguments);for(var j=-1,m=this.length;++j<m;)this[j].sort(comparator);return this.order();};function d3_selection_sortComparator(comparator){if(!arguments.length)comparator=d3_ascending;return function(a,b){return a&&b?comparator(a.__data__,b.__data__):!a-!b;};}
d3_selectionPrototype.each=function(callback){return d3_selection_each(this,function(node,i,j){callback.call(node,node.__data__,i,j);});};function d3_selection_each(groups,callback){for(var j=0,m=groups.length;j<m;j++){for(var group=groups[j],i=0,n=group.length,node;i<n;i++){if(node=group[i])callback(node,i,j);}}
return groups;}
d3_selectionPrototype.call=function(callback){var args=d3_array(arguments);callback.apply(args[0]=this,args);return this;};d3_selectionPrototype.empty=function(){return!this.node();};d3_selectionPrototype.node=function(){for(var j=0,m=this.length;j<m;j++){for(var group=this[j],i=0,n=group.length;i<n;i++){var node=group[i];if(node)return node;}}
return null;};d3_selectionPrototype.size=function(){var n=0;d3_selection_each(this,function(){++n;});return n;};function d3_selection_enter(selection){d3_subclass(selection,d3_selection_enterPrototype);return selection;}
var d3_selection_enterPrototype=[];d3.selection.enter=d3_selection_enter;d3.selection.enter.prototype=d3_selection_enterPrototype;d3_selection_enterPrototype.append=d3_selectionPrototype.append;d3_selection_enterPrototype.empty=d3_selectionPrototype.empty;d3_selection_enterPrototype.node=d3_selectionPrototype.node;d3_selection_enterPrototype.call=d3_selectionPrototype.call;d3_selection_enterPrototype.size=d3_selectionPrototype.size;d3_selection_enterPrototype.select=function(selector){var subgroups=[],subgroup,subnode,upgroup,group,node;for(var j=-1,m=this.length;++j<m;){upgroup=(group=this[j]).update;subgroups.push(subgroup=[]);subgroup.parentNode=group.parentNode;for(var i=-1,n=group.length;++i<n;){if(node=group[i]){subgroup.push(upgroup[i]=subnode=selector.call(group.parentNode,node.__data__,i,j));subnode.__data__=node.__data__;}else{subgroup.push(null);}}}
return d3_selection(subgroups);};d3_selection_enterPrototype.insert=function(name,before){if(arguments.length<2)before=d3_selection_enterInsertBefore(this);return d3_selectionPrototype.insert.call(this,name,before);};function d3_selection_enterInsertBefore(enter){var i0,j0;return function(d,i,j){var group=enter[j].update,n=group.length,node;if(j!=j0)j0=j,i0=0;if(i>=i0)i0=i+1;while(!(node=group[i0])&&++i0<n);return node;};}
d3.select=function(node){var group;if(typeof node==="string"){group=[d3_select(node,d3_document)];group.parentNode=d3_document.documentElement;}else{group=[node];group.parentNode=d3_documentElement(node);}
return d3_selection([group]);};d3.selectAll=function(nodes){var group;if(typeof nodes==="string"){group=d3_array(d3_selectAll(nodes,d3_document));group.parentNode=d3_document.documentElement;}else{group=nodes;group.parentNode=null;}
return d3_selection([group]);};d3_selectionPrototype.on=function(type,listener,capture){var n=arguments.length;if(n<3){if(typeof type!=="string"){if(n<2)listener=false;for(capture in type)this.each(d3_selection_on(capture,type[capture],listener));return this;}
if(n<2)return(n=this.node()["__on"+type])&&n._;capture=false;}
return this.each(d3_selection_on(type,listener,capture));};function d3_selection_on(type,listener,capture){var name="__on"+type,i=type.indexOf("."),wrap=d3_selection_onListener;if(i>0)type=type.slice(0,i);var filter=d3_selection_onFilters.get(type);if(filter)type=filter,wrap=d3_selection_onFilter;function onRemove(){var l=this[name];if(l){this.removeEventListener(type,l,l.$);delete this[name];}}
function onAdd(){var l=wrap(listener,d3_array(arguments));onRemove.call(this);this.addEventListener(type,this[name]=l,l.$=capture);l._=listener;}
function removeAll(){var re=new RegExp("^__on([^.]+)"+d3.requote(type)+"$"),match;for(var name in this){if(match=name.match(re)){var l=this[name];this.removeEventListener(match[1],l,l.$);delete this[name];}}}
return i?listener?onAdd:onRemove:listener?d3_noop:removeAll;}
var d3_selection_onFilters=d3.map({mouseenter:"mouseover",mouseleave:"mouseout"});if(d3_document){d3_selection_onFilters.forEach(function(k){if("on"+k in d3_document)d3_selection_onFilters.remove(k);});}
function d3_selection_onListener(listener,argumentz){return function(e){var o=d3.event;d3.event=e;argumentz[0]=this.__data__;try{listener.apply(this,argumentz);}finally{d3.event=o;}};}
function d3_selection_onFilter(listener,argumentz){var l=d3_selection_onListener(listener,argumentz);return function(e){var target=this,related=e.relatedTarget;if(!related||related!==target&&!(related.compareDocumentPosition(target)&8)){l.call(target,e);}};}
var d3_event_dragSelect,d3_event_dragId=0;function d3_event_dragSuppress(node){var name=".dragsuppress-"+ ++d3_event_dragId,click="click"+name,w=d3.select(d3_window(node)).on("touchmove"+name,d3_eventPreventDefault).on("dragstart"+name,d3_eventPreventDefault).on("selectstart"+name,d3_eventPreventDefault);if(d3_event_dragSelect==null){d3_event_dragSelect="onselectstart"in node?false:d3_vendorSymbol(node.style,"userSelect");}
if(d3_event_dragSelect){var style=d3_documentElement(node).style,select=style[d3_event_dragSelect];style[d3_event_dragSelect]="none";}
return function(suppressClick){w.on(name,null);if(d3_event_dragSelect)style[d3_event_dragSelect]=select;if(suppressClick){var off=function(){w.on(click,null);};w.on(click,function(){d3_eventPreventDefault();off();},true);setTimeout(off,0);}};}
d3.mouse=function(container){return d3_mousePoint(container,d3_eventSource());};var d3_mouse_bug44083=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;function d3_mousePoint(container,e){if(e.changedTouches)e=e.changedTouches[0];var svg=container.ownerSVGElement||container;if(svg.createSVGPoint){var point=svg.createSVGPoint();if(d3_mouse_bug44083<0){var window=d3_window(container);if(window.scrollX||window.scrollY){svg=d3.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var ctm=svg[0][0].getScreenCTM();d3_mouse_bug44083=!(ctm.f||ctm.e);svg.remove();}}
if(d3_mouse_bug44083)point.x=e.pageX,point.y=e.pageY;else point.x=e.clientX,point.y=e.clientY;point=point.matrixTransform(container.getScreenCTM().inverse());return[point.x,point.y];}
var rect=container.getBoundingClientRect();return[e.clientX-rect.left-container.clientLeft,e.clientY-rect.top-container.clientTop];}
d3.touch=function(container,touches,identifier){if(arguments.length<3)identifier=touches,touches=d3_eventSource().changedTouches;if(touches)for(var i=0,n=touches.length,touch;i<n;++i){if((touch=touches[i]).identifier===identifier){return d3_mousePoint(container,touch);}}};d3.behavior.drag=function(){var event=d3_eventDispatch(drag,"drag","dragstart","dragend"),origin=null,mousedown=dragstart(d3_noop,d3.mouse,d3_window,"mousemove","mouseup"),touchstart=dragstart(d3_behavior_dragTouchId,d3.touch,d3_identity,"touchmove","touchend");function drag(){this.on("mousedown.drag",mousedown).on("touchstart.drag",touchstart);}
function dragstart(id,position,subject,move,end){return function(){var that=this,target=d3.event.target,parent=that.parentNode,dispatch=event.of(that,arguments),dragged=0,dragId=id(),dragName=".drag"+(dragId==null?"":"-"+dragId),dragOffset,dragSubject=d3.select(subject(target)).on(move+dragName,moved).on(end+dragName,ended),dragRestore=d3_event_dragSuppress(target),position0=position(parent,dragId);if(origin){dragOffset=origin.apply(that,arguments);dragOffset=[dragOffset.x-position0[0],dragOffset.y-position0[1]];}else{dragOffset=[0,0];}
dispatch({type:"dragstart"});function moved(){var position1=position(parent,dragId),dx,dy;if(!position1)return;dx=position1[0]-position0[0];dy=position1[1]-position0[1];dragged|=dx|dy;position0=position1;dispatch({type:"drag",x:position1[0]+dragOffset[0],y:position1[1]+dragOffset[1],dx:dx,dy:dy});}
function ended(){if(!position(parent,dragId))return;dragSubject.on(move+dragName,null).on(end+dragName,null);dragRestore(dragged&&d3.event.target===target);dispatch({type:"dragend"});}};}
drag.origin=function(x){if(!arguments.length)return origin;origin=x;return drag;};return d3.rebind(drag,event,"on");};function d3_behavior_dragTouchId(){return d3.event.changedTouches[0].identifier;}
d3.touches=function(container,touches){if(arguments.length<2)touches=d3_eventSource().touches;return touches?d3_array(touches).map(function(touch){var point=d3_mousePoint(container,touch);point.identifier=touch.identifier;return point;}):[];};var ε=1e-6,ε2=ε*ε,π=Math.PI,τ=2*π,τε=τ-ε,halfπ=π/2,d3_radians=π/180,d3_degrees=180/π;function d3_sgn(x){return x>0?1:x<0?-1:0;}
function d3_cross2d(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(b[1]-a[1])*(c[0]-a[0]);}
function d3_acos(x){return x>1?0:x<-1?π:Math.acos(x);}
function d3_asin(x){return x>1?halfπ:x<-1?-halfπ:Math.asin(x);}
function d3_sinh(x){return((x=Math.exp(x))-1/x)/2;}
function d3_cosh(x){return((x=Math.exp(x))+1/x)/2;}
function d3_tanh(x){return((x=Math.exp(2*x))-1)/(x+1);}
function d3_haversin(x){return(x=Math.sin(x/2))*x;}
var ρ=Math.SQRT2,ρ2=2,ρ4=4;d3.interpolateZoom=function(p0,p1){var ux0=p0[0],uy0=p0[1],w0=p0[2],ux1=p1[0],uy1=p1[1],w1=p1[2];var dx=ux1-ux0,dy=uy1-uy0,d2=dx*dx+dy*dy,d1=Math.sqrt(d2),b0=(w1*w1-w0*w0+ρ4*d2)/(2*w0*ρ2*d1),b1=(w1*w1-w0*w0-ρ4*d2)/(2*w1*ρ2*d1),r0=Math.log(Math.sqrt(b0*b0+1)-b0),r1=Math.log(Math.sqrt(b1*b1+1)-b1),dr=r1-r0,S=(dr||Math.log(w1/w0))/ρ;function interpolate(t){var s=t*S;if(dr){var coshr0=d3_cosh(r0),u=w0/(ρ2*d1)*(coshr0*d3_tanh(ρ*s+r0)-d3_sinh(r0));return[ux0+u*dx,uy0+u*dy,w0*coshr0/d3_cosh(ρ*s+r0)];}
return[ux0+t*dx,uy0+t*dy,w0*Math.exp(ρ*s)];}
interpolate.duration=S*1e3;return interpolate;};d3.behavior.zoom=function(){var view={x:0,y:0,k:1},translate0,center0,center,size=[960,500],scaleExtent=d3_behavior_zoomInfinity,duration=250,zooming=0,mousedown="mousedown.zoom",mousemove="mousemove.zoom",mouseup="mouseup.zoom",mousewheelTimer,touchstart="touchstart.zoom",touchtime,event=d3_eventDispatch(zoom,"zoomstart","zoom","zoomend"),x0,x1,y0,y1;if(!d3_behavior_zoomWheel){d3_behavior_zoomWheel="onwheel"in d3_document?(d3_behavior_zoomDelta=function(){return-d3.event.deltaY*(d3.event.deltaMode?120:1);},"wheel"):"onmousewheel"in d3_document?(d3_behavior_zoomDelta=function(){return d3.event.wheelDelta;},"mousewheel"):(d3_behavior_zoomDelta=function(){return-d3.event.detail;},"MozMousePixelScroll");}
function zoom(g){g.on(mousedown,mousedowned).on(d3_behavior_zoomWheel+".zoom",mousewheeled).on("dblclick.zoom",dblclicked).on(touchstart,touchstarted);}
zoom.event=function(g){g.each(function(){var dispatch=event.of(this,arguments),view1=view;if(d3_transitionInheritId){d3.select(this).transition().each("start.zoom",function(){view=this.__chart__||{x:0,y:0,k:1};zoomstarted(dispatch);}).tween("zoom:zoom",function(){var dx=size[0],dy=size[1],cx=center0?center0[0]:dx/2,cy=center0?center0[1]:dy/2,i=d3.interpolateZoom([(cx-view.x)/view.k,(cy-view.y)/view.k,dx/view.k],[(cx-view1.x)/view1.k,(cy-view1.y)/view1.k,dx/view1.k]);return function(t){var l=i(t),k=dx/l[2];this.__chart__=view={x:cx-l[0]*k,y:cy-l[1]*k,k:k};zoomed(dispatch);};}).each("interrupt.zoom",function(){zoomended(dispatch);}).each("end.zoom",function(){zoomended(dispatch);});}else{this.__chart__=view;zoomstarted(dispatch);zoomed(dispatch);zoomended(dispatch);}});};zoom.translate=function(_){if(!arguments.length)return[view.x,view.y];view={x:+_[0],y:+_[1],k:view.k};rescale();return zoom;};zoom.scale=function(_){if(!arguments.length)return view.k;view={x:view.x,y:view.y,k:+_};rescale();return zoom;};zoom.scaleExtent=function(_){if(!arguments.length)return scaleExtent;scaleExtent=_==null?d3_behavior_zoomInfinity:[+_[0],+_[1]];return zoom;};zoom.center=function(_){if(!arguments.length)return center;center=_&&[+_[0],+_[1]];return zoom;};zoom.size=function(_){if(!arguments.length)return size;size=_&&[+_[0],+_[1]];return zoom;};zoom.duration=function(_){if(!arguments.length)return duration;duration=+_;return zoom;};zoom.x=function(z){if(!arguments.length)return x1;x1=z;x0=z.copy();view={x:0,y:0,k:1};return zoom;};zoom.y=function(z){if(!arguments.length)return y1;y1=z;y0=z.copy();view={x:0,y:0,k:1};return zoom;};function location(p){return[(p[0]-view.x)/view.k,(p[1]-view.y)/view.k];}
function point(l){return[l[0]*view.k+view.x,l[1]*view.k+view.y];}
function scaleTo(s){view.k=Math.max(scaleExtent[0],Math.min(scaleExtent[1],s));}
function translateTo(p,l){l=point(l);view.x+=p[0]-l[0];view.y+=p[1]-l[1];}
function zoomTo(that,p,l,k){that.__chart__={x:view.x,y:view.y,k:view.k};scaleTo(Math.pow(2,k));translateTo(center0=p,l);that=d3.select(that);if(duration>0)that=that.transition().duration(duration);that.call(zoom.event);}
function rescale(){if(x1)x1.domain(x0.range().map(function(x){return(x-view.x)/view.k;}).map(x0.invert));if(y1)y1.domain(y0.range().map(function(y){return(y-view.y)/view.k;}).map(y0.invert));}
function zoomstarted(dispatch){if(!zooming++)dispatch({type:"zoomstart"});}
function zoomed(dispatch){rescale();dispatch({type:"zoom",scale:view.k,translate:[view.x,view.y]});}
function zoomended(dispatch){if(!--zooming)dispatch({type:"zoomend"}),center0=null;}
function mousedowned(){var that=this,target=d3.event.target,dispatch=event.of(that,arguments),dragged=0,subject=d3.select(d3_window(that)).on(mousemove,moved).on(mouseup,ended),location0=location(d3.mouse(that)),dragRestore=d3_event_dragSuppress(that);d3_selection_interrupt.call(that);zoomstarted(dispatch);function moved(){dragged=1;translateTo(d3.mouse(that),location0);zoomed(dispatch);}
function ended(){subject.on(mousemove,null).on(mouseup,null);dragRestore(dragged&&d3.event.target===target);zoomended(dispatch);}}
function touchstarted(){var that=this,dispatch=event.of(that,arguments),locations0={},distance0=0,scale0,zoomName=".zoom-"+d3.event.changedTouches[0].identifier,touchmove="touchmove"+zoomName,touchend="touchend"+zoomName,targets=[],subject=d3.select(that),dragRestore=d3_event_dragSuppress(that);started();zoomstarted(dispatch);subject.on(mousedown,null).on(touchstart,started);function relocate(){var touches=d3.touches(that);scale0=view.k;touches.forEach(function(t){if(t.identifier in locations0)locations0[t.identifier]=location(t);});return touches;}
function started(){var target=d3.event.target;d3.select(target).on(touchmove,moved).on(touchend,ended);targets.push(target);var changed=d3.event.changedTouches;for(var i=0,n=changed.length;i<n;++i){locations0[changed[i].identifier]=null;}
var touches=relocate(),now=Date.now();if(touches.length===1){if(now-touchtime<500){var p=touches[0];zoomTo(that,p,locations0[p.identifier],Math.floor(Math.log(view.k)/Math.LN2)+1);d3_eventPreventDefault();}
touchtime=now;}else if(touches.length>1){var p=touches[0],q=touches[1],dx=p[0]-q[0],dy=p[1]-q[1];distance0=dx*dx+dy*dy;}}
function moved(){var touches=d3.touches(that),p0,l0,p1,l1;d3_selection_interrupt.call(that);for(var i=0,n=touches.length;i<n;++i,l1=null){p1=touches[i];if(l1=locations0[p1.identifier]){if(l0)break;p0=p1,l0=l1;}}
if(l1){var distance1=(distance1=p1[0]-p0[0])*distance1+(distance1=p1[1]-p0[1])*distance1,scale1=distance0&&Math.sqrt(distance1/distance0);p0=[(p0[0]+p1[0])/2,(p0[1]+p1[1])/2];l0=[(l0[0]+l1[0])/2,(l0[1]+l1[1])/2];scaleTo(scale1*scale0);}
touchtime=null;translateTo(p0,l0);zoomed(dispatch);}
function ended(){if(d3.event.touches.length){var changed=d3.event.changedTouches;for(var i=0,n=changed.length;i<n;++i){delete locations0[changed[i].identifier];}
for(var identifier in locations0){return void relocate();}}
d3.selectAll(targets).on(zoomName,null);subject.on(mousedown,mousedowned).on(touchstart,touchstarted);dragRestore();zoomended(dispatch);}}
function mousewheeled(){var dispatch=event.of(this,arguments);if(mousewheelTimer)clearTimeout(mousewheelTimer);else d3_selection_interrupt.call(this),translate0=location(center0=center||d3.mouse(this)),zoomstarted(dispatch);mousewheelTimer=setTimeout(function(){mousewheelTimer=null;zoomended(dispatch);},50);d3_eventPreventDefault();scaleTo(Math.pow(2,d3_behavior_zoomDelta()*.002)*view.k);translateTo(center0,translate0);zoomed(dispatch);}
function dblclicked(){var p=d3.mouse(this),k=Math.log(view.k)/Math.LN2;zoomTo(this,p,location(p),d3.event.shiftKey?Math.ceil(k)-1:Math.floor(k)+1);}
return d3.rebind(zoom,event,"on");};var d3_behavior_zoomInfinity=[0,Infinity],d3_behavior_zoomDelta,d3_behavior_zoomWheel;d3.color=d3_color;function d3_color(){}
d3_color.prototype.toString=function(){return this.rgb()+"";};d3.hsl=d3_hsl;function d3_hsl(h,s,l){return this instanceof d3_hsl?void(this.h=+h,this.s=+s,this.l=+l):arguments.length<2?h instanceof d3_hsl?new d3_hsl(h.h,h.s,h.l):d3_rgb_parse(""+h,d3_rgb_hsl,d3_hsl):new d3_hsl(h,s,l);}
var d3_hslPrototype=d3_hsl.prototype=new d3_color();d3_hslPrototype.brighter=function(k){k=Math.pow(.7,arguments.length?k:1);return new d3_hsl(this.h,this.s,this.l/k);};d3_hslPrototype.darker=function(k){k=Math.pow(.7,arguments.length?k:1);return new d3_hsl(this.h,this.s,k*this.l);};d3_hslPrototype.rgb=function(){return d3_hsl_rgb(this.h,this.s,this.l);};function d3_hsl_rgb(h,s,l){var m1,m2;h=isNaN(h)?0:(h%=360)<0?h+360:h;s=isNaN(s)?0:s<0?0:s>1?1:s;l=l<0?0:l>1?1:l;m2=l<=.5?l*(1+s):l+s-l*s;m1=2*l-m2;function v(h){if(h>360)h-=360;else if(h<0)h+=360;if(h<60)return m1+(m2-m1)*h/60;if(h<180)return m2;if(h<240)return m1+(m2-m1)*(240-h)/60;return m1;}
function vv(h){return Math.round(v(h)*255);}
return new d3_rgb(vv(h+120),vv(h),vv(h-120));}
d3.hcl=d3_hcl;function d3_hcl(h,c,l){return this instanceof d3_hcl?void(this.h=+h,this.c=+c,this.l=+l):arguments.length<2?h instanceof d3_hcl?new d3_hcl(h.h,h.c,h.l):h instanceof d3_lab?d3_lab_hcl(h.l,h.a,h.b):d3_lab_hcl((h=d3_rgb_lab((h=d3.rgb(h)).r,h.g,h.b)).l,h.a,h.b):new d3_hcl(h,c,l);}
var d3_hclPrototype=d3_hcl.prototype=new d3_color();d3_hclPrototype.brighter=function(k){return new d3_hcl(this.h,this.c,Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)));};d3_hclPrototype.darker=function(k){return new d3_hcl(this.h,this.c,Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)));};d3_hclPrototype.rgb=function(){return d3_hcl_lab(this.h,this.c,this.l).rgb();};function d3_hcl_lab(h,c,l){if(isNaN(h))h=0;if(isNaN(c))c=0;return new d3_lab(l,Math.cos(h*=d3_radians)*c,Math.sin(h)*c);}
d3.lab=d3_lab;function d3_lab(l,a,b){return this instanceof d3_lab?void(this.l=+l,this.a=+a,this.b=+b):arguments.length<2?l instanceof d3_lab?new d3_lab(l.l,l.a,l.b):l instanceof d3_hcl?d3_hcl_lab(l.h,l.c,l.l):d3_rgb_lab((l=d3_rgb(l)).r,l.g,l.b):new d3_lab(l,a,b);}
var d3_lab_K=18;var d3_lab_X=.95047,d3_lab_Y=1,d3_lab_Z=1.08883;var d3_labPrototype=d3_lab.prototype=new d3_color();d3_labPrototype.brighter=function(k){return new d3_lab(Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)),this.a,this.b);};d3_labPrototype.darker=function(k){return new d3_lab(Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)),this.a,this.b);};d3_labPrototype.rgb=function(){return d3_lab_rgb(this.l,this.a,this.b);};function d3_lab_rgb(l,a,b){var y=(l+16)/116,x=y+a/500,z=y-b/200;x=d3_lab_xyz(x)*d3_lab_X;y=d3_lab_xyz(y)*d3_lab_Y;z=d3_lab_xyz(z)*d3_lab_Z;return new d3_rgb(d3_xyz_rgb(3.2404542*x-1.5371385*y-.4985314*z),d3_xyz_rgb(-.969266*x+1.8760108*y+.041556*z),d3_xyz_rgb(.0556434*x-.2040259*y+1.0572252*z));}
function d3_lab_hcl(l,a,b){return l>0?new d3_hcl(Math.atan2(b,a)*d3_degrees,Math.sqrt(a*a+b*b),l):new d3_hcl(NaN,NaN,l);}
function d3_lab_xyz(x){return x>.206893034?x*x*x:(x-4/29)/7.787037;}
function d3_xyz_lab(x){return x>.008856?Math.pow(x,1/3):7.787037*x+4/29;}
function d3_xyz_rgb(r){return Math.round(255*(r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055));}
d3.rgb=d3_rgb;function d3_rgb(r,g,b){return this instanceof d3_rgb?void(this.r=~~r,this.g=~~g,this.b=~~b):arguments.length<2?r instanceof d3_rgb?new d3_rgb(r.r,r.g,r.b):d3_rgb_parse(""+r,d3_rgb,d3_hsl_rgb):new d3_rgb(r,g,b);}
function d3_rgbNumber(value){return new d3_rgb(value>>16,value>>8&255,value&255);}
function d3_rgbString(value){return d3_rgbNumber(value)+"";}
var d3_rgbPrototype=d3_rgb.prototype=new d3_color();d3_rgbPrototype.brighter=function(k){k=Math.pow(.7,arguments.length?k:1);var r=this.r,g=this.g,b=this.b,i=30;if(!r&&!g&&!b)return new d3_rgb(i,i,i);if(r&&r<i)r=i;if(g&&g<i)g=i;if(b&&b<i)b=i;return new d3_rgb(Math.min(255,r/k),Math.min(255,g/k),Math.min(255,b/k));};d3_rgbPrototype.darker=function(k){k=Math.pow(.7,arguments.length?k:1);return new d3_rgb(k*this.r,k*this.g,k*this.b);};d3_rgbPrototype.hsl=function(){return d3_rgb_hsl(this.r,this.g,this.b);};d3_rgbPrototype.toString=function(){return"#"+d3_rgb_hex(this.r)+d3_rgb_hex(this.g)+d3_rgb_hex(this.b);};function d3_rgb_hex(v){return v<16?"0"+Math.max(0,v).toString(16):Math.min(255,v).toString(16);}
function d3_rgb_parse(format,rgb,hsl){var r=0,g=0,b=0,m1,m2,color;m1=/([a-z]+)\((.*)\)/.exec(format=format.toLowerCase());if(m1){m2=m1[2].split(",");switch(m1[1]){case"hsl":{return hsl(parseFloat(m2[0]),parseFloat(m2[1])/100,parseFloat(m2[2])/100);}
case"rgb":{return rgb(d3_rgb_parseNumber(m2[0]),d3_rgb_parseNumber(m2[1]),d3_rgb_parseNumber(m2[2]));}}}
if(color=d3_rgb_names.get(format)){return rgb(color.r,color.g,color.b);}
if(format!=null&&format.charAt(0)==="#"&&!isNaN(color=parseInt(format.slice(1),16))){if(format.length===4){r=(color&3840)>>4;r=r>>4|r;g=color&240;g=g>>4|g;b=color&15;b=b<<4|b;}else if(format.length===7){r=(color&16711680)>>16;g=(color&65280)>>8;b=color&255;}}
return rgb(r,g,b);}
function d3_rgb_hsl(r,g,b){var min=Math.min(r/=255,g/=255,b/=255),max=Math.max(r,g,b),d=max-min,h,s,l=(max+min)/2;if(d){s=l<.5?d/(max+min):d/(2-max-min);if(r==max)h=(g-b)/d+(g<b?6:0);else if(g==max)h=(b-r)/d+2;else h=(r-g)/d+4;h*=60;}else{h=NaN;s=l>0&&l<1?0:h;}
return new d3_hsl(h,s,l);}
function d3_rgb_lab(r,g,b){r=d3_rgb_xyz(r);g=d3_rgb_xyz(g);b=d3_rgb_xyz(b);var x=d3_xyz_lab((.4124564*r+.3575761*g+.1804375*b)/d3_lab_X),y=d3_xyz_lab((.2126729*r+.7151522*g+.072175*b)/d3_lab_Y),z=d3_xyz_lab((.0193339*r+.119192*g+.9503041*b)/d3_lab_Z);return d3_lab(116*y-16,500*(x-y),200*(y-z));}
function d3_rgb_xyz(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4);}
function d3_rgb_parseNumber(c){var f=parseFloat(c);return c.charAt(c.length-1)==="%"?Math.round(f*2.55):f;}
var d3_rgb_names=d3.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});d3_rgb_names.forEach(function(key,value){d3_rgb_names.set(key,d3_rgbNumber(value));});function d3_functor(v){return typeof v==="function"?v:function(){return v;};}
d3.functor=d3_functor;d3.xhr=d3_xhrType(d3_identity);function d3_xhrType(response){return function(url,mimeType,callback){if(arguments.length===2&&typeof mimeType==="function")callback=mimeType,mimeType=null;return d3_xhr(url,mimeType,response,callback);};}
function d3_xhr(url,mimeType,response,callback){var xhr={},dispatch=d3.dispatch("beforesend","progress","load","error"),headers={},request=new XMLHttpRequest(),responseType=null;if(this.XDomainRequest&&!("withCredentials"in request)&&/^(http(s)?:)?\/\//.test(url))request=new XDomainRequest();"onload"in request?request.onload=request.onerror=respond:request.onreadystatechange=function(){request.readyState>3&&respond();};function respond(){var status=request.status,result;if(!status&&d3_xhrHasResponse(request)||status>=200&&status<300||status===304){try{result=response.call(xhr,request);}catch(e){dispatch.error.call(xhr,e);return;}
dispatch.load.call(xhr,result);}else{dispatch.error.call(xhr,request);}}
request.onprogress=function(event){var o=d3.event;d3.event=event;try{dispatch.progress.call(xhr,request);}finally{d3.event=o;}};xhr.header=function(name,value){name=(name+"").toLowerCase();if(arguments.length<2)return headers[name];if(value==null)delete headers[name];else headers[name]=value+"";return xhr;};xhr.mimeType=function(value){if(!arguments.length)return mimeType;mimeType=value==null?null:value+"";return xhr;};xhr.responseType=function(value){if(!arguments.length)return responseType;responseType=value;return xhr;};xhr.response=function(value){response=value;return xhr;};["get","post"].forEach(function(method){xhr[method]=function(){return xhr.send.apply(xhr,[method].concat(d3_array(arguments)));};});xhr.send=function(method,data,callback){if(arguments.length===2&&typeof data==="function")callback=data,data=null;request.open(method,url,true);if(mimeType!=null&&!("accept"in headers))headers["accept"]=mimeType+",*/*";if(request.setRequestHeader)for(var name in headers)request.setRequestHeader(name,headers[name]);if(mimeType!=null&&request.overrideMimeType)request.overrideMimeType(mimeType);if(responseType!=null)request.responseType=responseType;if(callback!=null)xhr.on("error",callback).on("load",function(request){callback(null,request);});dispatch.beforesend.call(xhr,request);request.send(data==null?null:data);return xhr;};xhr.abort=function(){request.abort();return xhr;};d3.rebind(xhr,dispatch,"on");return callback==null?xhr:xhr.get(d3_xhr_fixCallback(callback));}
function d3_xhr_fixCallback(callback){return callback.length===1?function(error,request){callback(error==null?request:null);}:callback;}
function d3_xhrHasResponse(request){var type=request.responseType;return type&&type!=="text"?request.response:request.responseText;}
d3.dsv=function(delimiter,mimeType){var reFormat=new RegExp('["'+delimiter+"\n]"),delimiterCode=delimiter.charCodeAt(0);function dsv(url,row,callback){if(arguments.length<3)callback=row,row=null;var xhr=d3_xhr(url,mimeType,row==null?response:typedResponse(row),callback);xhr.row=function(_){return arguments.length?xhr.response((row=_)==null?response:typedResponse(_)):row;};return xhr;}
function response(request){return dsv.parse(request.responseText);}
function typedResponse(f){return function(request){return dsv.parse(request.responseText,f);};}
dsv.parse=function(text,f){var o;return dsv.parseRows(text,function(row,i){if(o)return o(row,i-1);var a=new Function("d","return {"+row.map(function(name,i){return JSON.stringify(name)+": d["+i+"]";}).join(",")+"}");o=f?function(row,i){return f(a(row),i);}:a;});};dsv.parseRows=function(text,f){var EOL={},EOF={},rows=[],N=text.length,I=0,n=0,t,eol;function token(){if(I>=N)return EOF;if(eol)return eol=false,EOL;var j=I;if(text.charCodeAt(j)===34){var i=j;while(i++<N){if(text.charCodeAt(i)===34){if(text.charCodeAt(i+1)!==34)break;++i;}}
I=i+2;var c=text.charCodeAt(i+1);if(c===13){eol=true;if(text.charCodeAt(i+2)===10)++I;}else if(c===10){eol=true;}
return text.slice(j+1,i).replace(/""/g,'"');}
while(I<N){var c=text.charCodeAt(I++),k=1;if(c===10)eol=true;else if(c===13){eol=true;if(text.charCodeAt(I)===10)++I,++k;}else if(c!==delimiterCode)continue;return text.slice(j,I-k);}
return text.slice(j);}
while((t=token())!==EOF){var a=[];while(t!==EOL&&t!==EOF){a.push(t);t=token();}
if(f&&(a=f(a,n++))==null)continue;rows.push(a);}
return rows;};dsv.format=function(rows){if(Array.isArray(rows[0]))return dsv.formatRows(rows);var fieldSet=new d3_Set(),fields=[];rows.forEach(function(row){for(var field in row){if(!fieldSet.has(field)){fields.push(fieldSet.add(field));}}});return[fields.map(formatValue).join(delimiter)].concat(rows.map(function(row){return fields.map(function(field){return formatValue(row[field]);}).join(delimiter);})).join("\n");};dsv.formatRows=function(rows){return rows.map(formatRow).join("\n");};function formatRow(row){return row.map(formatValue).join(delimiter);}
function formatValue(text){return reFormat.test(text)?'"'+text.replace(/\"/g,'""')+'"':text;}
return dsv;};d3.csv=d3.dsv(",","text/csv");d3.tsv=d3.dsv("	","text/tab-separated-values");var d3_timer_queueHead,d3_timer_queueTail,d3_timer_interval,d3_timer_timeout,d3_timer_active,d3_timer_frame=this[d3_vendorSymbol(this,"requestAnimationFrame")]||function(callback){setTimeout(callback,17);};d3.timer=function(callback,delay,then){var n=arguments.length;if(n<2)delay=0;if(n<3)then=Date.now();var time=then+delay,timer={c:callback,t:time,f:false,n:null};if(d3_timer_queueTail)d3_timer_queueTail.n=timer;else d3_timer_queueHead=timer;d3_timer_queueTail=timer;if(!d3_timer_interval){d3_timer_timeout=clearTimeout(d3_timer_timeout);d3_timer_interval=1;d3_timer_frame(d3_timer_step);}};function d3_timer_step(){var now=d3_timer_mark(),delay=d3_timer_sweep()-now;if(delay>24){if(isFinite(delay)){clearTimeout(d3_timer_timeout);d3_timer_timeout=setTimeout(d3_timer_step,delay);}
d3_timer_interval=0;}else{d3_timer_interval=1;d3_timer_frame(d3_timer_step);}}
d3.timer.flush=function(){d3_timer_mark();d3_timer_sweep();};function d3_timer_mark(){var now=Date.now();d3_timer_active=d3_timer_queueHead;while(d3_timer_active){if(now>=d3_timer_active.t)d3_timer_active.f=d3_timer_active.c(now-d3_timer_active.t);d3_timer_active=d3_timer_active.n;}
return now;}
function d3_timer_sweep(){var t0,t1=d3_timer_queueHead,time=Infinity;while(t1){if(t1.f){t1=t0?t0.n=t1.n:d3_timer_queueHead=t1.n;}else{if(t1.t<time)time=t1.t;t1=(t0=t1).n;}}
d3_timer_queueTail=t0;return time;}
function d3_format_precision(x,p){return p-(x?Math.ceil(Math.log(x)/Math.LN10):1);}
d3.round=function(x,n){return n?Math.round(x*(n=Math.pow(10,n)))/n:Math.round(x);};var d3_formatPrefixes=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(d3_formatPrefix);d3.formatPrefix=function(value,precision){var i=0;if(value){if(value<0)value*=-1;if(precision)value=d3.round(value,d3_format_precision(value,precision));i=1+Math.floor(1e-12+Math.log(value)/Math.LN10);i=Math.max(-24,Math.min(24,Math.floor((i-1)/3)*3));}
return d3_formatPrefixes[8+i/3];};function d3_formatPrefix(d,i){var k=Math.pow(10,abs(8-i)*3);return{scale:i>8?function(d){return d/k;}:function(d){return d*k;},symbol:d};}
function d3_locale_numberFormat(locale){var locale_decimal=locale.decimal,locale_thousands=locale.thousands,locale_grouping=locale.grouping,locale_currency=locale.currency,formatGroup=locale_grouping&&locale_thousands?function(value,width){var i=value.length,t=[],j=0,g=locale_grouping[0],length=0;while(i>0&&g>0){if(length+g+1>width)g=Math.max(1,width-length);t.push(value.substring(i-=g,i+g));if((length+=g+1)>width)break;g=locale_grouping[j=(j+1)%locale_grouping.length];}
return t.reverse().join(locale_thousands);}:d3_identity;return function(specifier){var match=d3_format_re.exec(specifier),fill=match[1]||" ",align=match[2]||">",sign=match[3]||"-",symbol=match[4]||"",zfill=match[5],width=+match[6],comma=match[7],precision=match[8],type=match[9],scale=1,prefix="",suffix="",integer=false,exponent=true;if(precision)precision=+precision.substring(1);if(zfill||fill==="0"&&align==="="){zfill=fill="0";align="=";}
switch(type){case"n":comma=true;type="g";break;case"%":scale=100;suffix="%";type="f";break;case"p":scale=100;suffix="%";type="r";break;case"b":case"o":case"x":case"X":if(symbol==="#")prefix="0"+type.toLowerCase();case"c":exponent=false;case"d":integer=true;precision=0;break;case"s":scale=-1;type="r";break;}
if(symbol==="$")prefix=locale_currency[0],suffix=locale_currency[1];if(type=="r"&&!precision)type="g";if(precision!=null){if(type=="g")precision=Math.max(1,Math.min(21,precision));else if(type=="e"||type=="f")precision=Math.max(0,Math.min(20,precision));}
type=d3_format_types.get(type)||d3_format_typeDefault;var zcomma=zfill&&comma;return function(value){var fullSuffix=suffix;if(integer&&value%1)return"";var negative=value<0||value===0&&1/value<0?(value=-value,"-"):sign==="-"?"":sign;if(scale<0){var unit=d3.formatPrefix(value,precision);value=unit.scale(value);fullSuffix=unit.symbol+suffix;}else{value*=scale;}
value=type(value,precision);var i=value.lastIndexOf("."),before,after;if(i<0){var j=exponent?value.lastIndexOf("e"):-1;if(j<0)before=value,after="";else before=value.substring(0,j),after=value.substring(j);}else{before=value.substring(0,i);after=locale_decimal+value.substring(i+1);}
if(!zfill&&comma)before=formatGroup(before,Infinity);var length=prefix.length+before.length+after.length+(zcomma?0:negative.length),padding=length<width?new Array(length=width-length+1).join(fill):"";if(zcomma)before=formatGroup(padding+before,padding.length?width-after.length:Infinity);negative+=prefix;value=before+after;return(align==="<"?negative+value+padding:align===">"?padding+negative+value:align==="^"?padding.substring(0,length>>=1)+negative+value+padding.substring(length):negative+(zcomma?value:padding+value))+fullSuffix;};};}
var d3_format_re=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i;var d3_format_types=d3.map({b:function(x){return x.toString(2);},c:function(x){return String.fromCharCode(x);},o:function(x){return x.toString(8);},x:function(x){return x.toString(16);},X:function(x){return x.toString(16).toUpperCase();},g:function(x,p){return x.toPrecision(p);},e:function(x,p){return x.toExponential(p);},f:function(x,p){return x.toFixed(p);},r:function(x,p){return(x=d3.round(x,d3_format_precision(x,p))).toFixed(Math.max(0,Math.min(20,d3_format_precision(x*(1+1e-15),p))));}});function d3_format_typeDefault(x){return x+"";}
var d3_time=d3.time={},d3_date=Date;function d3_date_utc(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0]);}
d3_date_utc.prototype={getDate:function(){return this._.getUTCDate();},getDay:function(){return this._.getUTCDay();},getFullYear:function(){return this._.getUTCFullYear();},getHours:function(){return this._.getUTCHours();},getMilliseconds:function(){return this._.getUTCMilliseconds();},getMinutes:function(){return this._.getUTCMinutes();},getMonth:function(){return this._.getUTCMonth();},getSeconds:function(){return this._.getUTCSeconds();},getTime:function(){return this._.getTime();},getTimezoneOffset:function(){return 0;},valueOf:function(){return this._.valueOf();},setDate:function(){d3_time_prototype.setUTCDate.apply(this._,arguments);},setDay:function(){d3_time_prototype.setUTCDay.apply(this._,arguments);},setFullYear:function(){d3_time_prototype.setUTCFullYear.apply(this._,arguments);},setHours:function(){d3_time_prototype.setUTCHours.apply(this._,arguments);},setMilliseconds:function(){d3_time_prototype.setUTCMilliseconds.apply(this._,arguments);},setMinutes:function(){d3_time_prototype.setUTCMinutes.apply(this._,arguments);},setMonth:function(){d3_time_prototype.setUTCMonth.apply(this._,arguments);},setSeconds:function(){d3_time_prototype.setUTCSeconds.apply(this._,arguments);},setTime:function(){d3_time_prototype.setTime.apply(this._,arguments);}};var d3_time_prototype=Date.prototype;function d3_time_interval(local,step,number){function round(date){var d0=local(date),d1=offset(d0,1);return date-d0<d1-date?d0:d1;}
function ceil(date){step(date=local(new d3_date(date-1)),1);return date;}
function offset(date,k){step(date=new d3_date(+date),k);return date;}
function range(t0,t1,dt){var time=ceil(t0),times=[];if(dt>1){while(time<t1){if(!(number(time)%dt))times.push(new Date(+time));step(time,1);}}else{while(time<t1)times.push(new Date(+time)),step(time,1);}
return times;}
function range_utc(t0,t1,dt){try{d3_date=d3_date_utc;var utc=new d3_date_utc();utc._=t0;return range(utc,t1,dt);}finally{d3_date=Date;}}
local.floor=local;local.round=round;local.ceil=ceil;local.offset=offset;local.range=range;var utc=local.utc=d3_time_interval_utc(local);utc.floor=utc;utc.round=d3_time_interval_utc(round);utc.ceil=d3_time_interval_utc(ceil);utc.offset=d3_time_interval_utc(offset);utc.range=range_utc;return local;}
function d3_time_interval_utc(method){return function(date,k){try{d3_date=d3_date_utc;var utc=new d3_date_utc();utc._=date;return method(utc,k)._;}finally{d3_date=Date;}};}
d3_time.year=d3_time_interval(function(date){date=d3_time.day(date);date.setMonth(0,1);return date;},function(date,offset){date.setFullYear(date.getFullYear()+offset);},function(date){return date.getFullYear();});d3_time.years=d3_time.year.range;d3_time.years.utc=d3_time.year.utc.range;d3_time.day=d3_time_interval(function(date){var day=new d3_date(2e3,0);day.setFullYear(date.getFullYear(),date.getMonth(),date.getDate());return day;},function(date,offset){date.setDate(date.getDate()+offset);},function(date){return date.getDate()-1;});d3_time.days=d3_time.day.range;d3_time.days.utc=d3_time.day.utc.range;d3_time.dayOfYear=function(date){var year=d3_time.year(date);return Math.floor((date-year-(date.getTimezoneOffset()-year.getTimezoneOffset())*6e4)/864e5);};["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(day,i){i=7-i;var interval=d3_time[day]=d3_time_interval(function(date){(date=d3_time.day(date)).setDate(date.getDate()-(date.getDay()+i)%7);return date;},function(date,offset){date.setDate(date.getDate()+Math.floor(offset)*7);},function(date){var day=d3_time.year(date).getDay();return Math.floor((d3_time.dayOfYear(date)+(day+i)%7)/7)-(day!==i);});d3_time[day+"s"]=interval.range;d3_time[day+"s"].utc=interval.utc.range;d3_time[day+"OfYear"]=function(date){var day=d3_time.year(date).getDay();return Math.floor((d3_time.dayOfYear(date)+(day+i)%7)/7);};});d3_time.week=d3_time.sunday;d3_time.weeks=d3_time.sunday.range;d3_time.weeks.utc=d3_time.sunday.utc.range;d3_time.weekOfYear=d3_time.sundayOfYear;function d3_locale_timeFormat(locale){var locale_dateTime=locale.dateTime,locale_date=locale.date,locale_time=locale.time,locale_periods=locale.periods,locale_days=locale.days,locale_shortDays=locale.shortDays,locale_months=locale.months,locale_shortMonths=locale.shortMonths;function d3_time_format(template){var n=template.length;function format(date){var string=[],i=-1,j=0,c,p,f;while(++i<n){if(template.charCodeAt(i)===37){string.push(template.slice(j,i));if((p=d3_time_formatPads[c=template.charAt(++i)])!=null)c=template.charAt(++i);if(f=d3_time_formats[c])c=f(date,p==null?c==="e"?" ":"0":p);string.push(c);j=i+1;}}
string.push(template.slice(j,i));return string.join("");}
format.parse=function(string){var d={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},i=d3_time_parse(d,template,string,0);if(i!=string.length)return null;if("p"in d)d.H=d.H%12+d.p*12;var localZ=d.Z!=null&&d3_date!==d3_date_utc,date=new(localZ?d3_date_utc:d3_date)();if("j"in d)date.setFullYear(d.y,0,d.j);else if("w"in d&&("W"in d||"U"in d)){date.setFullYear(d.y,0,1);date.setFullYear(d.y,0,"W"in d?(d.w+6)%7+d.W*7-(date.getDay()+5)%7:d.w+d.U*7-(date.getDay()+6)%7);}else date.setFullYear(d.y,d.m,d.d);date.setHours(d.H+(d.Z/100|0),d.M+d.Z%100,d.S,d.L);return localZ?date._:date;};format.toString=function(){return template;};return format;}
function d3_time_parse(date,template,string,j){var c,p,t,i=0,n=template.length,m=string.length;while(i<n){if(j>=m)return-1;c=template.charCodeAt(i++);if(c===37){t=template.charAt(i++);p=d3_time_parsers[t in d3_time_formatPads?template.charAt(i++):t];if(!p||(j=p(date,string,j))<0)return-1;}else if(c!=string.charCodeAt(j++)){return-1;}}
return j;}
d3_time_format.utc=function(template){var local=d3_time_format(template);function format(date){try{d3_date=d3_date_utc;var utc=new d3_date();utc._=date;return local(utc);}finally{d3_date=Date;}}
format.parse=function(string){try{d3_date=d3_date_utc;var date=local.parse(string);return date&&date._;}finally{d3_date=Date;}};format.toString=local.toString;return format;};d3_time_format.multi=d3_time_format.utc.multi=d3_time_formatMulti;var d3_time_periodLookup=d3.map(),d3_time_dayRe=d3_time_formatRe(locale_days),d3_time_dayLookup=d3_time_formatLookup(locale_days),d3_time_dayAbbrevRe=d3_time_formatRe(locale_shortDays),d3_time_dayAbbrevLookup=d3_time_formatLookup(locale_shortDays),d3_time_monthRe=d3_time_formatRe(locale_months),d3_time_monthLookup=d3_time_formatLookup(locale_months),d3_time_monthAbbrevRe=d3_time_formatRe(locale_shortMonths),d3_time_monthAbbrevLookup=d3_time_formatLookup(locale_shortMonths);locale_periods.forEach(function(p,i){d3_time_periodLookup.set(p.toLowerCase(),i);});var d3_time_formats={a:function(d){return locale_shortDays[d.getDay()];},A:function(d){return locale_days[d.getDay()];},b:function(d){return locale_shortMonths[d.getMonth()];},B:function(d){return locale_months[d.getMonth()];},c:d3_time_format(locale_dateTime),d:function(d,p){return d3_time_formatPad(d.getDate(),p,2);},e:function(d,p){return d3_time_formatPad(d.getDate(),p,2);},H:function(d,p){return d3_time_formatPad(d.getHours(),p,2);},I:function(d,p){return d3_time_formatPad(d.getHours()%12||12,p,2);},j:function(d,p){return d3_time_formatPad(1+d3_time.dayOfYear(d),p,3);},L:function(d,p){return d3_time_formatPad(d.getMilliseconds(),p,3);},m:function(d,p){return d3_time_formatPad(d.getMonth()+1,p,2);},M:function(d,p){return d3_time_formatPad(d.getMinutes(),p,2);},p:function(d){return locale_periods[+(d.getHours()>=12)];},S:function(d,p){return d3_time_formatPad(d.getSeconds(),p,2);},U:function(d,p){return d3_time_formatPad(d3_time.sundayOfYear(d),p,2);},w:function(d){return d.getDay();},W:function(d,p){return d3_time_formatPad(d3_time.mondayOfYear(d),p,2);},x:d3_time_format(locale_date),X:d3_time_format(locale_time),y:function(d,p){return d3_time_formatPad(d.getFullYear()%100,p,2);},Y:function(d,p){return d3_time_formatPad(d.getFullYear()%1e4,p,4);},Z:d3_time_zone,"%":function(){return"%";}};var d3_time_parsers={a:d3_time_parseWeekdayAbbrev,A:d3_time_parseWeekday,b:d3_time_parseMonthAbbrev,B:d3_time_parseMonth,c:d3_time_parseLocaleFull,d:d3_time_parseDay,e:d3_time_parseDay,H:d3_time_parseHour24,I:d3_time_parseHour24,j:d3_time_parseDayOfYear,L:d3_time_parseMilliseconds,m:d3_time_parseMonthNumber,M:d3_time_parseMinutes,p:d3_time_parseAmPm,S:d3_time_parseSeconds,U:d3_time_parseWeekNumberSunday,w:d3_time_parseWeekdayNumber,W:d3_time_parseWeekNumberMonday,x:d3_time_parseLocaleDate,X:d3_time_parseLocaleTime,y:d3_time_parseYear,Y:d3_time_parseFullYear,Z:d3_time_parseZone,"%":d3_time_parseLiteralPercent};function d3_time_parseWeekdayAbbrev(date,string,i){d3_time_dayAbbrevRe.lastIndex=0;var n=d3_time_dayAbbrevRe.exec(string.slice(i));return n?(date.w=d3_time_dayAbbrevLookup.get(n[0].toLowerCase()),i+n[0].length):-1;}
function d3_time_parseWeekday(date,string,i){d3_time_dayRe.lastIndex=0;var n=d3_time_dayRe.exec(string.slice(i));return n?(date.w=d3_time_dayLookup.get(n[0].toLowerCase()),i+n[0].length):-1;}
function d3_time_parseMonthAbbrev(date,string,i){d3_time_monthAbbrevRe.lastIndex=0;var n=d3_time_monthAbbrevRe.exec(string.slice(i));return n?(date.m=d3_time_monthAbbrevLookup.get(n[0].toLowerCase()),i+n[0].length):-1;}
function d3_time_parseMonth(date,string,i){d3_time_monthRe.lastIndex=0;var n=d3_time_monthRe.exec(string.slice(i));return n?(date.m=d3_time_monthLookup.get(n[0].toLowerCase()),i+n[0].length):-1;}
function d3_time_parseLocaleFull(date,string,i){return d3_time_parse(date,d3_time_formats.c.toString(),string,i);}
function d3_time_parseLocaleDate(date,string,i){return d3_time_parse(date,d3_time_formats.x.toString(),string,i);}
function d3_time_parseLocaleTime(date,string,i){return d3_time_parse(date,d3_time_formats.X.toString(),string,i);}
function d3_time_parseAmPm(date,string,i){var n=d3_time_periodLookup.get(string.slice(i,i+=2).toLowerCase());return n==null?-1:(date.p=n,i);}
return d3_time_format;}
var d3_time_formatPads={"-":"",_:" ","0":"0"},d3_time_numberRe=/^\s*\d+/,d3_time_percentRe=/^%/;function d3_time_formatPad(value,fill,width){var sign=value<0?"-":"",string=(sign?-value:value)+"",length=string.length;return sign+(length<width?new Array(width-length+1).join(fill)+string:string);}
function d3_time_formatRe(names){return new RegExp("^(?:"+names.map(d3.requote).join("|")+")","i");}
function d3_time_formatLookup(names){var map=new d3_Map(),i=-1,n=names.length;while(++i<n)map.set(names[i].toLowerCase(),i);return map;}
function d3_time_parseWeekdayNumber(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+1));return n?(date.w=+n[0],i+n[0].length):-1;}
function d3_time_parseWeekNumberSunday(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i));return n?(date.U=+n[0],i+n[0].length):-1;}
function d3_time_parseWeekNumberMonday(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i));return n?(date.W=+n[0],i+n[0].length):-1;}
function d3_time_parseFullYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+4));return n?(date.y=+n[0],i+n[0].length):-1;}
function d3_time_parseYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.y=d3_time_expandYear(+n[0]),i+n[0].length):-1;}
function d3_time_parseZone(date,string,i){return/^[+-]\d{4}$/.test(string=string.slice(i,i+5))?(date.Z=-string,i+5):-1;}
function d3_time_expandYear(d){return d+(d>68?1900:2e3);}
function d3_time_parseMonthNumber(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.m=n[0]-1,i+n[0].length):-1;}
function d3_time_parseDay(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.d=+n[0],i+n[0].length):-1;}
function d3_time_parseDayOfYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+3));return n?(date.j=+n[0],i+n[0].length):-1;}
function d3_time_parseHour24(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.H=+n[0],i+n[0].length):-1;}
function d3_time_parseMinutes(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.M=+n[0],i+n[0].length):-1;}
function d3_time_parseSeconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.S=+n[0],i+n[0].length):-1;}
function d3_time_parseMilliseconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+3));return n?(date.L=+n[0],i+n[0].length):-1;}
function d3_time_zone(d){var z=d.getTimezoneOffset(),zs=z>0?"-":"+",zh=abs(z)/60|0,zm=abs(z)%60;return zs+d3_time_formatPad(zh,"0",2)+d3_time_formatPad(zm,"0",2);}
function d3_time_parseLiteralPercent(date,string,i){d3_time_percentRe.lastIndex=0;var n=d3_time_percentRe.exec(string.slice(i,i+1));return n?i+n[0].length:-1;}
function d3_time_formatMulti(formats){var n=formats.length,i=-1;while(++i<n)formats[i][0]=this(formats[i][0]);return function(date){var i=0,f=formats[i];while(!f[1](date))f=formats[++i];return f[0](date);};}
d3.locale=function(locale){return{numberFormat:d3_locale_numberFormat(locale),timeFormat:d3_locale_timeFormat(locale)};};var d3_locale_enUS=d3.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});d3.format=d3_locale_enUS.numberFormat;d3.geo={};function d3_adder(){}
d3_adder.prototype={s:0,t:0,add:function(y){d3_adderSum(y,this.t,d3_adderTemp);d3_adderSum(d3_adderTemp.s,this.s,this);if(this.s)this.t+=d3_adderTemp.t;else this.s=d3_adderTemp.t;},reset:function(){this.s=this.t=0;},valueOf:function(){return this.s;}};var d3_adderTemp=new d3_adder();function d3_adderSum(a,b,o){var x=o.s=a+b,bv=x-a,av=x-bv;o.t=a-av+(b-bv);}
d3.geo.stream=function(object,listener){if(object&&d3_geo_streamObjectType.hasOwnProperty(object.type)){d3_geo_streamObjectType[object.type](object,listener);}else{d3_geo_streamGeometry(object,listener);}};function d3_geo_streamGeometry(geometry,listener){if(geometry&&d3_geo_streamGeometryType.hasOwnProperty(geometry.type)){d3_geo_streamGeometryType[geometry.type](geometry,listener);}}
var d3_geo_streamObjectType={Feature:function(feature,listener){d3_geo_streamGeometry(feature.geometry,listener);},FeatureCollection:function(object,listener){var features=object.features,i=-1,n=features.length;while(++i<n)d3_geo_streamGeometry(features[i].geometry,listener);}};var d3_geo_streamGeometryType={Sphere:function(object,listener){listener.sphere();},Point:function(object,listener){object=object.coordinates;listener.point(object[0],object[1],object[2]);},MultiPoint:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)object=coordinates[i],listener.point(object[0],object[1],object[2]);},LineString:function(object,listener){d3_geo_streamLine(object.coordinates,listener,0);},MultiLineString:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)d3_geo_streamLine(coordinates[i],listener,0);},Polygon:function(object,listener){d3_geo_streamPolygon(object.coordinates,listener);},MultiPolygon:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)d3_geo_streamPolygon(coordinates[i],listener);},GeometryCollection:function(object,listener){var geometries=object.geometries,i=-1,n=geometries.length;while(++i<n)d3_geo_streamGeometry(geometries[i],listener);}};function d3_geo_streamLine(coordinates,listener,closed){var i=-1,n=coordinates.length-closed,coordinate;listener.lineStart();while(++i<n)coordinate=coordinates[i],listener.point(coordinate[0],coordinate[1],coordinate[2]);listener.lineEnd();}
function d3_geo_streamPolygon(coordinates,listener){var i=-1,n=coordinates.length;listener.polygonStart();while(++i<n)d3_geo_streamLine(coordinates[i],listener,1);listener.polygonEnd();}
d3.geo.area=function(object){d3_geo_areaSum=0;d3.geo.stream(object,d3_geo_area);return d3_geo_areaSum;};var d3_geo_areaSum,d3_geo_areaRingSum=new d3_adder();var d3_geo_area={sphere:function(){d3_geo_areaSum+=4*π;},point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_areaRingSum.reset();d3_geo_area.lineStart=d3_geo_areaRingStart;},polygonEnd:function(){var area=2*d3_geo_areaRingSum;d3_geo_areaSum+=area<0?4*π+area:area;d3_geo_area.lineStart=d3_geo_area.lineEnd=d3_geo_area.point=d3_noop;}};function d3_geo_areaRingStart(){var λ00,φ00,λ0,cosφ0,sinφ0;d3_geo_area.point=function(λ,φ){d3_geo_area.point=nextPoint;λ0=(λ00=λ)*d3_radians,cosφ0=Math.cos(φ=(φ00=φ)*d3_radians/2+π/4),sinφ0=Math.sin(φ);};function nextPoint(λ,φ){λ*=d3_radians;φ=φ*d3_radians/2+π/4;var dλ=λ-λ0,sdλ=dλ>=0?1:-1,adλ=sdλ*dλ,cosφ=Math.cos(φ),sinφ=Math.sin(φ),k=sinφ0*sinφ,u=cosφ0*cosφ+k*Math.cos(adλ),v=k*sdλ*Math.sin(adλ);d3_geo_areaRingSum.add(Math.atan2(v,u));λ0=λ,cosφ0=cosφ,sinφ0=sinφ;}
d3_geo_area.lineEnd=function(){nextPoint(λ00,φ00);};}
function d3_geo_cartesian(spherical){var λ=spherical[0],φ=spherical[1],cosφ=Math.cos(φ);return[cosφ*Math.cos(λ),cosφ*Math.sin(λ),Math.sin(φ)];}
function d3_geo_cartesianDot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2];}
function d3_geo_cartesianCross(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]];}
function d3_geo_cartesianAdd(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];}
function d3_geo_cartesianScale(vector,k){return[vector[0]*k,vector[1]*k,vector[2]*k];}
function d3_geo_cartesianNormalize(d){var l=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);d[0]/=l;d[1]/=l;d[2]/=l;}
function d3_geo_spherical(cartesian){return[Math.atan2(cartesian[1],cartesian[0]),d3_asin(cartesian[2])];}
function d3_geo_sphericalEqual(a,b){return abs(a[0]-b[0])<ε&&abs(a[1]-b[1])<ε;}
d3.geo.bounds=function(){var λ0,φ0,λ1,φ1,λ_,λ__,φ__,p0,dλSum,ranges,range;var bound={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){bound.point=ringPoint;bound.lineStart=ringStart;bound.lineEnd=ringEnd;dλSum=0;d3_geo_area.polygonStart();},polygonEnd:function(){d3_geo_area.polygonEnd();bound.point=point;bound.lineStart=lineStart;bound.lineEnd=lineEnd;if(d3_geo_areaRingSum<0)λ0=-(λ1=180),φ0=-(φ1=90);else if(dλSum>ε)φ1=90;else if(dλSum<-ε)φ0=-90;range[0]=λ0,range[1]=λ1;}};function point(λ,φ){ranges.push(range=[λ0=λ,λ1=λ]);if(φ<φ0)φ0=φ;if(φ>φ1)φ1=φ;}
function linePoint(λ,φ){var p=d3_geo_cartesian([λ*d3_radians,φ*d3_radians]);if(p0){var normal=d3_geo_cartesianCross(p0,p),equatorial=[normal[1],-normal[0],0],inflection=d3_geo_cartesianCross(equatorial,normal);d3_geo_cartesianNormalize(inflection);inflection=d3_geo_spherical(inflection);var dλ=λ-λ_,s=dλ>0?1:-1,λi=inflection[0]*d3_degrees*s,antimeridian=abs(dλ)>180;if(antimeridian^(s*λ_<λi&&λi<s*λ)){var φi=inflection[1]*d3_degrees;if(φi>φ1)φ1=φi;}else if(λi=(λi+360)%360-180,antimeridian^(s*λ_<λi&&λi<s*λ)){var φi=-inflection[1]*d3_degrees;if(φi<φ0)φ0=φi;}else{if(φ<φ0)φ0=φ;if(φ>φ1)φ1=φ;}
if(antimeridian){if(λ<λ_){if(angle(λ0,λ)>angle(λ0,λ1))λ1=λ;}else{if(angle(λ,λ1)>angle(λ0,λ1))λ0=λ;}}else{if(λ1>=λ0){if(λ<λ0)λ0=λ;if(λ>λ1)λ1=λ;}else{if(λ>λ_){if(angle(λ0,λ)>angle(λ0,λ1))λ1=λ;}else{if(angle(λ,λ1)>angle(λ0,λ1))λ0=λ;}}}}else{point(λ,φ);}
p0=p,λ_=λ;}
function lineStart(){bound.point=linePoint;}
function lineEnd(){range[0]=λ0,range[1]=λ1;bound.point=point;p0=null;}
function ringPoint(λ,φ){if(p0){var dλ=λ-λ_;dλSum+=abs(dλ)>180?dλ+(dλ>0?360:-360):dλ;}else λ__=λ,φ__=φ;d3_geo_area.point(λ,φ);linePoint(λ,φ);}
function ringStart(){d3_geo_area.lineStart();}
function ringEnd(){ringPoint(λ__,φ__);d3_geo_area.lineEnd();if(abs(dλSum)>ε)λ0=-(λ1=180);range[0]=λ0,range[1]=λ1;p0=null;}
function angle(λ0,λ1){return(λ1-=λ0)<0?λ1+360:λ1;}
function compareRanges(a,b){return a[0]-b[0];}
function withinRange(x,range){return range[0]<=range[1]?range[0]<=x&&x<=range[1]:x<range[0]||range[1]<x;}
return function(feature){φ1=λ1=-(λ0=φ0=Infinity);ranges=[];d3.geo.stream(feature,bound);var n=ranges.length;if(n){ranges.sort(compareRanges);for(var i=1,a=ranges[0],b,merged=[a];i<n;++i){b=ranges[i];if(withinRange(b[0],a)||withinRange(b[1],a)){if(angle(a[0],b[1])>angle(a[0],a[1]))a[1]=b[1];if(angle(b[0],a[1])>angle(a[0],a[1]))a[0]=b[0];}else{merged.push(a=b);}}
var best=-Infinity,dλ;for(var n=merged.length-1,i=0,a=merged[n],b;i<=n;a=b,++i){b=merged[i];if((dλ=angle(a[1],b[0]))>best)best=dλ,λ0=b[0],λ1=a[1];}}
ranges=range=null;return λ0===Infinity||φ0===Infinity?[[NaN,NaN],[NaN,NaN]]:[[λ0,φ0],[λ1,φ1]];};}();d3.geo.centroid=function(object){d3_geo_centroidW0=d3_geo_centroidW1=d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0;d3.geo.stream(object,d3_geo_centroid);var x=d3_geo_centroidX2,y=d3_geo_centroidY2,z=d3_geo_centroidZ2,m=x*x+y*y+z*z;if(m<ε2){x=d3_geo_centroidX1,y=d3_geo_centroidY1,z=d3_geo_centroidZ1;if(d3_geo_centroidW1<ε)x=d3_geo_centroidX0,y=d3_geo_centroidY0,z=d3_geo_centroidZ0;m=x*x+y*y+z*z;if(m<ε2)return[NaN,NaN];}
return[Math.atan2(y,x)*d3_degrees,d3_asin(z/Math.sqrt(m))*d3_degrees];};var d3_geo_centroidW0,d3_geo_centroidW1,d3_geo_centroidX0,d3_geo_centroidY0,d3_geo_centroidZ0,d3_geo_centroidX1,d3_geo_centroidY1,d3_geo_centroidZ1,d3_geo_centroidX2,d3_geo_centroidY2,d3_geo_centroidZ2;var d3_geo_centroid={sphere:d3_noop,point:d3_geo_centroidPoint,lineStart:d3_geo_centroidLineStart,lineEnd:d3_geo_centroidLineEnd,polygonStart:function(){d3_geo_centroid.lineStart=d3_geo_centroidRingStart;},polygonEnd:function(){d3_geo_centroid.lineStart=d3_geo_centroidLineStart;}};function d3_geo_centroidPoint(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);d3_geo_centroidPointXYZ(cosφ*Math.cos(λ),cosφ*Math.sin(λ),Math.sin(φ));}
function d3_geo_centroidPointXYZ(x,y,z){++d3_geo_centroidW0;d3_geo_centroidX0+=(x-d3_geo_centroidX0)/d3_geo_centroidW0;d3_geo_centroidY0+=(y-d3_geo_centroidY0)/d3_geo_centroidW0;d3_geo_centroidZ0+=(z-d3_geo_centroidZ0)/d3_geo_centroidW0;}
function d3_geo_centroidLineStart(){var x0,y0,z0;d3_geo_centroid.point=function(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);x0=cosφ*Math.cos(λ);y0=cosφ*Math.sin(λ);z0=Math.sin(φ);d3_geo_centroid.point=nextPoint;d3_geo_centroidPointXYZ(x0,y0,z0);};function nextPoint(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians),x=cosφ*Math.cos(λ),y=cosφ*Math.sin(λ),z=Math.sin(φ),w=Math.atan2(Math.sqrt((w=y0*z-z0*y)*w+(w=z0*x-x0*z)*w+(w=x0*y-y0*x)*w),x0*x+y0*y+z0*z);d3_geo_centroidW1+=w;d3_geo_centroidX1+=w*(x0+(x0=x));d3_geo_centroidY1+=w*(y0+(y0=y));d3_geo_centroidZ1+=w*(z0+(z0=z));d3_geo_centroidPointXYZ(x0,y0,z0);}}
function d3_geo_centroidLineEnd(){d3_geo_centroid.point=d3_geo_centroidPoint;}
function d3_geo_centroidRingStart(){var λ00,φ00,x0,y0,z0;d3_geo_centroid.point=function(λ,φ){λ00=λ,φ00=φ;d3_geo_centroid.point=nextPoint;λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);x0=cosφ*Math.cos(λ);y0=cosφ*Math.sin(λ);z0=Math.sin(φ);d3_geo_centroidPointXYZ(x0,y0,z0);};d3_geo_centroid.lineEnd=function(){nextPoint(λ00,φ00);d3_geo_centroid.lineEnd=d3_geo_centroidLineEnd;d3_geo_centroid.point=d3_geo_centroidPoint;};function nextPoint(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians),x=cosφ*Math.cos(λ),y=cosφ*Math.sin(λ),z=Math.sin(φ),cx=y0*z-z0*y,cy=z0*x-x0*z,cz=x0*y-y0*x,m=Math.sqrt(cx*cx+cy*cy+cz*cz),u=x0*x+y0*y+z0*z,v=m&&-d3_acos(u)/m,w=Math.atan2(m,u);d3_geo_centroidX2+=v*cx;d3_geo_centroidY2+=v*cy;d3_geo_centroidZ2+=v*cz;d3_geo_centroidW1+=w;d3_geo_centroidX1+=w*(x0+(x0=x));d3_geo_centroidY1+=w*(y0+(y0=y));d3_geo_centroidZ1+=w*(z0+(z0=z));d3_geo_centroidPointXYZ(x0,y0,z0);}}
function d3_geo_compose(a,b){function compose(x,y){return x=a(x,y),b(x[0],x[1]);}
if(a.invert&&b.invert)compose.invert=function(x,y){return x=b.invert(x,y),x&&a.invert(x[0],x[1]);};return compose;}
function d3_true(){return true;}
function d3_geo_clipPolygon(segments,compare,clipStartInside,interpolate,listener){var subject=[],clip=[];segments.forEach(function(segment){if((n=segment.length-1)<=0)return;var n,p0=segment[0],p1=segment[n];if(d3_geo_sphericalEqual(p0,p1)){listener.lineStart();for(var i=0;i<n;++i)listener.point((p0=segment[i])[0],p0[1]);listener.lineEnd();return;}
var a=new d3_geo_clipPolygonIntersection(p0,segment,null,true),b=new d3_geo_clipPolygonIntersection(p0,null,a,false);a.o=b;subject.push(a);clip.push(b);a=new d3_geo_clipPolygonIntersection(p1,segment,null,false);b=new d3_geo_clipPolygonIntersection(p1,null,a,true);a.o=b;subject.push(a);clip.push(b);});clip.sort(compare);d3_geo_clipPolygonLinkCircular(subject);d3_geo_clipPolygonLinkCircular(clip);if(!subject.length)return;for(var i=0,entry=clipStartInside,n=clip.length;i<n;++i){clip[i].e=entry=!entry;}
var start=subject[0],points,point;while(1){var current=start,isSubject=true;while(current.v)if((current=current.n)===start)return;points=current.z;listener.lineStart();do{current.v=current.o.v=true;if(current.e){if(isSubject){for(var i=0,n=points.length;i<n;++i)listener.point((point=points[i])[0],point[1]);}else{interpolate(current.x,current.n.x,1,listener);}
current=current.n;}else{if(isSubject){points=current.p.z;for(var i=points.length-1;i>=0;--i)listener.point((point=points[i])[0],point[1]);}else{interpolate(current.x,current.p.x,-1,listener);}
current=current.p;}
current=current.o;points=current.z;isSubject=!isSubject;}while(!current.v);listener.lineEnd();}}
function d3_geo_clipPolygonLinkCircular(array){if(!(n=array.length))return;var n,i=0,a=array[0],b;while(++i<n){a.n=b=array[i];b.p=a;a=b;}
a.n=b=array[0];b.p=a;}
function d3_geo_clipPolygonIntersection(point,points,other,entry){this.x=point;this.z=points;this.o=other;this.e=entry;this.v=false;this.n=this.p=null;}
function d3_geo_clip(pointVisible,clipLine,interpolate,clipStart){return function(rotate,listener){var line=clipLine(listener),rotatedClipStart=rotate.invert(clipStart[0],clipStart[1]);var clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){clip.point=pointRing;clip.lineStart=ringStart;clip.lineEnd=ringEnd;segments=[];polygon=[];},polygonEnd:function(){clip.point=point;clip.lineStart=lineStart;clip.lineEnd=lineEnd;segments=d3.merge(segments);var clipStartInside=d3_geo_pointInPolygon(rotatedClipStart,polygon);if(segments.length){if(!polygonStarted)listener.polygonStart(),polygonStarted=true;d3_geo_clipPolygon(segments,d3_geo_clipSort,clipStartInside,interpolate,listener);}else if(clipStartInside){if(!polygonStarted)listener.polygonStart(),polygonStarted=true;listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd();}
if(polygonStarted)listener.polygonEnd(),polygonStarted=false;segments=polygon=null;},sphere:function(){listener.polygonStart();listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd();listener.polygonEnd();}};function point(λ,φ){var point=rotate(λ,φ);if(pointVisible(λ=point[0],φ=point[1]))listener.point(λ,φ);}
function pointLine(λ,φ){var point=rotate(λ,φ);line.point(point[0],point[1]);}
function lineStart(){clip.point=pointLine;line.lineStart();}
function lineEnd(){clip.point=point;line.lineEnd();}
var segments;var buffer=d3_geo_clipBufferListener(),ringListener=clipLine(buffer),polygonStarted=false,polygon,ring;function pointRing(λ,φ){ring.push([λ,φ]);var point=rotate(λ,φ);ringListener.point(point[0],point[1]);}
function ringStart(){ringListener.lineStart();ring=[];}
function ringEnd(){pointRing(ring[0][0],ring[0][1]);ringListener.lineEnd();var clean=ringListener.clean(),ringSegments=buffer.buffer(),segment,n=ringSegments.length;ring.pop();polygon.push(ring);ring=null;if(!n)return;if(clean&1){segment=ringSegments[0];var n=segment.length-1,i=-1,point;if(n>0){if(!polygonStarted)listener.polygonStart(),polygonStarted=true;listener.lineStart();while(++i<n)listener.point((point=segment[i])[0],point[1]);listener.lineEnd();}
return;}
if(n>1&&clean&2)ringSegments.push(ringSegments.pop().concat(ringSegments.shift()));segments.push(ringSegments.filter(d3_geo_clipSegmentLength1));}
return clip;};}
function d3_geo_clipSegmentLength1(segment){return segment.length>1;}
function d3_geo_clipBufferListener(){var lines=[],line;return{lineStart:function(){lines.push(line=[]);},point:function(λ,φ){line.push([λ,φ]);},lineEnd:d3_noop,buffer:function(){var buffer=lines;lines=[];line=null;return buffer;},rejoin:function(){if(lines.length>1)lines.push(lines.pop().concat(lines.shift()));}};}
function d3_geo_clipSort(a,b){return((a=a.x)[0]<0?a[1]-halfπ-ε:halfπ-a[1])-((b=b.x)[0]<0?b[1]-halfπ-ε:halfπ-b[1]);}
var d3_geo_clipAntimeridian=d3_geo_clip(d3_true,d3_geo_clipAntimeridianLine,d3_geo_clipAntimeridianInterpolate,[-π,-π/2]);function d3_geo_clipAntimeridianLine(listener){var λ0=NaN,φ0=NaN,sλ0=NaN,clean;return{lineStart:function(){listener.lineStart();clean=1;},point:function(λ1,φ1){var sλ1=λ1>0?π:-π,dλ=abs(λ1-λ0);if(abs(dλ-π)<ε){listener.point(λ0,φ0=(φ0+φ1)/2>0?halfπ:-halfπ);listener.point(sλ0,φ0);listener.lineEnd();listener.lineStart();listener.point(sλ1,φ0);listener.point(λ1,φ0);clean=0;}else if(sλ0!==sλ1&&dλ>=π){if(abs(λ0-sλ0)<ε)λ0-=sλ0*ε;if(abs(λ1-sλ1)<ε)λ1-=sλ1*ε;φ0=d3_geo_clipAntimeridianIntersect(λ0,φ0,λ1,φ1);listener.point(sλ0,φ0);listener.lineEnd();listener.lineStart();listener.point(sλ1,φ0);clean=0;}
listener.point(λ0=λ1,φ0=φ1);sλ0=sλ1;},lineEnd:function(){listener.lineEnd();λ0=φ0=NaN;},clean:function(){return 2-clean;}};}
function d3_geo_clipAntimeridianIntersect(λ0,φ0,λ1,φ1){var cosφ0,cosφ1,sinλ0_λ1=Math.sin(λ0-λ1);return abs(sinλ0_λ1)>ε?Math.atan((Math.sin(φ0)*(cosφ1=Math.cos(φ1))*Math.sin(λ1)-Math.sin(φ1)*(cosφ0=Math.cos(φ0))*Math.sin(λ0))/(cosφ0*cosφ1*sinλ0_λ1)):(φ0+φ1)/2;}
function d3_geo_clipAntimeridianInterpolate(from,to,direction,listener){var φ;if(from==null){φ=direction*halfπ;listener.point(-π,φ);listener.point(0,φ);listener.point(π,φ);listener.point(π,0);listener.point(π,-φ);listener.point(0,-φ);listener.point(-π,-φ);listener.point(-π,0);listener.point(-π,φ);}else if(abs(from[0]-to[0])>ε){var s=from[0]<to[0]?π:-π;φ=direction*s/2;listener.point(-s,φ);listener.point(0,φ);listener.point(s,φ);}else{listener.point(to[0],to[1]);}}
function d3_geo_pointInPolygon(point,polygon){var meridian=point[0],parallel=point[1],meridianNormal=[Math.sin(meridian),-Math.cos(meridian),0],polarAngle=0,winding=0;d3_geo_areaRingSum.reset();for(var i=0,n=polygon.length;i<n;++i){var ring=polygon[i],m=ring.length;if(!m)continue;var point0=ring[0],λ0=point0[0],φ0=point0[1]/2+π/4,sinφ0=Math.sin(φ0),cosφ0=Math.cos(φ0),j=1;while(true){if(j===m)j=0;point=ring[j];var λ=point[0],φ=point[1]/2+π/4,sinφ=Math.sin(φ),cosφ=Math.cos(φ),dλ=λ-λ0,sdλ=dλ>=0?1:-1,adλ=sdλ*dλ,antimeridian=adλ>π,k=sinφ0*sinφ;d3_geo_areaRingSum.add(Math.atan2(k*sdλ*Math.sin(adλ),cosφ0*cosφ+k*Math.cos(adλ)));polarAngle+=antimeridian?dλ+sdλ*τ:dλ;if(antimeridian^λ0>=meridian^λ>=meridian){var arc=d3_geo_cartesianCross(d3_geo_cartesian(point0),d3_geo_cartesian(point));d3_geo_cartesianNormalize(arc);var intersection=d3_geo_cartesianCross(meridianNormal,arc);d3_geo_cartesianNormalize(intersection);var φarc=(antimeridian^dλ>=0?-1:1)*d3_asin(intersection[2]);if(parallel>φarc||parallel===φarc&&(arc[0]||arc[1])){winding+=antimeridian^dλ>=0?1:-1;}}
if(!j++)break;λ0=λ,sinφ0=sinφ,cosφ0=cosφ,point0=point;}}
return(polarAngle<-ε||polarAngle<ε&&d3_geo_areaRingSum<0)^winding&1;}
function d3_geo_clipCircle(radius){var cr=Math.cos(radius),smallRadius=cr>0,notHemisphere=abs(cr)>ε,interpolate=d3_geo_circleInterpolate(radius,6*d3_radians);return d3_geo_clip(visible,clipLine,interpolate,smallRadius?[0,-radius]:[-π,radius-π]);function visible(λ,φ){return Math.cos(λ)*Math.cos(φ)>cr;}
function clipLine(listener){var point0,c0,v0,v00,clean;return{lineStart:function(){v00=v0=false;clean=1;},point:function(λ,φ){var point1=[λ,φ],point2,v=visible(λ,φ),c=smallRadius?v?0:code(λ,φ):v?code(λ+(λ<0?π:-π),φ):0;if(!point0&&(v00=v0=v))listener.lineStart();if(v!==v0){point2=intersect(point0,point1);if(d3_geo_sphericalEqual(point0,point2)||d3_geo_sphericalEqual(point1,point2)){point1[0]+=ε;point1[1]+=ε;v=visible(point1[0],point1[1]);}}
if(v!==v0){clean=0;if(v){listener.lineStart();point2=intersect(point1,point0);listener.point(point2[0],point2[1]);}else{point2=intersect(point0,point1);listener.point(point2[0],point2[1]);listener.lineEnd();}
point0=point2;}else if(notHemisphere&&point0&&smallRadius^v){var t;if(!(c&c0)&&(t=intersect(point1,point0,true))){clean=0;if(smallRadius){listener.lineStart();listener.point(t[0][0],t[0][1]);listener.point(t[1][0],t[1][1]);listener.lineEnd();}else{listener.point(t[1][0],t[1][1]);listener.lineEnd();listener.lineStart();listener.point(t[0][0],t[0][1]);}}}
if(v&&(!point0||!d3_geo_sphericalEqual(point0,point1))){listener.point(point1[0],point1[1]);}
point0=point1,v0=v,c0=c;},lineEnd:function(){if(v0)listener.lineEnd();point0=null;},clean:function(){return clean|(v00&&v0)<<1;}};}
function intersect(a,b,two){var pa=d3_geo_cartesian(a),pb=d3_geo_cartesian(b);var n1=[1,0,0],n2=d3_geo_cartesianCross(pa,pb),n2n2=d3_geo_cartesianDot(n2,n2),n1n2=n2[0],determinant=n2n2-n1n2*n1n2;if(!determinant)return!two&&a;var c1=cr*n2n2/determinant,c2=-cr*n1n2/determinant,n1xn2=d3_geo_cartesianCross(n1,n2),A=d3_geo_cartesianScale(n1,c1),B=d3_geo_cartesianScale(n2,c2);d3_geo_cartesianAdd(A,B);var u=n1xn2,w=d3_geo_cartesianDot(A,u),uu=d3_geo_cartesianDot(u,u),t2=w*w-uu*(d3_geo_cartesianDot(A,A)-1);if(t2<0)return;var t=Math.sqrt(t2),q=d3_geo_cartesianScale(u,(-w-t)/uu);d3_geo_cartesianAdd(q,A);q=d3_geo_spherical(q);if(!two)return q;var λ0=a[0],λ1=b[0],φ0=a[1],φ1=b[1],z;if(λ1<λ0)z=λ0,λ0=λ1,λ1=z;var δλ=λ1-λ0,polar=abs(δλ-π)<ε,meridian=polar||δλ<ε;if(!polar&&φ1<φ0)z=φ0,φ0=φ1,φ1=z;if(meridian?polar?φ0+φ1>0^q[1]<(abs(q[0]-λ0)<ε?φ0:φ1):φ0<=q[1]&&q[1]<=φ1:δλ>π^(λ0<=q[0]&&q[0]<=λ1)){var q1=d3_geo_cartesianScale(u,(-w+t)/uu);d3_geo_cartesianAdd(q1,A);return[q,d3_geo_spherical(q1)];}}
function code(λ,φ){var r=smallRadius?radius:π-radius,code=0;if(λ<-r)code|=1;else if(λ>r)code|=2;if(φ<-r)code|=4;else if(φ>r)code|=8;return code;}}
function d3_geom_clipLine(x0,y0,x1,y1){return function(line){var a=line.a,b=line.b,ax=a.x,ay=a.y,bx=b.x,by=b.y,t0=0,t1=1,dx=bx-ax,dy=by-ay,r;r=x0-ax;if(!dx&&r>0)return;r/=dx;if(dx<0){if(r<t0)return;if(r<t1)t1=r;}else if(dx>0){if(r>t1)return;if(r>t0)t0=r;}
r=x1-ax;if(!dx&&r<0)return;r/=dx;if(dx<0){if(r>t1)return;if(r>t0)t0=r;}else if(dx>0){if(r<t0)return;if(r<t1)t1=r;}
r=y0-ay;if(!dy&&r>0)return;r/=dy;if(dy<0){if(r<t0)return;if(r<t1)t1=r;}else if(dy>0){if(r>t1)return;if(r>t0)t0=r;}
r=y1-ay;if(!dy&&r<0)return;r/=dy;if(dy<0){if(r>t1)return;if(r>t0)t0=r;}else if(dy>0){if(r<t0)return;if(r<t1)t1=r;}
if(t0>0)line.a={x:ax+t0*dx,y:ay+t0*dy};if(t1<1)line.b={x:ax+t1*dx,y:ay+t1*dy};return line;};}
var d3_geo_clipExtentMAX=1e9;d3.geo.clipExtent=function(){var x0,y0,x1,y1,stream,clip,clipExtent={stream:function(output){if(stream)stream.valid=false;stream=clip(output);stream.valid=true;return stream;},extent:function(_){if(!arguments.length)return[[x0,y0],[x1,y1]];clip=d3_geo_clipExtent(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1]);if(stream)stream.valid=false,stream=null;return clipExtent;}};return clipExtent.extent([[0,0],[960,500]]);};function d3_geo_clipExtent(x0,y0,x1,y1){return function(listener){var listener_=listener,bufferListener=d3_geo_clipBufferListener(),clipLine=d3_geom_clipLine(x0,y0,x1,y1),segments,polygon,ring;var clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){listener=bufferListener;segments=[];polygon=[];clean=true;},polygonEnd:function(){listener=listener_;segments=d3.merge(segments);var clipStartInside=insidePolygon([x0,y1]),inside=clean&&clipStartInside,visible=segments.length;if(inside||visible){listener.polygonStart();if(inside){listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd();}
if(visible){d3_geo_clipPolygon(segments,compare,clipStartInside,interpolate,listener);}
listener.polygonEnd();}
segments=polygon=ring=null;}};function insidePolygon(p){var wn=0,n=polygon.length,y=p[1];for(var i=0;i<n;++i){for(var j=1,v=polygon[i],m=v.length,a=v[0],b;j<m;++j){b=v[j];if(a[1]<=y){if(b[1]>y&&d3_cross2d(a,b,p)>0)++wn;}else{if(b[1]<=y&&d3_cross2d(a,b,p)<0)--wn;}
a=b;}}
return wn!==0;}
function interpolate(from,to,direction,listener){var a=0,a1=0;if(from==null||(a=corner(from,direction))!==(a1=corner(to,direction))||comparePoints(from,to)<0^direction>0){do{listener.point(a===0||a===3?x0:x1,a>1?y1:y0);}while((a=(a+direction+4)%4)!==a1);}else{listener.point(to[0],to[1]);}}
function pointVisible(x,y){return x0<=x&&x<=x1&&y0<=y&&y<=y1;}
function point(x,y){if(pointVisible(x,y))listener.point(x,y);}
var x__,y__,v__,x_,y_,v_,first,clean;function lineStart(){clip.point=linePoint;if(polygon)polygon.push(ring=[]);first=true;v_=false;x_=y_=NaN;}
function lineEnd(){if(segments){linePoint(x__,y__);if(v__&&v_)bufferListener.rejoin();segments.push(bufferListener.buffer());}
clip.point=point;if(v_)listener.lineEnd();}
function linePoint(x,y){x=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,x));y=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,y));var v=pointVisible(x,y);if(polygon)ring.push([x,y]);if(first){x__=x,y__=y,v__=v;first=false;if(v){listener.lineStart();listener.point(x,y);}}else{if(v&&v_)listener.point(x,y);else{var l={a:{x:x_,y:y_},b:{x:x,y:y}};if(clipLine(l)){if(!v_){listener.lineStart();listener.point(l.a.x,l.a.y);}
listener.point(l.b.x,l.b.y);if(!v)listener.lineEnd();clean=false;}else if(v){listener.lineStart();listener.point(x,y);clean=false;}}}
x_=x,y_=y,v_=v;}
return clip;};function corner(p,direction){return abs(p[0]-x0)<ε?direction>0?0:3:abs(p[0]-x1)<ε?direction>0?2:1:abs(p[1]-y0)<ε?direction>0?1:0:direction>0?3:2;}
function compare(a,b){return comparePoints(a.x,b.x);}
function comparePoints(a,b){var ca=corner(a,1),cb=corner(b,1);return ca!==cb?ca-cb:ca===0?b[1]-a[1]:ca===1?a[0]-b[0]:ca===2?a[1]-b[1]:b[0]-a[0];}}
function d3_geo_conic(projectAt){var φ0=0,φ1=π/3,m=d3_geo_projectionMutator(projectAt),p=m(φ0,φ1);p.parallels=function(_){if(!arguments.length)return[φ0/π*180,φ1/π*180];return m(φ0=_[0]*π/180,φ1=_[1]*π/180);};return p;}
function d3_geo_conicEqualArea(φ0,φ1){var sinφ0=Math.sin(φ0),n=(sinφ0+Math.sin(φ1))/2,C=1+sinφ0*(2*n-sinφ0),ρ0=Math.sqrt(C)/n;function forward(λ,φ){var ρ=Math.sqrt(C-2*n*Math.sin(φ))/n;return[ρ*Math.sin(λ*=n),ρ0-ρ*Math.cos(λ)];}
forward.invert=function(x,y){var ρ0_y=ρ0-y;return[Math.atan2(x,ρ0_y)/n,d3_asin((C-(x*x+ρ0_y*ρ0_y)*n*n)/(2*n))];};return forward;}
(d3.geo.conicEqualArea=function(){return d3_geo_conic(d3_geo_conicEqualArea);}).raw=d3_geo_conicEqualArea;d3.geo.albers=function(){return d3.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070);};d3.geo.albersUsa=function(){var lower48=d3.geo.albers();var alaska=d3.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]);var hawaii=d3.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]);var point,pointStream={point:function(x,y){point=[x,y];}},lower48Point,alaskaPoint,hawaiiPoint;function albersUsa(coordinates){var x=coordinates[0],y=coordinates[1];point=null;(lower48Point(x,y),point)||(alaskaPoint(x,y),point)||hawaiiPoint(x,y);return point;}
albersUsa.invert=function(coordinates){var k=lower48.scale(),t=lower48.translate(),x=(coordinates[0]-t[0])/k,y=(coordinates[1]-t[1])/k;return(y>=.12&&y<.234&&x>=-.425&&x<-.214?alaska:y>=.166&&y<.234&&x>=-.214&&x<-.115?hawaii:lower48).invert(coordinates);};albersUsa.stream=function(stream){var lower48Stream=lower48.stream(stream),alaskaStream=alaska.stream(stream),hawaiiStream=hawaii.stream(stream);return{point:function(x,y){lower48Stream.point(x,y);alaskaStream.point(x,y);hawaiiStream.point(x,y);},sphere:function(){lower48Stream.sphere();alaskaStream.sphere();hawaiiStream.sphere();},lineStart:function(){lower48Stream.lineStart();alaskaStream.lineStart();hawaiiStream.lineStart();},lineEnd:function(){lower48Stream.lineEnd();alaskaStream.lineEnd();hawaiiStream.lineEnd();},polygonStart:function(){lower48Stream.polygonStart();alaskaStream.polygonStart();hawaiiStream.polygonStart();},polygonEnd:function(){lower48Stream.polygonEnd();alaskaStream.polygonEnd();hawaiiStream.polygonEnd();}};};albersUsa.precision=function(_){if(!arguments.length)return lower48.precision();lower48.precision(_);alaska.precision(_);hawaii.precision(_);return albersUsa;};albersUsa.scale=function(_){if(!arguments.length)return lower48.scale();lower48.scale(_);alaska.scale(_*.35);hawaii.scale(_);return albersUsa.translate(lower48.translate());};albersUsa.translate=function(_){if(!arguments.length)return lower48.translate();var k=lower48.scale(),x=+_[0],y=+_[1];lower48Point=lower48.translate(_).clipExtent([[x-.455*k,y-.238*k],[x+.455*k,y+.238*k]]).stream(pointStream).point;alaskaPoint=alaska.translate([x-.307*k,y+.201*k]).clipExtent([[x-.425*k+ε,y+.12*k+ε],[x-.214*k-ε,y+.234*k-ε]]).stream(pointStream).point;hawaiiPoint=hawaii.translate([x-.205*k,y+.212*k]).clipExtent([[x-.214*k+ε,y+.166*k+ε],[x-.115*k-ε,y+.234*k-ε]]).stream(pointStream).point;return albersUsa;};return albersUsa.scale(1070);};var d3_geo_pathAreaSum,d3_geo_pathAreaPolygon,d3_geo_pathArea={point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_pathAreaPolygon=0;d3_geo_pathArea.lineStart=d3_geo_pathAreaRingStart;},polygonEnd:function(){d3_geo_pathArea.lineStart=d3_geo_pathArea.lineEnd=d3_geo_pathArea.point=d3_noop;d3_geo_pathAreaSum+=abs(d3_geo_pathAreaPolygon/2);}};function d3_geo_pathAreaRingStart(){var x00,y00,x0,y0;d3_geo_pathArea.point=function(x,y){d3_geo_pathArea.point=nextPoint;x00=x0=x,y00=y0=y;};function nextPoint(x,y){d3_geo_pathAreaPolygon+=y0*x-x0*y;x0=x,y0=y;}
d3_geo_pathArea.lineEnd=function(){nextPoint(x00,y00);};}
var d3_geo_pathBoundsX0,d3_geo_pathBoundsY0,d3_geo_pathBoundsX1,d3_geo_pathBoundsY1;var d3_geo_pathBounds={point:d3_geo_pathBoundsPoint,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop};function d3_geo_pathBoundsPoint(x,y){if(x<d3_geo_pathBoundsX0)d3_geo_pathBoundsX0=x;if(x>d3_geo_pathBoundsX1)d3_geo_pathBoundsX1=x;if(y<d3_geo_pathBoundsY0)d3_geo_pathBoundsY0=y;if(y>d3_geo_pathBoundsY1)d3_geo_pathBoundsY1=y;}
function d3_geo_pathBuffer(){var pointCircle=d3_geo_pathBufferCircle(4.5),buffer=[];var stream={point:point,lineStart:function(){stream.point=pointLineStart;},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon;},polygonEnd:function(){stream.lineEnd=lineEnd;stream.point=point;},pointRadius:function(_){pointCircle=d3_geo_pathBufferCircle(_);return stream;},result:function(){if(buffer.length){var result=buffer.join("");buffer=[];return result;}}};function point(x,y){buffer.push("M",x,",",y,pointCircle);}
function pointLineStart(x,y){buffer.push("M",x,",",y);stream.point=pointLine;}
function pointLine(x,y){buffer.push("L",x,",",y);}
function lineEnd(){stream.point=point;}
function lineEndPolygon(){buffer.push("Z");}
return stream;}
function d3_geo_pathBufferCircle(radius){return"m0,"+radius+"a"+radius+","+radius+" 0 1,1 0,"+-2*radius+"a"+radius+","+radius+" 0 1,1 0,"+2*radius+"z";}
var d3_geo_pathCentroid={point:d3_geo_pathCentroidPoint,lineStart:d3_geo_pathCentroidLineStart,lineEnd:d3_geo_pathCentroidLineEnd,polygonStart:function(){d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidRingStart;},polygonEnd:function(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint;d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidLineStart;d3_geo_pathCentroid.lineEnd=d3_geo_pathCentroidLineEnd;}};function d3_geo_pathCentroidPoint(x,y){d3_geo_centroidX0+=x;d3_geo_centroidY0+=y;++d3_geo_centroidZ0;}
function d3_geo_pathCentroidLineStart(){var x0,y0;d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint;d3_geo_pathCentroidPoint(x0=x,y0=y);};function nextPoint(x,y){var dx=x-x0,dy=y-y0,z=Math.sqrt(dx*dx+dy*dy);d3_geo_centroidX1+=z*(x0+x)/2;d3_geo_centroidY1+=z*(y0+y)/2;d3_geo_centroidZ1+=z;d3_geo_pathCentroidPoint(x0=x,y0=y);}}
function d3_geo_pathCentroidLineEnd(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint;}
function d3_geo_pathCentroidRingStart(){var x00,y00,x0,y0;d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint;d3_geo_pathCentroidPoint(x00=x0=x,y00=y0=y);};function nextPoint(x,y){var dx=x-x0,dy=y-y0,z=Math.sqrt(dx*dx+dy*dy);d3_geo_centroidX1+=z*(x0+x)/2;d3_geo_centroidY1+=z*(y0+y)/2;d3_geo_centroidZ1+=z;z=y0*x-x0*y;d3_geo_centroidX2+=z*(x0+x);d3_geo_centroidY2+=z*(y0+y);d3_geo_centroidZ2+=z*3;d3_geo_pathCentroidPoint(x0=x,y0=y);}
d3_geo_pathCentroid.lineEnd=function(){nextPoint(x00,y00);};}
function d3_geo_pathContext(context){var pointRadius=4.5;var stream={point:point,lineStart:function(){stream.point=pointLineStart;},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon;},polygonEnd:function(){stream.lineEnd=lineEnd;stream.point=point;},pointRadius:function(_){pointRadius=_;return stream;},result:d3_noop};function point(x,y){context.moveTo(x+pointRadius,y);context.arc(x,y,pointRadius,0,τ);}
function pointLineStart(x,y){context.moveTo(x,y);stream.point=pointLine;}
function pointLine(x,y){context.lineTo(x,y);}
function lineEnd(){stream.point=point;}
function lineEndPolygon(){context.closePath();}
return stream;}
function d3_geo_resample(project){var δ2=.5,cosMinDistance=Math.cos(30*d3_radians),maxDepth=16;function resample(stream){return(maxDepth?resampleRecursive:resampleNone)(stream);}
function resampleNone(stream){return d3_geo_transformPoint(stream,function(x,y){x=project(x,y);stream.point(x[0],x[1]);});}
function resampleRecursive(stream){var λ00,φ00,x00,y00,a00,b00,c00,λ0,x0,y0,a0,b0,c0;var resample={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){stream.polygonStart();resample.lineStart=ringStart;},polygonEnd:function(){stream.polygonEnd();resample.lineStart=lineStart;}};function point(x,y){x=project(x,y);stream.point(x[0],x[1]);}
function lineStart(){x0=NaN;resample.point=linePoint;stream.lineStart();}
function linePoint(λ,φ){var c=d3_geo_cartesian([λ,φ]),p=project(λ,φ);resampleLineTo(x0,y0,λ0,a0,b0,c0,x0=p[0],y0=p[1],λ0=λ,a0=c[0],b0=c[1],c0=c[2],maxDepth,stream);stream.point(x0,y0);}
function lineEnd(){resample.point=point;stream.lineEnd();}
function ringStart(){lineStart();resample.point=ringPoint;resample.lineEnd=ringEnd;}
function ringPoint(λ,φ){linePoint(λ00=λ,φ00=φ),x00=x0,y00=y0,a00=a0,b00=b0,c00=c0;resample.point=linePoint;}
function ringEnd(){resampleLineTo(x0,y0,λ0,a0,b0,c0,x00,y00,λ00,a00,b00,c00,maxDepth,stream);resample.lineEnd=lineEnd;lineEnd();}
return resample;}
function resampleLineTo(x0,y0,λ0,a0,b0,c0,x1,y1,λ1,a1,b1,c1,depth,stream){var dx=x1-x0,dy=y1-y0,d2=dx*dx+dy*dy;if(d2>4*δ2&&depth--){var a=a0+a1,b=b0+b1,c=c0+c1,m=Math.sqrt(a*a+b*b+c*c),φ2=Math.asin(c/=m),λ2=abs(abs(c)-1)<ε||abs(λ0-λ1)<ε?(λ0+λ1)/2:Math.atan2(b,a),p=project(λ2,φ2),x2=p[0],y2=p[1],dx2=x2-x0,dy2=y2-y0,dz=dy*dx2-dx*dy2;if(dz*dz/d2>δ2||abs((dx*dx2+dy*dy2)/d2-.5)>.3||a0*a1+b0*b1+c0*c1<cosMinDistance){resampleLineTo(x0,y0,λ0,a0,b0,c0,x2,y2,λ2,a/=m,b/=m,c,depth,stream);stream.point(x2,y2);resampleLineTo(x2,y2,λ2,a,b,c,x1,y1,λ1,a1,b1,c1,depth,stream);}}}
resample.precision=function(_){if(!arguments.length)return Math.sqrt(δ2);maxDepth=(δ2=_*_)>0&&16;return resample;};return resample;}
d3.geo.path=function(){var pointRadius=4.5,projection,context,projectStream,contextStream,cacheStream;function path(object){if(object){if(typeof pointRadius==="function")contextStream.pointRadius(+pointRadius.apply(this,arguments));if(!cacheStream||!cacheStream.valid)cacheStream=projectStream(contextStream);d3.geo.stream(object,cacheStream);}
return contextStream.result();}
path.area=function(object){d3_geo_pathAreaSum=0;d3.geo.stream(object,projectStream(d3_geo_pathArea));return d3_geo_pathAreaSum;};path.centroid=function(object){d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0;d3.geo.stream(object,projectStream(d3_geo_pathCentroid));return d3_geo_centroidZ2?[d3_geo_centroidX2/d3_geo_centroidZ2,d3_geo_centroidY2/d3_geo_centroidZ2]:d3_geo_centroidZ1?[d3_geo_centroidX1/d3_geo_centroidZ1,d3_geo_centroidY1/d3_geo_centroidZ1]:d3_geo_centroidZ0?[d3_geo_centroidX0/d3_geo_centroidZ0,d3_geo_centroidY0/d3_geo_centroidZ0]:[NaN,NaN];};path.bounds=function(object){d3_geo_pathBoundsX1=d3_geo_pathBoundsY1=-(d3_geo_pathBoundsX0=d3_geo_pathBoundsY0=Infinity);d3.geo.stream(object,projectStream(d3_geo_pathBounds));return[[d3_geo_pathBoundsX0,d3_geo_pathBoundsY0],[d3_geo_pathBoundsX1,d3_geo_pathBoundsY1]];};path.projection=function(_){if(!arguments.length)return projection;projectStream=(projection=_)?_.stream||d3_geo_pathProjectStream(_):d3_identity;return reset();};path.context=function(_){if(!arguments.length)return context;contextStream=(context=_)==null?new d3_geo_pathBuffer():new d3_geo_pathContext(_);if(typeof pointRadius!=="function")contextStream.pointRadius(pointRadius);return reset();};path.pointRadius=function(_){if(!arguments.length)return pointRadius;pointRadius=typeof _==="function"?_:(contextStream.pointRadius(+_),+_);return path;};function reset(){cacheStream=null;return path;}
return path.projection(d3.geo.albersUsa()).context(null);};function d3_geo_pathProjectStream(project){var resample=d3_geo_resample(function(x,y){return project([x*d3_degrees,y*d3_degrees]);});return function(stream){return d3_geo_projectionRadians(resample(stream));};}
d3.geo.transform=function(methods){return{stream:function(stream){var transform=new d3_geo_transform(stream);for(var k in methods)transform[k]=methods[k];return transform;}};};function d3_geo_transform(stream){this.stream=stream;}
d3_geo_transform.prototype={point:function(x,y){this.stream.point(x,y);},sphere:function(){this.stream.sphere();},lineStart:function(){this.stream.lineStart();},lineEnd:function(){this.stream.lineEnd();},polygonStart:function(){this.stream.polygonStart();},polygonEnd:function(){this.stream.polygonEnd();}};function d3_geo_transformPoint(stream,point){return{point:point,sphere:function(){stream.sphere();},lineStart:function(){stream.lineStart();},lineEnd:function(){stream.lineEnd();},polygonStart:function(){stream.polygonStart();},polygonEnd:function(){stream.polygonEnd();}};}
d3.geo.projection=d3_geo_projection;d3.geo.projectionMutator=d3_geo_projectionMutator;function d3_geo_projection(project){return d3_geo_projectionMutator(function(){return project;})();}
function d3_geo_projectionMutator(projectAt){var project,rotate,projectRotate,projectResample=d3_geo_resample(function(x,y){x=project(x,y);return[x[0]*k+δx,δy-x[1]*k];}),k=150,x=480,y=250,λ=0,φ=0,δλ=0,δφ=0,δγ=0,δx,δy,preclip=d3_geo_clipAntimeridian,postclip=d3_identity,clipAngle=null,clipExtent=null,stream;function projection(point){point=projectRotate(point[0]*d3_radians,point[1]*d3_radians);return[point[0]*k+δx,δy-point[1]*k];}
function invert(point){point=projectRotate.invert((point[0]-δx)/k,(δy-point[1])/k);return point&&[point[0]*d3_degrees,point[1]*d3_degrees];}
projection.stream=function(output){if(stream)stream.valid=false;stream=d3_geo_projectionRadians(preclip(rotate,projectResample(postclip(output))));stream.valid=true;return stream;};projection.clipAngle=function(_){if(!arguments.length)return clipAngle;preclip=_==null?(clipAngle=_,d3_geo_clipAntimeridian):d3_geo_clipCircle((clipAngle=+_)*d3_radians);return invalidate();};projection.clipExtent=function(_){if(!arguments.length)return clipExtent;clipExtent=_;postclip=_?d3_geo_clipExtent(_[0][0],_[0][1],_[1][0],_[1][1]):d3_identity;return invalidate();};projection.scale=function(_){if(!arguments.length)return k;k=+_;return reset();};projection.translate=function(_){if(!arguments.length)return[x,y];x=+_[0];y=+_[1];return reset();};projection.center=function(_){if(!arguments.length)return[λ*d3_degrees,φ*d3_degrees];λ=_[0]%360*d3_radians;φ=_[1]%360*d3_radians;return reset();};projection.rotate=function(_){if(!arguments.length)return[δλ*d3_degrees,δφ*d3_degrees,δγ*d3_degrees];δλ=_[0]%360*d3_radians;δφ=_[1]%360*d3_radians;δγ=_.length>2?_[2]%360*d3_radians:0;return reset();};d3.rebind(projection,projectResample,"precision");function reset(){projectRotate=d3_geo_compose(rotate=d3_geo_rotation(δλ,δφ,δγ),project);var center=project(λ,φ);δx=x-center[0]*k;δy=y+center[1]*k;return invalidate();}
function invalidate(){if(stream)stream.valid=false,stream=null;return projection;}
return function(){project=projectAt.apply(this,arguments);projection.invert=project.invert&&invert;return reset();};}
function d3_geo_projectionRadians(stream){return d3_geo_transformPoint(stream,function(x,y){stream.point(x*d3_radians,y*d3_radians);});}
function d3_geo_equirectangular(λ,φ){return[λ,φ];}
(d3.geo.equirectangular=function(){return d3_geo_projection(d3_geo_equirectangular);}).raw=d3_geo_equirectangular.invert=d3_geo_equirectangular;d3.geo.rotation=function(rotate){rotate=d3_geo_rotation(rotate[0]%360*d3_radians,rotate[1]*d3_radians,rotate.length>2?rotate[2]*d3_radians:0);function forward(coordinates){coordinates=rotate(coordinates[0]*d3_radians,coordinates[1]*d3_radians);return coordinates[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates;}
forward.invert=function(coordinates){coordinates=rotate.invert(coordinates[0]*d3_radians,coordinates[1]*d3_radians);return coordinates[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates;};return forward;};function d3_geo_identityRotation(λ,φ){return[λ>π?λ-τ:λ<-π?λ+τ:λ,φ];}
d3_geo_identityRotation.invert=d3_geo_equirectangular;function d3_geo_rotation(δλ,δφ,δγ){return δλ?δφ||δγ?d3_geo_compose(d3_geo_rotationλ(δλ),d3_geo_rotationφγ(δφ,δγ)):d3_geo_rotationλ(δλ):δφ||δγ?d3_geo_rotationφγ(δφ,δγ):d3_geo_identityRotation;}
function d3_geo_forwardRotationλ(δλ){return function(λ,φ){return λ+=δλ,[λ>π?λ-τ:λ<-π?λ+τ:λ,φ];};}
function d3_geo_rotationλ(δλ){var rotation=d3_geo_forwardRotationλ(δλ);rotation.invert=d3_geo_forwardRotationλ(-δλ);return rotation;}
function d3_geo_rotationφγ(δφ,δγ){var cosδφ=Math.cos(δφ),sinδφ=Math.sin(δφ),cosδγ=Math.cos(δγ),sinδγ=Math.sin(δγ);function rotation(λ,φ){var cosφ=Math.cos(φ),x=Math.cos(λ)*cosφ,y=Math.sin(λ)*cosφ,z=Math.sin(φ),k=z*cosδφ+x*sinδφ;return[Math.atan2(y*cosδγ-k*sinδγ,x*cosδφ-z*sinδφ),d3_asin(k*cosδγ+y*sinδγ)];}
rotation.invert=function(λ,φ){var cosφ=Math.cos(φ),x=Math.cos(λ)*cosφ,y=Math.sin(λ)*cosφ,z=Math.sin(φ),k=z*cosδγ-y*sinδγ;return[Math.atan2(y*cosδγ+z*sinδγ,x*cosδφ+k*sinδφ),d3_asin(k*cosδφ-x*sinδφ)];};return rotation;}
d3.geo.circle=function(){var origin=[0,0],angle,precision=6,interpolate;function circle(){var center=typeof origin==="function"?origin.apply(this,arguments):origin,rotate=d3_geo_rotation(-center[0]*d3_radians,-center[1]*d3_radians,0).invert,ring=[];interpolate(null,null,1,{point:function(x,y){ring.push(x=rotate(x,y));x[0]*=d3_degrees,x[1]*=d3_degrees;}});return{type:"Polygon",coordinates:[ring]};}
circle.origin=function(x){if(!arguments.length)return origin;origin=x;return circle;};circle.angle=function(x){if(!arguments.length)return angle;interpolate=d3_geo_circleInterpolate((angle=+x)*d3_radians,precision*d3_radians);return circle;};circle.precision=function(_){if(!arguments.length)return precision;interpolate=d3_geo_circleInterpolate(angle*d3_radians,(precision=+_)*d3_radians);return circle;};return circle.angle(90);};function d3_geo_circleInterpolate(radius,precision){var cr=Math.cos(radius),sr=Math.sin(radius);return function(from,to,direction,listener){var step=direction*precision;if(from!=null){from=d3_geo_circleAngle(cr,from);to=d3_geo_circleAngle(cr,to);if(direction>0?from<to:from>to)from+=direction*τ;}else{from=radius+direction*τ;to=radius-.5*step;}
for(var point,t=from;direction>0?t>to:t<to;t-=step){listener.point((point=d3_geo_spherical([cr,-sr*Math.cos(t),-sr*Math.sin(t)]))[0],point[1]);}};}
function d3_geo_circleAngle(cr,point){var a=d3_geo_cartesian(point);a[0]-=cr;d3_geo_cartesianNormalize(a);var angle=d3_acos(-a[1]);return((-a[2]<0?-angle:angle)+2*Math.PI-ε)%(2*Math.PI);}
d3.geo.distance=function(a,b){var Δλ=(b[0]-a[0])*d3_radians,φ0=a[1]*d3_radians,φ1=b[1]*d3_radians,sinΔλ=Math.sin(Δλ),cosΔλ=Math.cos(Δλ),sinφ0=Math.sin(φ0),cosφ0=Math.cos(φ0),sinφ1=Math.sin(φ1),cosφ1=Math.cos(φ1),t;return Math.atan2(Math.sqrt((t=cosφ1*sinΔλ)*t+(t=cosφ0*sinφ1-sinφ0*cosφ1*cosΔλ)*t),sinφ0*sinφ1+cosφ0*cosφ1*cosΔλ);};d3.geo.graticule=function(){var x1,x0,X1,X0,y1,y0,Y1,Y0,dx=10,dy=dx,DX=90,DY=360,x,y,X,Y,precision=2.5;function graticule(){return{type:"MultiLineString",coordinates:lines()};}
function lines(){return d3.range(Math.ceil(X0/DX)*DX,X1,DX).map(X).concat(d3.range(Math.ceil(Y0/DY)*DY,Y1,DY).map(Y)).concat(d3.range(Math.ceil(x0/dx)*dx,x1,dx).filter(function(x){return abs(x%DX)>ε;}).map(x)).concat(d3.range(Math.ceil(y0/dy)*dy,y1,dy).filter(function(y){return abs(y%DY)>ε;}).map(y));}
graticule.lines=function(){return lines().map(function(coordinates){return{type:"LineString",coordinates:coordinates};});};graticule.outline=function(){return{type:"Polygon",coordinates:[X(X0).concat(Y(Y1).slice(1),X(X1).reverse().slice(1),Y(Y0).reverse().slice(1))]};};graticule.extent=function(_){if(!arguments.length)return graticule.minorExtent();return graticule.majorExtent(_).minorExtent(_);};graticule.majorExtent=function(_){if(!arguments.length)return[[X0,Y0],[X1,Y1]];X0=+_[0][0],X1=+_[1][0];Y0=+_[0][1],Y1=+_[1][1];if(X0>X1)_=X0,X0=X1,X1=_;if(Y0>Y1)_=Y0,Y0=Y1,Y1=_;return graticule.precision(precision);};graticule.minorExtent=function(_){if(!arguments.length)return[[x0,y0],[x1,y1]];x0=+_[0][0],x1=+_[1][0];y0=+_[0][1],y1=+_[1][1];if(x0>x1)_=x0,x0=x1,x1=_;if(y0>y1)_=y0,y0=y1,y1=_;return graticule.precision(precision);};graticule.step=function(_){if(!arguments.length)return graticule.minorStep();return graticule.majorStep(_).minorStep(_);};graticule.majorStep=function(_){if(!arguments.length)return[DX,DY];DX=+_[0],DY=+_[1];return graticule;};graticule.minorStep=function(_){if(!arguments.length)return[dx,dy];dx=+_[0],dy=+_[1];return graticule;};graticule.precision=function(_){if(!arguments.length)return precision;precision=+_;x=d3_geo_graticuleX(y0,y1,90);y=d3_geo_graticuleY(x0,x1,precision);X=d3_geo_graticuleX(Y0,Y1,90);Y=d3_geo_graticuleY(X0,X1,precision);return graticule;};return graticule.majorExtent([[-180,-90+ε],[180,90-ε]]).minorExtent([[-180,-80-ε],[180,80+ε]]);};function d3_geo_graticuleX(y0,y1,dy){var y=d3.range(y0,y1-ε,dy).concat(y1);return function(x){return y.map(function(y){return[x,y];});};}
function d3_geo_graticuleY(x0,x1,dx){var x=d3.range(x0,x1-ε,dx).concat(x1);return function(y){return x.map(function(x){return[x,y];});};}
function d3_source(d){return d.source;}
function d3_target(d){return d.target;}
d3.geo.greatArc=function(){var source=d3_source,source_,target=d3_target,target_;function greatArc(){return{type:"LineString",coordinates:[source_||source.apply(this,arguments),target_||target.apply(this,arguments)]};}
greatArc.distance=function(){return d3.geo.distance(source_||source.apply(this,arguments),target_||target.apply(this,arguments));};greatArc.source=function(_){if(!arguments.length)return source;source=_,source_=typeof _==="function"?null:_;return greatArc;};greatArc.target=function(_){if(!arguments.length)return target;target=_,target_=typeof _==="function"?null:_;return greatArc;};greatArc.precision=function(){return arguments.length?greatArc:0;};return greatArc;};d3.geo.interpolate=function(source,target){return d3_geo_interpolate(source[0]*d3_radians,source[1]*d3_radians,target[0]*d3_radians,target[1]*d3_radians);};function d3_geo_interpolate(x0,y0,x1,y1){var cy0=Math.cos(y0),sy0=Math.sin(y0),cy1=Math.cos(y1),sy1=Math.sin(y1),kx0=cy0*Math.cos(x0),ky0=cy0*Math.sin(x0),kx1=cy1*Math.cos(x1),ky1=cy1*Math.sin(x1),d=2*Math.asin(Math.sqrt(d3_haversin(y1-y0)+cy0*cy1*d3_haversin(x1-x0))),k=1/Math.sin(d);var interpolate=d?function(t){var B=Math.sin(t*=d)*k,A=Math.sin(d-t)*k,x=A*kx0+B*kx1,y=A*ky0+B*ky1,z=A*sy0+B*sy1;return[Math.atan2(y,x)*d3_degrees,Math.atan2(z,Math.sqrt(x*x+y*y))*d3_degrees];}:function(){return[x0*d3_degrees,y0*d3_degrees];};interpolate.distance=d;return interpolate;}
d3.geo.length=function(object){d3_geo_lengthSum=0;d3.geo.stream(object,d3_geo_length);return d3_geo_lengthSum;};var d3_geo_lengthSum;var d3_geo_length={sphere:d3_noop,point:d3_noop,lineStart:d3_geo_lengthLineStart,lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop};function d3_geo_lengthLineStart(){var λ0,sinφ0,cosφ0;d3_geo_length.point=function(λ,φ){λ0=λ*d3_radians,sinφ0=Math.sin(φ*=d3_radians),cosφ0=Math.cos(φ);d3_geo_length.point=nextPoint;};d3_geo_length.lineEnd=function(){d3_geo_length.point=d3_geo_length.lineEnd=d3_noop;};function nextPoint(λ,φ){var sinφ=Math.sin(φ*=d3_radians),cosφ=Math.cos(φ),t=abs((λ*=d3_radians)-λ0),cosΔλ=Math.cos(t);d3_geo_lengthSum+=Math.atan2(Math.sqrt((t=cosφ*Math.sin(t))*t+(t=cosφ0*sinφ-sinφ0*cosφ*cosΔλ)*t),sinφ0*sinφ+cosφ0*cosφ*cosΔλ);λ0=λ,sinφ0=sinφ,cosφ0=cosφ;}}
function d3_geo_azimuthal(scale,angle){function azimuthal(λ,φ){var cosλ=Math.cos(λ),cosφ=Math.cos(φ),k=scale(cosλ*cosφ);return[k*cosφ*Math.sin(λ),k*Math.sin(φ)];}
azimuthal.invert=function(x,y){var ρ=Math.sqrt(x*x+y*y),c=angle(ρ),sinc=Math.sin(c),cosc=Math.cos(c);return[Math.atan2(x*sinc,ρ*cosc),Math.asin(ρ&&y*sinc/ρ)];};return azimuthal;}
var d3_geo_azimuthalEqualArea=d3_geo_azimuthal(function(cosλcosφ){return Math.sqrt(2/(1+cosλcosφ));},function(ρ){return 2*Math.asin(ρ/2);});(d3.geo.azimuthalEqualArea=function(){return d3_geo_projection(d3_geo_azimuthalEqualArea);}).raw=d3_geo_azimuthalEqualArea;var d3_geo_azimuthalEquidistant=d3_geo_azimuthal(function(cosλcosφ){var c=Math.acos(cosλcosφ);return c&&c/Math.sin(c);},d3_identity);(d3.geo.azimuthalEquidistant=function(){return d3_geo_projection(d3_geo_azimuthalEquidistant);}).raw=d3_geo_azimuthalEquidistant;function d3_geo_conicConformal(φ0,φ1){var cosφ0=Math.cos(φ0),t=function(φ){return Math.tan(π/4+φ/2);},n=φ0===φ1?Math.sin(φ0):Math.log(cosφ0/Math.cos(φ1))/Math.log(t(φ1)/t(φ0)),F=cosφ0*Math.pow(t(φ0),n)/n;if(!n)return d3_geo_mercator;function forward(λ,φ){if(F>0){if(φ<-halfπ+ε)φ=-halfπ+ε;}else{if(φ>halfπ-ε)φ=halfπ-ε;}
var ρ=F/Math.pow(t(φ),n);return[ρ*Math.sin(n*λ),F-ρ*Math.cos(n*λ)];}
forward.invert=function(x,y){var ρ0_y=F-y,ρ=d3_sgn(n)*Math.sqrt(x*x+ρ0_y*ρ0_y);return[Math.atan2(x,ρ0_y)/n,2*Math.atan(Math.pow(F/ρ,1/n))-halfπ];};return forward;}
(d3.geo.conicConformal=function(){return d3_geo_conic(d3_geo_conicConformal);}).raw=d3_geo_conicConformal;function d3_geo_conicEquidistant(φ0,φ1){var cosφ0=Math.cos(φ0),n=φ0===φ1?Math.sin(φ0):(cosφ0-Math.cos(φ1))/(φ1-φ0),G=cosφ0/n+φ0;if(abs(n)<ε)return d3_geo_equirectangular;function forward(λ,φ){var ρ=G-φ;return[ρ*Math.sin(n*λ),G-ρ*Math.cos(n*λ)];}
forward.invert=function(x,y){var ρ0_y=G-y;return[Math.atan2(x,ρ0_y)/n,G-d3_sgn(n)*Math.sqrt(x*x+ρ0_y*ρ0_y)];};return forward;}
(d3.geo.conicEquidistant=function(){return d3_geo_conic(d3_geo_conicEquidistant);}).raw=d3_geo_conicEquidistant;var d3_geo_gnomonic=d3_geo_azimuthal(function(cosλcosφ){return 1/cosλcosφ;},Math.atan);(d3.geo.gnomonic=function(){return d3_geo_projection(d3_geo_gnomonic);}).raw=d3_geo_gnomonic;function d3_geo_mercator(λ,φ){return[λ,Math.log(Math.tan(π/4+φ/2))];}
d3_geo_mercator.invert=function(x,y){return[x,2*Math.atan(Math.exp(y))-halfπ];};function d3_geo_mercatorProjection(project){var m=d3_geo_projection(project),scale=m.scale,translate=m.translate,clipExtent=m.clipExtent,clipAuto;m.scale=function(){var v=scale.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v;};m.translate=function(){var v=translate.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v;};m.clipExtent=function(_){var v=clipExtent.apply(m,arguments);if(v===m){if(clipAuto=_==null){var k=π*scale(),t=translate();clipExtent([[t[0]-k,t[1]-k],[t[0]+k,t[1]+k]]);}}else if(clipAuto){v=null;}
return v;};return m.clipExtent(null);}
(d3.geo.mercator=function(){return d3_geo_mercatorProjection(d3_geo_mercator);}).raw=d3_geo_mercator;var d3_geo_orthographic=d3_geo_azimuthal(function(){return 1;},Math.asin);(d3.geo.orthographic=function(){return d3_geo_projection(d3_geo_orthographic);}).raw=d3_geo_orthographic;var d3_geo_stereographic=d3_geo_azimuthal(function(cosλcosφ){return 1/(1+cosλcosφ);},function(ρ){return 2*Math.atan(ρ);});(d3.geo.stereographic=function(){return d3_geo_projection(d3_geo_stereographic);}).raw=d3_geo_stereographic;function d3_geo_transverseMercator(λ,φ){return[Math.log(Math.tan(π/4+φ/2)),-λ];}
d3_geo_transverseMercator.invert=function(x,y){return[-y,2*Math.atan(Math.exp(x))-halfπ];};(d3.geo.transverseMercator=function(){var projection=d3_geo_mercatorProjection(d3_geo_transverseMercator),center=projection.center,rotate=projection.rotate;projection.center=function(_){return _?center([-_[1],_[0]]):(_=center(),[_[1],-_[0]]);};projection.rotate=function(_){return _?rotate([_[0],_[1],_.length>2?_[2]+90:90]):(_=rotate(),[_[0],_[1],_[2]-90]);};return rotate([0,0,90]);}).raw=d3_geo_transverseMercator;d3.geom={};function d3_geom_pointX(d){return d[0];}
function d3_geom_pointY(d){return d[1];}
d3.geom.hull=function(vertices){var x=d3_geom_pointX,y=d3_geom_pointY;if(arguments.length)return hull(vertices);function hull(data){if(data.length<3)return[];var fx=d3_functor(x),fy=d3_functor(y),i,n=data.length,points=[],flippedPoints=[];for(i=0;i<n;i++){points.push([+fx.call(this,data[i],i),+fy.call(this,data[i],i),i]);}
points.sort(d3_geom_hullOrder);for(i=0;i<n;i++)flippedPoints.push([points[i][0],-points[i][1]]);var upper=d3_geom_hullUpper(points),lower=d3_geom_hullUpper(flippedPoints);var skipLeft=lower[0]===upper[0],skipRight=lower[lower.length-1]===upper[upper.length-1],polygon=[];for(i=upper.length-1;i>=0;--i)polygon.push(data[points[upper[i]][2]]);for(i=+skipLeft;i<lower.length-skipRight;++i)polygon.push(data[points[lower[i]][2]]);return polygon;}
hull.x=function(_){return arguments.length?(x=_,hull):x;};hull.y=function(_){return arguments.length?(y=_,hull):y;};return hull;};function d3_geom_hullUpper(points){var n=points.length,hull=[0,1],hs=2;for(var i=2;i<n;i++){while(hs>1&&d3_cross2d(points[hull[hs-2]],points[hull[hs-1]],points[i])<=0)--hs;hull[hs++]=i;}
return hull.slice(0,hs);}
function d3_geom_hullOrder(a,b){return a[0]-b[0]||a[1]-b[1];}
d3.geom.polygon=function(coordinates){d3_subclass(coordinates,d3_geom_polygonPrototype);return coordinates;};var d3_geom_polygonPrototype=d3.geom.polygon.prototype=[];d3_geom_polygonPrototype.area=function(){var i=-1,n=this.length,a,b=this[n-1],area=0;while(++i<n){a=b;b=this[i];area+=a[1]*b[0]-a[0]*b[1];}
return area*.5;};d3_geom_polygonPrototype.centroid=function(k){var i=-1,n=this.length,x=0,y=0,a,b=this[n-1],c;if(!arguments.length)k=-1/(6*this.area());while(++i<n){a=b;b=this[i];c=a[0]*b[1]-b[0]*a[1];x+=(a[0]+b[0])*c;y+=(a[1]+b[1])*c;}
return[x*k,y*k];};d3_geom_polygonPrototype.clip=function(subject){var input,closed=d3_geom_polygonClosed(subject),i=-1,n=this.length-d3_geom_polygonClosed(this),j,m,a=this[n-1],b,c,d;while(++i<n){input=subject.slice();subject.length=0;b=this[i];c=input[(m=input.length-closed)-1];j=-1;while(++j<m){d=input[j];if(d3_geom_polygonInside(d,a,b)){if(!d3_geom_polygonInside(c,a,b)){subject.push(d3_geom_polygonIntersect(c,d,a,b));}
subject.push(d);}else if(d3_geom_polygonInside(c,a,b)){subject.push(d3_geom_polygonIntersect(c,d,a,b));}
c=d;}
if(closed)subject.push(subject[0]);a=b;}
return subject;};function d3_geom_polygonInside(p,a,b){return(b[0]-a[0])*(p[1]-a[1])<(b[1]-a[1])*(p[0]-a[0]);}
function d3_geom_polygonIntersect(c,d,a,b){var x1=c[0],x3=a[0],x21=d[0]-x1,x43=b[0]-x3,y1=c[1],y3=a[1],y21=d[1]-y1,y43=b[1]-y3,ua=(x43*(y1-y3)-y43*(x1-x3))/(y43*x21-x43*y21);return[x1+ua*x21,y1+ua*y21];}
function d3_geom_polygonClosed(coordinates){var a=coordinates[0],b=coordinates[coordinates.length-1];return!(a[0]-b[0]||a[1]-b[1]);}
var d3_geom_voronoiEdges,d3_geom_voronoiCells,d3_geom_voronoiBeaches,d3_geom_voronoiBeachPool=[],d3_geom_voronoiFirstCircle,d3_geom_voronoiCircles,d3_geom_voronoiCirclePool=[];function d3_geom_voronoiBeach(){d3_geom_voronoiRedBlackNode(this);this.edge=this.site=this.circle=null;}
function d3_geom_voronoiCreateBeach(site){var beach=d3_geom_voronoiBeachPool.pop()||new d3_geom_voronoiBeach();beach.site=site;return beach;}
function d3_geom_voronoiDetachBeach(beach){d3_geom_voronoiDetachCircle(beach);d3_geom_voronoiBeaches.remove(beach);d3_geom_voronoiBeachPool.push(beach);d3_geom_voronoiRedBlackNode(beach);}
function d3_geom_voronoiRemoveBeach(beach){var circle=beach.circle,x=circle.x,y=circle.cy,vertex={x:x,y:y},previous=beach.P,next=beach.N,disappearing=[beach];d3_geom_voronoiDetachBeach(beach);var lArc=previous;while(lArc.circle&&abs(x-lArc.circle.x)<ε&&abs(y-lArc.circle.cy)<ε){previous=lArc.P;disappearing.unshift(lArc);d3_geom_voronoiDetachBeach(lArc);lArc=previous;}
disappearing.unshift(lArc);d3_geom_voronoiDetachCircle(lArc);var rArc=next;while(rArc.circle&&abs(x-rArc.circle.x)<ε&&abs(y-rArc.circle.cy)<ε){next=rArc.N;disappearing.push(rArc);d3_geom_voronoiDetachBeach(rArc);rArc=next;}
disappearing.push(rArc);d3_geom_voronoiDetachCircle(rArc);var nArcs=disappearing.length,iArc;for(iArc=1;iArc<nArcs;++iArc){rArc=disappearing[iArc];lArc=disappearing[iArc-1];d3_geom_voronoiSetEdgeEnd(rArc.edge,lArc.site,rArc.site,vertex);}
lArc=disappearing[0];rArc=disappearing[nArcs-1];rArc.edge=d3_geom_voronoiCreateEdge(lArc.site,rArc.site,null,vertex);d3_geom_voronoiAttachCircle(lArc);d3_geom_voronoiAttachCircle(rArc);}
function d3_geom_voronoiAddBeach(site){var x=site.x,directrix=site.y,lArc,rArc,dxl,dxr,node=d3_geom_voronoiBeaches._;while(node){dxl=d3_geom_voronoiLeftBreakPoint(node,directrix)-x;if(dxl>ε)node=node.L;else{dxr=x-d3_geom_voronoiRightBreakPoint(node,directrix);if(dxr>ε){if(!node.R){lArc=node;break;}
node=node.R;}else{if(dxl>-ε){lArc=node.P;rArc=node;}else if(dxr>-ε){lArc=node;rArc=node.N;}else{lArc=rArc=node;}
break;}}}
var newArc=d3_geom_voronoiCreateBeach(site);d3_geom_voronoiBeaches.insert(lArc,newArc);if(!lArc&&!rArc)return;if(lArc===rArc){d3_geom_voronoiDetachCircle(lArc);rArc=d3_geom_voronoiCreateBeach(lArc.site);d3_geom_voronoiBeaches.insert(newArc,rArc);newArc.edge=rArc.edge=d3_geom_voronoiCreateEdge(lArc.site,newArc.site);d3_geom_voronoiAttachCircle(lArc);d3_geom_voronoiAttachCircle(rArc);return;}
if(!rArc){newArc.edge=d3_geom_voronoiCreateEdge(lArc.site,newArc.site);return;}
d3_geom_voronoiDetachCircle(lArc);d3_geom_voronoiDetachCircle(rArc);var lSite=lArc.site,ax=lSite.x,ay=lSite.y,bx=site.x-ax,by=site.y-ay,rSite=rArc.site,cx=rSite.x-ax,cy=rSite.y-ay,d=2*(bx*cy-by*cx),hb=bx*bx+by*by,hc=cx*cx+cy*cy,vertex={x:(cy*hb-by*hc)/d+ax,y:(bx*hc-cx*hb)/d+ay};d3_geom_voronoiSetEdgeEnd(rArc.edge,lSite,rSite,vertex);newArc.edge=d3_geom_voronoiCreateEdge(lSite,site,null,vertex);rArc.edge=d3_geom_voronoiCreateEdge(site,rSite,null,vertex);d3_geom_voronoiAttachCircle(lArc);d3_geom_voronoiAttachCircle(rArc);}
function d3_geom_voronoiLeftBreakPoint(arc,directrix){var site=arc.site,rfocx=site.x,rfocy=site.y,pby2=rfocy-directrix;if(!pby2)return rfocx;var lArc=arc.P;if(!lArc)return-Infinity;site=lArc.site;var lfocx=site.x,lfocy=site.y,plby2=lfocy-directrix;if(!plby2)return lfocx;var hl=lfocx-rfocx,aby2=1/pby2-1/plby2,b=hl/plby2;if(aby2)return(-b+Math.sqrt(b*b-2*aby2*(hl*hl/(-2*plby2)-lfocy+plby2/2+rfocy-pby2/2)))/aby2+rfocx;return(rfocx+lfocx)/2;}
function d3_geom_voronoiRightBreakPoint(arc,directrix){var rArc=arc.N;if(rArc)return d3_geom_voronoiLeftBreakPoint(rArc,directrix);var site=arc.site;return site.y===directrix?site.x:Infinity;}
function d3_geom_voronoiCell(site){this.site=site;this.edges=[];}
d3_geom_voronoiCell.prototype.prepare=function(){var halfEdges=this.edges,iHalfEdge=halfEdges.length,edge;while(iHalfEdge--){edge=halfEdges[iHalfEdge].edge;if(!edge.b||!edge.a)halfEdges.splice(iHalfEdge,1);}
halfEdges.sort(d3_geom_voronoiHalfEdgeOrder);return halfEdges.length;};function d3_geom_voronoiCloseCells(extent){var x0=extent[0][0],x1=extent[1][0],y0=extent[0][1],y1=extent[1][1],x2,y2,x3,y3,cells=d3_geom_voronoiCells,iCell=cells.length,cell,iHalfEdge,halfEdges,nHalfEdges,start,end;while(iCell--){cell=cells[iCell];if(!cell||!cell.prepare())continue;halfEdges=cell.edges;nHalfEdges=halfEdges.length;iHalfEdge=0;while(iHalfEdge<nHalfEdges){end=halfEdges[iHalfEdge].end(),x3=end.x,y3=end.y;start=halfEdges[++iHalfEdge%nHalfEdges].start(),x2=start.x,y2=start.y;if(abs(x3-x2)>ε||abs(y3-y2)>ε){halfEdges.splice(iHalfEdge,0,new d3_geom_voronoiHalfEdge(d3_geom_voronoiCreateBorderEdge(cell.site,end,abs(x3-x0)<ε&&y1-y3>ε?{x:x0,y:abs(x2-x0)<ε?y2:y1}:abs(y3-y1)<ε&&x1-x3>ε?{x:abs(y2-y1)<ε?x2:x1,y:y1}:abs(x3-x1)<ε&&y3-y0>ε?{x:x1,y:abs(x2-x1)<ε?y2:y0}:abs(y3-y0)<ε&&x3-x0>ε?{x:abs(y2-y0)<ε?x2:x0,y:y0}:null),cell.site,null));++nHalfEdges;}}}}
function d3_geom_voronoiHalfEdgeOrder(a,b){return b.angle-a.angle;}
function d3_geom_voronoiCircle(){d3_geom_voronoiRedBlackNode(this);this.x=this.y=this.arc=this.site=this.cy=null;}
function d3_geom_voronoiAttachCircle(arc){var lArc=arc.P,rArc=arc.N;if(!lArc||!rArc)return;var lSite=lArc.site,cSite=arc.site,rSite=rArc.site;if(lSite===rSite)return;var bx=cSite.x,by=cSite.y,ax=lSite.x-bx,ay=lSite.y-by,cx=rSite.x-bx,cy=rSite.y-by;var d=2*(ax*cy-ay*cx);if(d>=-ε2)return;var ha=ax*ax+ay*ay,hc=cx*cx+cy*cy,x=(cy*ha-ay*hc)/d,y=(ax*hc-cx*ha)/d,cy=y+by;var circle=d3_geom_voronoiCirclePool.pop()||new d3_geom_voronoiCircle();circle.arc=arc;circle.site=cSite;circle.x=x+bx;circle.y=cy+Math.sqrt(x*x+y*y);circle.cy=cy;arc.circle=circle;var before=null,node=d3_geom_voronoiCircles._;while(node){if(circle.y<node.y||circle.y===node.y&&circle.x<=node.x){if(node.L)node=node.L;else{before=node.P;break;}}else{if(node.R)node=node.R;else{before=node;break;}}}
d3_geom_voronoiCircles.insert(before,circle);if(!before)d3_geom_voronoiFirstCircle=circle;}
function d3_geom_voronoiDetachCircle(arc){var circle=arc.circle;if(circle){if(!circle.P)d3_geom_voronoiFirstCircle=circle.N;d3_geom_voronoiCircles.remove(circle);d3_geom_voronoiCirclePool.push(circle);d3_geom_voronoiRedBlackNode(circle);arc.circle=null;}}
function d3_geom_voronoiClipEdges(extent){var edges=d3_geom_voronoiEdges,clip=d3_geom_clipLine(extent[0][0],extent[0][1],extent[1][0],extent[1][1]),i=edges.length,e;while(i--){e=edges[i];if(!d3_geom_voronoiConnectEdge(e,extent)||!clip(e)||abs(e.a.x-e.b.x)<ε&&abs(e.a.y-e.b.y)<ε){e.a=e.b=null;edges.splice(i,1);}}}
function d3_geom_voronoiConnectEdge(edge,extent){var vb=edge.b;if(vb)return true;var va=edge.a,x0=extent[0][0],x1=extent[1][0],y0=extent[0][1],y1=extent[1][1],lSite=edge.l,rSite=edge.r,lx=lSite.x,ly=lSite.y,rx=rSite.x,ry=rSite.y,fx=(lx+rx)/2,fy=(ly+ry)/2,fm,fb;if(ry===ly){if(fx<x0||fx>=x1)return;if(lx>rx){if(!va)va={x:fx,y:y0};else if(va.y>=y1)return;vb={x:fx,y:y1};}else{if(!va)va={x:fx,y:y1};else if(va.y<y0)return;vb={x:fx,y:y0};}}else{fm=(lx-rx)/(ry-ly);fb=fy-fm*fx;if(fm<-1||fm>1){if(lx>rx){if(!va)va={x:(y0-fb)/fm,y:y0};else if(va.y>=y1)return;vb={x:(y1-fb)/fm,y:y1};}else{if(!va)va={x:(y1-fb)/fm,y:y1};else if(va.y<y0)return;vb={x:(y0-fb)/fm,y:y0};}}else{if(ly<ry){if(!va)va={x:x0,y:fm*x0+fb};else if(va.x>=x1)return;vb={x:x1,y:fm*x1+fb};}else{if(!va)va={x:x1,y:fm*x1+fb};else if(va.x<x0)return;vb={x:x0,y:fm*x0+fb};}}}
edge.a=va;edge.b=vb;return true;}
function d3_geom_voronoiEdge(lSite,rSite){this.l=lSite;this.r=rSite;this.a=this.b=null;}
function d3_geom_voronoiCreateEdge(lSite,rSite,va,vb){var edge=new d3_geom_voronoiEdge(lSite,rSite);d3_geom_voronoiEdges.push(edge);if(va)d3_geom_voronoiSetEdgeEnd(edge,lSite,rSite,va);if(vb)d3_geom_voronoiSetEdgeEnd(edge,rSite,lSite,vb);d3_geom_voronoiCells[lSite.i].edges.push(new d3_geom_voronoiHalfEdge(edge,lSite,rSite));d3_geom_voronoiCells[rSite.i].edges.push(new d3_geom_voronoiHalfEdge(edge,rSite,lSite));return edge;}
function d3_geom_voronoiCreateBorderEdge(lSite,va,vb){var edge=new d3_geom_voronoiEdge(lSite,null);edge.a=va;edge.b=vb;d3_geom_voronoiEdges.push(edge);return edge;}
function d3_geom_voronoiSetEdgeEnd(edge,lSite,rSite,vertex){if(!edge.a&&!edge.b){edge.a=vertex;edge.l=lSite;edge.r=rSite;}else if(edge.l===rSite){edge.b=vertex;}else{edge.a=vertex;}}
function d3_geom_voronoiHalfEdge(edge,lSite,rSite){var va=edge.a,vb=edge.b;this.edge=edge;this.site=lSite;this.angle=rSite?Math.atan2(rSite.y-lSite.y,rSite.x-lSite.x):edge.l===lSite?Math.atan2(vb.x-va.x,va.y-vb.y):Math.atan2(va.x-vb.x,vb.y-va.y);}
d3_geom_voronoiHalfEdge.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b;},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a;}};function d3_geom_voronoiRedBlackTree(){this._=null;}
function d3_geom_voronoiRedBlackNode(node){node.U=node.C=node.L=node.R=node.P=node.N=null;}
d3_geom_voronoiRedBlackTree.prototype={insert:function(after,node){var parent,grandpa,uncle;if(after){node.P=after;node.N=after.N;if(after.N)after.N.P=node;after.N=node;if(after.R){after=after.R;while(after.L)after=after.L;after.L=node;}else{after.R=node;}
parent=after;}else if(this._){after=d3_geom_voronoiRedBlackFirst(this._);node.P=null;node.N=after;after.P=after.L=node;parent=after;}else{node.P=node.N=null;this._=node;parent=null;}
node.L=node.R=null;node.U=parent;node.C=true;after=node;while(parent&&parent.C){grandpa=parent.U;if(parent===grandpa.L){uncle=grandpa.R;if(uncle&&uncle.C){parent.C=uncle.C=false;grandpa.C=true;after=grandpa;}else{if(after===parent.R){d3_geom_voronoiRedBlackRotateLeft(this,parent);after=parent;parent=after.U;}
parent.C=false;grandpa.C=true;d3_geom_voronoiRedBlackRotateRight(this,grandpa);}}else{uncle=grandpa.L;if(uncle&&uncle.C){parent.C=uncle.C=false;grandpa.C=true;after=grandpa;}else{if(after===parent.L){d3_geom_voronoiRedBlackRotateRight(this,parent);after=parent;parent=after.U;}
parent.C=false;grandpa.C=true;d3_geom_voronoiRedBlackRotateLeft(this,grandpa);}}
parent=after.U;}
this._.C=false;},remove:function(node){if(node.N)node.N.P=node.P;if(node.P)node.P.N=node.N;node.N=node.P=null;var parent=node.U,sibling,left=node.L,right=node.R,next,red;if(!left)next=right;else if(!right)next=left;else next=d3_geom_voronoiRedBlackFirst(right);if(parent){if(parent.L===node)parent.L=next;else parent.R=next;}else{this._=next;}
if(left&&right){red=next.C;next.C=node.C;next.L=left;left.U=next;if(next!==right){parent=next.U;next.U=node.U;node=next.R;parent.L=node;next.R=right;right.U=next;}else{next.U=parent;parent=next;node=next.R;}}else{red=node.C;node=next;}
if(node)node.U=parent;if(red)return;if(node&&node.C){node.C=false;return;}
do{if(node===this._)break;if(node===parent.L){sibling=parent.R;if(sibling.C){sibling.C=false;parent.C=true;d3_geom_voronoiRedBlackRotateLeft(this,parent);sibling=parent.R;}
if(sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){if(!sibling.R||!sibling.R.C){sibling.L.C=false;sibling.C=true;d3_geom_voronoiRedBlackRotateRight(this,sibling);sibling=parent.R;}
sibling.C=parent.C;parent.C=sibling.R.C=false;d3_geom_voronoiRedBlackRotateLeft(this,parent);node=this._;break;}}else{sibling=parent.L;if(sibling.C){sibling.C=false;parent.C=true;d3_geom_voronoiRedBlackRotateRight(this,parent);sibling=parent.L;}
if(sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){if(!sibling.L||!sibling.L.C){sibling.R.C=false;sibling.C=true;d3_geom_voronoiRedBlackRotateLeft(this,sibling);sibling=parent.L;}
sibling.C=parent.C;parent.C=sibling.L.C=false;d3_geom_voronoiRedBlackRotateRight(this,parent);node=this._;break;}}
sibling.C=true;node=parent;parent=parent.U;}while(!node.C);if(node)node.C=false;}};function d3_geom_voronoiRedBlackRotateLeft(tree,node){var p=node,q=node.R,parent=p.U;if(parent){if(parent.L===p)parent.L=q;else parent.R=q;}else{tree._=q;}
q.U=parent;p.U=q;p.R=q.L;if(p.R)p.R.U=p;q.L=p;}
function d3_geom_voronoiRedBlackRotateRight(tree,node){var p=node,q=node.L,parent=p.U;if(parent){if(parent.L===p)parent.L=q;else parent.R=q;}else{tree._=q;}
q.U=parent;p.U=q;p.L=q.R;if(p.L)p.L.U=p;q.R=p;}
function d3_geom_voronoiRedBlackFirst(node){while(node.L)node=node.L;return node;}
function d3_geom_voronoi(sites,bbox){var site=sites.sort(d3_geom_voronoiVertexOrder).pop(),x0,y0,circle;d3_geom_voronoiEdges=[];d3_geom_voronoiCells=new Array(sites.length);d3_geom_voronoiBeaches=new d3_geom_voronoiRedBlackTree();d3_geom_voronoiCircles=new d3_geom_voronoiRedBlackTree();while(true){circle=d3_geom_voronoiFirstCircle;if(site&&(!circle||site.y<circle.y||site.y===circle.y&&site.x<circle.x)){if(site.x!==x0||site.y!==y0){d3_geom_voronoiCells[site.i]=new d3_geom_voronoiCell(site);d3_geom_voronoiAddBeach(site);x0=site.x,y0=site.y;}
site=sites.pop();}else if(circle){d3_geom_voronoiRemoveBeach(circle.arc);}else{break;}}
if(bbox)d3_geom_voronoiClipEdges(bbox),d3_geom_voronoiCloseCells(bbox);var diagram={cells:d3_geom_voronoiCells,edges:d3_geom_voronoiEdges};d3_geom_voronoiBeaches=d3_geom_voronoiCircles=d3_geom_voronoiEdges=d3_geom_voronoiCells=null;return diagram;}
function d3_geom_voronoiVertexOrder(a,b){return b.y-a.y||b.x-a.x;}
d3.geom.voronoi=function(points){var x=d3_geom_pointX,y=d3_geom_pointY,fx=x,fy=y,clipExtent=d3_geom_voronoiClipExtent;if(points)return voronoi(points);function voronoi(data){var polygons=new Array(data.length),x0=clipExtent[0][0],y0=clipExtent[0][1],x1=clipExtent[1][0],y1=clipExtent[1][1];d3_geom_voronoi(sites(data),clipExtent).cells.forEach(function(cell,i){var edges=cell.edges,site=cell.site,polygon=polygons[i]=edges.length?edges.map(function(e){var s=e.start();return[s.x,s.y];}):site.x>=x0&&site.x<=x1&&site.y>=y0&&site.y<=y1?[[x0,y1],[x1,y1],[x1,y0],[x0,y0]]:[];polygon.point=data[i];});return polygons;}
function sites(data){return data.map(function(d,i){return{x:Math.round(fx(d,i)/ε)*ε,y:Math.round(fy(d,i)/ε)*ε,i:i};});}
voronoi.links=function(data){return d3_geom_voronoi(sites(data)).edges.filter(function(edge){return edge.l&&edge.r;}).map(function(edge){return{source:data[edge.l.i],target:data[edge.r.i]};});};voronoi.triangles=function(data){var triangles=[];d3_geom_voronoi(sites(data)).cells.forEach(function(cell,i){var site=cell.site,edges=cell.edges.sort(d3_geom_voronoiHalfEdgeOrder),j=-1,m=edges.length,e0,s0,e1=edges[m-1].edge,s1=e1.l===site?e1.r:e1.l;while(++j<m){e0=e1;s0=s1;e1=edges[j].edge;s1=e1.l===site?e1.r:e1.l;if(i<s0.i&&i<s1.i&&d3_geom_voronoiTriangleArea(site,s0,s1)<0){triangles.push([data[i],data[s0.i],data[s1.i]]);}}});return triangles;};voronoi.x=function(_){return arguments.length?(fx=d3_functor(x=_),voronoi):x;};voronoi.y=function(_){return arguments.length?(fy=d3_functor(y=_),voronoi):y;};voronoi.clipExtent=function(_){if(!arguments.length)return clipExtent===d3_geom_voronoiClipExtent?null:clipExtent;clipExtent=_==null?d3_geom_voronoiClipExtent:_;return voronoi;};voronoi.size=function(_){if(!arguments.length)return clipExtent===d3_geom_voronoiClipExtent?null:clipExtent&&clipExtent[1];return voronoi.clipExtent(_&&[[0,0],_]);};return voronoi;};var d3_geom_voronoiClipExtent=[[-1e6,-1e6],[1e6,1e6]];function d3_geom_voronoiTriangleArea(a,b,c){return(a.x-c.x)*(b.y-a.y)-(a.x-b.x)*(c.y-a.y);}
d3.geom.delaunay=function(vertices){return d3.geom.voronoi().triangles(vertices);};d3.geom.quadtree=function(points,x1,y1,x2,y2){var x=d3_geom_pointX,y=d3_geom_pointY,compat;if(compat=arguments.length){x=d3_geom_quadtreeCompatX;y=d3_geom_quadtreeCompatY;if(compat===3){y2=y1;x2=x1;y1=x1=0;}
return quadtree(points);}
function quadtree(data){var d,fx=d3_functor(x),fy=d3_functor(y),xs,ys,i,n,x1_,y1_,x2_,y2_;if(x1!=null){x1_=x1,y1_=y1,x2_=x2,y2_=y2;}else{x2_=y2_=-(x1_=y1_=Infinity);xs=[],ys=[];n=data.length;if(compat)for(i=0;i<n;++i){d=data[i];if(d.x<x1_)x1_=d.x;if(d.y<y1_)y1_=d.y;if(d.x>x2_)x2_=d.x;if(d.y>y2_)y2_=d.y;xs.push(d.x);ys.push(d.y);}else for(i=0;i<n;++i){var x_=+fx(d=data[i],i),y_=+fy(d,i);if(x_<x1_)x1_=x_;if(y_<y1_)y1_=y_;if(x_>x2_)x2_=x_;if(y_>y2_)y2_=y_;xs.push(x_);ys.push(y_);}}
var dx=x2_-x1_,dy=y2_-y1_;if(dx>dy)y2_=y1_+dx;else x2_=x1_+dy;function insert(n,d,x,y,x1,y1,x2,y2){if(isNaN(x)||isNaN(y))return;if(n.leaf){var nx=n.x,ny=n.y;if(nx!=null){if(abs(nx-x)+abs(ny-y)<.01){insertChild(n,d,x,y,x1,y1,x2,y2);}else{var nPoint=n.point;n.x=n.y=n.point=null;insertChild(n,nPoint,nx,ny,x1,y1,x2,y2);insertChild(n,d,x,y,x1,y1,x2,y2);}}else{n.x=x,n.y=y,n.point=d;}}else{insertChild(n,d,x,y,x1,y1,x2,y2);}}
function insertChild(n,d,x,y,x1,y1,x2,y2){var xm=(x1+x2)*.5,ym=(y1+y2)*.5,right=x>=xm,below=y>=ym,i=below<<1|right;n.leaf=false;n=n.nodes[i]||(n.nodes[i]=d3_geom_quadtreeNode());if(right)x1=xm;else x2=xm;if(below)y1=ym;else y2=ym;insert(n,d,x,y,x1,y1,x2,y2);}
var root=d3_geom_quadtreeNode();root.add=function(d){insert(root,d,+fx(d,++i),+fy(d,i),x1_,y1_,x2_,y2_);};root.visit=function(f){d3_geom_quadtreeVisit(f,root,x1_,y1_,x2_,y2_);};root.find=function(point){return d3_geom_quadtreeFind(root,point[0],point[1],x1_,y1_,x2_,y2_);};i=-1;if(x1==null){while(++i<n){insert(root,data[i],xs[i],ys[i],x1_,y1_,x2_,y2_);}
--i;}else data.forEach(root.add);xs=ys=data=d=null;return root;}
quadtree.x=function(_){return arguments.length?(x=_,quadtree):x;};quadtree.y=function(_){return arguments.length?(y=_,quadtree):y;};quadtree.extent=function(_){if(!arguments.length)return x1==null?null:[[x1,y1],[x2,y2]];if(_==null)x1=y1=x2=y2=null;else x1=+_[0][0],y1=+_[0][1],x2=+_[1][0],y2=+_[1][1];return quadtree;};quadtree.size=function(_){if(!arguments.length)return x1==null?null:[x2-x1,y2-y1];if(_==null)x1=y1=x2=y2=null;else x1=y1=0,x2=+_[0],y2=+_[1];return quadtree;};return quadtree;};function d3_geom_quadtreeCompatX(d){return d.x;}
function d3_geom_quadtreeCompatY(d){return d.y;}
function d3_geom_quadtreeNode(){return{leaf:true,nodes:[],point:null,x:null,y:null};}
function d3_geom_quadtreeVisit(f,node,x1,y1,x2,y2){if(!f(node,x1,y1,x2,y2)){var sx=(x1+x2)*.5,sy=(y1+y2)*.5,children=node.nodes;if(children[0])d3_geom_quadtreeVisit(f,children[0],x1,y1,sx,sy);if(children[1])d3_geom_quadtreeVisit(f,children[1],sx,y1,x2,sy);if(children[2])d3_geom_quadtreeVisit(f,children[2],x1,sy,sx,y2);if(children[3])d3_geom_quadtreeVisit(f,children[3],sx,sy,x2,y2);}}
function d3_geom_quadtreeFind(root,x,y,x0,y0,x3,y3){var minDistance2=Infinity,closestPoint;(function find(node,x1,y1,x2,y2){if(x1>x3||y1>y3||x2<x0||y2<y0)return;if(point=node.point){var point,dx=x-node.x,dy=y-node.y,distance2=dx*dx+dy*dy;if(distance2<minDistance2){var distance=Math.sqrt(minDistance2=distance2);x0=x-distance,y0=y-distance;x3=x+distance,y3=y+distance;closestPoint=point;}}
var children=node.nodes,xm=(x1+x2)*.5,ym=(y1+y2)*.5,right=x>=xm,below=y>=ym;for(var i=below<<1|right,j=i+4;i<j;++i){if(node=children[i&3])switch(i&3){case 0:find(node,x1,y1,xm,ym);break;case 1:find(node,xm,y1,x2,ym);break;case 2:find(node,x1,ym,xm,y2);break;case 3:find(node,xm,ym,x2,y2);break;}}})(root,x0,y0,x3,y3);return closestPoint;}
d3.interpolateRgb=d3_interpolateRgb;function d3_interpolateRgb(a,b){a=d3.rgb(a);b=d3.rgb(b);var ar=a.r,ag=a.g,ab=a.b,br=b.r-ar,bg=b.g-ag,bb=b.b-ab;return function(t){return"#"+d3_rgb_hex(Math.round(ar+br*t))+d3_rgb_hex(Math.round(ag+bg*t))+d3_rgb_hex(Math.round(ab+bb*t));};}
d3.interpolateObject=d3_interpolateObject;function d3_interpolateObject(a,b){var i={},c={},k;for(k in a){if(k in b){i[k]=d3_interpolate(a[k],b[k]);}else{c[k]=a[k];}}
for(k in b){if(!(k in a)){c[k]=b[k];}}
return function(t){for(k in i)c[k]=i[k](t);return c;};}
d3.interpolateNumber=d3_interpolateNumber;function d3_interpolateNumber(a,b){a=+a,b=+b;return function(t){return a*(1-t)+b*t;};}
d3.interpolateString=d3_interpolateString;function d3_interpolateString(a,b){var bi=d3_interpolate_numberA.lastIndex=d3_interpolate_numberB.lastIndex=0,am,bm,bs,i=-1,s=[],q=[];a=a+"",b=b+"";while((am=d3_interpolate_numberA.exec(a))&&(bm=d3_interpolate_numberB.exec(b))){if((bs=bm.index)>bi){bs=b.slice(bi,bs);if(s[i])s[i]+=bs;else s[++i]=bs;}
if((am=am[0])===(bm=bm[0])){if(s[i])s[i]+=bm;else s[++i]=bm;}else{s[++i]=null;q.push({i:i,x:d3_interpolateNumber(am,bm)});}
bi=d3_interpolate_numberB.lastIndex;}
if(bi<b.length){bs=b.slice(bi);if(s[i])s[i]+=bs;else s[++i]=bs;}
return s.length<2?q[0]?(b=q[0].x,function(t){return b(t)+"";}):function(){return b;}:(b=q.length,function(t){for(var i=0,o;i<b;++i)s[(o=q[i]).i]=o.x(t);return s.join("");});}
var d3_interpolate_numberA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,d3_interpolate_numberB=new RegExp(d3_interpolate_numberA.source,"g");d3.interpolate=d3_interpolate;function d3_interpolate(a,b){var i=d3.interpolators.length,f;while(--i>=0&&!(f=d3.interpolators[i](a,b)));return f;}
d3.interpolators=[function(a,b){var t=typeof b;return(t==="string"?d3_rgb_names.has(b.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(b)?d3_interpolateRgb:d3_interpolateString:b instanceof d3_color?d3_interpolateRgb:Array.isArray(b)?d3_interpolateArray:t==="object"&&isNaN(b)?d3_interpolateObject:d3_interpolateNumber)(a,b);}];d3.interpolateArray=d3_interpolateArray;function d3_interpolateArray(a,b){var x=[],c=[],na=a.length,nb=b.length,n0=Math.min(a.length,b.length),i;for(i=0;i<n0;++i)x.push(d3_interpolate(a[i],b[i]));for(;i<na;++i)c[i]=a[i];for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<n0;++i)c[i]=x[i](t);return c;};}
var d3_ease_default=function(){return d3_identity;};var d3_ease=d3.map({linear:d3_ease_default,poly:d3_ease_poly,quad:function(){return d3_ease_quad;},cubic:function(){return d3_ease_cubic;},sin:function(){return d3_ease_sin;},exp:function(){return d3_ease_exp;},circle:function(){return d3_ease_circle;},elastic:d3_ease_elastic,back:d3_ease_back,bounce:function(){return d3_ease_bounce;}});var d3_ease_mode=d3.map({"in":d3_identity,out:d3_ease_reverse,"in-out":d3_ease_reflect,"out-in":function(f){return d3_ease_reflect(d3_ease_reverse(f));}});d3.ease=function(name){var i=name.indexOf("-"),t=i>=0?name.slice(0,i):name,m=i>=0?name.slice(i+1):"in";t=d3_ease.get(t)||d3_ease_default;m=d3_ease_mode.get(m)||d3_identity;return d3_ease_clamp(m(t.apply(null,d3_arraySlice.call(arguments,1))));};function d3_ease_clamp(f){return function(t){return t<=0?0:t>=1?1:f(t);};}
function d3_ease_reverse(f){return function(t){return 1-f(1-t);};}
function d3_ease_reflect(f){return function(t){return.5*(t<.5?f(2*t):2-f(2-2*t));};}
function d3_ease_quad(t){return t*t;}
function d3_ease_cubic(t){return t*t*t;}
function d3_ease_cubicInOut(t){if(t<=0)return 0;if(t>=1)return 1;var t2=t*t,t3=t2*t;return 4*(t<.5?t3:3*(t-t2)+t3-.75);}
function d3_ease_poly(e){return function(t){return Math.pow(t,e);};}
function d3_ease_sin(t){return 1-Math.cos(t*halfπ);}
function d3_ease_exp(t){return Math.pow(2,10*(t-1));}
function d3_ease_circle(t){return 1-Math.sqrt(1-t*t);}
function d3_ease_elastic(a,p){var s;if(arguments.length<2)p=.45;if(arguments.length)s=p/τ*Math.asin(1/a);else a=1,s=p/4;return function(t){return 1+a*Math.pow(2,-10*t)*Math.sin((t-s)*τ/p);};}
function d3_ease_back(s){if(!s)s=1.70158;return function(t){return t*t*((s+1)*t-s);};}
function d3_ease_bounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375;}
d3.interpolateHcl=d3_interpolateHcl;function d3_interpolateHcl(a,b){a=d3.hcl(a);b=d3.hcl(b);var ah=a.h,ac=a.c,al=a.l,bh=b.h-ah,bc=b.c-ac,bl=b.l-al;if(isNaN(bc))bc=0,ac=isNaN(ac)?b.c:ac;if(isNaN(bh))bh=0,ah=isNaN(ah)?b.h:ah;else if(bh>180)bh-=360;else if(bh<-180)bh+=360;return function(t){return d3_hcl_lab(ah+bh*t,ac+bc*t,al+bl*t)+"";};}
d3.interpolateHsl=d3_interpolateHsl;function d3_interpolateHsl(a,b){a=d3.hsl(a);b=d3.hsl(b);var ah=a.h,as=a.s,al=a.l,bh=b.h-ah,bs=b.s-as,bl=b.l-al;if(isNaN(bs))bs=0,as=isNaN(as)?b.s:as;if(isNaN(bh))bh=0,ah=isNaN(ah)?b.h:ah;else if(bh>180)bh-=360;else if(bh<-180)bh+=360;return function(t){return d3_hsl_rgb(ah+bh*t,as+bs*t,al+bl*t)+"";};}
d3.interpolateLab=d3_interpolateLab;function d3_interpolateLab(a,b){a=d3.lab(a);b=d3.lab(b);var al=a.l,aa=a.a,ab=a.b,bl=b.l-al,ba=b.a-aa,bb=b.b-ab;return function(t){return d3_lab_rgb(al+bl*t,aa+ba*t,ab+bb*t)+"";};}
d3.interpolateRound=d3_interpolateRound;function d3_interpolateRound(a,b){b-=a;return function(t){return Math.round(a+b*t);};}
d3.transform=function(string){var g=d3_document.createElementNS(d3.ns.prefix.svg,"g");return(d3.transform=function(string){if(string!=null){g.setAttribute("transform",string);var t=g.transform.baseVal.consolidate();}
return new d3_transform(t?t.matrix:d3_transformIdentity);})(string);};function d3_transform(m){var r0=[m.a,m.b],r1=[m.c,m.d],kx=d3_transformNormalize(r0),kz=d3_transformDot(r0,r1),ky=d3_transformNormalize(d3_transformCombine(r1,r0,-kz))||0;if(r0[0]*r1[1]<r1[0]*r0[1]){r0[0]*=-1;r0[1]*=-1;kx*=-1;kz*=-1;}
this.rotate=(kx?Math.atan2(r0[1],r0[0]):Math.atan2(-r1[0],r1[1]))*d3_degrees;this.translate=[m.e,m.f];this.scale=[kx,ky];this.skew=ky?Math.atan2(kz,ky)*d3_degrees:0;}
d3_transform.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")";};function d3_transformDot(a,b){return a[0]*b[0]+a[1]*b[1];}
function d3_transformNormalize(a){var k=Math.sqrt(d3_transformDot(a,a));if(k){a[0]/=k;a[1]/=k;}
return k;}
function d3_transformCombine(a,b,k){a[0]+=k*b[0];a[1]+=k*b[1];return a;}
var d3_transformIdentity={a:1,b:0,c:0,d:1,e:0,f:0};d3.interpolateTransform=d3_interpolateTransform;function d3_interpolateTransform(a,b){var s=[],q=[],n,A=d3.transform(a),B=d3.transform(b),ta=A.translate,tb=B.translate,ra=A.rotate,rb=B.rotate,wa=A.skew,wb=B.skew,ka=A.scale,kb=B.scale;if(ta[0]!=tb[0]||ta[1]!=tb[1]){s.push("translate(",null,",",null,")");q.push({i:1,x:d3_interpolateNumber(ta[0],tb[0])},{i:3,x:d3_interpolateNumber(ta[1],tb[1])});}else if(tb[0]||tb[1]){s.push("translate("+tb+")");}else{s.push("");}
if(ra!=rb){if(ra-rb>180)rb+=360;else if(rb-ra>180)ra+=360;q.push({i:s.push(s.pop()+"rotate(",null,")")-2,x:d3_interpolateNumber(ra,rb)});}else if(rb){s.push(s.pop()+"rotate("+rb+")");}
if(wa!=wb){q.push({i:s.push(s.pop()+"skewX(",null,")")-2,x:d3_interpolateNumber(wa,wb)});}else if(wb){s.push(s.pop()+"skewX("+wb+")");}
if(ka[0]!=kb[0]||ka[1]!=kb[1]){n=s.push(s.pop()+"scale(",null,",",null,")");q.push({i:n-4,x:d3_interpolateNumber(ka[0],kb[0])},{i:n-2,x:d3_interpolateNumber(ka[1],kb[1])});}else if(kb[0]!=1||kb[1]!=1){s.push(s.pop()+"scale("+kb+")");}
n=q.length;return function(t){var i=-1,o;while(++i<n)s[(o=q[i]).i]=o.x(t);return s.join("");};}
function d3_uninterpolateNumber(a,b){b=(b-=a=+a)||1/b;return function(x){return(x-a)/b;};}
function d3_uninterpolateClamp(a,b){b=(b-=a=+a)||1/b;return function(x){return Math.max(0,Math.min(1,(x-a)/b));};}
d3.layout={};d3.layout.bundle=function(){return function(links){var paths=[],i=-1,n=links.length;while(++i<n)paths.push(d3_layout_bundlePath(links[i]));return paths;};};function d3_layout_bundlePath(link){var start=link.source,end=link.target,lca=d3_layout_bundleLeastCommonAncestor(start,end),points=[start];while(start!==lca){start=start.parent;points.push(start);}
var k=points.length;while(end!==lca){points.splice(k,0,end);end=end.parent;}
return points;}
function d3_layout_bundleAncestors(node){var ancestors=[],parent=node.parent;while(parent!=null){ancestors.push(node);node=parent;parent=parent.parent;}
ancestors.push(node);return ancestors;}
function d3_layout_bundleLeastCommonAncestor(a,b){if(a===b)return a;var aNodes=d3_layout_bundleAncestors(a),bNodes=d3_layout_bundleAncestors(b),aNode=aNodes.pop(),bNode=bNodes.pop(),sharedNode=null;while(aNode===bNode){sharedNode=aNode;aNode=aNodes.pop();bNode=bNodes.pop();}
return sharedNode;}
d3.layout.chord=function(){var chord={},chords,groups,matrix,n,padding=0,sortGroups,sortSubgroups,sortChords;function relayout(){var subgroups={},groupSums=[],groupIndex=d3.range(n),subgroupIndex=[],k,x,x0,i,j;chords=[];groups=[];k=0,i=-1;while(++i<n){x=0,j=-1;while(++j<n){x+=matrix[i][j];}
groupSums.push(x);subgroupIndex.push(d3.range(n));k+=x;}
if(sortGroups){groupIndex.sort(function(a,b){return sortGroups(groupSums[a],groupSums[b]);});}
if(sortSubgroups){subgroupIndex.forEach(function(d,i){d.sort(function(a,b){return sortSubgroups(matrix[i][a],matrix[i][b]);});});}
k=(τ-padding*n)/k;x=0,i=-1;while(++i<n){x0=x,j=-1;while(++j<n){var di=groupIndex[i],dj=subgroupIndex[di][j],v=matrix[di][dj],a0=x,a1=x+=v*k;subgroups[di+"-"+dj]={index:di,subindex:dj,startAngle:a0,endAngle:a1,value:v};}
groups[di]={index:di,startAngle:x0,endAngle:x,value:(x-x0)/k};x+=padding;}
i=-1;while(++i<n){j=i-1;while(++j<n){var source=subgroups[i+"-"+j],target=subgroups[j+"-"+i];if(source.value||target.value){chords.push(source.value<target.value?{source:target,target:source}:{source:source,target:target});}}}
if(sortChords)resort();}
function resort(){chords.sort(function(a,b){return sortChords((a.source.value+a.target.value)/2,(b.source.value+b.target.value)/2);});}
chord.matrix=function(x){if(!arguments.length)return matrix;n=(matrix=x)&&matrix.length;chords=groups=null;return chord;};chord.padding=function(x){if(!arguments.length)return padding;padding=x;chords=groups=null;return chord;};chord.sortGroups=function(x){if(!arguments.length)return sortGroups;sortGroups=x;chords=groups=null;return chord;};chord.sortSubgroups=function(x){if(!arguments.length)return sortSubgroups;sortSubgroups=x;chords=null;return chord;};chord.sortChords=function(x){if(!arguments.length)return sortChords;sortChords=x;if(chords)resort();return chord;};chord.chords=function(){if(!chords)relayout();return chords;};chord.groups=function(){if(!groups)relayout();return groups;};return chord;};d3.layout.force=function(){var force={},event=d3.dispatch("start","tick","end"),size=[1,1],drag,alpha,friction=.9,linkDistance=d3_layout_forceLinkDistance,linkStrength=d3_layout_forceLinkStrength,charge=-30,chargeDistance2=d3_layout_forceChargeDistance2,gravity=.1,theta2=.64,nodes=[],links=[],distances,strengths,charges;function repulse(node){return function(quad,x1,_,x2){if(quad.point!==node){var dx=quad.cx-node.x,dy=quad.cy-node.y,dw=x2-x1,dn=dx*dx+dy*dy;if(dw*dw/theta2<dn){if(dn<chargeDistance2){var k=quad.charge/dn;node.px-=dx*k;node.py-=dy*k;}
return true;}
if(quad.point&&dn&&dn<chargeDistance2){var k=quad.pointCharge/dn;node.px-=dx*k;node.py-=dy*k;}}
return!quad.charge;};}
force.tick=function(){if((alpha*=.99)<.005){event.end({type:"end",alpha:alpha=0});return true;}
var n=nodes.length,m=links.length,q,i,o,s,t,l,k,x,y;for(i=0;i<m;++i){o=links[i];s=o.source;t=o.target;x=t.x-s.x;y=t.y-s.y;if(l=x*x+y*y){l=alpha*strengths[i]*((l=Math.sqrt(l))-distances[i])/l;x*=l;y*=l;t.x-=x*(k=s.weight/(t.weight+s.weight));t.y-=y*k;s.x+=x*(k=1-k);s.y+=y*k;}}
if(k=alpha*gravity){x=size[0]/2;y=size[1]/2;i=-1;if(k)while(++i<n){o=nodes[i];o.x+=(x-o.x)*k;o.y+=(y-o.y)*k;}}
if(charge){d3_layout_forceAccumulate(q=d3.geom.quadtree(nodes),alpha,charges);i=-1;while(++i<n){if(!(o=nodes[i]).fixed){q.visit(repulse(o));}}}
i=-1;while(++i<n){o=nodes[i];if(o.fixed){o.x=o.px;o.y=o.py;}else{o.x-=(o.px-(o.px=o.x))*friction;o.y-=(o.py-(o.py=o.y))*friction;}}
event.tick({type:"tick",alpha:alpha});};force.nodes=function(x){if(!arguments.length)return nodes;nodes=x;return force;};force.links=function(x){if(!arguments.length)return links;links=x;return force;};force.size=function(x){if(!arguments.length)return size;size=x;return force;};force.linkDistance=function(x){if(!arguments.length)return linkDistance;linkDistance=typeof x==="function"?x:+x;return force;};force.distance=force.linkDistance;force.linkStrength=function(x){if(!arguments.length)return linkStrength;linkStrength=typeof x==="function"?x:+x;return force;};force.friction=function(x){if(!arguments.length)return friction;friction=+x;return force;};force.charge=function(x){if(!arguments.length)return charge;charge=typeof x==="function"?x:+x;return force;};force.chargeDistance=function(x){if(!arguments.length)return Math.sqrt(chargeDistance2);chargeDistance2=x*x;return force;};force.gravity=function(x){if(!arguments.length)return gravity;gravity=+x;return force;};force.theta=function(x){if(!arguments.length)return Math.sqrt(theta2);theta2=x*x;return force;};force.alpha=function(x){if(!arguments.length)return alpha;x=+x;if(alpha){if(x>0)alpha=x;else alpha=0;}else if(x>0){event.start({type:"start",alpha:alpha=x});d3.timer(force.tick);}
return force;};force.start=function(){var i,n=nodes.length,m=links.length,w=size[0],h=size[1],neighbors,o;for(i=0;i<n;++i){(o=nodes[i]).index=i;o.weight=0;}
for(i=0;i<m;++i){o=links[i];if(typeof o.source=="number")o.source=nodes[o.source];if(typeof o.target=="number")o.target=nodes[o.target];++o.source.weight;++o.target.weight;}
for(i=0;i<n;++i){o=nodes[i];if(isNaN(o.x))o.x=position("x",w);if(isNaN(o.y))o.y=position("y",h);if(isNaN(o.px))o.px=o.x;if(isNaN(o.py))o.py=o.y;}
distances=[];if(typeof linkDistance==="function")for(i=0;i<m;++i)distances[i]=+linkDistance.call(this,links[i],i);else for(i=0;i<m;++i)distances[i]=linkDistance;strengths=[];if(typeof linkStrength==="function")for(i=0;i<m;++i)strengths[i]=+linkStrength.call(this,links[i],i);else for(i=0;i<m;++i)strengths[i]=linkStrength;charges=[];if(typeof charge==="function")for(i=0;i<n;++i)charges[i]=+charge.call(this,nodes[i],i);else for(i=0;i<n;++i)charges[i]=charge;function position(dimension,size){if(!neighbors){neighbors=new Array(n);for(j=0;j<n;++j){neighbors[j]=[];}
for(j=0;j<m;++j){var o=links[j];neighbors[o.source.index].push(o.target);neighbors[o.target.index].push(o.source);}}
var candidates=neighbors[i],j=-1,l=candidates.length,x;while(++j<l)if(!isNaN(x=candidates[j][dimension]))return x;return Math.random()*size;}
return force.resume();};force.resume=function(){return force.alpha(.1);};force.stop=function(){return force.alpha(0);};force.drag=function(){if(!drag)drag=d3.behavior.drag().origin(d3_identity).on("dragstart.force",d3_layout_forceDragstart).on("drag.force",dragmove).on("dragend.force",d3_layout_forceDragend);if(!arguments.length)return drag;this.on("mouseover.force",d3_layout_forceMouseover).on("mouseout.force",d3_layout_forceMouseout).call(drag);};function dragmove(d){d.px=d3.event.x,d.py=d3.event.y;force.resume();}
return d3.rebind(force,event,"on");};function d3_layout_forceDragstart(d){d.fixed|=2;}
function d3_layout_forceDragend(d){d.fixed&=~6;}
function d3_layout_forceMouseover(d){d.fixed|=4;d.px=d.x,d.py=d.y;}
function d3_layout_forceMouseout(d){d.fixed&=~4;}
function d3_layout_forceAccumulate(quad,alpha,charges){var cx=0,cy=0;quad.charge=0;if(!quad.leaf){var nodes=quad.nodes,n=nodes.length,i=-1,c;while(++i<n){c=nodes[i];if(c==null)continue;d3_layout_forceAccumulate(c,alpha,charges);quad.charge+=c.charge;cx+=c.charge*c.cx;cy+=c.charge*c.cy;}}
if(quad.point){if(!quad.leaf){quad.point.x+=Math.random()-.5;quad.point.y+=Math.random()-.5;}
var k=alpha*charges[quad.point.index];quad.charge+=quad.pointCharge=k;cx+=k*quad.point.x;cy+=k*quad.point.y;}
quad.cx=cx/quad.charge;quad.cy=cy/quad.charge;}
var d3_layout_forceLinkDistance=20,d3_layout_forceLinkStrength=1,d3_layout_forceChargeDistance2=Infinity;d3.layout.hierarchy=function(){var sort=d3_layout_hierarchySort,children=d3_layout_hierarchyChildren,value=d3_layout_hierarchyValue;function hierarchy(root){var stack=[root],nodes=[],node;root.depth=0;while((node=stack.pop())!=null){nodes.push(node);if((childs=children.call(hierarchy,node,node.depth))&&(n=childs.length)){var n,childs,child;while(--n>=0){stack.push(child=childs[n]);child.parent=node;child.depth=node.depth+1;}
if(value)node.value=0;node.children=childs;}else{if(value)node.value=+value.call(hierarchy,node,node.depth)||0;delete node.children;}}
d3_layout_hierarchyVisitAfter(root,function(node){var childs,parent;if(sort&&(childs=node.children))childs.sort(sort);if(value&&(parent=node.parent))parent.value+=node.value;});return nodes;}
hierarchy.sort=function(x){if(!arguments.length)return sort;sort=x;return hierarchy;};hierarchy.children=function(x){if(!arguments.length)return children;children=x;return hierarchy;};hierarchy.value=function(x){if(!arguments.length)return value;value=x;return hierarchy;};hierarchy.revalue=function(root){if(value){d3_layout_hierarchyVisitBefore(root,function(node){if(node.children)node.value=0;});d3_layout_hierarchyVisitAfter(root,function(node){var parent;if(!node.children)node.value=+value.call(hierarchy,node,node.depth)||0;if(parent=node.parent)parent.value+=node.value;});}
return root;};return hierarchy;};function d3_layout_hierarchyRebind(object,hierarchy){d3.rebind(object,hierarchy,"sort","children","value");object.nodes=object;object.links=d3_layout_hierarchyLinks;return object;}
function d3_layout_hierarchyVisitBefore(node,callback){var nodes=[node];while((node=nodes.pop())!=null){callback(node);if((children=node.children)&&(n=children.length)){var n,children;while(--n>=0)nodes.push(children[n]);}}}
function d3_layout_hierarchyVisitAfter(node,callback){var nodes=[node],nodes2=[];while((node=nodes.pop())!=null){nodes2.push(node);if((children=node.children)&&(n=children.length)){var i=-1,n,children;while(++i<n)nodes.push(children[i]);}}
while((node=nodes2.pop())!=null){callback(node);}}
function d3_layout_hierarchyChildren(d){return d.children;}
function d3_layout_hierarchyValue(d){return d.value;}
function d3_layout_hierarchySort(a,b){return b.value-a.value;}
function d3_layout_hierarchyLinks(nodes){return d3.merge(nodes.map(function(parent){return(parent.children||[]).map(function(child){return{source:parent,target:child};});}));}
d3.layout.partition=function(){var hierarchy=d3.layout.hierarchy(),size=[1,1];function position(node,x,dx,dy){var children=node.children;node.x=x;node.y=node.depth*dy;node.dx=dx;node.dy=dy;if(children&&(n=children.length)){var i=-1,n,c,d;dx=node.value?dx/node.value:0;while(++i<n){position(c=children[i],x,d=c.value*dx,dy);x+=d;}}}
function depth(node){var children=node.children,d=0;if(children&&(n=children.length)){var i=-1,n;while(++i<n)d=Math.max(d,depth(children[i]));}
return 1+d;}
function partition(d,i){var nodes=hierarchy.call(this,d,i);position(nodes[0],0,size[0],size[1]/depth(nodes[0]));return nodes;}
partition.size=function(x){if(!arguments.length)return size;size=x;return partition;};return d3_layout_hierarchyRebind(partition,hierarchy);};d3.layout.pie=function(){var value=Number,sort=d3_layout_pieSortByValue,startAngle=0,endAngle=τ,padAngle=0;function pie(data){var n=data.length,values=data.map(function(d,i){return+value.call(pie,d,i);}),a=+(typeof startAngle==="function"?startAngle.apply(this,arguments):startAngle),da=(typeof endAngle==="function"?endAngle.apply(this,arguments):endAngle)-a,p=Math.min(Math.abs(da)/n,+(typeof padAngle==="function"?padAngle.apply(this,arguments):padAngle)),pa=p*(da<0?-1:1),k=(da-n*pa)/d3.sum(values),index=d3.range(n),arcs=[],v;if(sort!=null)index.sort(sort===d3_layout_pieSortByValue?function(i,j){return values[j]-values[i];}:function(i,j){return sort(data[i],data[j]);});index.forEach(function(i){arcs[i]={data:data[i],value:v=values[i],startAngle:a,endAngle:a+=v*k+pa,padAngle:p};});return arcs;}
pie.value=function(_){if(!arguments.length)return value;value=_;return pie;};pie.sort=function(_){if(!arguments.length)return sort;sort=_;return pie;};pie.startAngle=function(_){if(!arguments.length)return startAngle;startAngle=_;return pie;};pie.endAngle=function(_){if(!arguments.length)return endAngle;endAngle=_;return pie;};pie.padAngle=function(_){if(!arguments.length)return padAngle;padAngle=_;return pie;};return pie;};var d3_layout_pieSortByValue={};d3.layout.stack=function(){var values=d3_identity,order=d3_layout_stackOrderDefault,offset=d3_layout_stackOffsetZero,out=d3_layout_stackOut,x=d3_layout_stackX,y=d3_layout_stackY;function stack(data,index){if(!(n=data.length))return data;var series=data.map(function(d,i){return values.call(stack,d,i);});var points=series.map(function(d){return d.map(function(v,i){return[x.call(stack,v,i),y.call(stack,v,i)];});});var orders=order.call(stack,points,index);series=d3.permute(series,orders);points=d3.permute(points,orders);var offsets=offset.call(stack,points,index);var m=series[0].length,n,i,j,o;for(j=0;j<m;++j){out.call(stack,series[0][j],o=offsets[j],points[0][j][1]);for(i=1;i<n;++i){out.call(stack,series[i][j],o+=points[i-1][j][1],points[i][j][1]);}}
return data;}
stack.values=function(x){if(!arguments.length)return values;values=x;return stack;};stack.order=function(x){if(!arguments.length)return order;order=typeof x==="function"?x:d3_layout_stackOrders.get(x)||d3_layout_stackOrderDefault;return stack;};stack.offset=function(x){if(!arguments.length)return offset;offset=typeof x==="function"?x:d3_layout_stackOffsets.get(x)||d3_layout_stackOffsetZero;return stack;};stack.x=function(z){if(!arguments.length)return x;x=z;return stack;};stack.y=function(z){if(!arguments.length)return y;y=z;return stack;};stack.out=function(z){if(!arguments.length)return out;out=z;return stack;};return stack;};function d3_layout_stackX(d){return d.x;}
function d3_layout_stackY(d){return d.y;}
function d3_layout_stackOut(d,y0,y){d.y0=y0;d.y=y;}
var d3_layout_stackOrders=d3.map({"inside-out":function(data){var n=data.length,i,j,max=data.map(d3_layout_stackMaxIndex),sums=data.map(d3_layout_stackReduceSum),index=d3.range(n).sort(function(a,b){return max[a]-max[b];}),top=0,bottom=0,tops=[],bottoms=[];for(i=0;i<n;++i){j=index[i];if(top<bottom){top+=sums[j];tops.push(j);}else{bottom+=sums[j];bottoms.push(j);}}
return bottoms.reverse().concat(tops);},reverse:function(data){return d3.range(data.length).reverse();},"default":d3_layout_stackOrderDefault});var d3_layout_stackOffsets=d3.map({silhouette:function(data){var n=data.length,m=data[0].length,sums=[],max=0,i,j,o,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<n;i++)o+=data[i][j][1];if(o>max)max=o;sums.push(o);}
for(j=0;j<m;++j){y0[j]=(max-sums[j])/2;}
return y0;},wiggle:function(data){var n=data.length,x=data[0],m=x.length,i,j,k,s1,s2,s3,dx,o,o0,y0=[];y0[0]=o=o0=0;for(j=1;j<m;++j){for(i=0,s1=0;i<n;++i)s1+=data[i][j][1];for(i=0,s2=0,dx=x[j][0]-x[j-1][0];i<n;++i){for(k=0,s3=(data[i][j][1]-data[i][j-1][1])/(2*dx);k<i;++k){s3+=(data[k][j][1]-data[k][j-1][1])/dx;}
s2+=s3*data[i][j][1];}
y0[j]=o-=s1?s2/s1*dx:0;if(o<o0)o0=o;}
for(j=0;j<m;++j)y0[j]-=o0;return y0;},expand:function(data){var n=data.length,m=data[0].length,k=1/n,i,j,o,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<n;i++)o+=data[i][j][1];if(o)for(i=0;i<n;i++)data[i][j][1]/=o;else for(i=0;i<n;i++)data[i][j][1]=k;}
for(j=0;j<m;++j)y0[j]=0;return y0;},zero:d3_layout_stackOffsetZero});function d3_layout_stackOrderDefault(data){return d3.range(data.length);}
function d3_layout_stackOffsetZero(data){var j=-1,m=data[0].length,y0=[];while(++j<m)y0[j]=0;return y0;}
function d3_layout_stackMaxIndex(array){var i=1,j=0,v=array[0][1],k,n=array.length;for(;i<n;++i){if((k=array[i][1])>v){j=i;v=k;}}
return j;}
function d3_layout_stackReduceSum(d){return d.reduce(d3_layout_stackSum,0);}
function d3_layout_stackSum(p,d){return p+d[1];}
d3.layout.histogram=function(){var frequency=true,valuer=Number,ranger=d3_layout_histogramRange,binner=d3_layout_histogramBinSturges;function histogram(data,i){var bins=[],values=data.map(valuer,this),range=ranger.call(this,values,i),thresholds=binner.call(this,range,values,i),bin,i=-1,n=values.length,m=thresholds.length-1,k=frequency?1:1/n,x;while(++i<m){bin=bins[i]=[];bin.dx=thresholds[i+1]-(bin.x=thresholds[i]);bin.y=0;}
if(m>0){i=-1;while(++i<n){x=values[i];if(x>=range[0]&&x<=range[1]){bin=bins[d3.bisect(thresholds,x,1,m)-1];bin.y+=k;bin.push(data[i]);}}}
return bins;}
histogram.value=function(x){if(!arguments.length)return valuer;valuer=x;return histogram;};histogram.range=function(x){if(!arguments.length)return ranger;ranger=d3_functor(x);return histogram;};histogram.bins=function(x){if(!arguments.length)return binner;binner=typeof x==="number"?function(range){return d3_layout_histogramBinFixed(range,x);}:d3_functor(x);return histogram;};histogram.frequency=function(x){if(!arguments.length)return frequency;frequency=!!x;return histogram;};return histogram;};function d3_layout_histogramBinSturges(range,values){return d3_layout_histogramBinFixed(range,Math.ceil(Math.log(values.length)/Math.LN2+1));}
function d3_layout_histogramBinFixed(range,n){var x=-1,b=+range[0],m=(range[1]-b)/n,f=[];while(++x<=n)f[x]=m*x+b;return f;}
function d3_layout_histogramRange(values){return[d3.min(values),d3.max(values)];}
d3.layout.pack=function(){var hierarchy=d3.layout.hierarchy().sort(d3_layout_packSort),padding=0,size=[1,1],radius;function pack(d,i){var nodes=hierarchy.call(this,d,i),root=nodes[0],w=size[0],h=size[1],r=radius==null?Math.sqrt:typeof radius==="function"?radius:function(){return radius;};root.x=root.y=0;d3_layout_hierarchyVisitAfter(root,function(d){d.r=+r(d.value);});d3_layout_hierarchyVisitAfter(root,d3_layout_packSiblings);if(padding){var dr=padding*(radius?1:Math.max(2*root.r/w,2*root.r/h))/2;d3_layout_hierarchyVisitAfter(root,function(d){d.r+=dr;});d3_layout_hierarchyVisitAfter(root,d3_layout_packSiblings);d3_layout_hierarchyVisitAfter(root,function(d){d.r-=dr;});}
d3_layout_packTransform(root,w/2,h/2,radius?1:1/Math.max(2*root.r/w,2*root.r/h));return nodes;}
pack.size=function(_){if(!arguments.length)return size;size=_;return pack;};pack.radius=function(_){if(!arguments.length)return radius;radius=_==null||typeof _==="function"?_:+_;return pack;};pack.padding=function(_){if(!arguments.length)return padding;padding=+_;return pack;};return d3_layout_hierarchyRebind(pack,hierarchy);};function d3_layout_packSort(a,b){return a.value-b.value;}
function d3_layout_packInsert(a,b){var c=a._pack_next;a._pack_next=b;b._pack_prev=a;b._pack_next=c;c._pack_prev=b;}
function d3_layout_packSplice(a,b){a._pack_next=b;b._pack_prev=a;}
function d3_layout_packIntersects(a,b){var dx=b.x-a.x,dy=b.y-a.y,dr=a.r+b.r;return.999*dr*dr>dx*dx+dy*dy;}
function d3_layout_packSiblings(node){if(!(nodes=node.children)||!(n=nodes.length))return;var nodes,xMin=Infinity,xMax=-Infinity,yMin=Infinity,yMax=-Infinity,a,b,c,i,j,k,n;function bound(node){xMin=Math.min(node.x-node.r,xMin);xMax=Math.max(node.x+node.r,xMax);yMin=Math.min(node.y-node.r,yMin);yMax=Math.max(node.y+node.r,yMax);}
nodes.forEach(d3_layout_packLink);a=nodes[0];a.x=-a.r;a.y=0;bound(a);if(n>1){b=nodes[1];b.x=b.r;b.y=0;bound(b);if(n>2){c=nodes[2];d3_layout_packPlace(a,b,c);bound(c);d3_layout_packInsert(a,c);a._pack_prev=c;d3_layout_packInsert(c,b);b=a._pack_next;for(i=3;i<n;i++){d3_layout_packPlace(a,b,c=nodes[i]);var isect=0,s1=1,s2=1;for(j=b._pack_next;j!==b;j=j._pack_next,s1++){if(d3_layout_packIntersects(j,c)){isect=1;break;}}
if(isect==1){for(k=a._pack_prev;k!==j._pack_prev;k=k._pack_prev,s2++){if(d3_layout_packIntersects(k,c)){break;}}}
if(isect){if(s1<s2||s1==s2&&b.r<a.r)d3_layout_packSplice(a,b=j);else d3_layout_packSplice(a=k,b);i--;}else{d3_layout_packInsert(a,c);b=c;bound(c);}}}}
var cx=(xMin+xMax)/2,cy=(yMin+yMax)/2,cr=0;for(i=0;i<n;i++){c=nodes[i];c.x-=cx;c.y-=cy;cr=Math.max(cr,c.r+Math.sqrt(c.x*c.x+c.y*c.y));}
node.r=cr;nodes.forEach(d3_layout_packUnlink);}
function d3_layout_packLink(node){node._pack_next=node._pack_prev=node;}
function d3_layout_packUnlink(node){delete node._pack_next;delete node._pack_prev;}
function d3_layout_packTransform(node,x,y,k){var children=node.children;node.x=x+=k*node.x;node.y=y+=k*node.y;node.r*=k;if(children){var i=-1,n=children.length;while(++i<n)d3_layout_packTransform(children[i],x,y,k);}}
function d3_layout_packPlace(a,b,c){var db=a.r+c.r,dx=b.x-a.x,dy=b.y-a.y;if(db&&(dx||dy)){var da=b.r+c.r,dc=dx*dx+dy*dy;da*=da;db*=db;var x=.5+(db-da)/(2*dc),y=Math.sqrt(Math.max(0,2*da*(db+dc)-(db-=dc)*db-da*da))/(2*dc);c.x=a.x+x*dx+y*dy;c.y=a.y+x*dy-y*dx;}else{c.x=a.x+db;c.y=a.y;}}
d3.layout.tree=function(){var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1],nodeSize=null;function tree(d,i){var nodes=hierarchy.call(this,d,i),root0=nodes[0],root1=wrapTree(root0);d3_layout_hierarchyVisitAfter(root1,firstWalk),root1.parent.m=-root1.z;d3_layout_hierarchyVisitBefore(root1,secondWalk);if(nodeSize)d3_layout_hierarchyVisitBefore(root0,sizeNode);else{var left=root0,right=root0,bottom=root0;d3_layout_hierarchyVisitBefore(root0,function(node){if(node.x<left.x)left=node;if(node.x>right.x)right=node;if(node.depth>bottom.depth)bottom=node;});var tx=separation(left,right)/2-left.x,kx=size[0]/(right.x+separation(right,left)/2+tx),ky=size[1]/(bottom.depth||1);d3_layout_hierarchyVisitBefore(root0,function(node){node.x=(node.x+tx)*kx;node.y=node.depth*ky;});}
return nodes;}
function wrapTree(root0){var root1={A:null,children:[root0]},queue=[root1],node1;while((node1=queue.pop())!=null){for(var children=node1.children,child,i=0,n=children.length;i<n;++i){queue.push((children[i]=child={_:children[i],parent:node1,children:(child=children[i].children)&&child.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:i}).a=child);}}
return root1.children[0];}
function firstWalk(v){var children=v.children,siblings=v.parent.children,w=v.i?siblings[v.i-1]:null;if(children.length){d3_layout_treeShift(v);var midpoint=(children[0].z+children[children.length-1].z)/2;if(w){v.z=w.z+separation(v._,w._);v.m=v.z-midpoint;}else{v.z=midpoint;}}else if(w){v.z=w.z+separation(v._,w._);}
v.parent.A=apportion(v,w,v.parent.A||siblings[0]);}
function secondWalk(v){v._.x=v.z+v.parent.m;v.m+=v.parent.m;}
function apportion(v,w,ancestor){if(w){var vip=v,vop=v,vim=w,vom=vip.parent.children[0],sip=vip.m,sop=vop.m,sim=vim.m,som=vom.m,shift;while(vim=d3_layout_treeRight(vim),vip=d3_layout_treeLeft(vip),vim&&vip){vom=d3_layout_treeLeft(vom);vop=d3_layout_treeRight(vop);vop.a=v;shift=vim.z+sim-vip.z-sip+separation(vim._,vip._);if(shift>0){d3_layout_treeMove(d3_layout_treeAncestor(vim,v,ancestor),v,shift);sip+=shift;sop+=shift;}
sim+=vim.m;sip+=vip.m;som+=vom.m;sop+=vop.m;}
if(vim&&!d3_layout_treeRight(vop)){vop.t=vim;vop.m+=sim-sop;}
if(vip&&!d3_layout_treeLeft(vom)){vom.t=vip;vom.m+=sip-som;ancestor=v;}}
return ancestor;}
function sizeNode(node){node.x*=size[0];node.y=node.depth*size[1];}
tree.separation=function(x){if(!arguments.length)return separation;separation=x;return tree;};tree.size=function(x){if(!arguments.length)return nodeSize?null:size;nodeSize=(size=x)==null?sizeNode:null;return tree;};tree.nodeSize=function(x){if(!arguments.length)return nodeSize?size:null;nodeSize=(size=x)==null?null:sizeNode;return tree;};return d3_layout_hierarchyRebind(tree,hierarchy);};function d3_layout_treeSeparation(a,b){return a.parent==b.parent?1:2;}
function d3_layout_treeLeft(v){var children=v.children;return children.length?children[0]:v.t;}
function d3_layout_treeRight(v){var children=v.children,n;return(n=children.length)?children[n-1]:v.t;}
function d3_layout_treeMove(wm,wp,shift){var change=shift/(wp.i-wm.i);wp.c-=change;wp.s+=shift;wm.c+=change;wp.z+=shift;wp.m+=shift;}
function d3_layout_treeShift(v){var shift=0,change=0,children=v.children,i=children.length,w;while(--i>=0){w=children[i];w.z+=shift;w.m+=shift;shift+=w.s+(change+=w.c);}}
function d3_layout_treeAncestor(vim,v,ancestor){return vim.a.parent===v.parent?vim.a:ancestor;}
d3.layout.cluster=function(){var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1],nodeSize=false;function cluster(d,i){var nodes=hierarchy.call(this,d,i),root=nodes[0],previousNode,x=0;d3_layout_hierarchyVisitAfter(root,function(node){var children=node.children;if(children&&children.length){node.x=d3_layout_clusterX(children);node.y=d3_layout_clusterY(children);}else{node.x=previousNode?x+=separation(node,previousNode):0;node.y=0;previousNode=node;}});var left=d3_layout_clusterLeft(root),right=d3_layout_clusterRight(root),x0=left.x-separation(left,right)/2,x1=right.x+separation(right,left)/2;d3_layout_hierarchyVisitAfter(root,nodeSize?function(node){node.x=(node.x-root.x)*size[0];node.y=(root.y-node.y)*size[1];}:function(node){node.x=(node.x-x0)/(x1-x0)*size[0];node.y=(1-(root.y?node.y/root.y:1))*size[1];});return nodes;}
cluster.separation=function(x){if(!arguments.length)return separation;separation=x;return cluster;};cluster.size=function(x){if(!arguments.length)return nodeSize?null:size;nodeSize=(size=x)==null;return cluster;};cluster.nodeSize=function(x){if(!arguments.length)return nodeSize?size:null;nodeSize=(size=x)!=null;return cluster;};return d3_layout_hierarchyRebind(cluster,hierarchy);};function d3_layout_clusterY(children){return 1+d3.max(children,function(child){return child.y;});}
function d3_layout_clusterX(children){return children.reduce(function(x,child){return x+child.x;},0)/children.length;}
function d3_layout_clusterLeft(node){var children=node.children;return children&&children.length?d3_layout_clusterLeft(children[0]):node;}
function d3_layout_clusterRight(node){var children=node.children,n;return children&&(n=children.length)?d3_layout_clusterRight(children[n-1]):node;}
d3.layout.treemap=function(){var hierarchy=d3.layout.hierarchy(),round=Math.round,size=[1,1],padding=null,pad=d3_layout_treemapPadNull,sticky=false,stickies,mode="squarify",ratio=.5*(1+Math.sqrt(5));function scale(children,k){var i=-1,n=children.length,child,area;while(++i<n){area=(child=children[i]).value*(k<0?0:k);child.area=isNaN(area)||area<=0?0:area;}}
function squarify(node){var children=node.children;if(children&&children.length){var rect=pad(node),row=[],remaining=children.slice(),child,best=Infinity,score,u=mode==="slice"?rect.dx:mode==="dice"?rect.dy:mode==="slice-dice"?node.depth&1?rect.dy:rect.dx:Math.min(rect.dx,rect.dy),n;scale(remaining,rect.dx*rect.dy/node.value);row.area=0;while((n=remaining.length)>0){row.push(child=remaining[n-1]);row.area+=child.area;if(mode!=="squarify"||(score=worst(row,u))<=best){remaining.pop();best=score;}else{row.area-=row.pop().area;position(row,u,rect,false);u=Math.min(rect.dx,rect.dy);row.length=row.area=0;best=Infinity;}}
if(row.length){position(row,u,rect,true);row.length=row.area=0;}
children.forEach(squarify);}}
function stickify(node){var children=node.children;if(children&&children.length){var rect=pad(node),remaining=children.slice(),child,row=[];scale(remaining,rect.dx*rect.dy/node.value);row.area=0;while(child=remaining.pop()){row.push(child);row.area+=child.area;if(child.z!=null){position(row,child.z?rect.dx:rect.dy,rect,!remaining.length);row.length=row.area=0;}}
children.forEach(stickify);}}
function worst(row,u){var s=row.area,r,rmax=0,rmin=Infinity,i=-1,n=row.length;while(++i<n){if(!(r=row[i].area))continue;if(r<rmin)rmin=r;if(r>rmax)rmax=r;}
s*=s;u*=u;return s?Math.max(u*rmax*ratio/s,s/(u*rmin*ratio)):Infinity;}
function position(row,u,rect,flush){var i=-1,n=row.length,x=rect.x,y=rect.y,v=u?round(row.area/u):0,o;if(u==rect.dx){if(flush||v>rect.dy)v=rect.dy;while(++i<n){o=row[i];o.x=x;o.y=y;o.dy=v;x+=o.dx=Math.min(rect.x+rect.dx-x,v?round(o.area/v):0);}
o.z=true;o.dx+=rect.x+rect.dx-x;rect.y+=v;rect.dy-=v;}else{if(flush||v>rect.dx)v=rect.dx;while(++i<n){o=row[i];o.x=x;o.y=y;o.dx=v;y+=o.dy=Math.min(rect.y+rect.dy-y,v?round(o.area/v):0);}
o.z=false;o.dy+=rect.y+rect.dy-y;rect.x+=v;rect.dx-=v;}}
function treemap(d){var nodes=stickies||hierarchy(d),root=nodes[0];root.x=0;root.y=0;root.dx=size[0];root.dy=size[1];if(stickies)hierarchy.revalue(root);scale([root],root.dx*root.dy/root.value);(stickies?stickify:squarify)(root);if(sticky)stickies=nodes;return nodes;}
treemap.size=function(x){if(!arguments.length)return size;size=x;return treemap;};treemap.padding=function(x){if(!arguments.length)return padding;function padFunction(node){var p=x.call(treemap,node,node.depth);return p==null?d3_layout_treemapPadNull(node):d3_layout_treemapPad(node,typeof p==="number"?[p,p,p,p]:p);}
function padConstant(node){return d3_layout_treemapPad(node,x);}
var type;pad=(padding=x)==null?d3_layout_treemapPadNull:(type=typeof x)==="function"?padFunction:type==="number"?(x=[x,x,x,x],padConstant):padConstant;return treemap;};treemap.round=function(x){if(!arguments.length)return round!=Number;round=x?Math.round:Number;return treemap;};treemap.sticky=function(x){if(!arguments.length)return sticky;sticky=x;stickies=null;return treemap;};treemap.ratio=function(x){if(!arguments.length)return ratio;ratio=x;return treemap;};treemap.mode=function(x){if(!arguments.length)return mode;mode=x+"";return treemap;};return d3_layout_hierarchyRebind(treemap,hierarchy);};function d3_layout_treemapPadNull(node){return{x:node.x,y:node.y,dx:node.dx,dy:node.dy};}
function d3_layout_treemapPad(node,padding){var x=node.x+padding[3],y=node.y+padding[0],dx=node.dx-padding[1]-padding[3],dy=node.dy-padding[0]-padding[2];if(dx<0){x+=dx/2;dx=0;}
if(dy<0){y+=dy/2;dy=0;}
return{x:x,y:y,dx:dx,dy:dy};}
d3.random={normal:function(µ,σ){var n=arguments.length;if(n<2)σ=1;if(n<1)µ=0;return function(){var x,y,r;do{x=Math.random()*2-1;y=Math.random()*2-1;r=x*x+y*y;}while(!r||r>1);return µ+σ*x*Math.sqrt(-2*Math.log(r)/r);};},logNormal:function(){var random=d3.random.normal.apply(d3,arguments);return function(){return Math.exp(random());};},bates:function(m){var random=d3.random.irwinHall(m);return function(){return random()/m;};},irwinHall:function(m){return function(){for(var s=0,j=0;j<m;j++)s+=Math.random();return s;};}};d3.scale={};function d3_scaleExtent(domain){var start=domain[0],stop=domain[domain.length-1];return start<stop?[start,stop]:[stop,start];}
function d3_scaleRange(scale){return scale.rangeExtent?scale.rangeExtent():d3_scaleExtent(scale.range());}
function d3_scale_bilinear(domain,range,uninterpolate,interpolate){var u=uninterpolate(domain[0],domain[1]),i=interpolate(range[0],range[1]);return function(x){return i(u(x));};}
function d3_scale_nice(domain,nice){var i0=0,i1=domain.length-1,x0=domain[i0],x1=domain[i1],dx;if(x1<x0){dx=i0,i0=i1,i1=dx;dx=x0,x0=x1,x1=dx;}
domain[i0]=nice.floor(x0);domain[i1]=nice.ceil(x1);return domain;}
function d3_scale_niceStep(step){return step?{floor:function(x){return Math.floor(x/step)*step;},ceil:function(x){return Math.ceil(x/step)*step;}}:d3_scale_niceIdentity;}
var d3_scale_niceIdentity={floor:d3_identity,ceil:d3_identity};function d3_scale_polylinear(domain,range,uninterpolate,interpolate){var u=[],i=[],j=0,k=Math.min(domain.length,range.length)-1;if(domain[k]<domain[0]){domain=domain.slice().reverse();range=range.slice().reverse();}
while(++j<=k){u.push(uninterpolate(domain[j-1],domain[j]));i.push(interpolate(range[j-1],range[j]));}
return function(x){var j=d3.bisect(domain,x,1,k)-1;return i[j](u[j](x));};}
d3.scale.linear=function(){return d3_scale_linear([0,1],[0,1],d3_interpolate,false);};function d3_scale_linear(domain,range,interpolate,clamp){var output,input;function rescale(){var linear=Math.min(domain.length,range.length)>2?d3_scale_polylinear:d3_scale_bilinear,uninterpolate=clamp?d3_uninterpolateClamp:d3_uninterpolateNumber;output=linear(domain,range,uninterpolate,interpolate);input=linear(range,domain,uninterpolate,d3_interpolate);return scale;}
function scale(x){return output(x);}
scale.invert=function(y){return input(y);};scale.domain=function(x){if(!arguments.length)return domain;domain=x.map(Number);return rescale();};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale();};scale.rangeRound=function(x){return scale.range(x).interpolate(d3_interpolateRound);};scale.clamp=function(x){if(!arguments.length)return clamp;clamp=x;return rescale();};scale.interpolate=function(x){if(!arguments.length)return interpolate;interpolate=x;return rescale();};scale.ticks=function(m){return d3_scale_linearTicks(domain,m);};scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format);};scale.nice=function(m){d3_scale_linearNice(domain,m);return rescale();};scale.copy=function(){return d3_scale_linear(domain,range,interpolate,clamp);};return rescale();}
function d3_scale_linearRebind(scale,linear){return d3.rebind(scale,linear,"range","rangeRound","interpolate","clamp");}
function d3_scale_linearNice(domain,m){return d3_scale_nice(domain,d3_scale_niceStep(d3_scale_linearTickRange(domain,m)[2]));}
function d3_scale_linearTickRange(domain,m){if(m==null)m=10;var extent=d3_scaleExtent(domain),span=extent[1]-extent[0],step=Math.pow(10,Math.floor(Math.log(span/m)/Math.LN10)),err=m/span*step;if(err<=.15)step*=10;else if(err<=.35)step*=5;else if(err<=.75)step*=2;extent[0]=Math.ceil(extent[0]/step)*step;extent[1]=Math.floor(extent[1]/step)*step+step*.5;extent[2]=step;return extent;}
function d3_scale_linearTicks(domain,m){return d3.range.apply(d3,d3_scale_linearTickRange(domain,m));}
function d3_scale_linearTickFormat(domain,m,format){var range=d3_scale_linearTickRange(domain,m);if(format){var match=d3_format_re.exec(format);match.shift();if(match[8]==="s"){var prefix=d3.formatPrefix(Math.max(abs(range[0]),abs(range[1])));if(!match[7])match[7]="."+d3_scale_linearPrecision(prefix.scale(range[2]));match[8]="f";format=d3.format(match.join(""));return function(d){return format(prefix.scale(d))+prefix.symbol;};}
if(!match[7])match[7]="."+d3_scale_linearFormatPrecision(match[8],range);format=match.join("");}else{format=",."+d3_scale_linearPrecision(range[2])+"f";}
return d3.format(format);}
var d3_scale_linearFormatSignificant={s:1,g:1,p:1,r:1,e:1};function d3_scale_linearPrecision(value){return-Math.floor(Math.log(value)/Math.LN10+.01);}
function d3_scale_linearFormatPrecision(type,range){var p=d3_scale_linearPrecision(range[2]);return type in d3_scale_linearFormatSignificant?Math.abs(p-d3_scale_linearPrecision(Math.max(abs(range[0]),abs(range[1]))))+ +(type!=="e"):p-(type==="%")*2;}
d3.scale.log=function(){return d3_scale_log(d3.scale.linear().domain([0,1]),10,true,[1,10]);};function d3_scale_log(linear,base,positive,domain){function log(x){return(positive?Math.log(x<0?0:x):-Math.log(x>0?0:-x))/Math.log(base);}
function pow(x){return positive?Math.pow(base,x):-Math.pow(base,-x);}
function scale(x){return linear(log(x));}
scale.invert=function(x){return pow(linear.invert(x));};scale.domain=function(x){if(!arguments.length)return domain;positive=x[0]>=0;linear.domain((domain=x.map(Number)).map(log));return scale;};scale.base=function(_){if(!arguments.length)return base;base=+_;linear.domain(domain.map(log));return scale;};scale.nice=function(){var niced=d3_scale_nice(domain.map(log),positive?Math:d3_scale_logNiceNegative);linear.domain(niced);domain=niced.map(pow);return scale;};scale.ticks=function(){var extent=d3_scaleExtent(domain),ticks=[],u=extent[0],v=extent[1],i=Math.floor(log(u)),j=Math.ceil(log(v)),n=base%1?2:base;if(isFinite(j-i)){if(positive){for(;i<j;i++)for(var k=1;k<n;k++)ticks.push(pow(i)*k);ticks.push(pow(i));}else{ticks.push(pow(i));for(;i++<j;)for(var k=n-1;k>0;k--)ticks.push(pow(i)*k);}
for(i=0;ticks[i]<u;i++){}
for(j=ticks.length;ticks[j-1]>v;j--){}
ticks=ticks.slice(i,j);}
return ticks;};scale.tickFormat=function(n,format){if(!arguments.length)return d3_scale_logFormat;if(arguments.length<2)format=d3_scale_logFormat;else if(typeof format!=="function")format=d3.format(format);var k=Math.max(.1,n/scale.ticks().length),f=positive?(e=1e-12,Math.ceil):(e=-1e-12,Math.floor),e;return function(d){return d/pow(f(log(d)+e))<=k?format(d):"";};};scale.copy=function(){return d3_scale_log(linear.copy(),base,positive,domain);};return d3_scale_linearRebind(scale,linear);}
var d3_scale_logFormat=d3.format(".0e"),d3_scale_logNiceNegative={floor:function(x){return-Math.ceil(-x);},ceil:function(x){return-Math.floor(-x);}};d3.scale.pow=function(){return d3_scale_pow(d3.scale.linear(),1,[0,1]);};function d3_scale_pow(linear,exponent,domain){var powp=d3_scale_powPow(exponent),powb=d3_scale_powPow(1/exponent);function scale(x){return linear(powp(x));}
scale.invert=function(x){return powb(linear.invert(x));};scale.domain=function(x){if(!arguments.length)return domain;linear.domain((domain=x.map(Number)).map(powp));return scale;};scale.ticks=function(m){return d3_scale_linearTicks(domain,m);};scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format);};scale.nice=function(m){return scale.domain(d3_scale_linearNice(domain,m));};scale.exponent=function(x){if(!arguments.length)return exponent;powp=d3_scale_powPow(exponent=x);powb=d3_scale_powPow(1/exponent);linear.domain(domain.map(powp));return scale;};scale.copy=function(){return d3_scale_pow(linear.copy(),exponent,domain);};return d3_scale_linearRebind(scale,linear);}
function d3_scale_powPow(e){return function(x){return x<0?-Math.pow(-x,e):Math.pow(x,e);};}
d3.scale.sqrt=function(){return d3.scale.pow().exponent(.5);};d3.scale.ordinal=function(){return d3_scale_ordinal([],{t:"range",a:[[]]});};function d3_scale_ordinal(domain,ranger){var index,range,rangeBand;function scale(x){return range[((index.get(x)||(ranger.t==="range"?index.set(x,domain.push(x)):NaN))-1)%range.length];}
function steps(start,step){return d3.range(domain.length).map(function(i){return start+step*i;});}
scale.domain=function(x){if(!arguments.length)return domain;domain=[];index=new d3_Map();var i=-1,n=x.length,xi;while(++i<n)if(!index.has(xi=x[i]))index.set(xi,domain.push(xi));return scale[ranger.t].apply(scale,ranger.a);};scale.range=function(x){if(!arguments.length)return range;range=x;rangeBand=0;ranger={t:"range",a:arguments};return scale;};scale.rangePoints=function(x,padding){if(arguments.length<2)padding=0;var start=x[0],stop=x[1],step=domain.length<2?(start=(start+stop)/2,0):(stop-start)/(domain.length-1+padding);range=steps(start+step*padding/2,step);rangeBand=0;ranger={t:"rangePoints",a:arguments};return scale;};scale.rangeRoundPoints=function(x,padding){if(arguments.length<2)padding=0;var start=x[0],stop=x[1],step=domain.length<2?(start=stop=Math.round((start+stop)/2),0):(stop-start)/(domain.length-1+padding)|0;range=steps(start+Math.round(step*padding/2+(stop-start-(domain.length-1+padding)*step)/2),step);rangeBand=0;ranger={t:"rangeRoundPoints",a:arguments};return scale;};scale.rangeBands=function(x,padding,outerPadding){if(arguments.length<2)padding=0;if(arguments.length<3)outerPadding=padding;var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=(stop-start)/(domain.length-padding+2*outerPadding);range=steps(start+step*outerPadding,step);if(reverse)range.reverse();rangeBand=step*(1-padding);ranger={t:"rangeBands",a:arguments};return scale;};scale.rangeRoundBands=function(x,padding,outerPadding){if(arguments.length<2)padding=0;if(arguments.length<3)outerPadding=padding;var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=Math.floor((stop-start)/(domain.length-padding+2*outerPadding));range=steps(start+Math.round((stop-start-(domain.length-padding)*step)/2),step);if(reverse)range.reverse();rangeBand=Math.round(step*(1-padding));ranger={t:"rangeRoundBands",a:arguments};return scale;};scale.rangeBand=function(){return rangeBand;};scale.rangeExtent=function(){return d3_scaleExtent(ranger.a[0]);};scale.copy=function(){return d3_scale_ordinal(domain,ranger);};return scale.domain(domain);}
d3.scale.category10=function(){return d3.scale.ordinal().range(d3_category10);};d3.scale.category20=function(){return d3.scale.ordinal().range(d3_category20);};d3.scale.category20b=function(){return d3.scale.ordinal().range(d3_category20b);};d3.scale.category20c=function(){return d3.scale.ordinal().range(d3_category20c);};var d3_category10=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(d3_rgbString);var d3_category20=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(d3_rgbString);var d3_category20b=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(d3_rgbString);var d3_category20c=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(d3_rgbString);d3.scale.quantile=function(){return d3_scale_quantile([],[]);};function d3_scale_quantile(domain,range){var thresholds;function rescale(){var k=0,q=range.length;thresholds=[];while(++k<q)thresholds[k-1]=d3.quantile(domain,k/q);return scale;}
function scale(x){if(!isNaN(x=+x))return range[d3.bisect(thresholds,x)];}
scale.domain=function(x){if(!arguments.length)return domain;domain=x.map(d3_number).filter(d3_numeric).sort(d3_ascending);return rescale();};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale();};scale.quantiles=function(){return thresholds;};scale.invertExtent=function(y){y=range.indexOf(y);return y<0?[NaN,NaN]:[y>0?thresholds[y-1]:domain[0],y<thresholds.length?thresholds[y]:domain[domain.length-1]];};scale.copy=function(){return d3_scale_quantile(domain,range);};return rescale();}
d3.scale.quantize=function(){return d3_scale_quantize(0,1,[0,1]);};function d3_scale_quantize(x0,x1,range){var kx,i;function scale(x){return range[Math.max(0,Math.min(i,Math.floor(kx*(x-x0))))];}
function rescale(){kx=range.length/(x1-x0);i=range.length-1;return scale;}
scale.domain=function(x){if(!arguments.length)return[x0,x1];x0=+x[0];x1=+x[x.length-1];return rescale();};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale();};scale.invertExtent=function(y){y=range.indexOf(y);y=y<0?NaN:y/kx+x0;return[y,y+1/kx];};scale.copy=function(){return d3_scale_quantize(x0,x1,range);};return rescale();}
d3.scale.threshold=function(){return d3_scale_threshold([.5],[0,1]);};function d3_scale_threshold(domain,range){function scale(x){if(x<=x)return range[d3.bisect(domain,x)];}
scale.domain=function(_){if(!arguments.length)return domain;domain=_;return scale;};scale.range=function(_){if(!arguments.length)return range;range=_;return scale;};scale.invertExtent=function(y){y=range.indexOf(y);return[domain[y-1],domain[y]];};scale.copy=function(){return d3_scale_threshold(domain,range);};return scale;}
d3.scale.identity=function(){return d3_scale_identity([0,1]);};function d3_scale_identity(domain){function identity(x){return+x;}
identity.invert=identity;identity.domain=identity.range=function(x){if(!arguments.length)return domain;domain=x.map(identity);return identity;};identity.ticks=function(m){return d3_scale_linearTicks(domain,m);};identity.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format);};identity.copy=function(){return d3_scale_identity(domain);};return identity;}
d3.svg={};function d3_zero(){return 0;}
d3.svg.arc=function(){var innerRadius=d3_svg_arcInnerRadius,outerRadius=d3_svg_arcOuterRadius,cornerRadius=d3_zero,padRadius=d3_svg_arcAuto,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle,padAngle=d3_svg_arcPadAngle;function arc(){var r0=Math.max(0,+innerRadius.apply(this,arguments)),r1=Math.max(0,+outerRadius.apply(this,arguments)),a0=startAngle.apply(this,arguments)-halfπ,a1=endAngle.apply(this,arguments)-halfπ,da=Math.abs(a1-a0),cw=a0>a1?0:1;if(r1<r0)rc=r1,r1=r0,r0=rc;if(da>=τε)return circleSegment(r1,cw)+(r0?circleSegment(r0,1-cw):"")+"Z";var rc,cr,rp,ap,p0=0,p1=0,x0,y0,x1,y1,x2,y2,x3,y3,path=[];if(ap=(+padAngle.apply(this,arguments)||0)/2){rp=padRadius===d3_svg_arcAuto?Math.sqrt(r0*r0+r1*r1):+padRadius.apply(this,arguments);if(!cw)p1*=-1;if(r1)p1=d3_asin(rp/r1*Math.sin(ap));if(r0)p0=d3_asin(rp/r0*Math.sin(ap));}
if(r1){x0=r1*Math.cos(a0+p1);y0=r1*Math.sin(a0+p1);x1=r1*Math.cos(a1-p1);y1=r1*Math.sin(a1-p1);var l1=Math.abs(a1-a0-2*p1)<=π?0:1;if(p1&&d3_svg_arcSweep(x0,y0,x1,y1)===cw^l1){var h1=(a0+a1)/2;x0=r1*Math.cos(h1);y0=r1*Math.sin(h1);x1=y1=null;}}else{x0=y0=0;}
if(r0){x2=r0*Math.cos(a1-p0);y2=r0*Math.sin(a1-p0);x3=r0*Math.cos(a0+p0);y3=r0*Math.sin(a0+p0);var l0=Math.abs(a0-a1+2*p0)<=π?0:1;if(p0&&d3_svg_arcSweep(x2,y2,x3,y3)===1-cw^l0){var h0=(a0+a1)/2;x2=r0*Math.cos(h0);y2=r0*Math.sin(h0);x3=y3=null;}}else{x2=y2=0;}
if((rc=Math.min(Math.abs(r1-r0)/2,+cornerRadius.apply(this,arguments)))>.001){cr=r0<r1^cw?0:1;var oc=x3==null?[x2,y2]:x1==null?[x0,y0]:d3_geom_polygonIntersect([x0,y0],[x3,y3],[x1,y1],[x2,y2]),ax=x0-oc[0],ay=y0-oc[1],bx=x1-oc[0],by=y1-oc[1],kc=1/Math.sin(Math.acos((ax*bx+ay*by)/(Math.sqrt(ax*ax+ay*ay)*Math.sqrt(bx*bx+by*by)))/2),lc=Math.sqrt(oc[0]*oc[0]+oc[1]*oc[1]);if(x1!=null){var rc1=Math.min(rc,(r1-lc)/(kc+1)),t30=d3_svg_arcCornerTangents(x3==null?[x2,y2]:[x3,y3],[x0,y0],r1,rc1,cw),t12=d3_svg_arcCornerTangents([x1,y1],[x2,y2],r1,rc1,cw);if(rc===rc1){path.push("M",t30[0],"A",rc1,",",rc1," 0 0,",cr," ",t30[1],"A",r1,",",r1," 0 ",1-cw^d3_svg_arcSweep(t30[1][0],t30[1][1],t12[1][0],t12[1][1]),",",cw," ",t12[1],"A",rc1,",",rc1," 0 0,",cr," ",t12[0]);}else{path.push("M",t30[0],"A",rc1,",",rc1," 0 1,",cr," ",t12[0]);}}else{path.push("M",x0,",",y0);}
if(x3!=null){var rc0=Math.min(rc,(r0-lc)/(kc-1)),t03=d3_svg_arcCornerTangents([x0,y0],[x3,y3],r0,-rc0,cw),t21=d3_svg_arcCornerTangents([x2,y2],x1==null?[x0,y0]:[x1,y1],r0,-rc0,cw);if(rc===rc0){path.push("L",t21[0],"A",rc0,",",rc0," 0 0,",cr," ",t21[1],"A",r0,",",r0," 0 ",cw^d3_svg_arcSweep(t21[1][0],t21[1][1],t03[1][0],t03[1][1]),",",1-cw," ",t03[1],"A",rc0,",",rc0," 0 0,",cr," ",t03[0]);}else{path.push("L",t21[0],"A",rc0,",",rc0," 0 0,",cr," ",t03[0]);}}else{path.push("L",x2,",",y2);}}else{path.push("M",x0,",",y0);if(x1!=null)path.push("A",r1,",",r1," 0 ",l1,",",cw," ",x1,",",y1);path.push("L",x2,",",y2);if(x3!=null)path.push("A",r0,",",r0," 0 ",l0,",",1-cw," ",x3,",",y3);}
path.push("Z");return path.join("");}
function circleSegment(r1,cw){return"M0,"+r1+"A"+r1+","+r1+" 0 1,"+cw+" 0,"+-r1+"A"+r1+","+r1+" 0 1,"+cw+" 0,"+r1;}
arc.innerRadius=function(v){if(!arguments.length)return innerRadius;innerRadius=d3_functor(v);return arc;};arc.outerRadius=function(v){if(!arguments.length)return outerRadius;outerRadius=d3_functor(v);return arc;};arc.cornerRadius=function(v){if(!arguments.length)return cornerRadius;cornerRadius=d3_functor(v);return arc;};arc.padRadius=function(v){if(!arguments.length)return padRadius;padRadius=v==d3_svg_arcAuto?d3_svg_arcAuto:d3_functor(v);return arc;};arc.startAngle=function(v){if(!arguments.length)return startAngle;startAngle=d3_functor(v);return arc;};arc.endAngle=function(v){if(!arguments.length)return endAngle;endAngle=d3_functor(v);return arc;};arc.padAngle=function(v){if(!arguments.length)return padAngle;padAngle=d3_functor(v);return arc;};arc.centroid=function(){var r=(+innerRadius.apply(this,arguments)+ +outerRadius.apply(this,arguments))/2,a=(+startAngle.apply(this,arguments)+ +endAngle.apply(this,arguments))/2-halfπ;return[Math.cos(a)*r,Math.sin(a)*r];};return arc;};var d3_svg_arcAuto="auto";function d3_svg_arcInnerRadius(d){return d.innerRadius;}
function d3_svg_arcOuterRadius(d){return d.outerRadius;}
function d3_svg_arcStartAngle(d){return d.startAngle;}
function d3_svg_arcEndAngle(d){return d.endAngle;}
function d3_svg_arcPadAngle(d){return d&&d.padAngle;}
function d3_svg_arcSweep(x0,y0,x1,y1){return(x0-x1)*y0-(y0-y1)*x0>0?0:1;}
function d3_svg_arcCornerTangents(p0,p1,r1,rc,cw){var x01=p0[0]-p1[0],y01=p0[1]-p1[1],lo=(cw?rc:-rc)/Math.sqrt(x01*x01+y01*y01),ox=lo*y01,oy=-lo*x01,x1=p0[0]+ox,y1=p0[1]+oy,x2=p1[0]+ox,y2=p1[1]+oy,x3=(x1+x2)/2,y3=(y1+y2)/2,dx=x2-x1,dy=y2-y1,d2=dx*dx+dy*dy,r=r1-rc,D=x1*y2-x2*y1,d=(dy<0?-1:1)*Math.sqrt(r*r*d2-D*D),cx0=(D*dy-dx*d)/d2,cy0=(-D*dx-dy*d)/d2,cx1=(D*dy+dx*d)/d2,cy1=(-D*dx+dy*d)/d2,dx0=cx0-x3,dy0=cy0-y3,dx1=cx1-x3,dy1=cy1-y3;if(dx0*dx0+dy0*dy0>dx1*dx1+dy1*dy1)cx0=cx1,cy0=cy1;return[[cx0-ox,cy0-oy],[cx0*r1/r,cy0*r1/r]];}
function d3_svg_line(projection){var x=d3_geom_pointX,y=d3_geom_pointY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,tension=.7;function line(data){var segments=[],points=[],i=-1,n=data.length,d,fx=d3_functor(x),fy=d3_functor(y);function segment(){segments.push("M",interpolate(projection(points),tension));}
while(++i<n){if(defined.call(this,d=data[i],i)){points.push([+fx.call(this,d,i),+fy.call(this,d,i)]);}else if(points.length){segment();points=[];}}
if(points.length)segment();return segments.length?segments.join(""):null;}
line.x=function(_){if(!arguments.length)return x;x=_;return line;};line.y=function(_){if(!arguments.length)return y;y=_;return line;};line.defined=function(_){if(!arguments.length)return defined;defined=_;return line;};line.interpolate=function(_){if(!arguments.length)return interpolateKey;if(typeof _==="function")interpolateKey=interpolate=_;else interpolateKey=(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key;return line;};line.tension=function(_){if(!arguments.length)return tension;tension=_;return line;};return line;}
d3.svg.line=function(){return d3_svg_line(d3_identity);};var d3_svg_lineInterpolators=d3.map({linear:d3_svg_lineLinear,"linear-closed":d3_svg_lineLinearClosed,step:d3_svg_lineStep,"step-before":d3_svg_lineStepBefore,"step-after":d3_svg_lineStepAfter,basis:d3_svg_lineBasis,"basis-open":d3_svg_lineBasisOpen,"basis-closed":d3_svg_lineBasisClosed,bundle:d3_svg_lineBundle,cardinal:d3_svg_lineCardinal,"cardinal-open":d3_svg_lineCardinalOpen,"cardinal-closed":d3_svg_lineCardinalClosed,monotone:d3_svg_lineMonotone});d3_svg_lineInterpolators.forEach(function(key,value){value.key=key;value.closed=/-closed$/.test(key);});function d3_svg_lineLinear(points){return points.join("L");}
function d3_svg_lineLinearClosed(points){return d3_svg_lineLinear(points)+"Z";}
function d3_svg_lineStep(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("H",(p[0]+(p=points[i])[0])/2,"V",p[1]);if(n>1)path.push("H",p[0]);return path.join("");}
function d3_svg_lineStepBefore(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("V",(p=points[i])[1],"H",p[0]);return path.join("");}
function d3_svg_lineStepAfter(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("H",(p=points[i])[0],"V",p[1]);return path.join("");}
function d3_svg_lineCardinalOpen(points,tension){return points.length<4?d3_svg_lineLinear(points):points[1]+d3_svg_lineHermite(points.slice(1,-1),d3_svg_lineCardinalTangents(points,tension));}
function d3_svg_lineCardinalClosed(points,tension){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite((points.push(points[0]),points),d3_svg_lineCardinalTangents([points[points.length-2]].concat(points,[points[1]]),tension));}
function d3_svg_lineCardinal(points,tension){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineCardinalTangents(points,tension));}
function d3_svg_lineHermite(points,tangents){if(tangents.length<1||points.length!=tangents.length&&points.length!=tangents.length+2){return d3_svg_lineLinear(points);}
var quad=points.length!=tangents.length,path="",p0=points[0],p=points[1],t0=tangents[0],t=t0,pi=1;if(quad){path+="Q"+(p[0]-t0[0]*2/3)+","+(p[1]-t0[1]*2/3)+","+p[0]+","+p[1];p0=points[1];pi=2;}
if(tangents.length>1){t=tangents[1];p=points[pi];pi++;path+="C"+(p0[0]+t0[0])+","+(p0[1]+t0[1])+","+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1];for(var i=2;i<tangents.length;i++,pi++){p=points[pi];t=tangents[i];path+="S"+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1];}}
if(quad){var lp=points[pi];path+="Q"+(p[0]+t[0]*2/3)+","+(p[1]+t[1]*2/3)+","+lp[0]+","+lp[1];}
return path;}
function d3_svg_lineCardinalTangents(points,tension){var tangents=[],a=(1-tension)/2,p0,p1=points[0],p2=points[1],i=1,n=points.length;while(++i<n){p0=p1;p1=p2;p2=points[i];tangents.push([a*(p2[0]-p0[0]),a*(p2[1]-p0[1])]);}
return tangents;}
function d3_svg_lineBasis(points){if(points.length<3)return d3_svg_lineLinear(points);var i=1,n=points.length,pi=points[0],x0=pi[0],y0=pi[1],px=[x0,x0,x0,(pi=points[1])[0]],py=[y0,y0,y0,pi[1]],path=[x0,",",y0,"L",d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)];points.push(points[n-1]);while(++i<=n){pi=points[i];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py);}
points.pop();path.push("L",pi);return path.join("");}
function d3_svg_lineBasisOpen(points){if(points.length<4)return d3_svg_lineLinear(points);var path=[],i=-1,n=points.length,pi,px=[0],py=[0];while(++i<3){pi=points[i];px.push(pi[0]);py.push(pi[1]);}
path.push(d3_svg_lineDot4(d3_svg_lineBasisBezier3,px)+","+d3_svg_lineDot4(d3_svg_lineBasisBezier3,py));--i;while(++i<n){pi=points[i];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py);}
return path.join("");}
function d3_svg_lineBasisClosed(points){var path,i=-1,n=points.length,m=n+4,pi,px=[],py=[];while(++i<4){pi=points[i%n];px.push(pi[0]);py.push(pi[1]);}
path=[d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)];--i;while(++i<m){pi=points[i%n];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py);}
return path.join("");}
function d3_svg_lineBundle(points,tension){var n=points.length-1;if(n){var x0=points[0][0],y0=points[0][1],dx=points[n][0]-x0,dy=points[n][1]-y0,i=-1,p,t;while(++i<=n){p=points[i];t=i/n;p[0]=tension*p[0]+(1-tension)*(x0+t*dx);p[1]=tension*p[1]+(1-tension)*(y0+t*dy);}}
return d3_svg_lineBasis(points);}
function d3_svg_lineDot4(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3];}
var d3_svg_lineBasisBezier1=[0,2/3,1/3,0],d3_svg_lineBasisBezier2=[0,1/3,2/3,0],d3_svg_lineBasisBezier3=[0,1/6,2/3,1/6];function d3_svg_lineBasisBezier(path,x,y){path.push("C",d3_svg_lineDot4(d3_svg_lineBasisBezier1,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier1,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,y));}
function d3_svg_lineSlope(p0,p1){return(p1[1]-p0[1])/(p1[0]-p0[0]);}
function d3_svg_lineFiniteDifferences(points){var i=0,j=points.length-1,m=[],p0=points[0],p1=points[1],d=m[0]=d3_svg_lineSlope(p0,p1);while(++i<j){m[i]=(d+(d=d3_svg_lineSlope(p0=p1,p1=points[i+1])))/2;}
m[i]=d;return m;}
function d3_svg_lineMonotoneTangents(points){var tangents=[],d,a,b,s,m=d3_svg_lineFiniteDifferences(points),i=-1,j=points.length-1;while(++i<j){d=d3_svg_lineSlope(points[i],points[i+1]);if(abs(d)<ε){m[i]=m[i+1]=0;}else{a=m[i]/d;b=m[i+1]/d;s=a*a+b*b;if(s>9){s=d*3/Math.sqrt(s);m[i]=s*a;m[i+1]=s*b;}}}
i=-1;while(++i<=j){s=(points[Math.min(j,i+1)][0]-points[Math.max(0,i-1)][0])/(6*(1+m[i]*m[i]));tangents.push([s||0,m[i]*s||0]);}
return tangents;}
function d3_svg_lineMonotone(points){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineMonotoneTangents(points));}
d3.svg.line.radial=function(){var line=d3_svg_line(d3_svg_lineRadial);line.radius=line.x,delete line.x;line.angle=line.y,delete line.y;return line;};function d3_svg_lineRadial(points){var point,i=-1,n=points.length,r,a;while(++i<n){point=points[i];r=point[0];a=point[1]-halfπ;point[0]=r*Math.cos(a);point[1]=r*Math.sin(a);}
return points;}
function d3_svg_area(projection){var x0=d3_geom_pointX,x1=d3_geom_pointX,y0=0,y1=d3_geom_pointY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,interpolateReverse=interpolate,L="L",tension=.7;function area(data){var segments=[],points0=[],points1=[],i=-1,n=data.length,d,fx0=d3_functor(x0),fy0=d3_functor(y0),fx1=x0===x1?function(){return x;}:d3_functor(x1),fy1=y0===y1?function(){return y;}:d3_functor(y1),x,y;function segment(){segments.push("M",interpolate(projection(points1),tension),L,interpolateReverse(projection(points0.reverse()),tension),"Z");}
while(++i<n){if(defined.call(this,d=data[i],i)){points0.push([x=+fx0.call(this,d,i),y=+fy0.call(this,d,i)]);points1.push([+fx1.call(this,d,i),+fy1.call(this,d,i)]);}else if(points0.length){segment();points0=[];points1=[];}}
if(points0.length)segment();return segments.length?segments.join(""):null;}
area.x=function(_){if(!arguments.length)return x1;x0=x1=_;return area;};area.x0=function(_){if(!arguments.length)return x0;x0=_;return area;};area.x1=function(_){if(!arguments.length)return x1;x1=_;return area;};area.y=function(_){if(!arguments.length)return y1;y0=y1=_;return area;};area.y0=function(_){if(!arguments.length)return y0;y0=_;return area;};area.y1=function(_){if(!arguments.length)return y1;y1=_;return area;};area.defined=function(_){if(!arguments.length)return defined;defined=_;return area;};area.interpolate=function(_){if(!arguments.length)return interpolateKey;if(typeof _==="function")interpolateKey=interpolate=_;else interpolateKey=(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key;interpolateReverse=interpolate.reverse||interpolate;L=interpolate.closed?"M":"L";return area;};area.tension=function(_){if(!arguments.length)return tension;tension=_;return area;};return area;}
d3_svg_lineStepBefore.reverse=d3_svg_lineStepAfter;d3_svg_lineStepAfter.reverse=d3_svg_lineStepBefore;d3.svg.area=function(){return d3_svg_area(d3_identity);};d3.svg.area.radial=function(){var area=d3_svg_area(d3_svg_lineRadial);area.radius=area.x,delete area.x;area.innerRadius=area.x0,delete area.x0;area.outerRadius=area.x1,delete area.x1;area.angle=area.y,delete area.y;area.startAngle=area.y0,delete area.y0;area.endAngle=area.y1,delete area.y1;return area;};d3.svg.chord=function(){var source=d3_source,target=d3_target,radius=d3_svg_chordRadius,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle;function chord(d,i){var s=subgroup(this,source,d,i),t=subgroup(this,target,d,i);return"M"+s.p0+arc(s.r,s.p1,s.a1-s.a0)+(equals(s,t)?curve(s.r,s.p1,s.r,s.p0):curve(s.r,s.p1,t.r,t.p0)+arc(t.r,t.p1,t.a1-t.a0)+curve(t.r,t.p1,s.r,s.p0))+"Z";}
function subgroup(self,f,d,i){var subgroup=f.call(self,d,i),r=radius.call(self,subgroup,i),a0=startAngle.call(self,subgroup,i)-halfπ,a1=endAngle.call(self,subgroup,i)-halfπ;return{r:r,a0:a0,a1:a1,p0:[r*Math.cos(a0),r*Math.sin(a0)],p1:[r*Math.cos(a1),r*Math.sin(a1)]};}
function equals(a,b){return a.a0==b.a0&&a.a1==b.a1;}
function arc(r,p,a){return"A"+r+","+r+" 0 "+ +(a>π)+",1 "+p;}
function curve(r0,p0,r1,p1){return"Q 0,0 "+p1;}
chord.radius=function(v){if(!arguments.length)return radius;radius=d3_functor(v);return chord;};chord.source=function(v){if(!arguments.length)return source;source=d3_functor(v);return chord;};chord.target=function(v){if(!arguments.length)return target;target=d3_functor(v);return chord;};chord.startAngle=function(v){if(!arguments.length)return startAngle;startAngle=d3_functor(v);return chord;};chord.endAngle=function(v){if(!arguments.length)return endAngle;endAngle=d3_functor(v);return chord;};return chord;};function d3_svg_chordRadius(d){return d.radius;}
d3.svg.diagonal=function(){var source=d3_source,target=d3_target,projection=d3_svg_diagonalProjection;function diagonal(d,i){var p0=source.call(this,d,i),p3=target.call(this,d,i),m=(p0.y+p3.y)/2,p=[p0,{x:p0.x,y:m},{x:p3.x,y:m},p3];p=p.map(projection);return"M"+p[0]+"C"+p[1]+" "+p[2]+" "+p[3];}
diagonal.source=function(x){if(!arguments.length)return source;source=d3_functor(x);return diagonal;};diagonal.target=function(x){if(!arguments.length)return target;target=d3_functor(x);return diagonal;};diagonal.projection=function(x){if(!arguments.length)return projection;projection=x;return diagonal;};return diagonal;};function d3_svg_diagonalProjection(d){return[d.x,d.y];}
d3.svg.diagonal.radial=function(){var diagonal=d3.svg.diagonal(),projection=d3_svg_diagonalProjection,projection_=diagonal.projection;diagonal.projection=function(x){return arguments.length?projection_(d3_svg_diagonalRadialProjection(projection=x)):projection;};return diagonal;};function d3_svg_diagonalRadialProjection(projection){return function(){var d=projection.apply(this,arguments),r=d[0],a=d[1]-halfπ;return[r*Math.cos(a),r*Math.sin(a)];};}
d3.svg.symbol=function(){var type=d3_svg_symbolType,size=d3_svg_symbolSize;function symbol(d,i){return(d3_svg_symbols.get(type.call(this,d,i))||d3_svg_symbolCircle)(size.call(this,d,i));}
symbol.type=function(x){if(!arguments.length)return type;type=d3_functor(x);return symbol;};symbol.size=function(x){if(!arguments.length)return size;size=d3_functor(x);return symbol;};return symbol;};function d3_svg_symbolSize(){return 64;}
function d3_svg_symbolType(){return"circle";}
function d3_svg_symbolCircle(size){var r=Math.sqrt(size/π);return"M0,"+r+"A"+r+","+r+" 0 1,1 0,"+-r+"A"+r+","+r+" 0 1,1 0,"+r+"Z";}
var d3_svg_symbols=d3.map({circle:d3_svg_symbolCircle,cross:function(size){var r=Math.sqrt(size/5)/2;return"M"+-3*r+","+-r+"H"+-r+"V"+-3*r+"H"+r+"V"+-r+"H"+3*r+"V"+r+"H"+r+"V"+3*r+"H"+-r+"V"+r+"H"+-3*r+"Z";},diamond:function(size){var ry=Math.sqrt(size/(2*d3_svg_symbolTan30)),rx=ry*d3_svg_symbolTan30;return"M0,"+-ry+"L"+rx+",0"+" 0,"+ry+" "+-rx+",0"+"Z";},square:function(size){var r=Math.sqrt(size)/2;return"M"+-r+","+-r+"L"+r+","+-r+" "+r+","+r+" "+-r+","+r+"Z";},"triangle-down":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+ry+"L"+rx+","+-ry+" "+-rx+","+-ry+"Z";},"triangle-up":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+-ry+"L"+rx+","+ry+" "+-rx+","+ry+"Z";}});d3.svg.symbolTypes=d3_svg_symbols.keys();var d3_svg_symbolSqrt3=Math.sqrt(3),d3_svg_symbolTan30=Math.tan(30*d3_radians);d3_selectionPrototype.transition=function(name){var id=d3_transitionInheritId||++d3_transitionId,ns=d3_transitionNamespace(name),subgroups=[],subgroup,node,transition=d3_transitionInherit||{time:Date.now(),ease:d3_ease_cubicInOut,delay:0,duration:250};for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i])d3_transitionNode(node,i,ns,id,transition);subgroup.push(node);}}
return d3_transition(subgroups,ns,id);};d3_selectionPrototype.interrupt=function(name){return this.each(name==null?d3_selection_interrupt:d3_selection_interruptNS(d3_transitionNamespace(name)));};var d3_selection_interrupt=d3_selection_interruptNS(d3_transitionNamespace());function d3_selection_interruptNS(ns){return function(){var lock,active;if((lock=this[ns])&&(active=lock[lock.active])){if(--lock.count)delete lock[lock.active];else delete this[ns];lock.active+=.5;active.event&&active.event.interrupt.call(this,this.__data__,active.index);}};}
function d3_transition(groups,ns,id){d3_subclass(groups,d3_transitionPrototype);groups.namespace=ns;groups.id=id;return groups;}
var d3_transitionPrototype=[],d3_transitionId=0,d3_transitionInheritId,d3_transitionInherit;d3_transitionPrototype.call=d3_selectionPrototype.call;d3_transitionPrototype.empty=d3_selectionPrototype.empty;d3_transitionPrototype.node=d3_selectionPrototype.node;d3_transitionPrototype.size=d3_selectionPrototype.size;d3.transition=function(selection,name){return selection&&selection.transition?d3_transitionInheritId?selection.transition(name):selection:d3.selection().transition(selection);};d3.transition.prototype=d3_transitionPrototype;d3_transitionPrototype.select=function(selector){var id=this.id,ns=this.namespace,subgroups=[],subgroup,subnode,node;selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;){if((node=group[i])&&(subnode=selector.call(node,node.__data__,i,j))){if("__data__"in node)subnode.__data__=node.__data__;d3_transitionNode(subnode,i,ns,id,node[ns][id]);subgroup.push(subnode);}else{subgroup.push(null);}}}
return d3_transition(subgroups,ns,id);};d3_transitionPrototype.selectAll=function(selector){var id=this.id,ns=this.namespace,subgroups=[],subgroup,subnodes,node,subnode,transition;selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i]){transition=node[ns][id];subnodes=selector.call(node,node.__data__,i,j);subgroups.push(subgroup=[]);for(var k=-1,o=subnodes.length;++k<o;){if(subnode=subnodes[k])d3_transitionNode(subnode,k,ns,id,transition);subgroup.push(subnode);}}}}
return d3_transition(subgroups,ns,id);};d3_transitionPrototype.filter=function(filter){var subgroups=[],subgroup,group,node;if(typeof filter!=="function")filter=d3_selection_filter(filter);for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group=this[j],i=0,n=group.length;i<n;i++){if((node=group[i])&&filter.call(node,node.__data__,i,j)){subgroup.push(node);}}}
return d3_transition(subgroups,this.namespace,this.id);};d3_transitionPrototype.tween=function(name,tween){var id=this.id,ns=this.namespace;if(arguments.length<2)return this.node()[ns][id].tween.get(name);return d3_selection_each(this,tween==null?function(node){node[ns][id].tween.remove(name);}:function(node){node[ns][id].tween.set(name,tween);});};function d3_transition_tween(groups,name,value,tween){var id=groups.id,ns=groups.namespace;return d3_selection_each(groups,typeof value==="function"?function(node,i,j){node[ns][id].tween.set(name,tween(value.call(node,node.__data__,i,j)));}:(value=tween(value),function(node){node[ns][id].tween.set(name,value);}));}
d3_transitionPrototype.attr=function(nameNS,value){if(arguments.length<2){for(value in nameNS)this.attr(value,nameNS[value]);return this;}
var interpolate=nameNS=="transform"?d3_interpolateTransform:d3_interpolate,name=d3.ns.qualify(nameNS);function attrNull(){this.removeAttribute(name);}
function attrNullNS(){this.removeAttributeNS(name.space,name.local);}
function attrTween(b){return b==null?attrNull:(b+="",function(){var a=this.getAttribute(name),i;return a!==b&&(i=interpolate(a,b),function(t){this.setAttribute(name,i(t));});});}
function attrTweenNS(b){return b==null?attrNullNS:(b+="",function(){var a=this.getAttributeNS(name.space,name.local),i;return a!==b&&(i=interpolate(a,b),function(t){this.setAttributeNS(name.space,name.local,i(t));});});}
return d3_transition_tween(this,"attr."+nameNS,value,name.local?attrTweenNS:attrTween);};d3_transitionPrototype.attrTween=function(nameNS,tween){var name=d3.ns.qualify(nameNS);function attrTween(d,i){var f=tween.call(this,d,i,this.getAttribute(name));return f&&function(t){this.setAttribute(name,f(t));};}
function attrTweenNS(d,i){var f=tween.call(this,d,i,this.getAttributeNS(name.space,name.local));return f&&function(t){this.setAttributeNS(name.space,name.local,f(t));};}
return this.tween("attr."+nameNS,name.local?attrTweenNS:attrTween);};d3_transitionPrototype.style=function(name,value,priority){var n=arguments.length;if(n<3){if(typeof name!=="string"){if(n<2)value="";for(priority in name)this.style(priority,name[priority],value);return this;}
priority="";}
function styleNull(){this.style.removeProperty(name);}
function styleString(b){return b==null?styleNull:(b+="",function(){var a=d3_window(this).getComputedStyle(this,null).getPropertyValue(name),i;return a!==b&&(i=d3_interpolate(a,b),function(t){this.style.setProperty(name,i(t),priority);});});}
return d3_transition_tween(this,"style."+name,value,styleString);};d3_transitionPrototype.styleTween=function(name,tween,priority){if(arguments.length<3)priority="";function styleTween(d,i){var f=tween.call(this,d,i,d3_window(this).getComputedStyle(this,null).getPropertyValue(name));return f&&function(t){this.style.setProperty(name,f(t),priority);};}
return this.tween("style."+name,styleTween);};d3_transitionPrototype.text=function(value){return d3_transition_tween(this,"text",value,d3_transition_text);};function d3_transition_text(b){if(b==null)b="";return function(){this.textContent=b;};}
d3_transitionPrototype.remove=function(){var ns=this.namespace;return this.each("end.transition",function(){var p;if(this[ns].count<2&&(p=this.parentNode))p.removeChild(this);});};d3_transitionPrototype.ease=function(value){var id=this.id,ns=this.namespace;if(arguments.length<1)return this.node()[ns][id].ease;if(typeof value!=="function")value=d3.ease.apply(d3,arguments);return d3_selection_each(this,function(node){node[ns][id].ease=value;});};d3_transitionPrototype.delay=function(value){var id=this.id,ns=this.namespace;if(arguments.length<1)return this.node()[ns][id].delay;return d3_selection_each(this,typeof value==="function"?function(node,i,j){node[ns][id].delay=+value.call(node,node.__data__,i,j);}:(value=+value,function(node){node[ns][id].delay=value;}));};d3_transitionPrototype.duration=function(value){var id=this.id,ns=this.namespace;if(arguments.length<1)return this.node()[ns][id].duration;return d3_selection_each(this,typeof value==="function"?function(node,i,j){node[ns][id].duration=Math.max(1,value.call(node,node.__data__,i,j));}:(value=Math.max(1,value),function(node){node[ns][id].duration=value;}));};d3_transitionPrototype.each=function(type,listener){var id=this.id,ns=this.namespace;if(arguments.length<2){var inherit=d3_transitionInherit,inheritId=d3_transitionInheritId;try{d3_transitionInheritId=id;d3_selection_each(this,function(node,i,j){d3_transitionInherit=node[ns][id];type.call(node,node.__data__,i,j);});}finally{d3_transitionInherit=inherit;d3_transitionInheritId=inheritId;}}else{d3_selection_each(this,function(node){var transition=node[ns][id];(transition.event||(transition.event=d3.dispatch("start","end","interrupt"))).on(type,listener);});}
return this;};d3_transitionPrototype.transition=function(){var id0=this.id,id1=++d3_transitionId,ns=this.namespace,subgroups=[],subgroup,group,node,transition;for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group=this[j],i=0,n=group.length;i<n;i++){if(node=group[i]){transition=node[ns][id0];d3_transitionNode(node,i,ns,id1,{time:transition.time,ease:transition.ease,delay:transition.delay+transition.duration,duration:transition.duration});}
subgroup.push(node);}}
return d3_transition(subgroups,ns,id1);};function d3_transitionNamespace(name){return name==null?"__transition__":"__transition_"+name+"__";}
function d3_transitionNode(node,i,ns,id,inherit){var lock=node[ns]||(node[ns]={active:0,count:0}),transition=lock[id];if(!transition){var time=inherit.time;transition=lock[id]={tween:new d3_Map(),time:time,delay:inherit.delay,duration:inherit.duration,ease:inherit.ease,index:i};inherit=null;++lock.count;d3.timer(function(elapsed){var delay=transition.delay,duration,ease,timer=d3_timer_active,tweened=[];timer.t=delay+time;if(delay<=elapsed)return start(elapsed-delay);timer.c=start;function start(elapsed){if(lock.active>id)return stop();var active=lock[lock.active];if(active){--lock.count;delete lock[lock.active];active.event&&active.event.interrupt.call(node,node.__data__,active.index);}
lock.active=id;transition.event&&transition.event.start.call(node,node.__data__,i);transition.tween.forEach(function(key,value){if(value=value.call(node,node.__data__,i)){tweened.push(value);}});ease=transition.ease;duration=transition.duration;d3.timer(function(){timer.c=tick(elapsed||1)?d3_true:tick;return 1;},0,time);}
function tick(elapsed){if(lock.active!==id)return 1;var t=elapsed/duration,e=ease(t),n=tweened.length;while(n>0){tweened[--n].call(node,e);}
if(t>=1){transition.event&&transition.event.end.call(node,node.__data__,i);return stop();}}
function stop(){if(--lock.count)delete lock[id];else delete node[ns];return 1;}},0,time);}}
d3.svg.axis=function(){var scale=d3.scale.linear(),orient=d3_svg_axisDefaultOrient,innerTickSize=6,outerTickSize=6,tickPadding=3,tickArguments_=[10],tickValues=null,tickFormat_;function axis(g){g.each(function(){var g=d3.select(this);var scale0=this.__chart__||scale,scale1=this.__chart__=scale.copy();var ticks=tickValues==null?scale1.ticks?scale1.ticks.apply(scale1,tickArguments_):scale1.domain():tickValues,tickFormat=tickFormat_==null?scale1.tickFormat?scale1.tickFormat.apply(scale1,tickArguments_):d3_identity:tickFormat_,tick=g.selectAll(".tick").data(ticks,scale1),tickEnter=tick.enter().insert("g",".domain").attr("class","tick").style("opacity",ε),tickExit=d3.transition(tick.exit()).style("opacity",ε).remove(),tickUpdate=d3.transition(tick.order()).style("opacity",1),tickSpacing=Math.max(innerTickSize,0)+tickPadding,tickTransform;var range=d3_scaleRange(scale1),path=g.selectAll(".domain").data([0]),pathUpdate=(path.enter().append("path").attr("class","domain"),d3.transition(path));tickEnter.append("line");tickEnter.append("text");var lineEnter=tickEnter.select("line"),lineUpdate=tickUpdate.select("line"),text=tick.select("text").text(tickFormat),textEnter=tickEnter.select("text"),textUpdate=tickUpdate.select("text"),sign=orient==="top"||orient==="left"?-1:1,x1,x2,y1,y2;if(orient==="bottom"||orient==="top"){tickTransform=d3_svg_axisX,x1="x",y1="y",x2="x2",y2="y2";text.attr("dy",sign<0?"0em":".71em").style("text-anchor","middle");pathUpdate.attr("d","M"+range[0]+","+sign*outerTickSize+"V0H"+range[1]+"V"+sign*outerTickSize);}else{tickTransform=d3_svg_axisY,x1="y",y1="x",x2="y2",y2="x2";text.attr("dy",".32em").style("text-anchor",sign<0?"end":"start");pathUpdate.attr("d","M"+sign*outerTickSize+","+range[0]+"H0V"+range[1]+"H"+sign*outerTickSize);}
lineEnter.attr(y2,sign*innerTickSize);textEnter.attr(y1,sign*tickSpacing);lineUpdate.attr(x2,0).attr(y2,sign*innerTickSize);textUpdate.attr(x1,0).attr(y1,sign*tickSpacing);if(scale1.rangeBand){var x=scale1,dx=x.rangeBand()/2;scale0=scale1=function(d){return x(d)+dx;};}else if(scale0.rangeBand){scale0=scale1;}else{tickExit.call(tickTransform,scale1,scale0);}
tickEnter.call(tickTransform,scale0,scale1);tickUpdate.call(tickTransform,scale1,scale1);});}
axis.scale=function(x){if(!arguments.length)return scale;scale=x;return axis;};axis.orient=function(x){if(!arguments.length)return orient;orient=x in d3_svg_axisOrients?x+"":d3_svg_axisDefaultOrient;return axis;};axis.ticks=function(){if(!arguments.length)return tickArguments_;tickArguments_=arguments;return axis;};axis.tickValues=function(x){if(!arguments.length)return tickValues;tickValues=x;return axis;};axis.tickFormat=function(x){if(!arguments.length)return tickFormat_;tickFormat_=x;return axis;};axis.tickSize=function(x){var n=arguments.length;if(!n)return innerTickSize;innerTickSize=+x;outerTickSize=+arguments[n-1];return axis;};axis.innerTickSize=function(x){if(!arguments.length)return innerTickSize;innerTickSize=+x;return axis;};axis.outerTickSize=function(x){if(!arguments.length)return outerTickSize;outerTickSize=+x;return axis;};axis.tickPadding=function(x){if(!arguments.length)return tickPadding;tickPadding=+x;return axis;};axis.tickSubdivide=function(){return arguments.length&&axis;};return axis;};var d3_svg_axisDefaultOrient="bottom",d3_svg_axisOrients={top:1,right:1,bottom:1,left:1};function d3_svg_axisX(selection,x0,x1){selection.attr("transform",function(d){var v0=x0(d);return"translate("+(isFinite(v0)?v0:x1(d))+",0)";});}
function d3_svg_axisY(selection,y0,y1){selection.attr("transform",function(d){var v0=y0(d);return"translate(0,"+(isFinite(v0)?v0:y1(d))+")";});}
d3.svg.brush=function(){var event=d3_eventDispatch(brush,"brushstart","brush","brushend"),x=null,y=null,xExtent=[0,0],yExtent=[0,0],xExtentDomain,yExtentDomain,xClamp=true,yClamp=true,resizes=d3_svg_brushResizes[0];function brush(g){g.each(function(){var g=d3.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",brushstart).on("touchstart.brush",brushstart);var background=g.selectAll(".background").data([0]);background.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair");g.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var resize=g.selectAll(".resize").data(resizes,d3_identity);resize.exit().remove();resize.enter().append("g").attr("class",function(d){return"resize "+d;}).style("cursor",function(d){return d3_svg_brushCursor[d];}).append("rect").attr("x",function(d){return/[ew]$/.test(d)?-3:null;}).attr("y",function(d){return/^[ns]/.test(d)?-3:null;}).attr("width",6).attr("height",6).style("visibility","hidden");resize.style("display",brush.empty()?"none":null);var gUpdate=d3.transition(g),backgroundUpdate=d3.transition(background),range;if(x){range=d3_scaleRange(x);backgroundUpdate.attr("x",range[0]).attr("width",range[1]-range[0]);redrawX(gUpdate);}
if(y){range=d3_scaleRange(y);backgroundUpdate.attr("y",range[0]).attr("height",range[1]-range[0]);redrawY(gUpdate);}
redraw(gUpdate);});}
brush.event=function(g){g.each(function(){var event_=event.of(this,arguments),extent1={x:xExtent,y:yExtent,i:xExtentDomain,j:yExtentDomain},extent0=this.__chart__||extent1;this.__chart__=extent1;if(d3_transitionInheritId){d3.select(this).transition().each("start.brush",function(){xExtentDomain=extent0.i;yExtentDomain=extent0.j;xExtent=extent0.x;yExtent=extent0.y;event_({type:"brushstart"});}).tween("brush:brush",function(){var xi=d3_interpolateArray(xExtent,extent1.x),yi=d3_interpolateArray(yExtent,extent1.y);xExtentDomain=yExtentDomain=null;return function(t){xExtent=extent1.x=xi(t);yExtent=extent1.y=yi(t);event_({type:"brush",mode:"resize"});};}).each("end.brush",function(){xExtentDomain=extent1.i;yExtentDomain=extent1.j;event_({type:"brush",mode:"resize"});event_({type:"brushend"});});}else{event_({type:"brushstart"});event_({type:"brush",mode:"resize"});event_({type:"brushend"});}});};function redraw(g){g.selectAll(".resize").attr("transform",function(d){return"translate("+xExtent[+/e$/.test(d)]+","+yExtent[+/^s/.test(d)]+")";});}
function redrawX(g){g.select(".extent").attr("x",xExtent[0]);g.selectAll(".extent,.n>rect,.s>rect").attr("width",xExtent[1]-xExtent[0]);}
function redrawY(g){g.select(".extent").attr("y",yExtent[0]);g.selectAll(".extent,.e>rect,.w>rect").attr("height",yExtent[1]-yExtent[0]);}
function brushstart(){var target=this,eventTarget=d3.select(d3.event.target),event_=event.of(target,arguments),g=d3.select(target),resizing=eventTarget.datum(),resizingX=!/^(n|s)$/.test(resizing)&&x,resizingY=!/^(e|w)$/.test(resizing)&&y,dragging=eventTarget.classed("extent"),dragRestore=d3_event_dragSuppress(target),center,origin=d3.mouse(target),offset;var w=d3.select(d3_window(target)).on("keydown.brush",keydown).on("keyup.brush",keyup);if(d3.event.changedTouches){w.on("touchmove.brush",brushmove).on("touchend.brush",brushend);}else{w.on("mousemove.brush",brushmove).on("mouseup.brush",brushend);}
g.interrupt().selectAll("*").interrupt();if(dragging){origin[0]=xExtent[0]-origin[0];origin[1]=yExtent[0]-origin[1];}else if(resizing){var ex=+/w$/.test(resizing),ey=+/^n/.test(resizing);offset=[xExtent[1-ex]-origin[0],yExtent[1-ey]-origin[1]];origin[0]=xExtent[ex];origin[1]=yExtent[ey];}else if(d3.event.altKey)center=origin.slice();g.style("pointer-events","none").selectAll(".resize").style("display",null);d3.select("body").style("cursor",eventTarget.style("cursor"));event_({type:"brushstart"});brushmove();function keydown(){if(d3.event.keyCode==32){if(!dragging){center=null;origin[0]-=xExtent[1];origin[1]-=yExtent[1];dragging=2;}
d3_eventPreventDefault();}}
function keyup(){if(d3.event.keyCode==32&&dragging==2){origin[0]+=xExtent[1];origin[1]+=yExtent[1];dragging=0;d3_eventPreventDefault();}}
function brushmove(){var point=d3.mouse(target),moved=false;if(offset){point[0]+=offset[0];point[1]+=offset[1];}
if(!dragging){if(d3.event.altKey){if(!center)center=[(xExtent[0]+xExtent[1])/2,(yExtent[0]+yExtent[1])/2];origin[0]=xExtent[+(point[0]<center[0])];origin[1]=yExtent[+(point[1]<center[1])];}else center=null;}
if(resizingX&&move1(point,x,0)){redrawX(g);moved=true;}
if(resizingY&&move1(point,y,1)){redrawY(g);moved=true;}
if(moved){redraw(g);event_({type:"brush",mode:dragging?"move":"resize"});}}
function move1(point,scale,i){var range=d3_scaleRange(scale),r0=range[0],r1=range[1],position=origin[i],extent=i?yExtent:xExtent,size=extent[1]-extent[0],min,max;if(dragging){r0-=position;r1-=size+position;}
min=(i?yClamp:xClamp)?Math.max(r0,Math.min(r1,point[i])):point[i];if(dragging){max=(min+=position)+size;}else{if(center)position=Math.max(r0,Math.min(r1,2*center[i]-min));if(position<min){max=min;min=position;}else{max=position;}}
if(extent[0]!=min||extent[1]!=max){if(i)yExtentDomain=null;else xExtentDomain=null;extent[0]=min;extent[1]=max;return true;}}
function brushend(){brushmove();g.style("pointer-events","all").selectAll(".resize").style("display",brush.empty()?"none":null);d3.select("body").style("cursor",null);w.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null);dragRestore();event_({type:"brushend"});}}
brush.x=function(z){if(!arguments.length)return x;x=z;resizes=d3_svg_brushResizes[!x<<1|!y];return brush;};brush.y=function(z){if(!arguments.length)return y;y=z;resizes=d3_svg_brushResizes[!x<<1|!y];return brush;};brush.clamp=function(z){if(!arguments.length)return x&&y?[xClamp,yClamp]:x?xClamp:y?yClamp:null;if(x&&y)xClamp=!!z[0],yClamp=!!z[1];else if(x)xClamp=!!z;else if(y)yClamp=!!z;return brush;};brush.extent=function(z){var x0,x1,y0,y1,t;if(!arguments.length){if(x){if(xExtentDomain){x0=xExtentDomain[0],x1=xExtentDomain[1];}else{x0=xExtent[0],x1=xExtent[1];if(x.invert)x0=x.invert(x0),x1=x.invert(x1);if(x1<x0)t=x0,x0=x1,x1=t;}}
if(y){if(yExtentDomain){y0=yExtentDomain[0],y1=yExtentDomain[1];}else{y0=yExtent[0],y1=yExtent[1];if(y.invert)y0=y.invert(y0),y1=y.invert(y1);if(y1<y0)t=y0,y0=y1,y1=t;}}
return x&&y?[[x0,y0],[x1,y1]]:x?[x0,x1]:y&&[y0,y1];}
if(x){x0=z[0],x1=z[1];if(y)x0=x0[0],x1=x1[0];xExtentDomain=[x0,x1];if(x.invert)x0=x(x0),x1=x(x1);if(x1<x0)t=x0,x0=x1,x1=t;if(x0!=xExtent[0]||x1!=xExtent[1])xExtent=[x0,x1];}
if(y){y0=z[0],y1=z[1];if(x)y0=y0[1],y1=y1[1];yExtentDomain=[y0,y1];if(y.invert)y0=y(y0),y1=y(y1);if(y1<y0)t=y0,y0=y1,y1=t;if(y0!=yExtent[0]||y1!=yExtent[1])yExtent=[y0,y1];}
return brush;};brush.clear=function(){if(!brush.empty()){xExtent=[0,0],yExtent=[0,0];xExtentDomain=yExtentDomain=null;}
return brush;};brush.empty=function(){return!!x&&xExtent[0]==xExtent[1]||!!y&&yExtent[0]==yExtent[1];};return d3.rebind(brush,event,"on");};var d3_svg_brushCursor={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"};var d3_svg_brushResizes=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];var d3_time_format=d3_time.format=d3_locale_enUS.timeFormat;var d3_time_formatUtc=d3_time_format.utc;var d3_time_formatIso=d3_time_formatUtc("%Y-%m-%dT%H:%M:%S.%LZ");d3_time_format.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?d3_time_formatIsoNative:d3_time_formatIso;function d3_time_formatIsoNative(date){return date.toISOString();}
d3_time_formatIsoNative.parse=function(string){var date=new Date(string);return isNaN(date)?null:date;};d3_time_formatIsoNative.toString=d3_time_formatIso.toString;d3_time.second=d3_time_interval(function(date){return new d3_date(Math.floor(date/1e3)*1e3);},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*1e3);},function(date){return date.getSeconds();});d3_time.seconds=d3_time.second.range;d3_time.seconds.utc=d3_time.second.utc.range;d3_time.minute=d3_time_interval(function(date){return new d3_date(Math.floor(date/6e4)*6e4);},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*6e4);},function(date){return date.getMinutes();});d3_time.minutes=d3_time.minute.range;d3_time.minutes.utc=d3_time.minute.utc.range;d3_time.hour=d3_time_interval(function(date){var timezone=date.getTimezoneOffset()/60;return new d3_date((Math.floor(date/36e5-timezone)+timezone)*36e5);},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*36e5);},function(date){return date.getHours();});d3_time.hours=d3_time.hour.range;d3_time.hours.utc=d3_time.hour.utc.range;d3_time.month=d3_time_interval(function(date){date=d3_time.day(date);date.setDate(1);return date;},function(date,offset){date.setMonth(date.getMonth()+offset);},function(date){return date.getMonth();});d3_time.months=d3_time.month.range;d3_time.months.utc=d3_time.month.utc.range;function d3_time_scale(linear,methods,format){function scale(x){return linear(x);}
scale.invert=function(x){return d3_time_scaleDate(linear.invert(x));};scale.domain=function(x){if(!arguments.length)return linear.domain().map(d3_time_scaleDate);linear.domain(x);return scale;};function tickMethod(extent,count){var span=extent[1]-extent[0],target=span/count,i=d3.bisect(d3_time_scaleSteps,target);return i==d3_time_scaleSteps.length?[methods.year,d3_scale_linearTickRange(extent.map(function(d){return d/31536e6;}),count)[2]]:!i?[d3_time_scaleMilliseconds,d3_scale_linearTickRange(extent,count)[2]]:methods[target/d3_time_scaleSteps[i-1]<d3_time_scaleSteps[i]/target?i-1:i];}
scale.nice=function(interval,skip){var domain=scale.domain(),extent=d3_scaleExtent(domain),method=interval==null?tickMethod(extent,10):typeof interval==="number"&&tickMethod(extent,interval);if(method)interval=method[0],skip=method[1];function skipped(date){return!isNaN(date)&&!interval.range(date,d3_time_scaleDate(+date+1),skip).length;}
return scale.domain(d3_scale_nice(domain,skip>1?{floor:function(date){while(skipped(date=interval.floor(date)))date=d3_time_scaleDate(date-1);return date;},ceil:function(date){while(skipped(date=interval.ceil(date)))date=d3_time_scaleDate(+date+1);return date;}}:interval));};scale.ticks=function(interval,skip){var extent=d3_scaleExtent(scale.domain()),method=interval==null?tickMethod(extent,10):typeof interval==="number"?tickMethod(extent,interval):!interval.range&&[{range:interval},skip];if(method)interval=method[0],skip=method[1];return interval.range(extent[0],d3_time_scaleDate(+extent[1]+1),skip<1?1:skip);};scale.tickFormat=function(){return format;};scale.copy=function(){return d3_time_scale(linear.copy(),methods,format);};return d3_scale_linearRebind(scale,linear);}
function d3_time_scaleDate(t){return new Date(t);}
var d3_time_scaleSteps=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6];var d3_time_scaleLocalMethods=[[d3_time.second,1],[d3_time.second,5],[d3_time.second,15],[d3_time.second,30],[d3_time.minute,1],[d3_time.minute,5],[d3_time.minute,15],[d3_time.minute,30],[d3_time.hour,1],[d3_time.hour,3],[d3_time.hour,6],[d3_time.hour,12],[d3_time.day,1],[d3_time.day,2],[d3_time.week,1],[d3_time.month,1],[d3_time.month,3],[d3_time.year,1]];var d3_time_scaleLocalFormat=d3_time_format.multi([[".%L",function(d){return d.getMilliseconds();}],[":%S",function(d){return d.getSeconds();}],["%I:%M",function(d){return d.getMinutes();}],["%I %p",function(d){return d.getHours();}],["%a %d",function(d){return d.getDay()&&d.getDate()!=1;}],["%b %d",function(d){return d.getDate()!=1;}],["%B",function(d){return d.getMonth();}],["%Y",d3_true]]);var d3_time_scaleMilliseconds={range:function(start,stop,step){return d3.range(Math.ceil(start/step)*step,+stop,step).map(d3_time_scaleDate);},floor:d3_identity,ceil:d3_identity};d3_time_scaleLocalMethods.year=d3_time.year;d3_time.scale=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleLocalMethods,d3_time_scaleLocalFormat);};var d3_time_scaleUtcMethods=d3_time_scaleLocalMethods.map(function(m){return[m[0].utc,m[1]];});var d3_time_scaleUtcFormat=d3_time_formatUtc.multi([[".%L",function(d){return d.getUTCMilliseconds();}],[":%S",function(d){return d.getUTCSeconds();}],["%I:%M",function(d){return d.getUTCMinutes();}],["%I %p",function(d){return d.getUTCHours();}],["%a %d",function(d){return d.getUTCDay()&&d.getUTCDate()!=1;}],["%b %d",function(d){return d.getUTCDate()!=1;}],["%B",function(d){return d.getUTCMonth();}],["%Y",d3_true]]);d3_time_scaleUtcMethods.year=d3_time.year.utc;d3_time.scale.utc=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleUtcMethods,d3_time_scaleUtcFormat);};d3.text=d3_xhrType(function(request){return request.responseText;});d3.json=function(url,callback){return d3_xhr(url,"application/json",d3_json,callback);};function d3_json(request){return JSON.parse(request.responseText);}
d3.html=function(url,callback){return d3_xhr(url,"text/html",d3_html,callback);};function d3_html(request){var range=d3_document.createRange();range.selectNode(d3_document.body);return range.createContextualFragment(request.responseText);}
d3.xml=d3_xhrType(function(request){return request.responseXML;});if(typeof define==="function"&&define.amd)define(d3);else if(typeof module==="object"&&module.exports)module.exports=d3;this.d3=d3;}();;

/* /web/static/lib/nvd3/nv.d3.js defined in bundle 'web.assets_backend' */
(function(){var nv={};nv.dev=false;nv.tooltip=nv.tooltip||{};nv.utils=nv.utils||{};nv.models=nv.models||{};nv.charts={};nv.logs={};nv.dom={};if(typeof(module)!=='undefined'&&typeof(exports)!=='undefined'&&typeof(d3)=='undefined'){d3=require('d3');}
nv.dispatch=d3.dispatch('render_start','render_end');if(!Function.prototype.bind){Function.prototype.bind=function(oThis){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");}
var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)));};fNOP.prototype=this.prototype;fBound.prototype=new fNOP();return fBound;};}
if(nv.dev){nv.dispatch.on('render_start',function(e){nv.logs.startTime=+new Date();});nv.dispatch.on('render_end',function(e){nv.logs.endTime=+new Date();nv.logs.totalTime=nv.logs.endTime-nv.logs.startTime;nv.log('total',nv.logs.totalTime);});}
nv.log=function(){if(nv.dev&&window.console&&console.log&&console.log.apply)
console.log.apply(console,arguments);else if(nv.dev&&window.console&&typeof console.log=="function"&&Function.prototype.bind){var log=Function.prototype.bind.call(console.log,console);log.apply(console,arguments);}
return arguments[arguments.length-1];};nv.deprecated=function(name,info){if(console&&console.warn){console.warn('nvd3 warning: `'+name+'` has been deprecated. ',info||'');}};nv.render=function render(step){step=step||1;nv.render.active=true;nv.dispatch.render_start();var renderLoop=function(){var chart,graph;for(var i=0;i<step&&(graph=nv.render.queue[i]);i++){chart=graph.generate();if(typeof graph.callback==typeof(Function))graph.callback(chart);}
nv.render.queue.splice(0,i);if(nv.render.queue.length){setTimeout(renderLoop);}
else{nv.dispatch.render_end();nv.render.active=false;}};setTimeout(renderLoop);};nv.render.active=false;nv.render.queue=[];nv.addGraph=function(obj){if(typeof arguments[0]===typeof(Function)){obj={generate:arguments[0],callback:arguments[1]};}
nv.render.queue.push(obj);if(!nv.render.active){nv.render();}};if(typeof(module)!=='undefined'&&typeof(exports)!=='undefined'){module.exports=nv;}
if(typeof(window)!=='undefined'){window.nv=nv;}
nv.dom.write=function(callback){if(window.fastdom!==undefined){return fastdom.write(callback);}
return callback();};nv.dom.read=function(callback){if(window.fastdom!==undefined){return fastdom.read(callback);}
return callback();};nv.interactiveGuideline=function(){"use strict";var margin={left:0,top:0},width=null,height=null,xScale=d3.scale.linear(),dispatch=d3.dispatch('elementMousemove','elementMouseout','elementClick','elementDblclick','elementMouseDown','elementMouseUp'),showGuideLine=true,svgContainer=null,tooltip=nv.models.tooltip(),isMSIE="ActiveXObject"in window;tooltip.duration(0).hideDelay(0).hidden(false);function layer(selection){selection.each(function(data){var container=d3.select(this);var availableWidth=(width||960),availableHeight=(height||400);var wrap=container.selectAll("g.nv-wrap.nv-interactiveLineLayer").data([data]);var wrapEnter=wrap.enter().append("g").attr("class"," nv-wrap nv-interactiveLineLayer");wrapEnter.append("g").attr("class","nv-interactiveGuideLine");if(!svgContainer){return;}
function mouseHandler(){var d3mouse=d3.mouse(this);var mouseX=d3mouse[0];var mouseY=d3mouse[1];var subtractMargin=true;var mouseOutAnyReason=false;if(isMSIE){mouseX=d3.event.offsetX;mouseY=d3.event.offsetY;if(d3.event.target.tagName!=="svg"){subtractMargin=false;}
if(d3.event.target.className.baseVal.match("nv-legend")){mouseOutAnyReason=true;}}
if(subtractMargin){mouseX-=margin.left;mouseY-=margin.top;}
if(d3.event.type==='mouseout'||mouseX<0||mouseY<0||mouseX>availableWidth||mouseY>availableHeight||(d3.event.relatedTarget&&d3.event.relatedTarget.ownerSVGElement===undefined)||mouseOutAnyReason){if(isMSIE){if(d3.event.relatedTarget&&d3.event.relatedTarget.ownerSVGElement===undefined&&(d3.event.relatedTarget.className===undefined||d3.event.relatedTarget.className.match(tooltip.nvPointerEventsClass))){return;}}
dispatch.elementMouseout({mouseX:mouseX,mouseY:mouseY});layer.renderGuideLine(null);tooltip.hidden(true);return;}else{tooltip.hidden(false);}
var scaleIsOrdinal=typeof xScale.rangeBands==='function';var pointXValue=undefined;if(scaleIsOrdinal){var elementIndex=d3.bisect(xScale.range(),mouseX)-1;if(xScale.range()[elementIndex]+xScale.rangeBand()>=mouseX){pointXValue=xScale.domain()[d3.bisect(xScale.range(),mouseX)-1];}
else{dispatch.elementMouseout({mouseX:mouseX,mouseY:mouseY});layer.renderGuideLine(null);tooltip.hidden(true);return;}}
else{pointXValue=xScale.invert(mouseX);}
dispatch.elementMousemove({mouseX:mouseX,mouseY:mouseY,pointXValue:pointXValue});if(d3.event.type==="dblclick"){dispatch.elementDblclick({mouseX:mouseX,mouseY:mouseY,pointXValue:pointXValue});}
if(d3.event.type==='click'){dispatch.elementClick({mouseX:mouseX,mouseY:mouseY,pointXValue:pointXValue});}
if(d3.event.type==='mousedown'){dispatch.elementMouseDown({mouseX:mouseX,mouseY:mouseY,pointXValue:pointXValue});}
if(d3.event.type==='mouseup'){dispatch.elementMouseUp({mouseX:mouseX,mouseY:mouseY,pointXValue:pointXValue});}}
svgContainer.on("touchmove",mouseHandler).on("mousemove",mouseHandler,true).on("mouseout",mouseHandler,true).on("mousedown",mouseHandler,true).on("mouseup",mouseHandler,true).on("dblclick",mouseHandler).on("click",mouseHandler);layer.guideLine=null;layer.renderGuideLine=function(x){if(!showGuideLine)return;if(layer.guideLine&&layer.guideLine.attr("x1")===x)return;nv.dom.write(function(){var line=wrap.select(".nv-interactiveGuideLine").selectAll("line").data((x!=null)?[nv.utils.NaNtoZero(x)]:[],String);line.enter().append("line").attr("class","nv-guideline").attr("x1",function(d){return d;}).attr("x2",function(d){return d;}).attr("y1",availableHeight).attr("y2",0);line.exit().remove();});}});}
layer.dispatch=dispatch;layer.tooltip=tooltip;layer.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.left=typeof _.left!='undefined'?_.left:margin.left;return layer;};layer.width=function(_){if(!arguments.length)return width;width=_;return layer;};layer.height=function(_){if(!arguments.length)return height;height=_;return layer;};layer.xScale=function(_){if(!arguments.length)return xScale;xScale=_;return layer;};layer.showGuideLine=function(_){if(!arguments.length)return showGuideLine;showGuideLine=_;return layer;};layer.svgContainer=function(_){if(!arguments.length)return svgContainer;svgContainer=_;return layer;};return layer;};nv.interactiveBisect=function(values,searchVal,xAccessor){"use strict";if(!(values instanceof Array)){return null;}
var _xAccessor;if(typeof xAccessor!=='function'){_xAccessor=function(d){return d.x;}}else{_xAccessor=xAccessor;}
var _cmp=function(d,v){return _xAccessor(d)-v;};var bisect=d3.bisector(_cmp).left;var index=d3.max([0,bisect(values,searchVal)-1]);var currentValue=_xAccessor(values[index]);if(typeof currentValue==='undefined'){currentValue=index;}
if(currentValue===searchVal){return index;}
var nextIndex=d3.min([index+1,values.length-1]);var nextValue=_xAccessor(values[nextIndex]);if(typeof nextValue==='undefined'){nextValue=nextIndex;}
if(Math.abs(nextValue-searchVal)>=Math.abs(currentValue-searchVal)){return index;}else{return nextIndex}};nv.nearestValueIndex=function(values,searchVal,threshold){"use strict";var yDistMax=Infinity,indexToHighlight=null;values.forEach(function(d,i){var delta=Math.abs(searchVal-d);if(d!=null&&delta<=yDistMax&&delta<threshold){yDistMax=delta;indexToHighlight=i;}});return indexToHighlight;};nv.models.tooltip=function(){"use strict";var id="nvtooltip-"+Math.floor(Math.random()*100000),data=null,gravity='w',distance=25,snapDistance=0,classes=null,chartContainer=null,hidden=true,hideDelay=200,tooltip=null,lastPosition={left:null,top:null},enabled=true,duration=100,headerEnabled=true,nvPointerEventsClass="nv-pointer-events-none";var position=function(){return{left:d3.event!==null?d3.event.clientX:0,top:d3.event!==null?d3.event.clientY:0};};var valueFormatter=function(d,i){return d;};var headerFormatter=function(d){return d;};var keyFormatter=function(d,i){return d;};var contentGenerator=function(d){if(d===null){return'';}
var table=d3.select(document.createElement("table"));if(headerEnabled){var theadEnter=table.selectAll("thead").data([d]).enter().append("thead");theadEnter.append("tr").append("td").attr("colspan",3).append("strong").classed("x-value",true).html(headerFormatter(d.value));}
var tbodyEnter=table.selectAll("tbody").data([d]).enter().append("tbody");var trowEnter=tbodyEnter.selectAll("tr").data(function(p){return p.series}).enter().append("tr").classed("highlight",function(p){return p.highlight});trowEnter.append("td").classed("legend-color-guide",true).append("div").style("background-color",function(p){return p.color});trowEnter.append("td").classed("key",true).classed("total",function(p){return!!p.total}).html(function(p,i){return keyFormatter(p.key,i)});trowEnter.append("td").classed("value",true).html(function(p,i){return valueFormatter(p.value,i)});trowEnter.selectAll("td").each(function(p){if(p.highlight){var opacityScale=d3.scale.linear().domain([0,1]).range(["#fff",p.color]);var opacity=0.6;d3.select(this).style("border-bottom-color",opacityScale(opacity)).style("border-top-color",opacityScale(opacity));}});var html=table.node().outerHTML;if(d.footer!==undefined)
html+="<div class='footer'>"+d.footer+"</div>";return html;};var dataSeriesExists=function(d){if(d&&d.series){if(nv.utils.isArray(d.series)){return true;}
if(nv.utils.isObject(d.series)){d.series=[d.series];return true;}}
return false;};var calcGravityOffset=function(pos){var height=tooltip.node().offsetHeight,width=tooltip.node().offsetWidth,clientWidth=document.documentElement.clientWidth,clientHeight=document.documentElement.clientHeight,left,top,tmp;switch(gravity){case'e':left=-width-distance;top=-(height/2);if(pos.left+left<0)left=distance;if((tmp=pos.top+top)<0)top-=tmp;if((tmp=pos.top+top+height)>clientHeight)top-=tmp-clientHeight;break;case'w':left=distance;top=-(height/2);if(pos.left+left+width>clientWidth)left=-width-distance;if((tmp=pos.top+top)<0)top-=tmp;if((tmp=pos.top+top+height)>clientHeight)top-=tmp-clientHeight;break;case'n':left=-(width/2)-5;top=distance;if(pos.top+top+height>clientHeight)top=-height-distance;if((tmp=pos.left+left)<0)left-=tmp;if((tmp=pos.left+left+width)>clientWidth)left-=tmp-clientWidth;break;case's':left=-(width/2);top=-height-distance;if(pos.top+top<0)top=distance;if((tmp=pos.left+left)<0)left-=tmp;if((tmp=pos.left+left+width)>clientWidth)left-=tmp-clientWidth;break;case'center':left=-(width/2);top=-(height/2);break;default:left=0;top=0;break;}
return{'left':left,'top':top};};var positionTooltip=function(){nv.dom.read(function(){var pos=position(),gravityOffset=calcGravityOffset(pos),left=pos.left+gravityOffset.left,top=pos.top+gravityOffset.top;if(hidden){tooltip.interrupt().transition().delay(hideDelay).duration(0).style('opacity',0);}else{var old_translate='translate('+lastPosition.left+'px, '+lastPosition.top+'px)';var new_translate='translate('+left+'px, '+top+'px)';var translateInterpolator=d3.interpolateString(old_translate,new_translate);var is_hidden=tooltip.style('opacity')<0.1;tooltip.interrupt().transition().duration(is_hidden?0:duration).styleTween('transform',function(d){return translateInterpolator;},'important').styleTween('-webkit-transform',function(d){return translateInterpolator;}).style('-ms-transform',new_translate).style('opacity',1);}
lastPosition.left=left;lastPosition.top=top;});};function initTooltip(){if(!tooltip||!tooltip.node()){var container=chartContainer?chartContainer:document.body;var data=[1];tooltip=d3.select(container).selectAll('.nvtooltip').data(data);tooltip.enter().append('div').attr("class","nvtooltip "+(classes?classes:"xy-tooltip")).attr("id",id).style("top",0).style("left",0).style('opacity',0).style('position','fixed').selectAll("div, table, td, tr").classed(nvPointerEventsClass,true).classed(nvPointerEventsClass,true);tooltip.exit().remove()}}
function nvtooltip(){if(!enabled)return;if(!dataSeriesExists(data))return;nv.dom.write(function(){initTooltip();var newContent=contentGenerator(data);if(newContent){tooltip.node().innerHTML=newContent;}
positionTooltip();});return nvtooltip;}
nvtooltip.nvPointerEventsClass=nvPointerEventsClass;nvtooltip.options=nv.utils.optionsFunc.bind(nvtooltip);nvtooltip._options=Object.create({},{duration:{get:function(){return duration;},set:function(_){duration=_;}},gravity:{get:function(){return gravity;},set:function(_){gravity=_;}},distance:{get:function(){return distance;},set:function(_){distance=_;}},snapDistance:{get:function(){return snapDistance;},set:function(_){snapDistance=_;}},classes:{get:function(){return classes;},set:function(_){classes=_;}},chartContainer:{get:function(){return chartContainer;},set:function(_){chartContainer=_;}},enabled:{get:function(){return enabled;},set:function(_){enabled=_;}},hideDelay:{get:function(){return hideDelay;},set:function(_){hideDelay=_;}},contentGenerator:{get:function(){return contentGenerator;},set:function(_){contentGenerator=_;}},valueFormatter:{get:function(){return valueFormatter;},set:function(_){valueFormatter=_;}},headerFormatter:{get:function(){return headerFormatter;},set:function(_){headerFormatter=_;}},keyFormatter:{get:function(){return keyFormatter;},set:function(_){keyFormatter=_;}},headerEnabled:{get:function(){return headerEnabled;},set:function(_){headerEnabled=_;}},position:{get:function(){return position;},set:function(_){position=_;}},fixedTop:{get:function(){return null;},set:function(_){nv.deprecated('fixedTop','feature removed after 1.8.1');}},offset:{get:function(){return{left:0,top:0};},set:function(_){nv.deprecated('offset','use chart.tooltip.distance() instead');}},hidden:{get:function(){return hidden;},set:function(_){if(hidden!=_){hidden=!!_;nvtooltip();}}},data:{get:function(){return data;},set:function(_){if(_.point){_.value=_.point.x;_.series=_.series||{};_.series.value=_.point.y;_.series.color=_.point.color||_.series.color;}
data=_;}},node:{get:function(){return tooltip.node();},set:function(_){}},id:{get:function(){return id;},set:function(_){}}});nv.utils.initOptions(nvtooltip);return nvtooltip;};nv.utils.windowSize=function(){var size={width:640,height:480};if(window.innerWidth&&window.innerHeight){size.width=window.innerWidth;size.height=window.innerHeight;return(size);}
if(document.compatMode=='CSS1Compat'&&document.documentElement&&document.documentElement.offsetWidth){size.width=document.documentElement.offsetWidth;size.height=document.documentElement.offsetHeight;return(size);}
if(document.body&&document.body.offsetWidth){size.width=document.body.offsetWidth;size.height=document.body.offsetHeight;return(size);}
return(size);};nv.utils.isArray=Array.isArray;nv.utils.isObject=function(a){return a!==null&&typeof a==='object';};nv.utils.isFunction=function(a){return typeof a==='function';};nv.utils.isDate=function(a){return toString.call(a)==='[object Date]';};nv.utils.isNumber=function(a){return!isNaN(a)&&typeof a==='number';};nv.utils.windowResize=function(handler){if(window.addEventListener){window.addEventListener('resize',handler);}else{nv.log("ERROR: Failed to bind to window.resize with: ",handler);}
return{callback:handler,clear:function(){window.removeEventListener('resize',handler);}}};nv.utils.getColor=function(color){if(color===undefined){return nv.utils.defaultColor();}else if(nv.utils.isArray(color)){var color_scale=d3.scale.ordinal().range(color);return function(d,i){var key=i===undefined?d:i;return d.color||color_scale(key);};}else{return color;}};nv.utils.defaultColor=function(){return nv.utils.getColor(d3.scale.category20().range());};nv.utils.customTheme=function(dictionary,getKey,defaultColors){getKey=getKey||function(series){return series.key};defaultColors=defaultColors||d3.scale.category20().range();var defIndex=defaultColors.length;return function(series,index){var key=getKey(series);if(nv.utils.isFunction(dictionary[key])){return dictionary[key]();}else if(dictionary[key]!==undefined){return dictionary[key];}else{if(!defIndex){defIndex=defaultColors.length;}
defIndex=defIndex-1;return defaultColors[defIndex];}};};nv.utils.pjax=function(links,content){var load=function(href){d3.html(href,function(fragment){var target=d3.select(content).node();target.parentNode.replaceChild(d3.select(fragment).select(content).node(),target);nv.utils.pjax(links,content);});};d3.selectAll(links).on("click",function(){history.pushState(this.href,this.textContent,this.href);load(this.href);d3.event.preventDefault();});d3.select(window).on("popstate",function(){if(d3.event.state){load(d3.event.state);}});};nv.utils.calcApproxTextWidth=function(svgTextElem){if(nv.utils.isFunction(svgTextElem.style)&&nv.utils.isFunction(svgTextElem.text)){var fontSize=parseInt(svgTextElem.style("font-size").replace("px",""),10);var textLength=svgTextElem.text().length;return nv.utils.NaNtoZero(textLength*fontSize*0.5);}
return 0;};nv.utils.NaNtoZero=function(n){if(!nv.utils.isNumber(n)||isNaN(n)||n===null||n===Infinity||n===-Infinity){return 0;}
return n;};d3.selection.prototype.watchTransition=function(renderWatch){var args=[this].concat([].slice.call(arguments,1));return renderWatch.transition.apply(renderWatch,args);};nv.utils.renderWatch=function(dispatch,duration){if(!(this instanceof nv.utils.renderWatch)){return new nv.utils.renderWatch(dispatch,duration);}
var _duration=duration!==undefined?duration:250;var renderStack=[];var self=this;this.models=function(models){models=[].slice.call(arguments,0);models.forEach(function(model){model.__rendered=false;(function(m){m.dispatch.on('renderEnd',function(arg){m.__rendered=true;self.renderEnd('model');});})(model);if(renderStack.indexOf(model)<0){renderStack.push(model);}});return this;};this.reset=function(duration){if(duration!==undefined){_duration=duration;}
renderStack=[];};this.transition=function(selection,args,duration){args=arguments.length>1?[].slice.call(arguments,1):[];if(args.length>1){duration=args.pop();}else{duration=_duration!==undefined?_duration:250;}
selection.__rendered=false;if(renderStack.indexOf(selection)<0){renderStack.push(selection);}
if(duration===0){selection.__rendered=true;selection.delay=function(){return this;};selection.duration=function(){return this;};return selection;}else{if(selection.length===0){selection.__rendered=true;}else if(selection.every(function(d){return!d.length;})){selection.__rendered=true;}else{selection.__rendered=false;}
var n=0;return selection.transition().duration(duration).each(function(){++n;}).each('end',function(d,i){if(--n===0){selection.__rendered=true;self.renderEnd.apply(this,args);}});}};this.renderEnd=function(){if(renderStack.every(function(d){return d.__rendered;})){renderStack.forEach(function(d){d.__rendered=false;});dispatch.renderEnd.apply(this,arguments);}}};nv.utils.deepExtend=function(dst){var sources=arguments.length>1?[].slice.call(arguments,1):[];sources.forEach(function(source){for(var key in source){var isArray=nv.utils.isArray(dst[key]);var isObject=nv.utils.isObject(dst[key]);var srcObj=nv.utils.isObject(source[key]);if(isObject&&!isArray&&srcObj){nv.utils.deepExtend(dst[key],source[key]);}else{dst[key]=source[key];}}});};nv.utils.state=function(){if(!(this instanceof nv.utils.state)){return new nv.utils.state();}
var state={};var _self=this;var _setState=function(){};var _getState=function(){return{};};var init=null;var changed=null;this.dispatch=d3.dispatch('change','set');this.dispatch.on('set',function(state){_setState(state,true);});this.getter=function(fn){_getState=fn;return this;};this.setter=function(fn,callback){if(!callback){callback=function(){};}
_setState=function(state,update){fn(state);if(update){callback();}};return this;};this.init=function(state){init=init||{};nv.utils.deepExtend(init,state);};var _set=function(){var settings=_getState();if(JSON.stringify(settings)===JSON.stringify(state)){return false;}
for(var key in settings){if(state[key]===undefined){state[key]={};}
state[key]=settings[key];changed=true;}
return true;};this.update=function(){if(init){_setState(init,false);init=null;}
if(_set.call(this)){this.dispatch.change(state);}};};nv.utils.optionsFunc=function(args){if(args){d3.map(args).forEach((function(key,value){if(nv.utils.isFunction(this[key])){this[key](value);}}).bind(this));}
return this;};nv.utils.calcTicksX=function(numTicks,data){var numValues=1;var i=0;for(i;i<data.length;i+=1){var stream_len=data[i]&&data[i].values?data[i].values.length:0;numValues=stream_len>numValues?stream_len:numValues;}
nv.log("Requested number of ticks: ",numTicks);nv.log("Calculated max values to be: ",numValues);numTicks=numTicks>numValues?numTicks=numValues-1:numTicks;numTicks=numTicks<1?1:numTicks;numTicks=Math.floor(numTicks);nv.log("Calculating tick count as: ",numTicks);return numTicks;};nv.utils.calcTicksY=function(numTicks,data){return nv.utils.calcTicksX(numTicks,data);};nv.utils.initOption=function(chart,name){if(chart._calls&&chart._calls[name]){chart[name]=chart._calls[name];}else{chart[name]=function(_){if(!arguments.length)return chart._options[name];chart._overrides[name]=true;chart._options[name]=_;return chart;};chart['_'+name]=function(_){if(!arguments.length)return chart._options[name];if(!chart._overrides[name]){chart._options[name]=_;}
return chart;}}};nv.utils.initOptions=function(chart){chart._overrides=chart._overrides||{};var ops=Object.getOwnPropertyNames(chart._options||{});var calls=Object.getOwnPropertyNames(chart._calls||{});ops=ops.concat(calls);for(var i in ops){nv.utils.initOption(chart,ops[i]);}};nv.utils.inheritOptionsD3=function(target,d3_source,oplist){target._d3options=oplist.concat(target._d3options||[]);oplist.unshift(d3_source);oplist.unshift(target);d3.rebind.apply(this,oplist);};nv.utils.arrayUnique=function(a){return a.sort().filter(function(item,pos){return!pos||item!=a[pos-1];});};nv.utils.symbolMap=d3.map();nv.utils.symbol=function(){var type,size=64;function symbol(d,i){var t=type.call(this,d,i);var s=size.call(this,d,i);if(d3.svg.symbolTypes.indexOf(t)!==-1){return d3.svg.symbol().type(t).size(s)();}else{return nv.utils.symbolMap.get(t)(s);}}
symbol.type=function(_){if(!arguments.length)return type;type=d3.functor(_);return symbol;};symbol.size=function(_){if(!arguments.length)return size;size=d3.functor(_);return symbol;};return symbol;};nv.utils.inheritOptions=function(target,source){var ops=Object.getOwnPropertyNames(source._options||{});var calls=Object.getOwnPropertyNames(source._calls||{});var inherited=source._inherited||[];var d3ops=source._d3options||[];var args=ops.concat(calls).concat(inherited).concat(d3ops);args.unshift(source);args.unshift(target);d3.rebind.apply(this,args);target._inherited=nv.utils.arrayUnique(ops.concat(calls).concat(inherited).concat(ops).concat(target._inherited||[]));target._d3options=nv.utils.arrayUnique(d3ops.concat(target._d3options||[]));};nv.utils.initSVG=function(svg){svg.classed({'nvd3-svg':true});};nv.utils.sanitizeHeight=function(height,container){return(height||parseInt(container.style('height'),10)||400);};nv.utils.sanitizeWidth=function(width,container){return(width||parseInt(container.style('width'),10)||960);};nv.utils.availableHeight=function(height,container,margin){return Math.max(0,nv.utils.sanitizeHeight(height,container)-margin.top-margin.bottom);};nv.utils.availableWidth=function(width,container,margin){return Math.max(0,nv.utils.sanitizeWidth(width,container)-margin.left-margin.right);};nv.utils.noData=function(chart,container){var opt=chart.options(),margin=opt.margin(),noData=opt.noData(),data=(noData==null)?["No Data Available."]:[noData],height=nv.utils.availableHeight(null,container,margin),width=nv.utils.availableWidth(null,container,margin),x=margin.left+width/2,y=margin.top+height/2;container.selectAll('g').remove();var noDataText=container.selectAll('.nv-noData').data(data);noDataText.enter().append('text').attr('class','nvd3 nv-noData').attr('dy','-.7em').style('text-anchor','middle');noDataText.attr('x',x).attr('y',y).text(function(t){return t;});};nv.utils.wrapTicks=function(text,width){text.each(function(){var text=d3.select(this),words=text.text().split(/\s+/).reverse(),word,line=[],lineNumber=0,lineHeight=1.1,y=text.attr("y"),dy=parseFloat(text.attr("dy")),tspan=text.text(null).append("tspan").attr("x",0).attr("y",y).attr("dy",dy+"em");while(word=words.pop()){line.push(word);tspan.text(line.join(" "));if(tspan.node().getComputedTextLength()>width){line.pop();tspan.text(line.join(" "));line=[word];tspan=text.append("tspan").attr("x",0).attr("y",y).attr("dy",++lineNumber*lineHeight+dy+"em").text(word);}}});};nv.utils.arrayEquals=function(array1,array2){if(array1===array2)
return true;if(!array1||!array2)
return false;if(array1.length!=array2.length)
return false;for(var i=0,l=array1.length;i<l;i++){if(array1[i]instanceof Array&&array2[i]instanceof Array){if(!nv.arrayEquals(array1[i],array2[i]))
return false;}else if(array1[i]!=array2[i]){return false;}}
return true;};nv.models.axis=function(){"use strict";var axis=d3.svg.axis();var scale=d3.scale.linear();var margin={top:0,right:0,bottom:0,left:0},width=75,height=60,axisLabelText=null,showMaxMin=true,rotateLabels=0,rotateYLabel=true,staggerLabels=false,isOrdinal=false,ticks=null,axisLabelDistance=0,fontSize=undefined,duration=250,dispatch=d3.dispatch('renderEnd');axis.scale(scale).orient('bottom').tickFormat(function(d){return d});var scale0;var renderWatch=nv.utils.renderWatch(dispatch,duration);function chart(selection){renderWatch.reset();selection.each(function(data){var container=d3.select(this);nv.utils.initSVG(container);var wrap=container.selectAll('g.nv-wrap.nv-axis').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-axis');var gEnter=wrapEnter.append('g');var g=wrap.select('g');if(ticks!==null)
axis.ticks(ticks);else if(axis.orient()=='top'||axis.orient()=='bottom')
axis.ticks(Math.abs(scale.range()[1]-scale.range()[0])/100);g.watchTransition(renderWatch,'axis').call(axis);scale0=scale0||axis.scale();var fmt=axis.tickFormat();if(fmt==null){fmt=scale0.tickFormat();}
var axisLabel=g.selectAll('text.nv-axislabel').data([axisLabelText||null]);axisLabel.exit().remove();if(fontSize!==undefined){g.selectAll('g').select("text").style('font-size',fontSize);}
var xLabelMargin;var axisMaxMin;var w;switch(axis.orient()){case'top':axisLabel.enter().append('text').attr('class','nv-axislabel');w=0;if(scale.range().length===1){w=isOrdinal?scale.range()[0]*2+scale.rangeBand():0;}else if(scale.range().length===2){w=isOrdinal?scale.range()[0]+scale.range()[1]+scale.rangeBand():scale.range()[1];}else if(scale.range().length>2){w=scale.range()[scale.range().length-1]+(scale.range()[1]-scale.range()[0]);};axisLabel.attr('text-anchor','middle').attr('y',0).attr('x',w/2);if(showMaxMin){axisMaxMin=wrap.selectAll('g.nv-axisMaxMin').data(scale.domain());axisMaxMin.enter().append('g').attr('class',function(d,i){return['nv-axisMaxMin','nv-axisMaxMin-x',(i==0?'nv-axisMin-x':'nv-axisMax-x')].join(' ')}).append('text');axisMaxMin.exit().remove();axisMaxMin.attr('transform',function(d,i){return'translate('+nv.utils.NaNtoZero(scale(d))+',0)'}).select('text').attr('dy','-0.5em').attr('y',-axis.tickPadding()).attr('text-anchor','middle').text(function(d,i){var v=fmt(d);return(''+v).match('NaN')?'':v;});axisMaxMin.watchTransition(renderWatch,'min-max top').attr('transform',function(d,i){return'translate('+nv.utils.NaNtoZero(scale.range()[i])+',0)'});}
break;case'bottom':xLabelMargin=axisLabelDistance+36;var maxTextWidth=30;var textHeight=0;var xTicks=g.selectAll('g').select("text");var rotateLabelsRule='';if(rotateLabels%360){xTicks.attr('transform','');xTicks.each(function(d,i){var box=this.getBoundingClientRect();var width=box.width;textHeight=box.height;if(width>maxTextWidth)maxTextWidth=width;});rotateLabelsRule='rotate('+rotateLabels+' 0,'+(textHeight/2+axis.tickPadding())+')';var sin=Math.abs(Math.sin(rotateLabels*Math.PI/180));xLabelMargin=(sin?sin*maxTextWidth:maxTextWidth)+30;xTicks.attr('transform',rotateLabelsRule).style('text-anchor',rotateLabels%360>0?'start':'end');}else{if(staggerLabels){xTicks.attr('transform',function(d,i){return'translate(0,'+(i%2==0?'0':'12')+')'});}else{xTicks.attr('transform',"translate(0,0)");}}
axisLabel.enter().append('text').attr('class','nv-axislabel');w=0;if(scale.range().length===1){w=isOrdinal?scale.range()[0]*2+scale.rangeBand():0;}else if(scale.range().length===2){w=isOrdinal?scale.range()[0]+scale.range()[1]+scale.rangeBand():scale.range()[1];}else if(scale.range().length>2){w=scale.range()[scale.range().length-1]+(scale.range()[1]-scale.range()[0]);};axisLabel.attr('text-anchor','middle').attr('y',xLabelMargin).attr('x',w/2);if(showMaxMin){axisMaxMin=wrap.selectAll('g.nv-axisMaxMin').data([scale.domain()[0],scale.domain()[scale.domain().length-1]]);axisMaxMin.enter().append('g').attr('class',function(d,i){return['nv-axisMaxMin','nv-axisMaxMin-x',(i==0?'nv-axisMin-x':'nv-axisMax-x')].join(' ')}).append('text');axisMaxMin.exit().remove();axisMaxMin.attr('transform',function(d,i){return'translate('+nv.utils.NaNtoZero((scale(d)+(isOrdinal?scale.rangeBand()/2:0)))+',0)'}).select('text').attr('dy','.71em').attr('y',axis.tickPadding()).attr('transform',rotateLabelsRule).style('text-anchor',rotateLabels?(rotateLabels%360>0?'start':'end'):'middle').text(function(d,i){var v=fmt(d);return(''+v).match('NaN')?'':v;});axisMaxMin.watchTransition(renderWatch,'min-max bottom').attr('transform',function(d,i){return'translate('+nv.utils.NaNtoZero((scale(d)+(isOrdinal?scale.rangeBand()/2:0)))+',0)'});}
break;case'right':axisLabel.enter().append('text').attr('class','nv-axislabel');axisLabel.style('text-anchor',rotateYLabel?'middle':'begin').attr('transform',rotateYLabel?'rotate(90)':'').attr('y',rotateYLabel?(-Math.max(margin.right,width)+12):-10).attr('x',rotateYLabel?(d3.max(scale.range())/2):axis.tickPadding());if(showMaxMin){axisMaxMin=wrap.selectAll('g.nv-axisMaxMin').data(scale.domain());axisMaxMin.enter().append('g').attr('class',function(d,i){return['nv-axisMaxMin','nv-axisMaxMin-y',(i==0?'nv-axisMin-y':'nv-axisMax-y')].join(' ')}).append('text').style('opacity',0);axisMaxMin.exit().remove();axisMaxMin.attr('transform',function(d,i){return'translate(0,'+nv.utils.NaNtoZero(scale(d))+')'}).select('text').attr('dy','.32em').attr('y',0).attr('x',axis.tickPadding()).style('text-anchor','start').text(function(d,i){var v=fmt(d);return(''+v).match('NaN')?'':v;});axisMaxMin.watchTransition(renderWatch,'min-max right').attr('transform',function(d,i){return'translate(0,'+nv.utils.NaNtoZero(scale.range()[i])+')'}).select('text').style('opacity',1);}
break;case'left':axisLabel.enter().append('text').attr('class','nv-axislabel');axisLabel.style('text-anchor',rotateYLabel?'middle':'end').attr('transform',rotateYLabel?'rotate(-90)':'').attr('y',rotateYLabel?(-Math.max(margin.left,width)+25-(axisLabelDistance||0)):-10).attr('x',rotateYLabel?(-d3.max(scale.range())/2):-axis.tickPadding());if(showMaxMin){axisMaxMin=wrap.selectAll('g.nv-axisMaxMin').data(scale.domain());axisMaxMin.enter().append('g').attr('class',function(d,i){return['nv-axisMaxMin','nv-axisMaxMin-y',(i==0?'nv-axisMin-y':'nv-axisMax-y')].join(' ')}).append('text').style('opacity',0);axisMaxMin.exit().remove();axisMaxMin.attr('transform',function(d,i){return'translate(0,'+nv.utils.NaNtoZero(scale0(d))+')'}).select('text').attr('dy','.32em').attr('y',0).attr('x',-axis.tickPadding()).attr('text-anchor','end').text(function(d,i){var v=fmt(d);return(''+v).match('NaN')?'':v;});axisMaxMin.watchTransition(renderWatch,'min-max right').attr('transform',function(d,i){return'translate(0,'+nv.utils.NaNtoZero(scale.range()[i])+')'}).select('text').style('opacity',1);}
break;}
axisLabel.text(function(d){return d});if(showMaxMin&&(axis.orient()==='left'||axis.orient()==='right')){g.selectAll('g').each(function(d,i){d3.select(this).select('text').attr('opacity',1);if(scale(d)<scale.range()[1]+10||scale(d)>scale.range()[0]-10){if(d>1e-10||d<-1e-10)
d3.select(this).attr('opacity',0);d3.select(this).select('text').attr('opacity',0);}});if(scale.domain()[0]==scale.domain()[1]&&scale.domain()[0]==0){wrap.selectAll('g.nv-axisMaxMin').style('opacity',function(d,i){return!i?1:0});}}
if(showMaxMin&&(axis.orient()==='top'||axis.orient()==='bottom')){var maxMinRange=[];wrap.selectAll('g.nv-axisMaxMin').each(function(d,i){try{if(i)
maxMinRange.push(scale(d)-this.getBoundingClientRect().width-4);else
maxMinRange.push(scale(d)+this.getBoundingClientRect().width+4)}catch(err){if(i)
maxMinRange.push(scale(d)-4);else
maxMinRange.push(scale(d)+4);}});g.selectAll('g').each(function(d,i){if(scale(d)<maxMinRange[0]||scale(d)>maxMinRange[1]){if(d>1e-10||d<-1e-10)
d3.select(this).remove();else
d3.select(this).select('text').remove();}});}
g.selectAll('.tick').filter(function(d){return!parseFloat(Math.round(d*100000)/1000000)&&(d!==undefined)}).classed('zero',true);scale0=scale.copy();});renderWatch.renderEnd('axis immediate');return chart;}
chart.axis=axis;chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{axisLabelDistance:{get:function(){return axisLabelDistance;},set:function(_){axisLabelDistance=_;}},staggerLabels:{get:function(){return staggerLabels;},set:function(_){staggerLabels=_;}},rotateLabels:{get:function(){return rotateLabels;},set:function(_){rotateLabels=_;}},rotateYLabel:{get:function(){return rotateYLabel;},set:function(_){rotateYLabel=_;}},showMaxMin:{get:function(){return showMaxMin;},set:function(_){showMaxMin=_;}},axisLabel:{get:function(){return axisLabelText;},set:function(_){axisLabelText=_;}},height:{get:function(){return height;},set:function(_){height=_;}},ticks:{get:function(){return ticks;},set:function(_){ticks=_;}},width:{get:function(){return width;},set:function(_){width=_;}},fontSize:{get:function(){return fontSize;},set:function(_){fontSize=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);}},scale:{get:function(){return scale;},set:function(_){scale=_;axis.scale(scale);isOrdinal=typeof scale.rangeBands==='function';nv.utils.inheritOptionsD3(chart,scale,['domain','range','rangeBand','rangeBands']);}}});nv.utils.initOptions(chart);nv.utils.inheritOptionsD3(chart,axis,['orient','tickValues','tickSubdivide','tickSize','tickPadding','tickFormat']);nv.utils.inheritOptionsD3(chart,scale,['domain','range','rangeBand','rangeBands']);return chart;};nv.models.scatter=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=null,height=null,color=nv.utils.defaultColor(),id=Math.floor(Math.random()*100000),container=null,x=d3.scale.linear(),y=d3.scale.linear(),z=d3.scale.linear(),getX=function(d){return d.x},getY=function(d){return d.y},getSize=function(d){return d.size||1},getShape=function(d){return d.shape||'circle'},forceX=[],forceY=[],forceSize=[],interactive=true,pointActive=function(d){return!d.notActive},padData=false,padDataOuter=.1,clipEdge=false,clipVoronoi=true,showVoronoi=false,clipRadius=function(){return 25},xDomain=null,yDomain=null,xRange=null,yRange=null,sizeDomain=null,sizeRange=null,singlePoint=false,dispatch=d3.dispatch('elementClick','elementDblClick','elementMouseover','elementMouseout','renderEnd'),useVoronoi=true,duration=250,interactiveUpdateDelay=300,showLabels=false;var x0,y0,z0,timeoutID,needsUpdate=false,renderWatch=nv.utils.renderWatch(dispatch,duration),_sizeRange_def=[16,256],_caches;function getCache(d){var cache,i;cache=_caches=_caches||{};i=d[0].series;cache=cache[i]=cache[i]||{};i=d[1];cache=cache[i]=cache[i]||{};return cache;}
function getDiffs(d){var i,key,point=d[0],cache=getCache(d),diffs=false;for(i=1;i<arguments.length;i++){key=arguments[i];if(cache[key]!==point[key]||!cache.hasOwnProperty(key)){cache[key]=point[key];diffs=true;}}
return diffs;}
function chart(selection){renderWatch.reset();selection.each(function(data){container=d3.select(this);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);nv.utils.initSVG(container);data.forEach(function(series,i){series.values.forEach(function(point){point.series=i;});});var logScale=chart.yScale().name===d3.scale.log().name?true:false;var seriesData=(xDomain&&yDomain&&sizeDomain)?[]:d3.merge(data.map(function(d){return d.values.map(function(d,i){return{x:getX(d,i),y:getY(d,i),size:getSize(d,i)}})}));x.domain(xDomain||d3.extent(seriesData.map(function(d){return d.x;}).concat(forceX)))
if(padData&&data[0])
x.range(xRange||[(availableWidth*padDataOuter+availableWidth)/(2*data[0].values.length),availableWidth-availableWidth*(1+padDataOuter)/(2*data[0].values.length)]);else
x.range(xRange||[0,availableWidth]);if(logScale){var min=d3.min(seriesData.map(function(d){if(d.y!==0)return d.y;}));y.clamp(true).domain(yDomain||d3.extent(seriesData.map(function(d){if(d.y!==0)return d.y;else return min*0.1;}).concat(forceY))).range(yRange||[availableHeight,0]);}else{y.domain(yDomain||d3.extent(seriesData.map(function(d){return d.y;}).concat(forceY))).range(yRange||[availableHeight,0]);}
z.domain(sizeDomain||d3.extent(seriesData.map(function(d){return d.size}).concat(forceSize))).range(sizeRange||_sizeRange_def);singlePoint=x.domain()[0]===x.domain()[1]||y.domain()[0]===y.domain()[1];if(x.domain()[0]===x.domain()[1])
x.domain()[0]?x.domain([x.domain()[0]-x.domain()[0]*0.01,x.domain()[1]+x.domain()[1]*0.01]):x.domain([-1,1]);if(y.domain()[0]===y.domain()[1])
y.domain()[0]?y.domain([y.domain()[0]-y.domain()[0]*0.01,y.domain()[1]+y.domain()[1]*0.01]):y.domain([-1,1]);if(isNaN(x.domain()[0])){x.domain([-1,1]);}
if(isNaN(y.domain()[0])){y.domain([-1,1]);}
x0=x0||x;y0=y0||y;z0=z0||z;var scaleDiff=x(1)!==x0(1)||y(1)!==y0(1)||z(1)!==z0(1);var wrap=container.selectAll('g.nv-wrap.nv-scatter').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-scatter nv-chart-'+id);var defsEnter=wrapEnter.append('defs');var gEnter=wrapEnter.append('g');var g=wrap.select('g');wrap.classed('nv-single-point',singlePoint);gEnter.append('g').attr('class','nv-groups');gEnter.append('g').attr('class','nv-point-paths');wrapEnter.append('g').attr('class','nv-point-clips');wrap.attr('transform','translate('+margin.left+','+margin.top+')');defsEnter.append('clipPath').attr('id','nv-edge-clip-'+id).append('rect');wrap.select('#nv-edge-clip-'+id+' rect').attr('width',availableWidth).attr('height',(availableHeight>0)?availableHeight:0);g.attr('clip-path',clipEdge?'url(#nv-edge-clip-'+id+')':'');function updateInteractiveLayer(){needsUpdate=false;if(!interactive)return false;if(useVoronoi===true){var vertices=d3.merge(data.map(function(group,groupIndex){return group.values.map(function(point,pointIndex){var pX=getX(point,pointIndex);var pY=getY(point,pointIndex);return[nv.utils.NaNtoZero(x(pX))+Math.random()*1e-4,nv.utils.NaNtoZero(y(pY))+Math.random()*1e-4,groupIndex,pointIndex,point];}).filter(function(pointArray,pointIndex){return pointActive(pointArray[4],pointIndex);})}));if(vertices.length==0)return false;if(vertices.length<3){vertices.push([x.range()[0]-20,y.range()[0]-20,null,null]);vertices.push([x.range()[1]+20,y.range()[1]+20,null,null]);vertices.push([x.range()[0]-20,y.range()[0]+20,null,null]);vertices.push([x.range()[1]+20,y.range()[1]-20,null,null]);}
var bounds=d3.geom.polygon([[-10,-10],[-10,height+10],[width+10,height+10],[width+10,-10]]);var voronoi=d3.geom.voronoi(vertices).map(function(d,i){return{'data':bounds.clip(d),'series':vertices[i][2],'point':vertices[i][3]}});wrap.select('.nv-point-paths').selectAll('path').remove();var pointPaths=wrap.select('.nv-point-paths').selectAll('path').data(voronoi);var vPointPaths=pointPaths.enter().append("svg:path").attr("d",function(d){if(!d||!d.data||d.data.length===0)
return'M 0 0';else
return"M"+d.data.join(",")+"Z";}).attr("id",function(d,i){return"nv-path-"+i;}).attr("clip-path",function(d,i){return"url(#nv-clip-"+id+"-"+i+")";});if(showVoronoi){vPointPaths.style("fill",d3.rgb(230,230,230)).style('fill-opacity',0.4).style('stroke-opacity',1).style("stroke",d3.rgb(200,200,200));}
if(clipVoronoi){wrap.select('.nv-point-clips').selectAll('*').remove();var pointClips=wrap.select('.nv-point-clips').selectAll('clipPath').data(vertices);var vPointClips=pointClips.enter().append("svg:clipPath").attr("id",function(d,i){return"nv-clip-"+id+"-"+i;}).append("svg:circle").attr('cx',function(d){return d[0];}).attr('cy',function(d){return d[1];}).attr('r',clipRadius);}
var mouseEventCallback=function(d,mDispatch){if(needsUpdate)return 0;var series=data[d.series];if(series===undefined)return;var point=series.values[d.point];point['color']=color(series,d.series);point['x']=getX(point);point['y']=getY(point);var box=container.node().getBoundingClientRect();var scrollTop=window.pageYOffset||document.documentElement.scrollTop;var scrollLeft=window.pageXOffset||document.documentElement.scrollLeft;var pos={left:x(getX(point,d.point))+box.left+scrollLeft+margin.left+10,top:y(getY(point,d.point))+box.top+scrollTop+margin.top+10};mDispatch({point:point,series:series,pos:pos,relativePos:[x(getX(point,d.point))+margin.left,y(getY(point,d.point))+margin.top],seriesIndex:d.series,pointIndex:d.point});};pointPaths.on('click',function(d){mouseEventCallback(d,dispatch.elementClick);}).on('dblclick',function(d){mouseEventCallback(d,dispatch.elementDblClick);}).on('mouseover',function(d){mouseEventCallback(d,dispatch.elementMouseover);}).on('mouseout',function(d,i){mouseEventCallback(d,dispatch.elementMouseout);});}else{wrap.select('.nv-groups').selectAll('.nv-group').selectAll('.nv-point').on('click',function(d,i){if(needsUpdate||!data[d.series])return 0;var series=data[d.series],point=series.values[i];dispatch.elementClick({point:point,series:series,pos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],relativePos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],seriesIndex:d.series,pointIndex:i});}).on('dblclick',function(d,i){if(needsUpdate||!data[d.series])return 0;var series=data[d.series],point=series.values[i];dispatch.elementDblClick({point:point,series:series,pos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],relativePos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],seriesIndex:d.series,pointIndex:i});}).on('mouseover',function(d,i){if(needsUpdate||!data[d.series])return 0;var series=data[d.series],point=series.values[i];dispatch.elementMouseover({point:point,series:series,pos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],relativePos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],seriesIndex:d.series,pointIndex:i,color:color(d,i)});}).on('mouseout',function(d,i){if(needsUpdate||!data[d.series])return 0;var series=data[d.series],point=series.values[i];dispatch.elementMouseout({point:point,series:series,pos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],relativePos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],seriesIndex:d.series,pointIndex:i,color:color(d,i)});});}}
needsUpdate=true;var groups=wrap.select('.nv-groups').selectAll('.nv-group').data(function(d){return d},function(d){return d.key});groups.enter().append('g').style('stroke-opacity',1e-6).style('fill-opacity',1e-6);groups.exit().remove();groups.attr('class',function(d,i){return(d.classed||'')+' nv-group nv-series-'+i;}).classed('nv-noninteractive',!interactive).classed('hover',function(d){return d.hover});groups.watchTransition(renderWatch,'scatter: groups').style('fill',function(d,i){return color(d,i)}).style('stroke',function(d,i){return color(d,i)}).style('stroke-opacity',1).style('fill-opacity',.5);var points=groups.selectAll('path.nv-point').data(function(d){return d.values.map(function(point,pointIndex){return[point,pointIndex]}).filter(function(pointArray,pointIndex){return pointActive(pointArray[0],pointIndex)})});points.enter().append('path').attr('class',function(d){return'nv-point nv-point-'+d[1];}).style('fill',function(d){return d.color}).style('stroke',function(d){return d.color}).attr('transform',function(d){return'translate('+nv.utils.NaNtoZero(x0(getX(d[0],d[1])))+','+nv.utils.NaNtoZero(y0(getY(d[0],d[1])))+')'}).attr('d',nv.utils.symbol().type(function(d){return getShape(d[0]);}).size(function(d){return z(getSize(d[0],d[1]))}));points.exit().remove();groups.exit().selectAll('path.nv-point').watchTransition(renderWatch,'scatter exit').attr('transform',function(d){return'translate('+nv.utils.NaNtoZero(x(getX(d[0],d[1])))+','+nv.utils.NaNtoZero(y(getY(d[0],d[1])))+')'}).remove();points.filter(function(d){return scaleDiff||getDiffs(d,'x','y');}).watchTransition(renderWatch,'scatter points').attr('transform',function(d){return'translate('+nv.utils.NaNtoZero(x(getX(d[0],d[1])))+','+nv.utils.NaNtoZero(y(getY(d[0],d[1])))+')'});points.filter(function(d){return scaleDiff||getDiffs(d,'shape','size');}).watchTransition(renderWatch,'scatter points').attr('d',nv.utils.symbol().type(function(d){return getShape(d[0]);}).size(function(d){return z(getSize(d[0],d[1]))}));if(showLabels)
{var titles=groups.selectAll('.nv-label').data(function(d){return d.values.map(function(point,pointIndex){return[point,pointIndex]}).filter(function(pointArray,pointIndex){return pointActive(pointArray[0],pointIndex)})});titles.enter().append('text').style('fill',function(d,i){return d.color}).style('stroke-opacity',0).style('fill-opacity',1).attr('transform',function(d){var dx=nv.utils.NaNtoZero(x0(getX(d[0],d[1])))+Math.sqrt(z(getSize(d[0],d[1]))/Math.PI)+2;return'translate('+dx+','+nv.utils.NaNtoZero(y0(getY(d[0],d[1])))+')';}).text(function(d,i){return d[0].label;});titles.exit().remove();groups.exit().selectAll('path.nv-label').watchTransition(renderWatch,'scatter exit').attr('transform',function(d){var dx=nv.utils.NaNtoZero(x(getX(d[0],d[1])))+Math.sqrt(z(getSize(d[0],d[1]))/Math.PI)+2;return'translate('+dx+','+nv.utils.NaNtoZero(y(getY(d[0],d[1])))+')';}).remove();titles.each(function(d){d3.select(this).classed('nv-label',true).classed('nv-label-'+d[1],false).classed('hover',false);});titles.watchTransition(renderWatch,'scatter labels').attr('transform',function(d){var dx=nv.utils.NaNtoZero(x(getX(d[0],d[1])))+Math.sqrt(z(getSize(d[0],d[1]))/Math.PI)+2;return'translate('+dx+','+nv.utils.NaNtoZero(y(getY(d[0],d[1])))+')'});}
if(interactiveUpdateDelay)
{clearTimeout(timeoutID);timeoutID=setTimeout(updateInteractiveLayer,interactiveUpdateDelay);}
else
{updateInteractiveLayer();}
x0=x.copy();y0=y.copy();z0=z.copy();});renderWatch.renderEnd('scatter immediate');return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._calls=new function(){this.clearHighlights=function(){nv.dom.write(function(){container.selectAll(".nv-point.hover").classed("hover",false);});return null;};this.highlightPoint=function(seriesIndex,pointIndex,isHoverOver){nv.dom.write(function(){container.select('.nv-groups').selectAll(".nv-series-"+seriesIndex).selectAll(".nv-point-"+pointIndex).classed("hover",isHoverOver);});};};dispatch.on('elementMouseover.point',function(d){if(interactive)chart._calls.highlightPoint(d.seriesIndex,d.pointIndex,true);});dispatch.on('elementMouseout.point',function(d){if(interactive)chart._calls.highlightPoint(d.seriesIndex,d.pointIndex,false);});chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},xScale:{get:function(){return x;},set:function(_){x=_;}},yScale:{get:function(){return y;},set:function(_){y=_;}},pointScale:{get:function(){return z;},set:function(_){z=_;}},xDomain:{get:function(){return xDomain;},set:function(_){xDomain=_;}},yDomain:{get:function(){return yDomain;},set:function(_){yDomain=_;}},pointDomain:{get:function(){return sizeDomain;},set:function(_){sizeDomain=_;}},xRange:{get:function(){return xRange;},set:function(_){xRange=_;}},yRange:{get:function(){return yRange;},set:function(_){yRange=_;}},pointRange:{get:function(){return sizeRange;},set:function(_){sizeRange=_;}},forceX:{get:function(){return forceX;},set:function(_){forceX=_;}},forceY:{get:function(){return forceY;},set:function(_){forceY=_;}},forcePoint:{get:function(){return forceSize;},set:function(_){forceSize=_;}},interactive:{get:function(){return interactive;},set:function(_){interactive=_;}},pointActive:{get:function(){return pointActive;},set:function(_){pointActive=_;}},padDataOuter:{get:function(){return padDataOuter;},set:function(_){padDataOuter=_;}},padData:{get:function(){return padData;},set:function(_){padData=_;}},clipEdge:{get:function(){return clipEdge;},set:function(_){clipEdge=_;}},clipVoronoi:{get:function(){return clipVoronoi;},set:function(_){clipVoronoi=_;}},clipRadius:{get:function(){return clipRadius;},set:function(_){clipRadius=_;}},showVoronoi:{get:function(){return showVoronoi;},set:function(_){showVoronoi=_;}},id:{get:function(){return id;},set:function(_){id=_;}},interactiveUpdateDelay:{get:function(){return interactiveUpdateDelay;},set:function(_){interactiveUpdateDelay=_;}},showLabels:{get:function(){return showLabels;},set:function(_){showLabels=_;}},x:{get:function(){return getX;},set:function(_){getX=d3.functor(_);}},y:{get:function(){return getY;},set:function(_){getY=d3.functor(_);}},pointSize:{get:function(){return getSize;},set:function(_){getSize=d3.functor(_);}},pointShape:{get:function(){return getShape;},set:function(_){getShape=d3.functor(_);}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}},useVoronoi:{get:function(){return useVoronoi;},set:function(_){useVoronoi=_;if(useVoronoi===false){clipVoronoi=false;}}}});nv.utils.initOptions(chart);return chart;};nv.models.multiBar=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=960,height=500,x=d3.scale.ordinal(),y=d3.scale.linear(),id=Math.floor(Math.random()*10000),container=null,getX=function(d){return d.x},getY=function(d){return d.y},forceY=[0],clipEdge=true,stacked=false,stackOffset='zero',color=nv.utils.defaultColor(),hideable=false,barColor=null,disabled,duration=500,xDomain,yDomain,xRange,yRange,groupSpacing=0.1,dispatch=d3.dispatch('chartClick','elementClick','elementDblClick','elementMouseover','elementMouseout','elementMousemove','renderEnd');var x0,y0,renderWatch=nv.utils.renderWatch(dispatch,duration);var last_datalength=0;function chart(selection){renderWatch.reset();selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom;container=d3.select(this);nv.utils.initSVG(container);var nonStackableCount=0;var endFn=function(d,i){if(d.series===data.length-1&&i===data[0].values.length-1)
return true;return false;};if(hideable&&data.length)hideable=[{values:data[0].values.map(function(d){return{x:d.x,y:0,series:d.series,size:0.01};})}];if(stacked){var parsed=d3.layout.stack().offset(stackOffset).values(function(d){return d.values}).y(getY)
(!data.length&&hideable?hideable:data);parsed.forEach(function(series,i){if(series.nonStackable){data[i].nonStackableSeries=nonStackableCount++;parsed[i]=data[i];}else{if(i>0&&parsed[i-1].nonStackable){parsed[i].values.map(function(d,j){d.y0-=parsed[i-1].values[j].y;d.y1=d.y0+d.y;});}}});data=parsed;}
data.forEach(function(series,i){series.values.forEach(function(point){point.series=i;point.key=series.key;});});if(stacked){data[0].values.map(function(d,i){var posBase=0,negBase=0;data.map(function(d,idx){if(!data[idx].nonStackable){var f=d.values[i]
f.size=Math.abs(f.y);if(f.y<0){f.y1=negBase;negBase=negBase-f.size;}else
{f.y1=f.size+posBase;posBase=posBase+f.size;}}});});}
var seriesData=(xDomain&&yDomain)?[]:data.map(function(d,idx){return d.values.map(function(d,i){return{x:getX(d,i),y:getY(d,i),y0:d.y0,y1:d.y1,idx:idx}})});x.domain(xDomain||d3.merge(seriesData).map(function(d){return d.x})).rangeBands(xRange||[0,availableWidth],groupSpacing);y.domain(yDomain||d3.extent(d3.merge(seriesData).map(function(d){var domain=d.y;if(stacked&&!data[d.idx].nonStackable){if(d.y>0){domain=d.y1}else{domain=d.y1+d.y}}
return domain;}).concat(forceY))).range(yRange||[availableHeight,0]);if(x.domain()[0]===x.domain()[1])
x.domain()[0]?x.domain([x.domain()[0]-x.domain()[0]*0.01,x.domain()[1]+x.domain()[1]*0.01]):x.domain([-1,1]);if(y.domain()[0]===y.domain()[1])
y.domain()[0]?y.domain([y.domain()[0]+y.domain()[0]*0.01,y.domain()[1]-y.domain()[1]*0.01]):y.domain([-1,1]);x0=x0||x;y0=y0||y;var wrap=container.selectAll('g.nv-wrap.nv-multibar').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-multibar');var defsEnter=wrapEnter.append('defs');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-groups');wrap.attr('transform','translate('+margin.left+','+margin.top+')');defsEnter.append('clipPath').attr('id','nv-edge-clip-'+id).append('rect');wrap.select('#nv-edge-clip-'+id+' rect').attr('width',availableWidth).attr('height',availableHeight);g.attr('clip-path',clipEdge?'url(#nv-edge-clip-'+id+')':'');var groups=wrap.select('.nv-groups').selectAll('.nv-group').data(function(d){return d},function(d,i){return i});groups.enter().append('g').style('stroke-opacity',1e-6).style('fill-opacity',1e-6);var exitTransition=renderWatch.transition(groups.exit().selectAll('rect.nv-bar'),'multibarExit',Math.min(100,duration)).attr('y',function(d,i,j){var yVal=y0(0)||0;if(stacked){if(data[d.series]&&!data[d.series].nonStackable){yVal=y0(d.y0);}}
return yVal;}).attr('height',0).remove();if(exitTransition.delay)
exitTransition.delay(function(d,i){var delay=i*(duration/(last_datalength+1))-i;return delay;});groups.attr('class',function(d,i){return'nv-group nv-series-'+i}).classed('hover',function(d){return d.hover}).style('fill',function(d,i){return color(d,i)}).style('stroke',function(d,i){return color(d,i)});groups.style('stroke-opacity',1).style('fill-opacity',0.75);var bars=groups.selectAll('rect.nv-bar').data(function(d){return(hideable&&!data.length)?hideable.values:d.values});bars.exit().remove();var barsEnter=bars.enter().append('rect').attr('class',function(d,i){return getY(d,i)<0?'nv-bar negative':'nv-bar positive'}).attr('x',function(d,i,j){return stacked&&!data[j].nonStackable?0:(j*x.rangeBand()/data.length)}).attr('y',function(d,i,j){return y0(stacked&&!data[j].nonStackable?d.y0:0)||0}).attr('height',0).attr('width',function(d,i,j){return x.rangeBand()/(stacked&&!data[j].nonStackable?1:data.length)}).attr('transform',function(d,i){return'translate('+x(getX(d,i))+',0)';});bars.style('fill',function(d,i,j){return color(d,j,i);}).style('stroke',function(d,i,j){return color(d,j,i);}).on('mouseover',function(d,i){d3.select(this).classed('hover',true);dispatch.elementMouseover({data:d,index:i,color:d3.select(this).style("fill")});}).on('mouseout',function(d,i){d3.select(this).classed('hover',false);dispatch.elementMouseout({data:d,index:i,color:d3.select(this).style("fill")});}).on('mousemove',function(d,i){dispatch.elementMousemove({data:d,index:i,color:d3.select(this).style("fill")});}).on('click',function(d,i){var element=this;dispatch.elementClick({data:d,index:i,color:d3.select(this).style("fill"),event:d3.event,element:element});d3.event.stopPropagation();}).on('dblclick',function(d,i){dispatch.elementDblClick({data:d,index:i,color:d3.select(this).style("fill")});d3.event.stopPropagation();});bars.attr('class',function(d,i){return getY(d,i)<0?'nv-bar negative':'nv-bar positive'}).attr('transform',function(d,i){return'translate('+x(getX(d,i))+',0)';})
if(barColor){if(!disabled)disabled=data.map(function(){return true});bars.style('fill',function(d,i,j){return d3.rgb(barColor(d,i)).darker(disabled.map(function(d,i){return i}).filter(function(d,i){return!disabled[i]})[j]).toString();}).style('stroke',function(d,i,j){return d3.rgb(barColor(d,i)).darker(disabled.map(function(d,i){return i}).filter(function(d,i){return!disabled[i]})[j]).toString();});}
var barSelection=bars.watchTransition(renderWatch,'multibar',Math.min(250,duration)).delay(function(d,i){return i*duration/data[0].values.length;});if(stacked){barSelection.attr('y',function(d,i,j){var yVal=0;if(!data[j].nonStackable){yVal=y(d.y1);}else{if(getY(d,i)<0){yVal=y(0);}else{if(y(0)-y(getY(d,i))<-1){yVal=y(0)-1;}else{yVal=y(getY(d,i))||0;}}}
return yVal;}).attr('height',function(d,i,j){if(!data[j].nonStackable){return Math.max(Math.abs(y(d.y+d.y0)-y(d.y0)),0);}else{return Math.max(Math.abs(y(getY(d,i))-y(0)),0)||0;}}).attr('x',function(d,i,j){var width=0;if(data[j].nonStackable){width=d.series*x.rangeBand()/data.length;if(data.length!==nonStackableCount){width=data[j].nonStackableSeries*x.rangeBand()/(nonStackableCount*2);}}
return width;}).attr('width',function(d,i,j){if(!data[j].nonStackable){return x.rangeBand();}else{var width=(x.rangeBand()/nonStackableCount);if(data.length!==nonStackableCount){width=x.rangeBand()/(nonStackableCount*2);}
return width;}});}
else{barSelection.attr('x',function(d,i){return d.series*x.rangeBand()/data.length;}).attr('width',x.rangeBand()/data.length).attr('y',function(d,i){return getY(d,i)<0?y(0):y(0)-y(getY(d,i))<1?y(0)-1:y(getY(d,i))||0;}).attr('height',function(d,i){return Math.max(Math.abs(y(getY(d,i))-y(0)),1)||0;});}
x0=x.copy();y0=y.copy();if(data[0]&&data[0].values){last_datalength=data[0].values.length;}});renderWatch.renderEnd('multibar immediate');return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},x:{get:function(){return getX;},set:function(_){getX=_;}},y:{get:function(){return getY;},set:function(_){getY=_;}},xScale:{get:function(){return x;},set:function(_){x=_;}},yScale:{get:function(){return y;},set:function(_){y=_;}},xDomain:{get:function(){return xDomain;},set:function(_){xDomain=_;}},yDomain:{get:function(){return yDomain;},set:function(_){yDomain=_;}},xRange:{get:function(){return xRange;},set:function(_){xRange=_;}},yRange:{get:function(){return yRange;},set:function(_){yRange=_;}},forceY:{get:function(){return forceY;},set:function(_){forceY=_;}},stacked:{get:function(){return stacked;},set:function(_){stacked=_;}},stackOffset:{get:function(){return stackOffset;},set:function(_){stackOffset=_;}},clipEdge:{get:function(){return clipEdge;},set:function(_){clipEdge=_;}},disabled:{get:function(){return disabled;},set:function(_){disabled=_;}},id:{get:function(){return id;},set:function(_){id=_;}},hideable:{get:function(){return hideable;},set:function(_){hideable=_;}},groupSpacing:{get:function(){return groupSpacing;},set:function(_){groupSpacing=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}},barColor:{get:function(){return barColor;},set:function(_){barColor=_?nv.utils.getColor(_):null;}}});nv.utils.initOptions(chart);return chart;};nv.models.legend=function(){"use strict";var margin={top:5,right:0,bottom:5,left:0},width=400,height=20,getKey=function(d){return d.key},color=nv.utils.getColor(),maxKeyLength=20,align=true,padding=32,rightAlign=true,updateState=true,radioButtonMode=false,expanded=false,dispatch=d3.dispatch('legendClick','legendDblclick','legendMouseover','legendMouseout','stateChange'),vers='classic';function chart(selection){selection.each(function(data){var availableWidth=width-margin.left-margin.right,container=d3.select(this);nv.utils.initSVG(container);var wrap=container.selectAll('g.nv-legend').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-legend').append('g');var g=wrap.select('g');wrap.attr('transform','translate('+margin.left+','+margin.top+')');var series=g.selectAll('.nv-series').data(function(d){if(vers!='furious')return d;return d.filter(function(n){return expanded?true:!n.disengaged;});});var seriesEnter=series.enter().append('g').attr('class','nv-series');var seriesShape;var versPadding;switch(vers){case'furious':versPadding=23;break;case'classic':versPadding=20;}
if(vers=='classic'){seriesEnter.append('circle').style('stroke-width',2).attr('class','nv-legend-symbol').attr('r',5);seriesShape=series.select('circle');}else if(vers=='furious'){seriesEnter.append('rect').style('stroke-width',2).attr('class','nv-legend-symbol').attr('rx',3).attr('ry',3);seriesShape=series.select('.nv-legend-symbol');seriesEnter.append('g').attr('class','nv-check-box').property('innerHTML','<path d="M0.5,5 L22.5,5 L22.5,26.5 L0.5,26.5 L0.5,5 Z" class="nv-box"></path><path d="M5.5,12.8618467 L11.9185089,19.2803556 L31,0.198864511" class="nv-check"></path>').attr('transform','translate(-10,-8)scale(0.5)');var seriesCheckbox=series.select('.nv-check-box');seriesCheckbox.each(function(d,i){d3.select(this).selectAll('path').attr('stroke',setTextColor(d,i));});}
seriesEnter.append('text').attr('text-anchor','start').attr('class','nv-legend-text').attr('dy','.32em').attr('dx','8');var seriesText=series.select('text.nv-legend-text');series.on('mouseover',function(d,i){dispatch.legendMouseover(d,i);}).on('mouseout',function(d,i){dispatch.legendMouseout(d,i);}).on('click',function(d,i){dispatch.legendClick(d,i);var data=series.data();if(updateState){if(vers=='classic'){if(radioButtonMode){data.forEach(function(series){series.disabled=true});d.disabled=false;}
else{d.disabled=!d.disabled;if(data.every(function(series){return series.disabled})){data.forEach(function(series){series.disabled=false});}}}else if(vers=='furious'){if(expanded){d.disengaged=!d.disengaged;d.userDisabled=d.userDisabled==undefined?!!d.disabled:d.userDisabled;d.disabled=d.disengaged||d.userDisabled;}else if(!expanded){d.disabled=!d.disabled;d.userDisabled=d.disabled;var engaged=data.filter(function(d){return!d.disengaged;});if(engaged.every(function(series){return series.userDisabled})){data.forEach(function(series){series.disabled=series.userDisabled=false;});}}}
dispatch.stateChange({disabled:data.map(function(d){return!!d.disabled}),disengaged:data.map(function(d){return!!d.disengaged})});}}).on('dblclick',function(d,i){if(vers=='furious'&&expanded)return;dispatch.legendDblclick(d,i);if(updateState){var data=series.data();data.forEach(function(series){series.disabled=true;if(vers=='furious')series.userDisabled=series.disabled;});d.disabled=false;if(vers=='furious')d.userDisabled=d.disabled;dispatch.stateChange({disabled:data.map(function(d){return!!d.disabled})});}});series.classed('nv-disabled',function(d){return d.userDisabled});series.exit().remove();seriesText.attr('fill',setTextColor).text(getKey);var legendWidth=0;if(align){var seriesWidths=[];series.each(function(d,i){var legendText;if(getKey(d).length>maxKeyLength){var trimmedKey=getKey(d).substring(0,maxKeyLength);legendText=d3.select(this).select('text').text(trimmedKey+"...");d3.select(this).append("svg:title").text(getKey(d));}else{legendText=d3.select(this).select('text');}
var nodeTextLength;try{nodeTextLength=legendText.node().getComputedTextLength();if(nodeTextLength<=0)throw Error();}
catch(e){nodeTextLength=nv.utils.calcApproxTextWidth(legendText);}
seriesWidths.push(nodeTextLength+padding);});var seriesPerRow=0;var columnWidths=[];legendWidth=0;while(legendWidth<availableWidth&&seriesPerRow<seriesWidths.length){columnWidths[seriesPerRow]=seriesWidths[seriesPerRow];legendWidth+=seriesWidths[seriesPerRow++];}
if(seriesPerRow===0)seriesPerRow=1;while(legendWidth>availableWidth&&seriesPerRow>1){columnWidths=[];seriesPerRow--;for(var k=0;k<seriesWidths.length;k++){if(seriesWidths[k]>(columnWidths[k%seriesPerRow]||0))
columnWidths[k%seriesPerRow]=seriesWidths[k];}
legendWidth=columnWidths.reduce(function(prev,cur,index,array){return prev+cur;});}
var xPositions=[];for(var i=0,curX=0;i<seriesPerRow;i++){xPositions[i]=curX;curX+=columnWidths[i];}
series.attr('transform',function(d,i){return'translate('+xPositions[i%seriesPerRow]+','+(5+Math.floor(i/seriesPerRow)*versPadding)+')';});if(rightAlign){g.attr('transform','translate('+(width-margin.right-legendWidth)+','+margin.top+')');}
else{g.attr('transform','translate(0'+','+margin.top+')');}
height=margin.top+margin.bottom+(Math.ceil(seriesWidths.length/seriesPerRow)*versPadding);}else{var ypos=5,newxpos=5,maxwidth=0,xpos;series.attr('transform',function(d,i){var length=d3.select(this).select('text').node().getComputedTextLength()+padding;xpos=newxpos;if(width<margin.left+margin.right+xpos+length){newxpos=xpos=5;ypos+=versPadding;}
newxpos+=length;if(newxpos>maxwidth)maxwidth=newxpos;if(legendWidth<xpos+maxwidth){legendWidth=xpos+maxwidth;}
return'translate('+xpos+','+ypos+')';});g.attr('transform','translate('+(width-margin.right-maxwidth)+','+margin.top+')');height=margin.top+margin.bottom+ypos+15;}
if(vers=='furious'){seriesShape.attr('width',function(d,i){return seriesText[0][i].getComputedTextLength()+27;}).attr('height',18).attr('y',-9).attr('x',-15);gEnter.insert('rect',':first-child').attr('class','nv-legend-bg').attr('fill','#eee').attr('opacity',0);var seriesBG=g.select('.nv-legend-bg');seriesBG.transition().duration(300).attr('x',-versPadding).attr('width',legendWidth+versPadding-12).attr('height',height+10).attr('y',-margin.top-10).attr('opacity',expanded?1:0);}
seriesShape.style('fill',setBGColor).style('fill-opacity',setBGOpacity).style('stroke',setBGColor);});function setTextColor(d,i){if(vers!='furious')return'#000';if(expanded){return d.disengaged?'#000':'#fff';}else if(!expanded){if(!d.color)d.color=color(d,i);return!!d.disabled?d.color:'#fff';}}
function setBGColor(d,i){if(expanded&&vers=='furious'){return d.disengaged?'#eee':d.color||color(d,i);}else{return d.color||color(d,i);}}
function setBGOpacity(d,i){if(expanded&&vers=='furious'){return 1;}else{return!!d.disabled?0:1;}}
return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},key:{get:function(){return getKey;},set:function(_){getKey=_;}},align:{get:function(){return align;},set:function(_){align=_;}},maxKeyLength:{get:function(){return maxKeyLength;},set:function(_){maxKeyLength=_;}},rightAlign:{get:function(){return rightAlign;},set:function(_){rightAlign=_;}},padding:{get:function(){return padding;},set:function(_){padding=_;}},updateState:{get:function(){return updateState;},set:function(_){updateState=_;}},radioButtonMode:{get:function(){return radioButtonMode;},set:function(_){radioButtonMode=_;}},expanded:{get:function(){return expanded;},set:function(_){expanded=_;}},vers:{get:function(){return vers;},set:function(_){vers=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}}});nv.utils.initOptions(chart);return chart;};nv.models.lineChart=function(){"use strict";var lines=nv.models.line(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),legend=nv.models.legend(),interactiveLayer=nv.interactiveGuideline(),tooltip=nv.models.tooltip(),lines2=nv.models.line(),x2Axis=nv.models.axis(),y2Axis=nv.models.axis(),brush=d3.svg.brush();var margin={top:30,right:20,bottom:50,left:60},margin2={top:0,right:20,bottom:20,left:60},color=nv.utils.defaultColor(),width=null,height=null,showLegend=true,legendPosition='top',showXAxis=true,showYAxis=true,rightAlignYAxis=false,useInteractiveGuideline=false,x,y,x2,y2,focusEnable=false,focusShowAxisY=false,focusShowAxisX=true,focusHeight=50,brushExtent=null,state=nv.utils.state(),defaultState=null,noData=null,dispatch=d3.dispatch('tooltipShow','tooltipHide','brush','stateChange','changeState','renderEnd'),duration=250;xAxis.orient('bottom').tickPadding(7);yAxis.orient(rightAlignYAxis?'right':'left');lines.clipEdge(true).duration(0);lines2.interactive(false);lines2.pointActive(function(d){return false;});x2Axis.orient('bottom').tickPadding(5);y2Axis.orient(rightAlignYAxis?'right':'left');tooltip.valueFormatter(function(d,i){return yAxis.tickFormat()(d,i);}).headerFormatter(function(d,i){return xAxis.tickFormat()(d,i);});interactiveLayer.tooltip.valueFormatter(function(d,i){return yAxis.tickFormat()(d,i);}).headerFormatter(function(d,i){return xAxis.tickFormat()(d,i);});var renderWatch=nv.utils.renderWatch(dispatch,duration);var stateGetter=function(data){return function(){return{active:data.map(function(d){return!d.disabled;})};};};var stateSetter=function(data){return function(state){if(state.active!==undefined)
data.forEach(function(series,i){series.disabled=!state.active[i];});};};function chart(selection){renderWatch.reset();renderWatch.models(lines);renderWatch.models(lines2);if(showXAxis)renderWatch.models(xAxis);if(showYAxis)renderWatch.models(yAxis);if(focusShowAxisX)renderWatch.models(x2Axis);if(focusShowAxisY)renderWatch.models(y2Axis);selection.each(function(data){var container=d3.select(this);nv.utils.initSVG(container);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight1=nv.utils.availableHeight(height,container,margin)-(focusEnable?focusHeight:0),availableHeight2=focusHeight-margin2.top-margin2.bottom;chart.update=function(){if(duration===0){container.call(chart);}else{container.transition().duration(duration).call(chart);}};chart.container=this;state.setter(stateSetter(data),chart.update).getter(stateGetter(data)).update();state.disabled=data.map(function(d){return!!d.disabled;});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length||!data.filter(function(d){return d.values.length;}).length){nv.utils.noData(chart,container);return chart;}else{container.selectAll('.nv-noData').remove();}
x=lines.xScale();y=lines.yScale();x2=lines2.xScale();y2=lines2.yScale();var wrap=container.selectAll('g.nv-wrap.nv-lineChart').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-lineChart').append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-legendWrap');var focusEnter=gEnter.append('g').attr('class','nv-focus');focusEnter.append('g').attr('class','nv-background').append('rect');focusEnter.append('g').attr('class','nv-x nv-axis');focusEnter.append('g').attr('class','nv-y nv-axis');focusEnter.append('g').attr('class','nv-linesWrap');focusEnter.append('g').attr('class','nv-interactive');var contextEnter=gEnter.append('g').attr('class','nv-context');contextEnter.append('g').attr('class','nv-background').append('rect');contextEnter.append('g').attr('class','nv-x nv-axis');contextEnter.append('g').attr('class','nv-y nv-axis');contextEnter.append('g').attr('class','nv-linesWrap');contextEnter.append('g').attr('class','nv-brushBackground');contextEnter.append('g').attr('class','nv-x nv-brush');if(!showLegend){g.select('.nv-legendWrap').selectAll('*').remove();}else{legend.width(availableWidth);g.select('.nv-legendWrap').datum(data).call(legend);if(legendPosition==='bottom'){wrap.select('.nv-legendWrap').attr('transform','translate(0,'+(availableHeight1+legend.height())+')');}else if(legendPosition==='top'){if(margin.top!=legend.height()){margin.top=legend.height();availableHeight1=nv.utils.availableHeight(height,container,margin)-(focusEnable?focusHeight:0);}
wrap.select('.nv-legendWrap').attr('transform','translate(0,'+(-margin.top)+')');}}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');if(rightAlignYAxis){g.select(".nv-y.nv-axis").attr("transform","translate("+availableWidth+",0)");}
if(useInteractiveGuideline){interactiveLayer.width(availableWidth).height(availableHeight1).margin({left:margin.left,top:margin.top}).svgContainer(container).xScale(x);wrap.select(".nv-interactive").call(interactiveLayer);}
g.select('.nv-focus .nv-background rect').attr('width',availableWidth).attr('height',availableHeight1);lines.width(availableWidth).height(availableHeight1).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled;}));var linesWrap=g.select('.nv-linesWrap').datum(data.filter(function(d){return!d.disabled;}));if(showXAxis){xAxis.scale(x)._ticks(nv.utils.calcTicksX(availableWidth/100,data)).tickSize(-availableHeight1,0);}
if(showYAxis){yAxis.scale(y)._ticks(nv.utils.calcTicksY(availableHeight1/36,data)).tickSize(-availableWidth,0);}
function updateXAxis(){if(showXAxis){g.select('.nv-focus .nv-x.nv-axis').transition().duration(duration).call(xAxis);}}
function updateYAxis(){if(showYAxis){g.select('.nv-focus .nv-y.nv-axis').transition().duration(duration).call(yAxis);}}
g.select('.nv-focus .nv-x.nv-axis').attr('transform','translate(0,'+availableHeight1+')');if(!focusEnable)
{linesWrap.call(lines);updateXAxis();updateYAxis();}
else
{lines2.defined(lines.defined()).width(availableWidth).height(availableHeight2).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled;}));g.select('.nv-context').attr('transform','translate(0,'+(availableHeight1+margin.bottom+margin2.top)+')').style('display',focusEnable?'initial':'none');var contextLinesWrap=g.select('.nv-context .nv-linesWrap').datum(data.filter(function(d){return!d.disabled;}));d3.transition(contextLinesWrap).call(lines2);brush.x(x2).on('brush',function(){onBrush();});if(brushExtent)brush.extent(brushExtent);var brushBG=g.select('.nv-brushBackground').selectAll('g').data([brushExtent||brush.extent()]);var brushBGenter=brushBG.enter().append('g');brushBGenter.append('rect').attr('class','left').attr('x',0).attr('y',0).attr('height',availableHeight2);brushBGenter.append('rect').attr('class','right').attr('x',0).attr('y',0).attr('height',availableHeight2);var gBrush=g.select('.nv-x.nv-brush').call(brush);gBrush.selectAll('rect').attr('height',availableHeight2);gBrush.selectAll('.resize').append('path').attr('d',resizePath);onBrush();g.select('.nv-context .nv-background rect').attr('width',availableWidth).attr('height',availableHeight2);if(focusShowAxisX){x2Axis.scale(x2)._ticks(nv.utils.calcTicksX(availableWidth/100,data)).tickSize(-availableHeight2,0);g.select('.nv-context .nv-x.nv-axis').attr('transform','translate(0,'+y2.range()[0]+')');d3.transition(g.select('.nv-context .nv-x.nv-axis')).call(x2Axis);}
if(focusShowAxisY){y2Axis.scale(y2)._ticks(nv.utils.calcTicksY(availableHeight2/36,data)).tickSize(-availableWidth,0);d3.transition(g.select('.nv-context .nv-y.nv-axis')).call(y2Axis);}
g.select('.nv-context .nv-x.nv-axis').attr('transform','translate(0,'+y2.range()[0]+')');}
legend.dispatch.on('stateChange',function(newState){for(var key in newState)
state[key]=newState[key];dispatch.stateChange(state);chart.update();});interactiveLayer.dispatch.on('elementMousemove',function(e){lines.clearHighlights();var singlePoint,pointIndex,pointXLocation,allData=[];data.filter(function(series,i){series.seriesIndex=i;return!series.disabled&&!series.disableTooltip;}).forEach(function(series,i){var extent=focusEnable?(brush.empty()?x2.domain():brush.extent()):x.domain();var currentValues=series.values.filter(function(d,i){return lines.x()(d,i)>=extent[0]&&lines.x()(d,i)<=extent[1];});pointIndex=nv.interactiveBisect(currentValues,e.pointXValue,lines.x());var point=currentValues[pointIndex];var pointYValue=chart.y()(point,pointIndex);if(pointYValue!==null){lines.highlightPoint(series.seriesIndex,pointIndex,true);}
if(point===undefined)return;if(singlePoint===undefined)singlePoint=point;if(pointXLocation===undefined)pointXLocation=chart.xScale()(chart.x()(point,pointIndex));allData.push({key:series.key,value:pointYValue,color:color(series,series.seriesIndex),data:point});});if(allData.length>2){var yValue=chart.yScale().invert(e.mouseY);var domainExtent=Math.abs(chart.yScale().domain()[0]-chart.yScale().domain()[1]);var threshold=0.03*domainExtent;var indexToHighlight=nv.nearestValueIndex(allData.map(function(d){return d.value;}),yValue,threshold);if(indexToHighlight!==null)
allData[indexToHighlight].highlight=true;}
var defaultValueFormatter=function(d,i){return d==null?"N/A":yAxis.tickFormat()(d);};interactiveLayer.tooltip.chartContainer(chart.container.parentNode).valueFormatter(interactiveLayer.tooltip.valueFormatter()||defaultValueFormatter).data({value:chart.x()(singlePoint,pointIndex),index:pointIndex,series:allData})();interactiveLayer.renderGuideLine(pointXLocation);});interactiveLayer.dispatch.on('elementClick',function(e){var pointXLocation,allData=[];data.filter(function(series,i){series.seriesIndex=i;return!series.disabled;}).forEach(function(series){var pointIndex=nv.interactiveBisect(series.values,e.pointXValue,chart.x());var point=series.values[pointIndex];if(typeof point==='undefined')return;if(typeof pointXLocation==='undefined')pointXLocation=chart.xScale()(chart.x()(point,pointIndex));var yPos=chart.yScale()(chart.y()(point,pointIndex));allData.push({point:point,pointIndex:pointIndex,pos:[pointXLocation,yPos],seriesIndex:series.seriesIndex,series:series});});lines.dispatch.elementClick(allData);});interactiveLayer.dispatch.on("elementMouseout",function(e){lines.clearHighlights();});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'&&data.length===e.disabled.length){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
chart.update();});function resizePath(d){var e=+(d=='e'),x=e?1:-1,y=availableHeight2/3;return'M'+(0.5*x)+','+y
+'A6,6 0 0 '+e+' '+(6.5*x)+','+(y+6)
+'V'+(2*y-6)
+'A6,6 0 0 '+e+' '+(0.5*x)+','+(2*y)
+'Z'
+'M'+(2.5*x)+','+(y+8)
+'V'+(2*y-8)
+'M'+(4.5*x)+','+(y+8)
+'V'+(2*y-8);}
function updateBrushBG(){if(!brush.empty())brush.extent(brushExtent);brushBG.data([brush.empty()?x2.domain():brushExtent]).each(function(d,i){var leftWidth=x2(d[0])-x.range()[0],rightWidth=availableWidth-x2(d[1]);d3.select(this).select('.left').attr('width',leftWidth<0?0:leftWidth);d3.select(this).select('.right').attr('x',x2(d[1])).attr('width',rightWidth<0?0:rightWidth);});}
function onBrush(){brushExtent=brush.empty()?null:brush.extent();var extent=brush.empty()?x2.domain():brush.extent();if(Math.abs(extent[0]-extent[1])<=1){return;}
dispatch.brush({extent:extent,brush:brush});updateBrushBG();var focusLinesWrap=g.select('.nv-focus .nv-linesWrap').datum(data.filter(function(d){return!d.disabled;}).map(function(d,i){return{key:d.key,area:d.area,classed:d.classed,values:d.values.filter(function(d,i){return lines.x()(d,i)>=extent[0]&&lines.x()(d,i)<=extent[1];}),disableTooltip:d.disableTooltip};}));focusLinesWrap.transition().duration(duration).call(lines);updateXAxis();updateYAxis();}});renderWatch.renderEnd('lineChart immediate');return chart;}
lines.dispatch.on('elementMouseover.tooltip',function(evt){if(!evt.series.disableTooltip){tooltip.data(evt).hidden(false);}});lines.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true);});chart.dispatch=dispatch;chart.lines=lines;chart.lines2=lines2;chart.legend=legend;chart.xAxis=xAxis;chart.x2Axis=x2Axis;chart.yAxis=yAxis;chart.y2Axis=y2Axis;chart.interactiveLayer=interactiveLayer;chart.tooltip=tooltip;chart.state=state;chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},showLegend:{get:function(){return showLegend;},set:function(_){showLegend=_;}},legendPosition:{get:function(){return legendPosition;},set:function(_){legendPosition=_;}},showXAxis:{get:function(){return showXAxis;},set:function(_){showXAxis=_;}},showYAxis:{get:function(){return showYAxis;},set:function(_){showYAxis=_;}},focusEnable:{get:function(){return focusEnable;},set:function(_){focusEnable=_;}},focusHeight:{get:function(){return height2;},set:function(_){focusHeight=_;}},focusShowAxisX:{get:function(){return focusShowAxisX;},set:function(_){focusShowAxisX=_;}},focusShowAxisY:{get:function(){return focusShowAxisY;},set:function(_){focusShowAxisY=_;}},brushExtent:{get:function(){return brushExtent;},set:function(_){brushExtent=_;}},defaultState:{get:function(){return defaultState;},set:function(_){defaultState=_;}},noData:{get:function(){return noData;},set:function(_){noData=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);lines.duration(duration);xAxis.duration(duration);x2Axis.duration(duration);yAxis.duration(duration);y2Axis.duration(duration);}},focusMargin:{get:function(){return margin2;},set:function(_){margin2.top=_.top!==undefined?_.top:margin2.top;margin2.right=_.right!==undefined?_.right:margin2.right;margin2.bottom=_.bottom!==undefined?_.bottom:margin2.bottom;margin2.left=_.left!==undefined?_.left:margin2.left;}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);legend.color(color);lines.color(color);}},interpolate:{get:function(){return lines.interpolate();},set:function(_){lines.interpolate(_);lines2.interpolate(_);}},xTickFormat:{get:function(){return xAxis.tickFormat();},set:function(_){xAxis.tickFormat(_);x2Axis.tickFormat(_);}},yTickFormat:{get:function(){return yAxis.tickFormat();},set:function(_){yAxis.tickFormat(_);y2Axis.tickFormat(_);}},x:{get:function(){return lines.x();},set:function(_){lines.x(_);lines2.x(_);}},y:{get:function(){return lines.y();},set:function(_){lines.y(_);lines2.y(_);}},rightAlignYAxis:{get:function(){return rightAlignYAxis;},set:function(_){rightAlignYAxis=_;yAxis.orient(rightAlignYAxis?'right':'left');}},useInteractiveGuideline:{get:function(){return useInteractiveGuideline;},set:function(_){useInteractiveGuideline=_;if(useInteractiveGuideline){lines.interactive(false);lines.useVoronoi(false);}}}});nv.utils.inheritOptions(chart,lines);nv.utils.initOptions(chart);return chart;};nv.models.lineWithFocusChart=function(){return nv.models.lineChart().margin({bottom:30}).focusEnable(true);};nv.models.line=function(){"use strict";var scatter=nv.models.scatter();var margin={top:0,right:0,bottom:0,left:0},width=960,height=500,container=null,strokeWidth=1.5,color=nv.utils.defaultColor(),getX=function(d){return d.x},getY=function(d){return d.y},defined=function(d,i){return!isNaN(getY(d,i))&&getY(d,i)!==null},isArea=function(d){return d.area},clipEdge=false,x,y,interpolate="linear",duration=250,dispatch=d3.dispatch('elementClick','elementMouseover','elementMouseout','renderEnd');scatter.pointSize(16).pointDomain([16,256]);var x0,y0,renderWatch=nv.utils.renderWatch(dispatch,duration);function chart(selection){renderWatch.reset();renderWatch.models(scatter);selection.each(function(data){container=d3.select(this);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);nv.utils.initSVG(container);x=scatter.xScale();y=scatter.yScale();x0=x0||x;y0=y0||y;var wrap=container.selectAll('g.nv-wrap.nv-line').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-line');var defsEnter=wrapEnter.append('defs');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-groups');gEnter.append('g').attr('class','nv-scatterWrap');wrap.attr('transform','translate('+margin.left+','+margin.top+')');scatter.width(availableWidth).height(availableHeight);var scatterWrap=wrap.select('.nv-scatterWrap');scatterWrap.call(scatter);defsEnter.append('clipPath').attr('id','nv-edge-clip-'+scatter.id()).append('rect');wrap.select('#nv-edge-clip-'+scatter.id()+' rect').attr('width',availableWidth).attr('height',(availableHeight>0)?availableHeight:0);g.attr('clip-path',clipEdge?'url(#nv-edge-clip-'+scatter.id()+')':'');scatterWrap.attr('clip-path',clipEdge?'url(#nv-edge-clip-'+scatter.id()+')':'');var groups=wrap.select('.nv-groups').selectAll('.nv-group').data(function(d){return d},function(d){return d.key});groups.enter().append('g').style('stroke-opacity',1e-6).style('stroke-width',function(d){return d.strokeWidth||strokeWidth}).style('fill-opacity',1e-6);groups.exit().remove();groups.attr('class',function(d,i){return(d.classed||'')+' nv-group nv-series-'+i;}).classed('hover',function(d){return d.hover}).style('fill',function(d,i){return color(d,i)}).style('stroke',function(d,i){return color(d,i)});groups.watchTransition(renderWatch,'line: groups').style('stroke-opacity',1).style('fill-opacity',function(d){return d.fillOpacity||.5});var areaPaths=groups.selectAll('path.nv-area').data(function(d){return isArea(d)?[d]:[]});areaPaths.enter().append('path').attr('class','nv-area').attr('d',function(d){return d3.svg.area().interpolate(interpolate).defined(defined).x(function(d,i){return nv.utils.NaNtoZero(x0(getX(d,i)))}).y0(function(d,i){return nv.utils.NaNtoZero(y0(getY(d,i)))}).y1(function(d,i){return y0(y.domain()[0]<=0?y.domain()[1]>=0?0:y.domain()[1]:y.domain()[0])}).apply(this,[d.values])});groups.exit().selectAll('path.nv-area').remove();areaPaths.watchTransition(renderWatch,'line: areaPaths').attr('d',function(d){return d3.svg.area().interpolate(interpolate).defined(defined).x(function(d,i){return nv.utils.NaNtoZero(x(getX(d,i)))}).y0(function(d,i){return nv.utils.NaNtoZero(y(getY(d,i)))}).y1(function(d,i){return y(y.domain()[0]<=0?y.domain()[1]>=0?0:y.domain()[1]:y.domain()[0])}).apply(this,[d.values])});var linePaths=groups.selectAll('path.nv-line').data(function(d){return[d.values]});linePaths.enter().append('path').attr('class','nv-line').attr('d',d3.svg.line().interpolate(interpolate).defined(defined).x(function(d,i){return nv.utils.NaNtoZero(x0(getX(d,i)))}).y(function(d,i){return nv.utils.NaNtoZero(y0(getY(d,i)))}));linePaths.watchTransition(renderWatch,'line: linePaths').attr('d',d3.svg.line().interpolate(interpolate).defined(defined).x(function(d,i){return nv.utils.NaNtoZero(x(getX(d,i)))}).y(function(d,i){return nv.utils.NaNtoZero(y(getY(d,i)))}));x0=x.copy();y0=y.copy();});renderWatch.renderEnd('line immediate');return chart;}
chart.dispatch=dispatch;chart.scatter=scatter;scatter.dispatch.on('elementClick',function(){dispatch.elementClick.apply(this,arguments);});scatter.dispatch.on('elementMouseover',function(){dispatch.elementMouseover.apply(this,arguments);});scatter.dispatch.on('elementMouseout',function(){dispatch.elementMouseout.apply(this,arguments);});chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},defined:{get:function(){return defined;},set:function(_){defined=_;}},interpolate:{get:function(){return interpolate;},set:function(_){interpolate=_;}},clipEdge:{get:function(){return clipEdge;},set:function(_){clipEdge=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);scatter.duration(duration);}},isArea:{get:function(){return isArea;},set:function(_){isArea=d3.functor(_);}},x:{get:function(){return getX;},set:function(_){getX=_;scatter.x(_);}},y:{get:function(){return getY;},set:function(_){getY=_;scatter.y(_);}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);scatter.color(color);}}});nv.utils.inheritOptions(chart,scatter);nv.utils.initOptions(chart);return chart;};nv.models.discreteBarChart=function(){"use strict";var discretebar=nv.models.discreteBar(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),legend=nv.models.legend(),tooltip=nv.models.tooltip();var margin={top:15,right:10,bottom:50,left:60},width=null,height=null,color=nv.utils.getColor(),showLegend=false,showXAxis=true,showYAxis=true,rightAlignYAxis=false,staggerLabels=false,wrapLabels=false,rotateLabels=0,x,y,noData=null,dispatch=d3.dispatch('beforeUpdate','renderEnd'),duration=250;xAxis.orient('bottom').showMaxMin(false).tickFormat(function(d){return d});yAxis.orient((rightAlignYAxis)?'right':'left').tickFormat(d3.format(',.1f'));tooltip.duration(0).headerEnabled(false).valueFormatter(function(d,i){return yAxis.tickFormat()(d,i);}).keyFormatter(function(d,i){return xAxis.tickFormat()(d,i);});var renderWatch=nv.utils.renderWatch(dispatch,duration);function chart(selection){renderWatch.reset();renderWatch.models(discretebar);if(showXAxis)renderWatch.models(xAxis);if(showYAxis)renderWatch.models(yAxis);selection.each(function(data){var container=d3.select(this),that=this;nv.utils.initSVG(container);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);chart.update=function(){dispatch.beforeUpdate();container.transition().duration(duration).call(chart);};chart.container=this;if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){nv.utils.noData(chart,container);return chart;}else{container.selectAll('.nv-noData').remove();}
x=discretebar.xScale();y=discretebar.yScale().clamp(true);var wrap=container.selectAll('g.nv-wrap.nv-discreteBarWithAxes').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-discreteBarWithAxes').append('g');var defsEnter=gEnter.append('defs');var g=wrap.select('g');gEnter.append('g').attr('class','nv-x nv-axis');gEnter.append('g').attr('class','nv-y nv-axis').append('g').attr('class','nv-zeroLine').append('line');gEnter.append('g').attr('class','nv-barsWrap');gEnter.append('g').attr('class','nv-legendWrap');g.attr('transform','translate('+margin.left+','+margin.top+')');if(!showLegend){g.select('.nv-legendWrap').selectAll('*').remove();}else{legend.width(availableWidth);g.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=nv.utils.availableHeight(height,container,margin);}
wrap.select('.nv-legendWrap').attr('transform','translate(0,'+(-margin.top)+')')}
if(rightAlignYAxis){g.select(".nv-y.nv-axis").attr("transform","translate("+availableWidth+",0)");}
discretebar.width(availableWidth).height(availableHeight);var barsWrap=g.select('.nv-barsWrap').datum(data.filter(function(d){return!d.disabled}));barsWrap.transition().call(discretebar);defsEnter.append('clipPath').attr('id','nv-x-label-clip-'+discretebar.id()).append('rect');g.select('#nv-x-label-clip-'+discretebar.id()+' rect').attr('width',x.rangeBand()*(staggerLabels?2:1)).attr('height',16).attr('x',-x.rangeBand()/(staggerLabels?1:2));if(showXAxis){xAxis.scale(x)._ticks(nv.utils.calcTicksX(availableWidth/100,data)).tickSize(-availableHeight,0);g.select('.nv-x.nv-axis').attr('transform','translate(0,'+(y.range()[0]+((discretebar.showValues()&&y.domain()[0]<0)?16:0))+')');g.select('.nv-x.nv-axis').call(xAxis);var xTicks=g.select('.nv-x.nv-axis').selectAll('g');if(staggerLabels){xTicks.selectAll('text').attr('transform',function(d,i,j){return'translate(0,'+(j%2==0?'5':'17')+')'})}
if(rotateLabels){xTicks.selectAll('.tick text').attr('transform','rotate('+rotateLabels+' 0,0)').style('text-anchor',rotateLabels>0?'start':'end');}
if(wrapLabels){g.selectAll('.tick text').call(nv.utils.wrapTicks,chart.xAxis.rangeBand())}}
if(showYAxis){yAxis.scale(y)._ticks(nv.utils.calcTicksY(availableHeight/36,data)).tickSize(-availableWidth,0);g.select('.nv-y.nv-axis').call(yAxis);}
g.select(".nv-zeroLine line").attr("x1",0).attr("x2",(rightAlignYAxis)?-availableWidth:availableWidth).attr("y1",y(0)).attr("y2",y(0));});renderWatch.renderEnd('discreteBar chart immediate');return chart;}
discretebar.dispatch.on('elementMouseover.tooltip',function(evt){evt['series']={key:chart.x()(evt.data),value:chart.y()(evt.data),color:evt.color};tooltip.data(evt).hidden(false);});discretebar.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true);});discretebar.dispatch.on('elementMousemove.tooltip',function(evt){tooltip();});chart.dispatch=dispatch;chart.discretebar=discretebar;chart.legend=legend;chart.xAxis=xAxis;chart.yAxis=yAxis;chart.tooltip=tooltip;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},showLegend:{get:function(){return showLegend;},set:function(_){showLegend=_;}},staggerLabels:{get:function(){return staggerLabels;},set:function(_){staggerLabels=_;}},rotateLabels:{get:function(){return rotateLabels;},set:function(_){rotateLabels=_;}},wrapLabels:{get:function(){return wrapLabels;},set:function(_){wrapLabels=!!_;}},showXAxis:{get:function(){return showXAxis;},set:function(_){showXAxis=_;}},showYAxis:{get:function(){return showYAxis;},set:function(_){showYAxis=_;}},noData:{get:function(){return noData;},set:function(_){noData=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);discretebar.duration(duration);xAxis.duration(duration);yAxis.duration(duration);}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);discretebar.color(color);legend.color(color);}},rightAlignYAxis:{get:function(){return rightAlignYAxis;},set:function(_){rightAlignYAxis=_;yAxis.orient((_)?'right':'left');}}});nv.utils.inheritOptions(chart,discretebar);nv.utils.initOptions(chart);return chart;}
nv.models.pieChart=function(){"use strict";var pie=nv.models.pie();var legend=nv.models.legend();var tooltip=nv.models.tooltip();var margin={top:30,right:20,bottom:20,left:20},width=null,height=null,showLegend=true,legendPosition="top",color=nv.utils.defaultColor(),state=nv.utils.state(),defaultState=null,noData=null,duration=250,dispatch=d3.dispatch('stateChange','changeState','renderEnd');tooltip.duration(0).headerEnabled(false).valueFormatter(function(d,i){return pie.valueFormat()(d,i);});var renderWatch=nv.utils.renderWatch(dispatch);var stateGetter=function(data){return function(){return{active:data.map(function(d){return!d.disabled})};}};var stateSetter=function(data){return function(state){if(state.active!==undefined){data.forEach(function(series,i){series.disabled=!state.active[i];});}}};function chart(selection){renderWatch.reset();renderWatch.models(pie);selection.each(function(data){var container=d3.select(this);nv.utils.initSVG(container);var that=this;var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);chart.update=function(){container.transition().call(chart);};chart.container=this;state.setter(stateSetter(data),chart.update).getter(stateGetter(data)).update();state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length){nv.utils.noData(chart,container);return chart;}else{container.selectAll('.nv-noData').remove();}
var wrap=container.selectAll('g.nv-wrap.nv-pieChart').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-pieChart').append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-pieWrap');gEnter.append('g').attr('class','nv-legendWrap');if(!showLegend){g.select('.nv-legendWrap').selectAll('*').remove();}else{if(legendPosition==="top"){legend.width(availableWidth).key(pie.x());wrap.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=nv.utils.availableHeight(height,container,margin);}
wrap.select('.nv-legendWrap').attr('transform','translate(0,'+(-margin.top)+')');}else if(legendPosition==="right"){var legendWidth=nv.models.legend().width();if(availableWidth/2<legendWidth){legendWidth=(availableWidth/2)}
legend.height(availableHeight).key(pie.x());legend.width(legendWidth);availableWidth-=legend.width();wrap.select('.nv-legendWrap').datum(data).call(legend).attr('transform','translate('+(availableWidth)+',0)');}}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');pie.width(availableWidth).height(availableHeight);var pieWrap=g.select('.nv-pieWrap').datum([data]);d3.transition(pieWrap).call(pie);legend.dispatch.on('stateChange',function(newState){for(var key in newState){state[key]=newState[key];}
dispatch.stateChange(state);chart.update();});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
chart.update();});});renderWatch.renderEnd('pieChart immediate');return chart;}
pie.dispatch.on('elementMouseover.tooltip',function(evt){evt['series']={key:chart.x()(evt.data),value:chart.y()(evt.data),color:evt.color};tooltip.data(evt).hidden(false);});pie.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true);});pie.dispatch.on('elementMousemove.tooltip',function(evt){tooltip();});chart.legend=legend;chart.dispatch=dispatch;chart.pie=pie;chart.tooltip=tooltip;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},noData:{get:function(){return noData;},set:function(_){noData=_;}},showLegend:{get:function(){return showLegend;},set:function(_){showLegend=_;}},legendPosition:{get:function(){return legendPosition;},set:function(_){legendPosition=_;}},defaultState:{get:function(){return defaultState;},set:function(_){defaultState=_;}},color:{get:function(){return color;},set:function(_){color=_;legend.color(color);pie.color(color);}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}}});nv.utils.inheritOptions(chart,pie);nv.utils.initOptions(chart);return chart;};nv.models.discreteBar=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=960,height=500,id=Math.floor(Math.random()*10000),container,x=d3.scale.ordinal(),y=d3.scale.linear(),getX=function(d){return d.x},getY=function(d){return d.y},forceY=[0],color=nv.utils.defaultColor(),showValues=false,valueFormat=d3.format(',.2f'),xDomain,yDomain,xRange,yRange,dispatch=d3.dispatch('chartClick','elementClick','elementDblClick','elementMouseover','elementMouseout','elementMousemove','renderEnd'),rectClass='discreteBar',duration=250;var x0,y0;var renderWatch=nv.utils.renderWatch(dispatch,duration);function chart(selection){renderWatch.reset();selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom;container=d3.select(this);nv.utils.initSVG(container);data.forEach(function(series,i){series.values.forEach(function(point){point.series=i;});});var seriesData=(xDomain&&yDomain)?[]:data.map(function(d){return d.values.map(function(d,i){return{x:getX(d,i),y:getY(d,i),y0:d.y0}})});x.domain(xDomain||d3.merge(seriesData).map(function(d){return d.x})).rangeBands(xRange||[0,availableWidth],.1);y.domain(yDomain||d3.extent(d3.merge(seriesData).map(function(d){return d.y}).concat(forceY)));if(showValues)y.range(yRange||[availableHeight-(y.domain()[0]<0?12:0),y.domain()[1]>0?12:0]);else y.range(yRange||[availableHeight,0]);x0=x0||x;y0=y0||y.copy().range([y(0),y(0)]);var wrap=container.selectAll('g.nv-wrap.nv-discretebar').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-discretebar');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-groups');wrap.attr('transform','translate('+margin.left+','+margin.top+')');var groups=wrap.select('.nv-groups').selectAll('.nv-group').data(function(d){return d},function(d){return d.key});groups.enter().append('g').style('stroke-opacity',1e-6).style('fill-opacity',1e-6);groups.exit().watchTransition(renderWatch,'discreteBar: exit groups').style('stroke-opacity',1e-6).style('fill-opacity',1e-6).remove();groups.attr('class',function(d,i){return'nv-group nv-series-'+i}).classed('hover',function(d){return d.hover});groups.watchTransition(renderWatch,'discreteBar: groups').style('stroke-opacity',1).style('fill-opacity',.75);var bars=groups.selectAll('g.nv-bar').data(function(d){return d.values});bars.exit().remove();var barsEnter=bars.enter().append('g').attr('transform',function(d,i,j){return'translate('+(x(getX(d,i))+x.rangeBand()*.05)+', '+y(0)+')'}).on('mouseover',function(d,i){d3.select(this).classed('hover',true);dispatch.elementMouseover({data:d,index:i,color:d3.select(this).style("fill")});}).on('mouseout',function(d,i){d3.select(this).classed('hover',false);dispatch.elementMouseout({data:d,index:i,color:d3.select(this).style("fill")});}).on('mousemove',function(d,i){dispatch.elementMousemove({data:d,index:i,color:d3.select(this).style("fill")});}).on('click',function(d,i){var element=this;dispatch.elementClick({data:d,index:i,color:d3.select(this).style("fill"),event:d3.event,element:element});d3.event.stopPropagation();}).on('dblclick',function(d,i){dispatch.elementDblClick({data:d,index:i,color:d3.select(this).style("fill")});d3.event.stopPropagation();});barsEnter.append('rect').attr('height',0).attr('width',x.rangeBand()*.9/data.length)
if(showValues){barsEnter.append('text').attr('text-anchor','middle');bars.select('text').text(function(d,i){return valueFormat(getY(d,i))}).watchTransition(renderWatch,'discreteBar: bars text').attr('x',x.rangeBand()*.9/2).attr('y',function(d,i){return getY(d,i)<0?y(getY(d,i))-y(0)+12:-4});}else{bars.selectAll('text').remove();}
bars.attr('class',function(d,i){return getY(d,i)<0?'nv-bar negative':'nv-bar positive'}).style('fill',function(d,i){return d.color||color(d,i)}).style('stroke',function(d,i){return d.color||color(d,i)}).select('rect').attr('class',rectClass).watchTransition(renderWatch,'discreteBar: bars rect').attr('width',x.rangeBand()*.9/data.length);bars.watchTransition(renderWatch,'discreteBar: bars').attr('transform',function(d,i){var left=x(getX(d,i))+x.rangeBand()*.05,top=getY(d,i)<0?y(0):y(0)-y(getY(d,i))<1?y(0)-1:y(getY(d,i));return'translate('+left+', '+top+')'}).select('rect').attr('height',function(d,i){return Math.max(Math.abs(y(getY(d,i))-y(0)),1)});x0=x.copy();y0=y.copy();});renderWatch.renderEnd('discreteBar immediate');return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},forceY:{get:function(){return forceY;},set:function(_){forceY=_;}},showValues:{get:function(){return showValues;},set:function(_){showValues=_;}},x:{get:function(){return getX;},set:function(_){getX=_;}},y:{get:function(){return getY;},set:function(_){getY=_;}},xScale:{get:function(){return x;},set:function(_){x=_;}},yScale:{get:function(){return y;},set:function(_){y=_;}},xDomain:{get:function(){return xDomain;},set:function(_){xDomain=_;}},yDomain:{get:function(){return yDomain;},set:function(_){yDomain=_;}},xRange:{get:function(){return xRange;},set:function(_){xRange=_;}},yRange:{get:function(){return yRange;},set:function(_){yRange=_;}},valueFormat:{get:function(){return valueFormat;},set:function(_){valueFormat=_;}},id:{get:function(){return id;},set:function(_){id=_;}},rectClass:{get:function(){return rectClass;},set:function(_){rectClass=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);}}});nv.utils.initOptions(chart);return chart;};nv.models.multiBarChart=function(){"use strict";var multibar=nv.models.multiBar(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),interactiveLayer=nv.interactiveGuideline(),legend=nv.models.legend(),controls=nv.models.legend(),tooltip=nv.models.tooltip();var margin={top:30,right:20,bottom:50,left:60},width=null,height=null,color=nv.utils.defaultColor(),showControls=true,controlLabels={},showLegend=true,showXAxis=true,showYAxis=true,rightAlignYAxis=false,reduceXTicks=true,staggerLabels=false,wrapLabels=false,rotateLabels=0,x,y,state=nv.utils.state(),defaultState=null,noData=null,dispatch=d3.dispatch('stateChange','changeState','renderEnd'),controlWidth=function(){return showControls?180:0},duration=250,useInteractiveGuideline=false;state.stacked=false
multibar.stacked(false);xAxis.orient('bottom').tickPadding(7).showMaxMin(false).tickFormat(function(d){return d});yAxis.orient((rightAlignYAxis)?'right':'left').tickFormat(d3.format(',.1f'));tooltip.duration(0).valueFormatter(function(d,i){return yAxis.tickFormat()(d,i);}).headerFormatter(function(d,i){return xAxis.tickFormat()(d,i);});controls.updateState(false);var renderWatch=nv.utils.renderWatch(dispatch);var stacked=false;var stateGetter=function(data){return function(){return{active:data.map(function(d){return!d.disabled}),stacked:stacked};}};var stateSetter=function(data){return function(state){if(state.stacked!==undefined)
stacked=state.stacked;if(state.active!==undefined)
data.forEach(function(series,i){series.disabled=!state.active[i];});}};function chart(selection){renderWatch.reset();renderWatch.models(multibar);if(showXAxis)renderWatch.models(xAxis);if(showYAxis)renderWatch.models(yAxis);selection.each(function(data){var container=d3.select(this),that=this;nv.utils.initSVG(container);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);chart.update=function(){if(duration===0)
container.call(chart);else
container.transition().duration(duration).call(chart);};chart.container=this;state.setter(stateSetter(data),chart.update).getter(stateGetter(data)).update();state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){nv.utils.noData(chart,container)
return chart;}else{container.selectAll('.nv-noData').remove();}
x=multibar.xScale();y=multibar.yScale();var wrap=container.selectAll('g.nv-wrap.nv-multiBarWithLegend').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-multiBarWithLegend').append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-x nv-axis');gEnter.append('g').attr('class','nv-y nv-axis');gEnter.append('g').attr('class','nv-barsWrap');gEnter.append('g').attr('class','nv-legendWrap');gEnter.append('g').attr('class','nv-controlsWrap');gEnter.append('g').attr('class','nv-interactive');if(!showLegend){g.select('.nv-legendWrap').selectAll('*').remove();}else{legend.width(availableWidth-controlWidth());g.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=nv.utils.availableHeight(height,container,margin);}
g.select('.nv-legendWrap').attr('transform','translate('+controlWidth()+','+(-margin.top)+')');}
if(!showControls){g.select('.nv-controlsWrap').selectAll('*').remove();}else{var controlsData=[{key:controlLabels.grouped||'Grouped',disabled:multibar.stacked()},{key:controlLabels.stacked||'Stacked',disabled:!multibar.stacked()}];controls.width(controlWidth()).color(['#444','#444','#444']);g.select('.nv-controlsWrap').datum(controlsData).attr('transform','translate(0,'+(-margin.top)+')').call(controls);}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');if(rightAlignYAxis){g.select(".nv-y.nv-axis").attr("transform","translate("+availableWidth+",0)");}
multibar.disabled(data.map(function(series){return series.disabled})).width(availableWidth).height(availableHeight).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled}));var barsWrap=g.select('.nv-barsWrap').datum(data.filter(function(d){return!d.disabled}));barsWrap.call(multibar);if(showXAxis){xAxis.scale(x)._ticks(nv.utils.calcTicksX(availableWidth/100,data)).tickSize(-availableHeight,0);g.select('.nv-x.nv-axis').attr('transform','translate(0,'+y.range()[0]+')');g.select('.nv-x.nv-axis').call(xAxis);var xTicks=g.select('.nv-x.nv-axis > g').selectAll('g');xTicks.selectAll('line, text').style('opacity',1)
if(staggerLabels){var getTranslate=function(x,y){return"translate("+x+","+y+")";};var staggerUp=5,staggerDown=17;xTicks.selectAll("text").attr('transform',function(d,i,j){return getTranslate(0,(j%2==0?staggerUp:staggerDown));});var totalInBetweenTicks=d3.selectAll(".nv-x.nv-axis .nv-wrap g g text")[0].length;g.selectAll(".nv-x.nv-axis .nv-axisMaxMin text").attr("transform",function(d,i){return getTranslate(0,(i===0||totalInBetweenTicks%2!==0)?staggerDown:staggerUp);});}
if(wrapLabels){g.selectAll('.tick text').call(nv.utils.wrapTicks,chart.xAxis.rangeBand())}
if(reduceXTicks)
xTicks.filter(function(d,i){return i%Math.ceil(data[0].values.length/(availableWidth/100))!==0;}).selectAll('text, line').style('opacity',0);if(rotateLabels)
xTicks.selectAll('.tick text').attr('transform','rotate('+rotateLabels+' 0,0)').style('text-anchor',rotateLabels>0?'start':'end');g.select('.nv-x.nv-axis').selectAll('g.nv-axisMaxMin text').style('opacity',1);}
if(showYAxis){yAxis.scale(y)._ticks(nv.utils.calcTicksY(availableHeight/36,data)).tickSize(-availableWidth,0);g.select('.nv-y.nv-axis').call(yAxis);}
if(useInteractiveGuideline){interactiveLayer.width(availableWidth).height(availableHeight).margin({left:margin.left,top:margin.top}).svgContainer(container).xScale(x);wrap.select(".nv-interactive").call(interactiveLayer);}
legend.dispatch.on('stateChange',function(newState){for(var key in newState)
state[key]=newState[key];dispatch.stateChange(state);chart.update();});controls.dispatch.on('legendClick',function(d,i){if(!d.disabled)return;controlsData=controlsData.map(function(s){s.disabled=true;return s;});d.disabled=false;switch(d.key){case'Grouped':case controlLabels.grouped:multibar.stacked(false);break;case'Stacked':case controlLabels.stacked:multibar.stacked(true);break;}
state.stacked=multibar.stacked();dispatch.stateChange(state);chart.update();});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
if(typeof e.stacked!=='undefined'){multibar.stacked(e.stacked);state.stacked=e.stacked;stacked=e.stacked;}
chart.update();});if(useInteractiveGuideline){interactiveLayer.dispatch.on('elementMousemove',function(e){if(e.pointXValue==undefined)return;var singlePoint,pointIndex,pointXLocation,xValue,allData=[];data.filter(function(series,i){series.seriesIndex=i;return!series.disabled;}).forEach(function(series,i){pointIndex=x.domain().indexOf(e.pointXValue)
var point=series.values[pointIndex];if(point===undefined)return;xValue=point.x;if(singlePoint===undefined)singlePoint=point;if(pointXLocation===undefined)pointXLocation=e.mouseX
allData.push({key:series.key,value:chart.y()(point,pointIndex),color:color(series,series.seriesIndex),data:series.values[pointIndex]});});interactiveLayer.tooltip.chartContainer(that.parentNode).data({value:xValue,index:pointIndex,series:allData})();interactiveLayer.renderGuideLine(pointXLocation);});interactiveLayer.dispatch.on("elementMouseout",function(e){interactiveLayer.tooltip.hidden(true);});}
else{multibar.dispatch.on('elementMouseover.tooltip',function(evt){evt.value=chart.x()(evt.data);evt['series']={key:evt.data.key,value:chart.y()(evt.data),color:evt.color};tooltip.data(evt).hidden(false);});multibar.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true);});multibar.dispatch.on('elementMousemove.tooltip',function(evt){tooltip();});}});renderWatch.renderEnd('multibarchart immediate');return chart;}
chart.dispatch=dispatch;chart.multibar=multibar;chart.legend=legend;chart.controls=controls;chart.xAxis=xAxis;chart.yAxis=yAxis;chart.state=state;chart.tooltip=tooltip;chart.interactiveLayer=interactiveLayer;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},showLegend:{get:function(){return showLegend;},set:function(_){showLegend=_;}},showControls:{get:function(){return showControls;},set:function(_){showControls=_;}},controlLabels:{get:function(){return controlLabels;},set:function(_){controlLabels=_;}},showXAxis:{get:function(){return showXAxis;},set:function(_){showXAxis=_;}},showYAxis:{get:function(){return showYAxis;},set:function(_){showYAxis=_;}},defaultState:{get:function(){return defaultState;},set:function(_){defaultState=_;}},noData:{get:function(){return noData;},set:function(_){noData=_;}},reduceXTicks:{get:function(){return reduceXTicks;},set:function(_){reduceXTicks=_;}},rotateLabels:{get:function(){return rotateLabels;},set:function(_){rotateLabels=_;}},staggerLabels:{get:function(){return staggerLabels;},set:function(_){staggerLabels=_;}},wrapLabels:{get:function(){return wrapLabels;},set:function(_){wrapLabels=!!_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;multibar.duration(duration);xAxis.duration(duration);yAxis.duration(duration);renderWatch.reset(duration);}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);legend.color(color);}},rightAlignYAxis:{get:function(){return rightAlignYAxis;},set:function(_){rightAlignYAxis=_;yAxis.orient(rightAlignYAxis?'right':'left');}},useInteractiveGuideline:{get:function(){return useInteractiveGuideline;},set:function(_){useInteractiveGuideline=_;}},barColor:{get:function(){return multibar.barColor;},set:function(_){multibar.barColor(_);legend.color(function(d,i){return d3.rgb('#ccc').darker(i*1.5).toString();})}}});nv.utils.inheritOptions(chart,multibar);nv.utils.initOptions(chart);return chart;};nv.models.pie=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=500,height=500,getX=function(d){return d.x},getY=function(d){return d.y},id=Math.floor(Math.random()*10000),container=null,color=nv.utils.defaultColor(),valueFormat=d3.format(',.2f'),showLabels=true,labelsOutside=false,labelType="key",labelThreshold=.02,donut=false,title=false,growOnHover=true,titleOffset=0,labelSunbeamLayout=false,startAngle=false,padAngle=false,endAngle=false,cornerRadius=0,donutRatio=0.5,arcsRadius=[],dispatch=d3.dispatch('chartClick','elementClick','elementDblClick','elementMouseover','elementMouseout','elementMousemove','renderEnd');var arcs=[];var arcsOver=[];var renderWatch=nv.utils.renderWatch(dispatch);function chart(selection){renderWatch.reset();selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom,radius=Math.min(availableWidth,availableHeight)/2,arcsRadiusOuter=[],arcsRadiusInner=[];container=d3.select(this)
if(arcsRadius.length===0){var outer=radius-radius/5;var inner=donutRatio*radius;for(var i=0;i<data[0].length;i++){arcsRadiusOuter.push(outer);arcsRadiusInner.push(inner);}}else{if(growOnHover){arcsRadiusOuter=arcsRadius.map(function(d){return(d.outer-d.outer/5)*radius;});arcsRadiusInner=arcsRadius.map(function(d){return(d.inner-d.inner/5)*radius;});donutRatio=d3.min(arcsRadius.map(function(d){return(d.inner-d.inner/5);}));}else{arcsRadiusOuter=arcsRadius.map(function(d){return d.outer*radius;});arcsRadiusInner=arcsRadius.map(function(d){return d.inner*radius;});donutRatio=d3.min(arcsRadius.map(function(d){return d.inner;}));}}
nv.utils.initSVG(container);var wrap=container.selectAll('.nv-wrap.nv-pie').data(data);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-pie nv-chart-'+id);var gEnter=wrapEnter.append('g');var g=wrap.select('g');var g_pie=gEnter.append('g').attr('class','nv-pie');gEnter.append('g').attr('class','nv-pieLabels');wrap.attr('transform','translate('+margin.left+','+margin.top+')');g.select('.nv-pie').attr('transform','translate('+availableWidth/2+','+availableHeight/2+')');g.select('.nv-pieLabels').attr('transform','translate('+availableWidth/2+','+availableHeight/2+')');container.on('click',function(d,i){dispatch.chartClick({data:d,index:i,pos:d3.event,id:id});});arcs=[];arcsOver=[];for(var i=0;i<data[0].length;i++){var arc=d3.svg.arc().outerRadius(arcsRadiusOuter[i]);var arcOver=d3.svg.arc().outerRadius(arcsRadiusOuter[i]+5);if(startAngle!==false){arc.startAngle(startAngle);arcOver.startAngle(startAngle);}
if(endAngle!==false){arc.endAngle(endAngle);arcOver.endAngle(endAngle);}
if(donut){arc.innerRadius(arcsRadiusInner[i]);arcOver.innerRadius(arcsRadiusInner[i]);}
if(arc.cornerRadius&&cornerRadius){arc.cornerRadius(cornerRadius);arcOver.cornerRadius(cornerRadius);}
arcs.push(arc);arcsOver.push(arcOver);}
var pie=d3.layout.pie().sort(null).value(function(d){return d.disabled?0:getY(d)});if(pie.padAngle&&padAngle){pie.padAngle(padAngle);}
if(donut&&title){g_pie.append("text").attr('class','nv-pie-title');wrap.select('.nv-pie-title').style("text-anchor","middle").text(function(d){return title;}).style("font-size",(Math.min(availableWidth,availableHeight))*donutRatio*2/(title.length+2)+"px").attr("dy","0.35em").attr('transform',function(d,i){return'translate(0, '+titleOffset+')';});}
var slices=wrap.select('.nv-pie').selectAll('.nv-slice').data(pie);var pieLabels=wrap.select('.nv-pieLabels').selectAll('.nv-label').data(pie);slices.exit().remove();pieLabels.exit().remove();var ae=slices.enter().append('g');ae.attr('class','nv-slice');ae.on('mouseover',function(d,i){d3.select(this).classed('hover',true);if(growOnHover){d3.select(this).select("path").transition().duration(70).attr("d",arcsOver[i]);}
dispatch.elementMouseover({data:d.data,index:i,color:d3.select(this).style("fill")});});ae.on('mouseout',function(d,i){d3.select(this).classed('hover',false);if(growOnHover){d3.select(this).select("path").transition().duration(50).attr("d",arcs[i]);}
dispatch.elementMouseout({data:d.data,index:i});});ae.on('mousemove',function(d,i){dispatch.elementMousemove({data:d.data,index:i});});ae.on('click',function(d,i){var element=this;dispatch.elementClick({data:d.data,index:i,color:d3.select(this).style("fill"),event:d3.event,element:element});});ae.on('dblclick',function(d,i){dispatch.elementDblClick({data:d.data,index:i,color:d3.select(this).style("fill")});});slices.attr('fill',function(d,i){return color(d.data,i);});slices.attr('stroke',function(d,i){return color(d.data,i);});var paths=ae.append('path').each(function(d){this._current=d;});slices.select('path').transition().attr('d',function(d,i){return arcs[i](d);}).attrTween('d',arcTween);if(showLabels){var labelsArc=[];for(var i=0;i<data[0].length;i++){labelsArc.push(arcs[i]);if(labelsOutside){if(donut){labelsArc[i]=d3.svg.arc().outerRadius(arcs[i].outerRadius());if(startAngle!==false)labelsArc[i].startAngle(startAngle);if(endAngle!==false)labelsArc[i].endAngle(endAngle);}}else if(!donut){labelsArc[i].innerRadius(0);}}
pieLabels.enter().append("g").classed("nv-label",true).each(function(d,i){var group=d3.select(this);group.attr('transform',function(d,i){if(labelSunbeamLayout){d.outerRadius=arcsRadiusOuter[i]+10;d.innerRadius=arcsRadiusOuter[i]+15;var rotateAngle=(d.startAngle+d.endAngle)/2*(180/Math.PI);if((d.startAngle+d.endAngle)/2<Math.PI){rotateAngle-=90;}else{rotateAngle+=90;}
return'translate('+labelsArc[i].centroid(d)+') rotate('+rotateAngle+')';}else{d.outerRadius=radius+10;d.innerRadius=radius+15;return'translate('+labelsArc[i].centroid(d)+')'}});group.append('rect').style('stroke','#fff').style('fill','#fff').attr("rx",3).attr("ry",3);group.append('text').style('text-anchor',labelSunbeamLayout?((d.startAngle+d.endAngle)/2<Math.PI?'start':'end'):'middle').style('fill','#000')});var labelLocationHash={};var avgHeight=14;var avgWidth=140;var createHashKey=function(coordinates){return Math.floor(coordinates[0]/avgWidth)*avgWidth+','+Math.floor(coordinates[1]/avgHeight)*avgHeight;};var getSlicePercentage=function(d){return(d.endAngle-d.startAngle)/(2*Math.PI);};pieLabels.watchTransition(renderWatch,'pie labels').attr('transform',function(d,i){if(labelSunbeamLayout){d.outerRadius=arcsRadiusOuter[i]+10;d.innerRadius=arcsRadiusOuter[i]+15;var rotateAngle=(d.startAngle+d.endAngle)/2*(180/Math.PI);if((d.startAngle+d.endAngle)/2<Math.PI){rotateAngle-=90;}else{rotateAngle+=90;}
return'translate('+labelsArc[i].centroid(d)+') rotate('+rotateAngle+')';}else{d.outerRadius=radius+10;d.innerRadius=radius+15;var center=labelsArc[i].centroid(d);var percent=getSlicePercentage(d);if(d.value&&percent>=labelThreshold){var hashKey=createHashKey(center);if(labelLocationHash[hashKey]){center[1]-=avgHeight;}
labelLocationHash[createHashKey(center)]=true;}
return'translate('+center+')'}});pieLabels.select(".nv-label text").style('text-anchor',function(d,i){return labelSunbeamLayout?((d.startAngle+d.endAngle)/2<Math.PI?'start':'end'):'middle';}).text(function(d,i){var percent=getSlicePercentage(d);var label='';if(!d.value||percent<labelThreshold)return'';if(typeof labelType==='function'){label=labelType(d,i,{'key':getX(d.data),'value':getY(d.data),'percent':valueFormat(percent)});}else{switch(labelType){case'key':label=getX(d.data);break;case'value':label=valueFormat(getY(d.data));break;case'percent':label=d3.format('%')(percent);break;}}
return label;});}
function angle(d){var a=(d.startAngle+d.endAngle)*90/Math.PI-90;return a>90?a-180:a;}
function arcTween(a,idx){a.endAngle=isNaN(a.endAngle)?0:a.endAngle;a.startAngle=isNaN(a.startAngle)?0:a.startAngle;if(!donut)a.innerRadius=0;var i=d3.interpolate(this._current,a);this._current=i(0);return function(t){return arcs[idx](i(t));};}});renderWatch.renderEnd('pie immediate');return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{arcsRadius:{get:function(){return arcsRadius;},set:function(_){arcsRadius=_;}},width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},showLabels:{get:function(){return showLabels;},set:function(_){showLabels=_;}},title:{get:function(){return title;},set:function(_){title=_;}},titleOffset:{get:function(){return titleOffset;},set:function(_){titleOffset=_;}},labelThreshold:{get:function(){return labelThreshold;},set:function(_){labelThreshold=_;}},valueFormat:{get:function(){return valueFormat;},set:function(_){valueFormat=_;}},x:{get:function(){return getX;},set:function(_){getX=_;}},id:{get:function(){return id;},set:function(_){id=_;}},endAngle:{get:function(){return endAngle;},set:function(_){endAngle=_;}},startAngle:{get:function(){return startAngle;},set:function(_){startAngle=_;}},padAngle:{get:function(){return padAngle;},set:function(_){padAngle=_;}},cornerRadius:{get:function(){return cornerRadius;},set:function(_){cornerRadius=_;}},donutRatio:{get:function(){return donutRatio;},set:function(_){donutRatio=_;}},labelsOutside:{get:function(){return labelsOutside;},set:function(_){labelsOutside=_;}},labelSunbeamLayout:{get:function(){return labelSunbeamLayout;},set:function(_){labelSunbeamLayout=_;}},donut:{get:function(){return donut;},set:function(_){donut=_;}},growOnHover:{get:function(){return growOnHover;},set:function(_){growOnHover=_;}},pieLabelsOutside:{get:function(){return labelsOutside;},set:function(_){labelsOutside=_;nv.deprecated('pieLabelsOutside','use labelsOutside instead');}},donutLabelsOutside:{get:function(){return labelsOutside;},set:function(_){labelsOutside=_;nv.deprecated('donutLabelsOutside','use labelsOutside instead');}},labelFormat:{get:function(){return valueFormat;},set:function(_){valueFormat=_;nv.deprecated('labelFormat','use valueFormat instead');}},margin:{get:function(){return margin;},set:function(_){margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;}},y:{get:function(){return getY;},set:function(_){getY=d3.functor(_);}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}},labelType:{get:function(){return labelType;},set:function(_){labelType=_||'key';}}});nv.utils.initOptions(chart);return chart;};nv.version="1.8.2-dev";})();;

/* /web/static/lib/backbone/backbone.js defined in bundle 'web.assets_backend' */
(function(){var root=this;var previousBackbone=root.Backbone;var array=[];var push=array.push;var slice=array.slice;var splice=array.splice;var Backbone;if(typeof exports!=='undefined'){Backbone=exports;}else{Backbone=root.Backbone={};}
Backbone.VERSION='1.1.0';var _=root._;if(!_&&(typeof require!=='undefined'))_=require('underscore');Backbone.$=root.jQuery||root.Zepto||root.ender||root.$;Backbone.noConflict=function(){root.Backbone=previousBackbone;return this;};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var Events=Backbone.Events={on:function(name,callback,context){if(!eventsApi(this,'on',name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);events.push({callback:callback,context:context,ctx:context||this});return this;},once:function(name,callback,context){if(!eventsApi(this,'once',name,[callback,context])||!callback)return this;var self=this;var once=_.once(function(){self.off(name,once);callback.apply(this,arguments);});once._callback=callback;return this.on(name,once,context);},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,'off',name,[callback,context]))return this;if(!name&&!callback&&!context){this._events={};return this;}
names=name?[name]:_.keys(this._events);for(i=0,l=names.length;i<l;i++){name=names[i];if(events=this._events[name]){this._events[name]=retain=[];if(callback||context){for(j=0,k=events.length;j<k;j++){ev=events[j];if((callback&&callback!==ev.callback&&callback!==ev.callback._callback)||(context&&context!==ev.context)){retain.push(ev);}}}
if(!retain.length)delete this._events[name];}}
return this;},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,'trigger',name,args))return this;var events=this._events[name];var allEvents=this._events.all;if(events)triggerEvents(events,args);if(allEvents)triggerEvents(allEvents,arguments);return this;},stopListening:function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var remove=!name&&!callback;if(!callback&&typeof name==='object')callback=this;if(obj)(listeningTo={})[obj._listenId]=obj;for(var id in listeningTo){obj=listeningTo[id];obj.off(name,callback,this);if(remove||_.isEmpty(obj._events))delete this._listeningTo[id];}
return this;}};var eventSplitter=/\s+/;var eventsApi=function(obj,action,name,rest){if(!name)return true;if(typeof name==='object'){for(var key in name){obj[action].apply(obj,[key,name[key]].concat(rest));}
return false;}
if(eventSplitter.test(name)){var names=name.split(eventSplitter);for(var i=0,l=names.length;i<l;i++){obj[action].apply(obj,[names[i]].concat(rest));}
return false;}
return true;};var triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:while(++i<l)(ev=events[i]).callback.call(ev.ctx);return;case 1:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:while(++i<l)(ev=events[i]).callback.apply(ev.ctx,args);}};var listenMethods={listenTo:'on',listenToOnce:'once'};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeningTo=this._listeningTo||(this._listeningTo={});var id=obj._listenId||(obj._listenId=_.uniqueId('l'));listeningTo[id]=obj;if(!callback&&typeof name==='object')callback=this;obj[implementation](name,callback,this);return this;};});Events.bind=Events.on;Events.unbind=Events.off;_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options||(options={});this.cid=_.uniqueId('c');this.attributes={};if(options.collection)this.collection=options.collection;if(options.parse)attrs=this.parse(attrs,options)||{};attrs=_.defaults({},attrs,_.result(this,'defaults'));this.set(attrs,options);this.changed={};this.initialize.apply(this,arguments);};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:'id',initialize:function(){},toJSON:function(options){return _.clone(this.attributes);},sync:function(){return Backbone.sync.apply(this,arguments);},get:function(attr){return this.attributes[attr];},escape:function(attr){return _.escape(this.get(attr));},has:function(attr){return this.get(attr)!=null;},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(key==null)return this;if(typeof key==='object'){attrs=key;options=val;}else{(attrs={})[key]=val;}
options||(options={});if(!this._validate(attrs,options))return false;unset=options.unset;silent=options.silent;changes=[];changing=this._changing;this._changing=true;if(!changing){this._previousAttributes=_.clone(this.attributes);this.changed={};}
current=this.attributes,prev=this._previousAttributes;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];for(attr in attrs){val=attrs[attr];if(!_.isEqual(current[attr],val))changes.push(attr);if(!_.isEqual(prev[attr],val)){this.changed[attr]=val;}else{delete this.changed[attr];}
unset?delete current[attr]:current[attr]=val;}
if(!silent){if(changes.length)this._pending=true;for(var i=0,l=changes.length;i<l;i++){this.trigger('change:'+changes[i],this,current[changes[i]],options);}}
if(changing)return this;if(!silent){while(this._pending){this._pending=false;this.trigger('change',this,options);}}
this._pending=false;this._changing=false;return this;},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:true}));},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:true}));},hasChanged:function(attr){if(attr==null)return!_.isEmpty(this.changed);return _.has(this.changed,attr);},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false;var old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff){if(_.isEqual(old[attr],(val=diff[attr])))continue;(changed||(changed={}))[attr]=val;}
return changed;},previous:function(attr){if(attr==null||!this._previousAttributes)return null;return this._previousAttributes[attr];},previousAttributes:function(){return _.clone(this._previousAttributes);},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){if(!model.set(model.parse(resp,options),options))return false;if(success)success(model,resp,options);model.trigger('sync',model,resp,options);};wrapError(this,options);return this.sync('read',this,options);},save:function(key,val,options){var attrs,method,xhr,attributes=this.attributes;if(key==null||typeof key==='object'){attrs=key;options=val;}else{(attrs={})[key]=val;}
options=_.extend({validate:true},options);if(attrs&&!options.wait){if(!this.set(attrs,options))return false;}else{if(!this._validate(attrs,options))return false;}
if(attrs&&options.wait){this.attributes=_.extend({},attributes,attrs);}
if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){model.attributes=attributes;var serverAttrs=model.parse(resp,options);if(options.wait)serverAttrs=_.extend(attrs||{},serverAttrs);if(_.isObject(serverAttrs)&&!model.set(serverAttrs,options)){return false;}
if(success)success(model,resp,options);model.trigger('sync',model,resp,options);};wrapError(this,options);method=this.isNew()?'create':(options.patch?'patch':'update');if(method==='patch')options.attrs=attrs;xhr=this.sync(method,this,options);if(attrs&&options.wait)this.attributes=attributes;return xhr;},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var destroy=function(){model.trigger('destroy',model,model.collection,options);};options.success=function(resp){if(options.wait||model.isNew())destroy();if(success)success(model,resp,options);if(!model.isNew())model.trigger('sync',model,resp,options);};if(this.isNew()){options.success();return false;}
wrapError(this,options);var xhr=this.sync('delete',this,options);if(!options.wait)destroy();return xhr;},url:function(){var base=_.result(this,'urlRoot')||_.result(this.collection,'url')||urlError();if(this.isNew())return base;return base+(base.charAt(base.length-1)==='/'?'':'/')+encodeURIComponent(this.id);},parse:function(resp,options){return resp;},clone:function(){return new this.constructor(this.attributes);},isNew:function(){return this.id==null;},isValid:function(options){return this._validate({},_.extend(options||{},{validate:true}));},_validate:function(attrs,options){if(!options.validate||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;if(!error)return true;this.trigger('invalid',this,error,_.extend(options,{validationError:error}));return false;}});var modelMethods=['keys','values','pairs','invert','pick','omit'];_.each(modelMethods,function(method){Model.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.attributes);return _[method].apply(_,args);};});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.model)this.model=options.model;if(options.comparator!==void 0)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,_.extend({silent:true},options));};var setOptions={add:true,remove:true,merge:true};var addOptions={add:true,remove:false};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options);});},sync:function(){return Backbone.sync.apply(this,arguments);},add:function(models,options){return this.set(models,_.extend({merge:false},options,addOptions));},remove:function(models,options){var singular=!_.isArray(models);models=singular?[models]:_.clone(models);options||(options={});var i,l,index,model;for(i=0,l=models.length;i<l;i++){model=models[i]=this.get(models[i]);if(!model)continue;delete this._byId[model.id];delete this._byId[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger('remove',model,this,options);}
this._removeReference(model);}
return singular?models[0]:models;},set:function(models,options){options=_.defaults({},options,setOptions);if(options.parse)models=this.parse(models,options);var singular=!_.isArray(models);models=singular?(models?[models]:[]):_.clone(models);var i,l,id,model,attrs,existing,sort;var at=options.at;var targetModel=this.model;var sortable=this.comparator&&(at==null)&&options.sort!==false;var sortAttr=_.isString(this.comparator)?this.comparator:null;var toAdd=[],toRemove=[],modelMap={};var add=options.add,merge=options.merge,remove=options.remove;var order=!sortable&&add&&remove?[]:false;for(i=0,l=models.length;i<l;i++){attrs=models[i];if(attrs instanceof Model){id=model=attrs;}else{id=attrs[targetModel.prototype.idAttribute];}
if(existing=this.get(id)){if(remove)modelMap[existing.cid]=true;if(merge){attrs=attrs===model?model.attributes:attrs;if(options.parse)attrs=existing.parse(attrs,options);existing.set(attrs,options);if(sortable&&!sort&&existing.hasChanged(sortAttr))sort=true;}
models[i]=existing;}else if(add){model=models[i]=this._prepareModel(attrs,options);if(!model)continue;toAdd.push(model);model.on('all',this._onModelEvent,this);this._byId[model.cid]=model;if(model.id!=null)this._byId[model.id]=model;}
if(order)order.push(existing||model);}
if(remove){for(i=0,l=this.length;i<l;++i){if(!modelMap[(model=this.models[i]).cid])toRemove.push(model);}
if(toRemove.length)this.remove(toRemove,options);}
if(toAdd.length||(order&&order.length)){if(sortable)sort=true;this.length+=toAdd.length;if(at!=null){for(i=0,l=toAdd.length;i<l;i++){this.models.splice(at+i,0,toAdd[i]);}}else{if(order)this.models.length=0;var orderedModels=order||toAdd;for(i=0,l=orderedModels.length;i<l;i++){this.models.push(orderedModels[i]);}}}
if(sort)this.sort({silent:true});if(!options.silent){for(i=0,l=toAdd.length;i<l;i++){(model=toAdd[i]).trigger('add',model,this,options);}
if(sort||(order&&order.length))this.trigger('sort',this,options);}
return singular?models[0]:models;},reset:function(models,options){options||(options={});for(var i=0,l=this.models.length;i<l;i++){this._removeReference(this.models[i]);}
options.previousModels=this.models;this._reset();models=this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger('reset',this,options);return models;},push:function(model,options){return this.add(model,_.extend({at:this.length},options));},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model;},unshift:function(model,options){return this.add(model,_.extend({at:0},options));},shift:function(options){var model=this.at(0);this.remove(model,options);return model;},slice:function(){return slice.apply(this.models,arguments);},get:function(obj){if(obj==null)return void 0;return this._byId[obj.id]||this._byId[obj.cid]||this._byId[obj];},at:function(index){return this.models[index];},where:function(attrs,first){if(_.isEmpty(attrs))return first?void 0:[];return this[first?'find':'filter'](function(model){for(var key in attrs){if(attrs[key]!==model.get(key))return false;}
return true;});},findWhere:function(attrs){return this.where(attrs,true);},sort:function(options){if(!this.comparator)throw new Error('Cannot sort a set without a comparator');options||(options={});if(_.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this);}else{this.models.sort(_.bind(this.comparator,this));}
if(!options.silent)this.trigger('sort',this,options);return this;},pluck:function(attr){return _.invoke(this.models,'get',attr);},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var success=options.success;var collection=this;options.success=function(resp){var method=options.reset?'reset':'set';collection[method](resp,options);if(success)success(collection,resp,options);collection.trigger('sync',collection,resp,options);};wrapError(this,options);return this.sync('read',this,options);},create:function(model,options){options=options?_.clone(options):{};if(!(model=this._prepareModel(model,options)))return false;if(!options.wait)this.add(model,options);var collection=this;var success=options.success;options.success=function(model,resp,options){if(options.wait)collection.add(model,options);if(success)success(model,resp,options);};model.save(null,options);return model;},parse:function(resp,options){return resp;},clone:function(){return new this.constructor(this.models);},_reset:function(){this.length=0;this.models=[];this._byId={};},_prepareModel:function(attrs,options){if(attrs instanceof Model){if(!attrs.collection)attrs.collection=this;return attrs;}
options=options?_.clone(options):{};options.collection=this;var model=new this.model(attrs,options);if(!model.validationError)return model;this.trigger('invalid',this,model.validationError,options);return false;},_removeReference:function(model){if(this===model.collection)delete model.collection;model.off('all',this._onModelEvent,this);},_onModelEvent:function(event,model,collection,options){if((event==='add'||event==='remove')&&collection!==this)return;if(event==='destroy')this.remove(model,options);if(model&&event==='change:'+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];if(model.id!=null)this._byId[model.id]=model;}
this.trigger.apply(this,arguments);}});var methods=['forEach','each','map','collect','reduce','foldl','inject','reduceRight','foldr','find','detect','filter','select','reject','every','all','some','any','include','contains','invoke','max','min','toArray','size','first','head','take','initial','rest','tail','drop','last','without','difference','indexOf','shuffle','lastIndexOf','isEmpty','chain'];_.each(methods,function(method){Collection.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.models);return _[method].apply(_,args);};});var attributeMethods=['groupBy','countBy','sortBy'];_.each(attributeMethods,function(method){Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value);};return _[method](this.models,iterator,context);};});var View=Backbone.View=function(options){this.cid=_.uniqueId('view');options||(options={});_.extend(this,_.pick(options,viewOptions));this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents();};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=['model','collection','el','id','attributes','className','tagName','events'];_.extend(View.prototype,Events,{tagName:'div',$:function(selector){return this.$el.find(selector);},initialize:function(){},render:function(){return this;},remove:function(){this.$el.remove();this.stopListening();return this;},setElement:function(element,delegate){if(this.$el)this.undelegateEvents();this.$el=element instanceof Backbone.$?element:Backbone.$(element);this.el=this.$el[0];if(delegate!==false)this.delegateEvents();return this;},delegateEvents:function(events){if(!(events||(events=_.result(this,'events'))))return this;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)continue;var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+='.delegateEvents'+this.cid;if(selector===''){this.$el.on(eventName,method);}else{this.$el.on(eventName,selector,method);}}
return this;},undelegateEvents:function(){this.$el.off('.delegateEvents'+this.cid);return this;},_ensureElement:function(){if(!this.el){var attrs=_.extend({},_.result(this,'attributes'));if(this.id)attrs.id=_.result(this,'id');if(this.className)attrs['class']=_.result(this,'className');var $el=Backbone.$('<'+_.result(this,'tagName')+'>').attr(attrs);this.setElement($el,false);}else{this.setElement(_.result(this,'el'),false);}}});Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:'json'};if(!options.url){params.url=_.result(model,'url')||urlError();}
if(options.data==null&&model&&(method==='create'||method==='update'||method==='patch')){params.contentType='application/json';params.data=JSON.stringify(options.attrs||model.toJSON(options));}
if(options.emulateJSON){params.contentType='application/x-www-form-urlencoded';params.data=params.data?{model:params.data}:{};}
if(options.emulateHTTP&&(type==='PUT'||type==='DELETE'||type==='PATCH')){params.type='POST';if(options.emulateJSON)params.data._method=type;var beforeSend=options.beforeSend;options.beforeSend=function(xhr){xhr.setRequestHeader('X-HTTP-Method-Override',type);if(beforeSend)return beforeSend.apply(this,arguments);};}
if(params.type!=='GET'&&!options.emulateJSON){params.processData=false;}
if(params.type==='PATCH'&&noXhrPatch){params.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP");};}
var xhr=options.xhr=Backbone.ajax(_.extend(params,options));model.trigger('request',model,xhr,options);return xhr;};var noXhrPatch=typeof window!=='undefined'&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);var methodMap={'create':'POST','update':'PUT','patch':'PATCH','delete':'DELETE','read':'GET'};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments);};var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments);};var optionalParam=/\((.*?)\)/g;var namedParam=/(\(\?)?:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){if(!_.isRegExp(route))route=this._routeToRegExp(route);if(_.isFunction(name)){callback=name;name='';}
if(!callback)callback=this[name];var router=this;Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);callback&&callback.apply(router,args);router.trigger.apply(router,['route:'+name].concat(args));router.trigger('route',name,args);Backbone.history.trigger('route',router,name,args);});return this;},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);return this;},_bindRoutes:function(){if(!this.routes)return;this.routes=_.result(this,'routes');var route,routes=_.keys(this.routes);while((route=routes.pop())!=null){this.route(route,this.routes[route]);}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,'\\$&').replace(optionalParam,'(?:$1)?').replace(namedParam,function(match,optional){return optional?match:'([^\/]+)';}).replace(splatParam,'(.*?)');return new RegExp('^'+route+'$');},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param){return param?decodeURIComponent(param):null;});}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,'checkUrl');if(typeof window!=='undefined'){this.location=window.location;this.history=window.history;}};var routeStripper=/^[#\/]|\s+$/g;var rootStripper=/^\/+|\/+$/g;var isExplorer=/msie [\w.]+/;var trailingSlash=/\/$/;var pathStripper=/[?#].*$/;History.started=false;_.extend(History.prototype,Events,{interval:50,getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:'';},getFragment:function(fragment,forcePushState){if(fragment==null){if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=this.location.pathname;var root=this.root.replace(trailingSlash,'');if(!fragment.indexOf(root))fragment=fragment.slice(root.length);}else{fragment=this.getHash();}}
return fragment.replace(routeStripper,'');},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({root:'/'},this.options,options);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var fragment=this.getFragment();var docMode=document.documentMode;var oldIE=(isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7));this.root=('/'+this.root+'/').replace(rootStripper,'/');if(oldIE&&this._wantsHashChange){this.iframe=Backbone.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo('body')[0].contentWindow;this.navigate(fragment);}
if(this._hasPushState){Backbone.$(window).on('popstate',this.checkUrl);}else if(this._wantsHashChange&&('onhashchange'in window)&&!oldIE){Backbone.$(window).on('hashchange',this.checkUrl);}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval);}
this.fragment=fragment;var loc=this.location;var atRoot=loc.pathname.replace(/[^\/]$/,'$&/')===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!atRoot){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+'#'+this.fragment);return true;}else if(this._hasPushState&&atRoot&&loc.hash){this.fragment=this.getHash().replace(routeStripper,'');this.history.replaceState({},document.title,this.root+this.fragment+loc.search);}}
if(!this.options.silent)return this.loadUrl();},stop:function(){Backbone.$(window).off('popstate',this.checkUrl).off('hashchange',this.checkUrl);clearInterval(this._checkUrlInterval);History.started=false;},route:function(route,callback){this.handlers.unshift({route:route,callback:callback});},checkUrl:function(e){var current=this.getFragment();if(current===this.fragment&&this.iframe){current=this.getFragment(this.getHash(this.iframe));}
if(current===this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl();},loadUrl:function(fragment){fragment=this.fragment=this.getFragment(fragment);return _.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true;}});},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:!!options};var url=this.root+(fragment=this.getFragment(fragment||''));fragment=fragment.replace(pathStripper,'');if(this.fragment===fragment)return;this.fragment=fragment;if(fragment===''&&url!=='/')url=url.slice(0,-1);if(this._hasPushState){this.history[options.replace?'replaceState':'pushState']({},document.title,url);}else if(this._wantsHashChange){this._updateHash(this.location,fragment,options.replace);if(this.iframe&&(fragment!==this.getFragment(this.getHash(this.iframe)))){if(!options.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,fragment,options.replace);}}else{return this.location.assign(url);}
if(options.trigger)return this.loadUrl(fragment);},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,'');location.replace(href+'#'+fragment);}else{location.hash='#'+fragment;}}});Backbone.history=new History;var extend=function(protoProps,staticProps){var parent=this;var child;if(protoProps&&_.has(protoProps,'constructor')){child=protoProps.constructor;}else{child=function(){return parent.apply(this,arguments);};}
_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child;};Surrogate.prototype=parent.prototype;child.prototype=new Surrogate;if(protoProps)_.extend(child.prototype,protoProps);child.__super__=parent.prototype;return child;};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified');};var wrapError=function(model,options){var error=options.error;options.error=function(resp){if(error)error(model,resp,options);model.trigger('error',model,resp,options);};};}).call(this);;

/* /web/static/lib/fuzzy-master/fuzzy.js defined in bundle 'web.assets_backend' */
(function(){var root=this;var fuzzy={};if(typeof exports!=='undefined'){module.exports=fuzzy;}else{root.fuzzy=fuzzy;}
fuzzy.simpleFilter=function(pattern,array){return array.filter(function(string){return fuzzy.test(pattern,string);});};fuzzy.test=function(pattern,string){return fuzzy.match(pattern,string)!==null;};fuzzy.match=function(pattern,string,opts){opts=opts||{};var patternIdx=0,result=[],len=string.length,totalScore=0,currScore=0,pre=opts.pre||'',post=opts.post||'',compareString=opts.caseSensitive&&string||string.toLowerCase(),ch,compareChar;pattern=opts.caseSensitive&&pattern||pattern.toLowerCase();for(var idx=0;idx<len;idx++){ch=string[idx];if(compareString[idx]===pattern[patternIdx]){ch=pre+ch+post;patternIdx+=1;currScore+=1+currScore-idx/1000;}else{currScore=0;}
totalScore+=currScore;result[result.length]=ch;}
if(patternIdx===pattern.length){return{rendered:result.join(''),score:totalScore};}
return null;};fuzzy.filter=function(pattern,arr,opts){if(!arr||arr.length===0){return[]}
if(typeof pattern!=='string'){return arr}
opts=opts||{};return arr.reduce(function(prev,element,idx,arr){var str=element;if(opts.extract){str=opts.extract(element);}
var rendered=fuzzy.match(pattern,str,opts);if(rendered!=null){prev[prev.length]={string:rendered.rendered,score:rendered.score,index:idx,original:element};}
return prev;},[]).sort(function(a,b){var compare=b.score-a.score;if(compare)return compare;return a.index-b.index;});};}());;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo._modules=["web","web_kanban","base","bus","web_tour","mail","report","product","web_planner","account","account_bank_statement_import","web_editor","website","website_partner","website_mail","event","website_event","website_portal","payment","website_payment","website_portal_sale","rating","website_links","im_livechat","website_livechat","web_kanban_gauge","mass_mailing","website_form","barcodes","point_of_sale","website_mass_mailing","account_accountant","website_blog","sales_team","sale","event_sale","contacts","web_calendar","calendar","crm","website_crm","l10n_cn","website_theme_install","website_slides","note","web_settings_dashboard","website_sale","board","maintenance","document","sale_stock","base_import","stock","purchase","hr","hr_attendance","project","project_issue","hr_timesheet","mrp_repair","sale_crm","portal","gamification","fleet","website_forum","hr_expense","web_diagram","lunch","mrp","hr_recruitment","hr_holidays","survey","website_event_sale","payment_transfer","hr_gamification"];;

/* /web/static/lib/py.js/lib/py.js defined in bundle 'web.assets_backend' */
var py={};(function(py){var create=function(o,props){function F(){}
F.prototype=o;var inst=new F;if(props){for(var name in props){if(!props.hasOwnProperty(name)){continue;}
inst[name]=props[name];}}
return inst;};var symbols={};var comparators={};var Base={nud:function(){throw new Error(this.id+" undefined as prefix");},led:function(led){throw new Error(this.id+" undefined as infix");},toString:function(){if(this.id==='(constant)'||this.id==='(number)'||this.id==='(name)'||this.id==='(string)'){return[this.id.slice(0,this.id.length-1),' ',this.value,')'].join('');}else if(this.id==='(end)'){return'(end)';}else if(this.id==='(comparator)'){var repr=['(comparator',this.expressions[0]];for(var i=0;i<this.operators.length;++i){repr.push(this.operators[i],this.expressions[i+1]);}
return repr.join(' ')+')';}
var out=[this.id,this.first,this.second,this.third].filter(function(r){return r}).join(' ');return'('+out+')';}};function symbol(id,bp){bp=bp||0;var s=symbols[id];if(s){if(bp>s.lbp){s.lbp=bp;}
return s;}
return symbols[id]=create(Base,{id:id,lbp:bp});}
function constant(id){var s=symbol(id);s.id='(constant)';s.value=id;s.nud=function(){return this;};}
function prefix(id,bp,nud){symbol(id).nud=nud||function(){this.first=expression(bp);return this}}
function infix(id,bp,led){symbol(id,bp).led=led||function(left){this.first=left;this.second=expression(bp);return this;}}
function infixr(id,bp){symbol(id,bp).led=function(left){this.first=left;this.second=expression(bp-1);return this;}}
function comparator(id){comparators[id]=true;var bp=60;infix(id,bp,function(left){this.id='(comparator)';this.operators=[id];this.expressions=[left,expression(bp)];while(token.id in comparators){this.operators.push(token.id);advance();this.expressions.push(expression(bp));}
return this;});}
constant('None');constant('False');constant('True');symbol('(number)').nud=function(){return this;};symbol('(name)').nud=function(){return this;};symbol('(string)').nud=function(){return this;};symbol('(end)');symbol(':');symbol(')');symbol(']');symbol('}');symbol(',');symbol('else');infix('=',10,function(left){if(left.id!=='(name)'){throw new Error("Expected keyword argument name, got "+token.id);}
this.first=left;this.second=expression();return this;});symbol('lambda',20).nud=function(){this.first=[];if(token.id!==':'){for(;;){if(token.id!=='(name)'){throw new Error('Excepted an argument name');}
this.first.push(token);advance();if(token.id!==','){break;}
advance(',');}}
advance(':');this.second=expression();return this;};infix('if',20,function(left){this.first=left;this.second=expression();advance('else');this.third=expression();return this;});infixr('or',30);infixr('and',40);prefix('not',50);comparator('in');comparator('not in');comparator('is');comparator('is not');comparator('<');comparator('<=');comparator('>');comparator('>=');comparator('<>');comparator('!=');comparator('==');infix('|',70);infix('^',80);infix('&',90);infix('<<',100);infix('>>',100);infix('+',110);infix('-',110);infix('*',120);infix('/',120);infix('//',120);infix('%',120);prefix('-',130);prefix('+',130);prefix('~',130);infixr('**',140);infix('.',150,function(left){if(token.id!=='(name)'){throw new Error('Expected attribute name, got '+token.id);}
this.first=left;this.second=token;advance();return this;});symbol('(',150).nud=function(){this.first=[];var comma=false;if(token.id!==')'){while(true){if(token.id===')'){break;}
this.first.push(expression());if(token.id!==','){break;}
comma=true;advance(',');}}
advance(')');if(!this.first.length||comma){return this;}else{return this.first[0];}};symbol('(').led=function(left){this.first=left;this.second=[];if(token.id!==")"){for(;;){this.second.push(expression());if(token.id!==','){break;}
advance(',');}}
advance(")");return this;};infix('[',150,function(left){this.first=left;this.second=expression();advance("]");return this;});symbol('[').nud=function(){this.first=[];if(token.id!==']'){for(;;){if(token.id===']'){break;}
this.first.push(expression());if(token.id!==','){break;}
advance(',');}}
advance(']');return this;};symbol('{').nud=function(){this.first=[];if(token.id!=='}'){for(;;){if(token.id==='}'){break;}
var key=expression();advance(':');var value=expression();this.first.push([key,value]);if(token.id!==','){break;}
advance(',');}}
advance('}');return this;};py.tokenize=(function(){function group(){return'('+Array.prototype.join.call(arguments,'|')+')';}
var Whitespace='[ \\f\\t]*';var Name='[a-zA-Z_]\\w*';var DecNumber='\\d+(L|l)?';var IntNumber=DecNumber;var PointFloat=group('\\d+\\.\\d*','\\.\\d+');var FloatNumber=PointFloat;var Number=group(FloatNumber,IntNumber);var Operator=group("\\*\\*=?",">>=?","<<=?","<>","!=","//=?","[+\\-*/%&|^=<>]=?","~");var Bracket='[\\[\\]\\(\\)\\{\\}]';var Special='[:;.,`@]';var Funny=group(Operator,Bracket,Special);var ContStr=group("([uU])?'([^']*)'",'([uU])?"([^"]*)"');var PseudoToken=Whitespace+group(Number,Funny,ContStr,Name);var number_pattern=new RegExp('^'+Number+'$');var string_pattern=new RegExp('^'+ContStr+'$');var name_pattern=new RegExp('^'+Name+'$');var strip=new RegExp('^'+Whitespace);return function tokenize(s){var max=s.length,tokens=[],start,end=undefined;var pseudoprog=new RegExp(PseudoToken,'g');while(pseudoprog.lastIndex<max){var pseudomatch=pseudoprog.exec(s);if(!pseudomatch){if(/^\s+$/.test(s.slice(end))){break;}
throw new Error('Failed to tokenize <<'+s
+'>> at index '+(end||0)
+'; parsed so far: '+tokens);}
start=pseudomatch.index;end=pseudoprog.lastIndex;var token=s.slice(start,end).replace(strip,'');var initial=token[0];if(number_pattern.test(token)){tokens.push(create(symbols['(number)'],{value:parseFloat(token)}));}else if(string_pattern.test(token)){var m=string_pattern.exec(token);tokens.push(create(symbols['(string)'],{unicode:!!(m[2]||m[4]),value:(m[3]!==undefined?m[3]:m[5])}));}else if(token in symbols){var symbol;if(token==='in'&&tokens.length>1&&tokens[tokens.length-1].id==='not'){symbol=symbols['not in'];tokens.pop();}else if(token==='not'&&tokens.length>1&&tokens[tokens.length-1].id==='is'){symbol=symbols['is not'];tokens.pop();}else{symbol=symbols[token];}
tokens.push(create(symbol));}else if(name_pattern.test(token)){tokens.push(create(symbols['(name)'],{value:token}));}else{throw new Error("Tokenizing failure of <<"+s+">> at index "+start
+" for token [["+token+"]]"
+"; parsed so far: "+tokens);}}
tokens.push(create(symbols['(end)']));return tokens;}})();var token,next;function expression(rbp){rbp=rbp||0;var t=token;token=next();var left=t.nud();while(rbp<token.lbp){t=token;token=next();left=t.led(left);}
return left;}
function advance(id){if(id&&token.id!==id){throw new Error('Expected "'+id+'", got "'+token.id+'"');}
token=next();}
function PY_ensurepy(val,name){switch(val){case undefined:throw new Error("NameError: name '"+name+"' is not defined");case null:return py.None;case true:return py.True;case false:return py.False;}
var fn=function(){};fn.prototype=py.object;if(py.PY_isInstance(val,py.object)||py.PY_isSubclass(val,py.object)){return val;}
switch(typeof val){case'number':return py.float.fromJSON(val);case'string':return py.str.fromJSON(val);case'function':return py.PY_def.fromJSON(val);}
switch(val.constructor){case Object:var o=py.PY_call(py.object);for(var prop in val){if(val.hasOwnProperty(prop)){o[prop]=val[prop];}}
return o;case Array:return py.list.fromJSON(val);}
throw new Error("Could not convert "+val+" to a pyval");}
var typename=function(obj){if(obj.__class__){return obj.__class__.__name__;}else if(typeof obj!=='object'){return typeof obj;}else{return obj.constructor.name;}};py.py={};py.PY_parseArgs=function PY_parseArgs(argument,format){var out={};var args=argument[0];var kwargs={};for(var k in argument[1]){if(!argument[1].hasOwnProperty(k)){continue;}
kwargs[k]=argument[1][k];}
if(typeof format==='string'){format=format.split(/\s+/);}
var name=function(spec){if(typeof spec==='string'){return spec;}else if(spec instanceof Array&&spec.length===2){return spec[0];}
throw new Error("TypeError: unknown format specification "+
JSON.stringify(spec));};var spec;for(var i=0;i<args.length;++i){spec=format[i];if(!spec||spec==='*'){throw new Error("TypeError: function takes exactly "+(i-1)+" positional arguments ("+args.length+" given")}else if(/^\*\w/.test(spec)){out[name(spec.slice(1))]=args.slice(i);break;}
out[name(spec)]=args[i];}
for(var j=i;j<format.length;++j){spec=format[j];var n=name(spec);if(n in out){throw new Error("TypeError: function got multiple values "+"for keyword argument '"+kwarg+"'");}
if(/^\*\*\w/.test(n)){out[n.slice(2)]=kwargs;kwargs={};break;}
if(n in kwargs){out[n]=kwargs[n];delete kwargs[n];}}
for(var key in kwargs){throw new Error("TypeError: function got an unexpected keyword argument '"
+key+"'");}
var kwonly=0;for(var k=0;k<format.length;++k){if(/^\*/.test(format[k])){kwonly=1;break;}}
for(var k=0;k<format.length;++k){spec=format[k];var n=name(spec);if(/^\*/.test(n)||n in out){continue;}
if(!(spec instanceof Array)){throw new Error("TypeError: function takes exactly "+(format.length-kwonly)
+" arguments");}
out[n]=spec[1];}
return out;};py.PY_hasAttr=function(o,attr_name){try{py.PY_getAttr(o,attr_name);return true;}catch(e){return false;}};py.PY_getAttr=function(o,attr_name){return PY_ensurepy(o.__getattribute__(attr_name));};py.PY_str=function(o){var v=o.__str__();if(py.PY_isInstance(v,py.str)){return v;}
throw new Error('TypeError: __str__ returned non-string (type '
+typename(v)
+')');};py.PY_isInstance=function(inst,cls){var fn=function(){};fn.prototype=cls;return inst instanceof fn;};py.PY_isSubclass=function(derived,cls){var fn=function(){};fn.prototype=cls;return derived===cls||derived instanceof fn;};py.PY_call=function(callable,args,kwargs){if(!args){args=[];}
if(typeof args==='object'&&!(args instanceof Array)){kwargs=args;args=[];}
if(!kwargs){kwargs={};}
if(callable.__is_type){var instance=callable.__new__.call(callable,args,kwargs);var typ=function(){};typ.prototype=callable;if(instance instanceof typ){instance.__init__.call(instance,args,kwargs);}
return instance}
return callable.__call__(args,kwargs);};py.PY_isTrue=function(o){var res=o.__nonzero__();if(res===py.True){return true;}
if(res===py.False){return false;}
throw new Error("TypeError: __nonzero__ should return bool, returned "
+typename(res));};py.PY_not=function(o){return!py.PY_isTrue(o);};py.PY_size=function(o){if(!o.__len__){throw new Error("TypeError: object of type '"+
typename(o)+"' has no len()");}
var v=o.__len__();if(typeof v!=='number'){throw new Error("TypeError: a number is required");}
return v;};py.PY_getItem=function(o,key){if(!('__getitem__'in o)){throw new Error("TypeError: '"+typename(o)+"' object is unsubscriptable")}
if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: '"+typename(key)+"' is not a py.js object");}
var res=o.__getitem__(key);if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: __getitem__ must return a py.js object, got "
+typename(res));}
return res;};py.PY_setItem=function(o,key,v){if(!('__setitem__'in o)){throw new Error("TypeError: '"+typename(o)+"' object does not support item assignment");}
if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: '"+typename(key)+"' is not a py.js object");}
if(!py.PY_isInstance(v,py.object)){throw new Error("TypeError: '"+typename(v)+"' is not a py.js object");}
o.__setitem__(key,v);};py.PY_add=function(o1,o2){return PY_op(o1,o2,'+');};py.PY_subtract=function(o1,o2){return PY_op(o1,o2,'-');};py.PY_multiply=function(o1,o2){return PY_op(o1,o2,'*');};py.PY_divide=function(o1,o2){return PY_op(o1,o2,'/');};py.PY_negative=function(o){if(!o.__neg__){throw new Error("TypeError: bad operand for unary -: '"
+typename(o)
+"'");}
return o.__neg__();};py.PY_positive=function(o){if(!o.__pos__){throw new Error("TypeError: bad operand for unary +: '"
+typename(o)
+"'");}
return o.__pos__();};py.type=function type(name,bases,dict){if(typeof name!=='string'){throw new Error("ValueError: a class name should be a string");}
if(!bases||bases.length===0){bases=[py.object];}else if(bases.length>1){throw new Error("ValueError: can't provide multiple bases for a "
+"new type");}
var base=bases[0];var ClassObj=create(base);if(dict){for(var k in dict){if(!dict.hasOwnProperty(k)){continue;}
ClassObj[k]=dict[k];}}
ClassObj.__class__=ClassObj;ClassObj.__name__=name;ClassObj.__bases__=bases;ClassObj.__is_type=true;return ClassObj;};py.type.__call__=function(){var args=py.PY_parseArgs(arguments,['object']);return args.object.__class__;};var hash_counter=0;py.object=py.type('object',[{}],{__new__:function(){var inst=create(this);inst.__is_type=false;return inst;},__init__:function(){},__hash__:function(){if(this._hash){return this._hash;}
return this._hash='\0\0\0'+String(hash_counter++);},__eq__:function(other){return(this===other)?py.True:py.False;},__ne__:function(other){if(py.PY_isTrue(this.__eq__(other))){return py.False;}else{return py.True;}},__lt__:function(){return py.NotImplemented;},__le__:function(){return py.NotImplemented;},__ge__:function(){return py.NotImplemented;},__gt__:function(){return py.NotImplemented;},__str__:function(){return this.__unicode__();},__unicode__:function(){return py.str.fromJSON('<'+typename(this)+' object>');},__nonzero__:function(){return py.True;},__getattribute__:function(name){if(name in this){var val=this[name];if(typeof val==='object'&&'__get__'in val){return val.__get__(this,py.PY_call(py.type,[this]));}
if(typeof val==='function'&&!this.hasOwnProperty(name)){return PY_instancemethod.fromJSON(val,this);}
return val;}
if('__getattr__'in this){return this.__getattr__(name);}
throw new Error("AttributeError: object has no attribute '"+name+"'");},__setattr__:function(name,value){if(name in this&&'__set__'in this[name]){this[name].__set__(this,value);}
this[name]=value;},toJSON:function(){throw new Error(this.constructor.name+' can not be converted to JSON');}});var NoneType=py.type('NoneType',null,{__nonzero__:function(){return py.False;},toJSON:function(){return null;}});py.None=py.PY_call(NoneType);var NotImplementedType=py.type('NotImplementedType',null,{});py.NotImplemented=py.PY_call(NotImplementedType);var booleans_initialized=false;py.bool=py.type('bool',null,{__new__:function(){if(!booleans_initialized){return py.object.__new__.apply(this);}
var ph={};var args=py.PY_parseArgs(arguments,[['value',ph]]);if(args.value===ph){return py.False;}
return py.PY_isTrue(args.value)?py.True:py.False;},__str__:function(){return py.str.fromJSON((this===py.True)?"True":"False");},__nonzero__:function(){return this;},fromJSON:function(val){return val?py.True:py.False},toJSON:function(){return this===py.True;}});py.True=py.PY_call(py.bool);py.False=py.PY_call(py.bool);booleans_initialized=true;py.float=py.type('float',null,{__init__:function(){var placeholder={};var args=py.PY_parseArgs(arguments,[['value',placeholder]]);var value=args.value;if(value===placeholder){this._value=0;return;}
if(py.PY_isInstance(value,py.float)){this._value=value._value;}
if(py.PY_isInstance(value,py.object)&&'__float__'in value){var res=value.__float__();if(py.PY_isInstance(res,py.float)){this._value=res._value;return;}
throw new Error('TypeError: __float__ returned non-float (type '+
typename(res)+')');}
throw new Error('TypeError: float() argument must be a string or a number');},__str__:function(){return py.str.fromJSON(String(this._value));},__eq__:function(other){return this._value===other._value?py.True:py.False;},__lt__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value<other._value?py.True:py.False;},__le__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value<=other._value?py.True:py.False;},__gt__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value>other._value?py.True:py.False;},__ge__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value>=other._value?py.True:py.False;},__abs__:function(){return py.float.fromJSON(Math.abs(this._value));},__add__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value+other._value);},__neg__:function(){return py.float.fromJSON(-this._value);},__sub__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value-other._value);},__mul__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value*other._value);},__div__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value/other._value);},__nonzero__:function(){return this._value?py.True:py.False;},fromJSON:function(v){if(!(typeof v==='number')){throw new Error('py.float.fromJSON can only take numbers');}
var instance=py.PY_call(py.float);instance._value=v;return instance;},toJSON:function(){return this._value;}});py.str=py.type('str',null,{__init__:function(){var placeholder={};var args=py.PY_parseArgs(arguments,[['value',placeholder]]);var s=args.value;if(s===placeholder){this._value='';return;}
this._value=py.PY_str(s)._value;},__hash__:function(){return'\1\0\1'+this._value;},__str__:function(){return this;},__eq__:function(other){if(py.PY_isInstance(other,py.str)&&this._value===other._value){return py.True;}
return py.False;},__lt__:function(other){if(py.PY_not(py.PY_call(py.isinstance,[other,py.str]))){return py.NotImplemented;}
return this._value<other._value?py.True:py.False;},__le__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value<=other._value?py.True:py.False;},__gt__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value>other._value?py.True:py.False;},__ge__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value>=other._value?py.True:py.False;},__add__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return py.str.fromJSON(this._value+other._value);},__nonzero__:function(){return this._value.length?py.True:py.False;},__contains__:function(s){return(this._value.indexOf(s._value)!==-1)?py.True:py.False;},fromJSON:function(s){if(typeof s==='string'){var instance=py.PY_call(py.str);instance._value=s;return instance;}
throw new Error("str.fromJSON can only take strings");},toJSON:function(){return this._value;}});py.tuple=py.type('tuple',null,{__init__:function(){this._values=[];},__len__:function(){return this._values.length;},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},__contains__:function(value){for(var i=0,len=this._values.length;i<len;++i){if(py.PY_isTrue(this._values[i].__eq__(value))){return py.True;}}
return py.False;},__getitem__:function(index){return this._values[index.toJSON()];},toJSON:function(){var out=[];for(var i=0;i<this._values.length;++i){out.push(this._values[i].toJSON());}
return out;},fromJSON:function(ar){if(!(ar instanceof Array)){throw new Error("Can only create a py.tuple from an Array");}
var t=py.PY_call(py.tuple);for(var i=0;i<ar.length;++i){t._values.push(PY_ensurepy(ar[i]));}
return t;}});py.list=py.type('list',null,{__nonzero__:function(){return this.__len__>0?py.True:py.False;},});_.defaults(py.list,py.tuple)
py.dict=py.type('dict',null,{__init__:function(){this._store={};},__getitem__:function(key){var h=key.__hash__();if(!(h in this._store)){throw new Error("KeyError: '"+key.toJSON()+"'");}
return this._store[h][1];},__setitem__:function(key,value){this._store[key.__hash__()]=[key,value];},__len__:function(){return Object.keys(this._store).length},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},get:function(){var args=py.PY_parseArgs(arguments,['k',['d',py.None]]);var h=args.k.__hash__();if(!(h in this._store)){return args.d;}
return this._store[h][1];},fromJSON:function(d){var instance=py.PY_call(py.dict);for(var k in(d||{})){if(!d.hasOwnProperty(k)){continue;}
instance.__setitem__(py.str.fromJSON(k),PY_ensurepy(d[k]));}
return instance;},toJSON:function(){var out={};for(var k in this._store){var item=this._store[k];out[item[0].toJSON()]=item[1].toJSON();}
return out;}});py.PY_def=py.type('function',null,{__call__:function(){return this._func.apply(this._inst,arguments);},fromJSON:function(nativefunc){var instance=py.PY_call(py.PY_def);instance._inst=null;instance._func=nativefunc;return instance;},toJSON:function(){return this._func;}});py.classmethod=py.type('classmethod',null,{__init__:function(){var args=py.PY_parseArgs(arguments,'function');this._func=args['function'];},__get__:function(obj,type){return PY_instancemethod.fromJSON(this._func,type);},fromJSON:function(func){return py.PY_call(py.classmethod,[func]);}});var PY_instancemethod=py.type('instancemethod',[py.PY_def],{fromJSON:function(nativefunc,instance){var inst=py.PY_call(PY_instancemethod);inst._inst=instance;inst._func=nativefunc;return inst;}});py.abs=new py.PY_def.fromJSON(function abs(){var args=py.PY_parseArgs(arguments,['number']);if(!args.number.__abs__){throw new Error("TypeError: bad operand type for abs(): '"
+typename(args.number)
+"'");}
return args.number.__abs__();});py.len=new py.PY_def.fromJSON(function len(){var args=py.PY_parseArgs(arguments,['object']);return py.float.fromJSON(py.PY_size(args.object));});py.isinstance=new py.PY_def.fromJSON(function isinstance(){var args=py.PY_parseArgs(arguments,['object','class']);return py.PY_isInstance(args.object,args['class'])?py.True:py.False;});py.issubclass=new py.PY_def.fromJSON(function issubclass(){var args=py.PY_parseArgs(arguments,['C','B']);return py.PY_isSubclass(args.C,args.B)?py.True:py.False;});var PY_decode_string_literal=function(str,unicode){var out=[],code;var direct_map={'\\':'\\','"':'"',"'":"'",'a':'\x07','b':'\x08','f':'\x0c','n':'\n','r':'\r','t':'\t','v':'\v'};for(var i=0;i<str.length;++i){if(str[i]!=='\\'){out.push(str[i]);continue;}
var escape=str[i+1];if(escape in direct_map){out.push(direct_map[escape]);++i;continue;}
switch(escape){case'\n':++i;continue;case'N':if(!unicode){break;}
throw Error("SyntaxError: \\N{} escape not implemented");case'u':if(!unicode){break;}
var uni=str.slice(i+2,i+6);if(!/[0-9a-f]{4}/i.test(uni)){throw new Error(["SyntaxError: (unicode error) 'unicodeescape' codec"," can't decode bytes in position ",i,"-",i+4,": truncated \\uXXXX escape"].join(''));}
code=parseInt(uni,16);out.push(String.fromCharCode(code));i+=5;continue;case'U':if(!unicode){break;}
throw Error("SyntaxError: \\U escape not implemented");case'x':var hex=str.slice(i+2,i+4);if(!/[0-9a-f]{2}/i.test(hex)){if(!unicode){throw new Error('ValueError: invalid \\x escape');}
throw new Error(["SyntaxError: (unicode error) 'unicodeescape'"," codec can't decode bytes in position ",i,'-',i+2,": truncated \\xXX escape"].join(''))}
code=parseInt(hex,16);out.push(String.fromCharCode(code));i+=3;continue;default:if(!/[0-8]/.test(escape)){break;}
var r=/[0-8]{1,3}/g;r.lastIndex=i+1;var m=r.exec(str);var oct=m[0];code=parseInt(oct,8);out.push(String.fromCharCode(code));i+=oct.length;continue;}
out.push('\\');}
return out.join('');};var PY_operators={'==':['eq','eq',function(a,b){return a===b;}],'!=':['ne','ne',function(a,b){return a!==b;}],'<>':['ne','ne',function(a,b){return a!==b;}],'<':['lt','gt',function(a,b){return a.__class__.__name__<b.__class__.__name__;}],'<=':['le','ge',function(a,b){return a.__class__.__name__<=b.__class__.__name__;}],'>':['gt','lt',function(a,b){return a.__class__.__name__>b.__class__.__name__;}],'>=':['ge','le',function(a,b){return a.__class__.__name__>=b.__class__.__name__;}],'+':['add','radd'],'-':['sub','rsub'],'*':['mul','rmul'],'/':['div','rdiv'],'//':['floordiv','rfloordiv'],'%':['mod','rmod'],'**':['pow','rpow'],'<<':['lshift','rlshift'],'>>':['rshift','rrshift'],'&':['and','rand'],'^':['xor','rxor'],'|':['or','ror']};var PY_op=function(o1,o2,op){var r;var methods=PY_operators[op];var forward='__'+methods[0]+'__',reverse='__'+methods[1]+'__';var otherwise=methods[2];if(forward in o1&&(r=o1[forward](o2))!==py.NotImplemented){return r;}
if(reverse in o2&&(r=o2[reverse](o1))!==py.NotImplemented){return r;}
if(otherwise){return PY_ensurepy(otherwise(o1,o2));}
throw new Error("TypeError: unsupported operand type(s) for "+op+": '"
+typename(o1)+"' and '"+typename(o2)+"'");};var PY_builtins={type:py.type,None:py.None,True:py.True,False:py.False,NotImplemented:py.NotImplemented,object:py.object,bool:py.bool,float:py.float,str:py.str,unicode:py.unicode,tuple:py.tuple,list:py.list,dict:py.dict,abs:py.abs,len:py.len,isinstance:py.isinstance,issubclass:py.issubclass,classmethod:py.classmethod,};py.parse=function(toks){var index=0;token=toks[0];next=function(){return toks[++index];};return expression();};var evaluate_operator=function(operator,a,b){switch(operator){case'is':return a===b?py.True:py.False;case'is not':return a!==b?py.True:py.False;case'in':return b.__contains__(a);case'not in':return py.PY_isTrue(b.__contains__(a))?py.False:py.True;case'==':case'!=':case'<>':case'<':case'<=':case'>':case'>=':return PY_op(a,b,operator);}
throw new Error('SyntaxError: unknown comparator [['+operator+']]');};py.evaluate=function(expr,context){context=context||{};switch(expr.id){case'(name)':var val=context[expr.value];if(val===undefined&&expr.value in PY_builtins){return PY_builtins[expr.value];}
return PY_ensurepy(val,expr.value);case'(string)':return py.str.fromJSON(PY_decode_string_literal(expr.value,expr.unicode));case'(number)':return py.float.fromJSON(expr.value);case'(constant)':switch(expr.value){case'None':return py.None;case'False':return py.False;case'True':return py.True;}
throw new Error("SyntaxError: unknown constant '"+expr.value+"'");case'(comparator)':var result,left=py.evaluate(expr.expressions[0],context);for(var i=0;i<expr.operators.length;++i){result=evaluate_operator(expr.operators[i],left,left=py.evaluate(expr.expressions[i+1],context));if(py.PY_not(result)){return py.False;}}
return py.True;case'not':return py.PY_isTrue(py.evaluate(expr.first,context))?py.False:py.True;case'and':var and_first=py.evaluate(expr.first,context);if(py.PY_isTrue(and_first.__nonzero__())){return py.evaluate(expr.second,context);}
return and_first;case'or':var or_first=py.evaluate(expr.first,context);if(py.PY_isTrue(or_first.__nonzero__())){return or_first}
return py.evaluate(expr.second,context);case'(':if(expr.second){var callable=py.evaluate(expr.first,context);var args=[],kwargs={};for(var jj=0;jj<expr.second.length;++jj){var arg=expr.second[jj];if(arg.id!=='='){args.push(py.evaluate(arg,context));}else{kwargs[arg.first.value]=py.evaluate(arg.second,context);}}
return py.PY_call(callable,args,kwargs);}
var tuple_exprs=expr.first,tuple_values=[];for(var j=0,len=tuple_exprs.length;j<len;++j){tuple_values.push(py.evaluate(tuple_exprs[j],context));}
return py.tuple.fromJSON(tuple_values);case'[':if(expr.second){return py.PY_getItem(py.evaluate(expr.first,context),py.evaluate(expr.second,context));}
var list_exprs=expr.first,list_values=[];for(var k=0;k<list_exprs.length;++k){list_values.push(py.evaluate(list_exprs[k],context));}
return py.list.fromJSON(list_values);case'{':var dict_exprs=expr.first,dict=py.PY_call(py.dict);for(var l=0;l<dict_exprs.length;++l){py.PY_setItem(dict,py.evaluate(dict_exprs[l][0],context),py.evaluate(dict_exprs[l][1],context));}
return dict;case'.':if(expr.second.id!=='(name)'){throw new Error('SyntaxError: '+expr);}
return py.PY_getAttr(py.evaluate(expr.first,context),expr.second.value);case'~':return(py.evaluate(expr.first,context)).__invert__();case'+':if(!expr.second){return py.PY_positive(py.evaluate(expr.first,context));}
case'-':if(!expr.second){return py.PY_negative(py.evaluate(expr.first,context));}
case'*':case'/':case'//':case'%':case'**':case'<<':case'>>':case'&':case'^':case'|':return PY_op(py.evaluate(expr.first,context),py.evaluate(expr.second,context),expr.id);default:throw new Error('SyntaxError: Unknown node [['+expr.id+']]');}};py.eval=function(str,context){return py.evaluate(py.parse(py.tokenize(str)),context).toJSON();}})(typeof exports==='undefined'?py:exports);;

/* /web/static/lib/jquery.ba-bbq/jquery.ba-bbq.js defined in bundle 'web.assets_backend' */
(function($,window){'$:nomunge';var undefined,aps=Array.prototype.slice,decode=decodeURIComponent,jq_param=$.param,jq_param_sorted,jq_param_fragment,jq_deparam,jq_deparam_fragment,jq_bbq=$.bbq=$.bbq||{},jq_bbq_pushState,jq_bbq_getState,jq_elemUrlAttr,special=$.event.special,str_hashchange='hashchange',str_querystring='querystring',str_fragment='fragment',str_elemUrlAttr='elemUrlAttr',str_href='href',str_src='src',re_params_querystring=/^.*\?|#.*$/g,re_params_fragment,re_fragment,re_no_escape,ajax_crawlable,fragment_prefix,elemUrlAttr_cache={};function is_string(arg){return typeof arg==='string';};function curry(func){var args=aps.call(arguments,1);return function(){return func.apply(this,args.concat(aps.call(arguments)));};};function get_fragment(url){return url.replace(re_fragment,'$2');};function get_querystring(url){return url.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,'$1');};function jq_param_sub(is_fragment,get_func,url,params,merge_mode){var result,qs,matches,url_params,hash;if(params!==undefined){matches=url.match(is_fragment?re_fragment:/^([^#?]*)\??([^#]*)(#?.*)/);hash=matches[3]||'';if(merge_mode===2&&is_string(params)){qs=params.replace(is_fragment?re_params_fragment:re_params_querystring,'');}else{url_params=jq_deparam(matches[2]);params=is_string(params)?jq_deparam[is_fragment?str_fragment:str_querystring](params):params;qs=merge_mode===2?params:merge_mode===1?$.extend({},params,url_params):$.extend({},url_params,params);qs=jq_param_sorted(qs);if(is_fragment){qs=qs.replace(re_no_escape,decode);}}
result=matches[1]+(is_fragment?fragment_prefix:qs||!matches[1]?'?':'')+qs+hash;}else{result=get_func(url!==undefined?url:location.href);}
return result;};jq_param[str_querystring]=curry(jq_param_sub,0,get_querystring);jq_param[str_fragment]=jq_param_fragment=curry(jq_param_sub,1,get_fragment);jq_param.sorted=jq_param_sorted=function(a,traditional){var arr=[],obj={};$.each(jq_param(a,traditional).split('&'),function(i,v){var key=v.replace(/(?:%5B|=).*$/,''),key_obj=obj[key];if(!key_obj){key_obj=obj[key]=[];arr.push(key);}
key_obj.push(v);});return $.map(arr.sort(),function(v){return obj[v];}).join('&');};jq_param_fragment.noEscape=function(chars){chars=chars||'';var arr=$.map(chars.split(''),encodeURIComponent);re_no_escape=new RegExp(arr.join('|'),'g');};jq_param_fragment.noEscape(',/');jq_param_fragment.ajaxCrawlable=function(state){if(state!==undefined){if(state){re_params_fragment=/^.*(?:#!|#)/;re_fragment=/^([^#]*)(?:#!|#)?(.*)$/;fragment_prefix='#!';}else{re_params_fragment=/^.*#/;re_fragment=/^([^#]*)#?(.*)$/;fragment_prefix='#';}
ajax_crawlable=!!state;}
return ajax_crawlable;};jq_param_fragment.ajaxCrawlable(0);$.deparam=jq_deparam=function(params,coerce){var obj={},coerce_types={'true':!0,'false':!1,'null':null};$.each(params.replace(/\+/g,' ').split('&'),function(j,v){var param=v.split('='),key=decode(param[0]),val,cur=obj,i=0,keys=key.split(']['),keys_last=keys.length-1;if(/\[/.test(keys[0])&&/\]$/.test(keys[keys_last])){keys[keys_last]=keys[keys_last].replace(/\]$/,'');keys=keys.shift().split('[').concat(keys);keys_last=keys.length-1;}else{keys_last=0;}
if(param.length===2){val=decode(param[1]);if(coerce){val=val&&!isNaN(val)?+val:val==='undefined'?undefined:coerce_types[val]!==undefined?coerce_types[val]:val;}
if(keys_last){for(;i<=keys_last;i++){key=keys[i]===''?cur.length:keys[i];cur=cur[key]=i<keys_last?cur[key]||(keys[i+1]&&isNaN(keys[i+1])?{}:[]):val;}}else{if($.isArray(obj[key])){obj[key].push(val);}else if(obj[key]!==undefined){obj[key]=[obj[key],val];}else{obj[key]=val;}}}else if(key){obj[key]=coerce?undefined:'';}});return obj;};function jq_deparam_sub(is_fragment,url_or_params,coerce){if(url_or_params===undefined||typeof url_or_params==='boolean'){coerce=url_or_params;url_or_params=jq_param[is_fragment?str_fragment:str_querystring]();}else{url_or_params=is_string(url_or_params)?url_or_params.replace(is_fragment?re_params_fragment:re_params_querystring,''):url_or_params;}
return jq_deparam(url_or_params,coerce);};jq_deparam[str_querystring]=curry(jq_deparam_sub,0);jq_deparam[str_fragment]=jq_deparam_fragment=curry(jq_deparam_sub,1);$[str_elemUrlAttr]||($[str_elemUrlAttr]=function(obj){return $.extend(elemUrlAttr_cache,obj);})({a:str_href,base:str_href,iframe:str_src,img:str_src,input:str_src,form:'action',link:str_href,script:str_src});jq_elemUrlAttr=$[str_elemUrlAttr];function jq_fn_sub(mode,force_attr,params,merge_mode){if(!is_string(params)&&typeof params!=='object'){merge_mode=params;params=force_attr;force_attr=undefined;}
return this.each(function(){var that=$(this),attr=force_attr||jq_elemUrlAttr()[(this.nodeName||'').toLowerCase()]||'',url=attr&&that.attr(attr)||'';that.attr(attr,jq_param[mode](url,params,merge_mode));});};$.fn[str_querystring]=curry(jq_fn_sub,str_querystring);$.fn[str_fragment]=curry(jq_fn_sub,str_fragment);jq_bbq.pushState=jq_bbq_pushState=function(params,merge_mode){if(is_string(params)&&/^#/.test(params)&&merge_mode===undefined){merge_mode=2;}
var has_args=params!==undefined,url=jq_param_fragment(location.href,has_args?params:{},has_args?merge_mode:2);location.href=url;};jq_bbq.getState=jq_bbq_getState=function(key,coerce){return key===undefined||typeof key==='boolean'?jq_deparam_fragment(key):jq_deparam_fragment(coerce)[key];};jq_bbq.removeState=function(arr){var state={};if(arr!==undefined){state=jq_bbq_getState();$.each($.isArray(arr)?arr:arguments,function(i,v){delete state[v];});}
jq_bbq_pushState(state,2);};special[str_hashchange]=$.extend(special[str_hashchange],{add:function(handleObj){var old_handler;function new_handler(e){var hash=e[str_fragment]=jq_param_fragment();e.getState=function(key,coerce){return key===undefined||typeof key==='boolean'?jq_deparam(hash,key):jq_deparam(hash,coerce)[key];};old_handler.apply(this,arguments);};if($.isFunction(handleObj)){old_handler=handleObj;return new_handler;}else{old_handler=handleObj.handler;handleObj.handler=new_handler;}}});})(jQuery,this);(function($,window,undefined){'$:nomunge';var str_hashchange='hashchange',doc=document,fake_onhashchange,special=$.event.special,doc_mode=doc.documentMode,supports_onhashchange='on'+str_hashchange in window&&(doc_mode===undefined||doc_mode>7);function get_fragment(url){url=url||location.href;return'#'+url.replace(/^[^#]*#?(.*)$/,'$1');};$.fn[str_hashchange]=function(fn){return fn?this.bind(str_hashchange,fn):this.trigger(str_hashchange);};$.fn[str_hashchange].delay=50;special[str_hashchange]=$.extend(special[str_hashchange],{setup:function(){if(supports_onhashchange){return false;}
$(fake_onhashchange.start);},teardown:function(){if(supports_onhashchange){return false;}
$(fake_onhashchange.stop);}});fake_onhashchange=(function(){var self={},timeout_id,last_hash=get_fragment(),fn_retval=function(val){return val;},history_set=fn_retval,history_get=fn_retval;self.start=function(){timeout_id||poll();};self.stop=function(){timeout_id&&clearTimeout(timeout_id);timeout_id=undefined;};function poll(){var hash=get_fragment(),history_hash=history_get(last_hash);if(hash!==last_hash){history_set(last_hash=hash,history_hash);$(window).trigger(str_hashchange);}else if(history_hash!==last_hash){location.href=location.href.replace(/#.*/,'')+history_hash;}
timeout_id=setTimeout(poll,$.fn[str_hashchange].delay);};$.browser.msie&&!supports_onhashchange&&(function(){var iframe,iframe_src;self.start=function(){if(!iframe){iframe_src=$.fn[str_hashchange].src;iframe_src=iframe_src&&iframe_src+get_fragment();iframe=$('<iframe tabindex="-1" title="empty"/>').hide().one('load',function(){iframe_src||history_set(get_fragment());poll();}).attr('src',iframe_src||'javascript:0').insertAfter('body')[0].contentWindow;doc.onpropertychange=function(){try{if(event.propertyName==='title'){iframe.document.title=doc.title;}}catch(e){}};}};self.stop=fn_retval;history_get=function(){return get_fragment(iframe.location.href);};history_set=function(hash,history_hash){var iframe_doc=iframe.document,domain=$.fn[str_hashchange].domain;if(hash!==history_hash){iframe_doc.title=doc.title;iframe_doc.open();domain&&iframe_doc.write('<script>document.domain="'+domain+'"</script>');iframe_doc.close();iframe.location.hash=hash;}};})();return self;})();})(jQuery,this);;

/* /web/static/src/js/framework/data_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.DataModel',function(require){"use strict";var data=require('web.data');var Model=require('web.Model');var pyeval=require('web.pyeval');var session=require('web.session');Model.include({query:function(fields){return new data.Query(this,fields);},domain:function(domain){if(!domain){return this._domain;}
return new data.CompoundDomain(this._domain,domain);},context:function(context){return new data.CompoundContext(session.user_context,this._context,context||{});},call:function(method,args,kwargs,options){args=args||[];kwargs=kwargs||{};if(!_.isArray(args)){kwargs=args;args=[];}
pyeval.ensure_evaluated(args,kwargs);var call_kw='/web/dataset/call_kw/'+this.name+'/'+method;return session.rpc(call_kw,{model:this.name,method:method,args:args,kwargs:kwargs},options);},call_button:function(method,args){pyeval.ensure_evaluated(args,{});return session.rpc('/web/dataset/call_button',{model:this.name,method:method,domain_id:null,context_id:args.length-1,args:args||[]});},});return Model;});;

/* /web/static/src/js/framework/formats.js defined in bundle 'web.assets_backend' */
odoo.define('web.formats',function(require){"use strict";var translation=require('web.translation');var time=require('web.time');var utils=require('web.utils');var _t=translation._t;function format_value(value,descriptor,value_if_empty){var l10n=_t.database.parameters;var date_format=time.strftime_to_moment_format(l10n.date_format);var time_format=time.strftime_to_moment_format(l10n.time_format);if(typeof value==='number'&&isNaN(value)){value=false;}
switch(value){case'':if(descriptor.type==='char'||descriptor.type==='text'){return'';}
console.warn('Field',descriptor,'had an empty string as value, treating as false...');return value_if_empty===undefined?'':value_if_empty;case false:case undefined:case Infinity:case-Infinity:return value_if_empty===undefined?'':value_if_empty;}
switch(descriptor.widget||descriptor.type||(descriptor.field&&descriptor.field.type)){case'id':return value.toString();case'integer':return utils.insert_thousand_seps(_.str.sprintf('%d',value));case'monetary':case'float':var digits=descriptor.digits?descriptor.digits:[69,2];digits=typeof digits==="string"?py.eval(digits):digits;var precision=digits[1];var formatted=_.str.sprintf('%.'+precision+'f',value).split('.');formatted[0]=utils.insert_thousand_seps(formatted[0]);return formatted.join(l10n.decimal_point);case'float_time':var pattern='%02d:%02d';if(value<0){value=Math.abs(value);pattern='-'+pattern;}
var hour=Math.floor(value);var min=Math.round((value%1)*60);if(min==60){min=0;hour=hour+1;}
return _.str.sprintf(pattern,hour,min);case'many2one':return value[1]?value[1].split("\n")[0]:value[1];case'one2many':case'many2many':if(typeof value==='string'){return value;}
return _.str.sprintf(_t("(%d records)"),value.length);case'datetime':if(typeof(value)=="string")
value=moment(time.auto_str_to_date(value));else{value=moment(value);}
return value.format(date_format+' '+time_format);case'date':if(typeof(value)=="string")
value=moment(time.auto_str_to_date(value));else{value=moment(value);}
return value.format(date_format);case'time':if(typeof(value)=="string")
value=moment(time.auto_str_to_date(value));else{value=moment(value);}
return value.format(time_format);case'selection':case'statusbar':if(_.isArray(value)){return value[1];}
var result=_(descriptor.selection).detect(function(choice){return choice[0]===value;});if(result){return result[1];}
return;default:return value;}}
function parse_value(value,descriptor,value_if_empty){var date_pattern=time.strftime_to_moment_format(_t.database.parameters.date_format),time_pattern=time.strftime_to_moment_format(_t.database.parameters.time_format);var date_pattern_wo_zero=date_pattern.replace('MM','M').replace('DD','D'),time_pattern_wo_zero=time_pattern.replace('HH','H').replace('mm','m').replace('ss','s');switch(value){case false:case"":return value_if_empty===undefined?false:value_if_empty;}
var tmp;switch(descriptor.widget||descriptor.type||(descriptor.field&&descriptor.field.type)){case'integer':do{tmp=value;value=value.replace(_t.database.parameters.thousands_sep,"");}while(tmp!==value);tmp=Number(value);if(isNaN(tmp)||tmp%1)
throw new Error(_.str.sprintf(_t("'%s' is not a correct integer"),value));return tmp;case'monetary':case'float':var tmp2=value;do{tmp=tmp2;tmp2=tmp.replace(_t.database.parameters.thousands_sep,"");}while(tmp!==tmp2);var reformatted_value=tmp.replace(_t.database.parameters.decimal_point,".");var parsed=Number(reformatted_value);if(isNaN(parsed))
throw new Error(_.str.sprintf(_t("'%s' is not a correct float"),value));return parsed;case'float_time':var factor=1;if(value[0]==='-'){value=value.slice(1);factor=-1;}
var float_time_pair=value.split(":");if(float_time_pair.length!=2)
return factor*parse_value(value,{type:"float"});var hours=parse_value(float_time_pair[0],{type:"integer"});var minutes=parse_value(float_time_pair[1],{type:"integer"});return factor*(hours+(minutes/60));case'progressbar':return parse_value(value,{type:"float"});case'datetime':var datetime=moment(value,[date_pattern+' '+time_pattern,date_pattern_wo_zero+' '+time_pattern_wo_zero,moment.ISO_8601],true);if(datetime.isValid()&&datetime.year()>=1900)
return time.datetime_to_str(datetime.toDate());datetime=moment(value,[date_pattern+' '+time_pattern,date_pattern_wo_zero+' '+time_pattern_wo_zero,moment.ISO_8601]);if(datetime.isValid()){if(datetime.year()===0){datetime.year(moment.utc().year());}
if(datetime.year()>=1900){return time.datetime_to_str(datetime.toDate());}}
throw new Error(_.str.sprintf(_t("'%s' is not a correct datetime"),value));case'date':var date=moment(value,[date_pattern,date_pattern_wo_zero,moment.ISO_8601],true);if(date.isValid()&&date.year()>=1900)
return time.date_to_str(date.toDate());date=moment(value,[date_pattern,date_pattern_wo_zero,moment.ISO_8601]);if(date.isValid()){if(date.year()===0){date.year(moment.utc().year());}
if(date.year()>=1900){return time.date_to_str(date.toDate());}}
throw new Error(_.str.sprintf(_t("'%s' is not a correct date"),value));case'time':var _time=moment(value,[time_pattern,time_pattern_wo_zero,moment.ISO_8601],true);if(_time.isValid())
return time.time_to_str(_time.toDate());throw new Error(_.str.sprintf(_t("'%s' is not a correct time"),value));}
return value;}
return{format_value:format_value,parse_value:parse_value,};});;

/* /web/static/src/js/framework/view.js defined in bundle 'web.assets_backend' */
odoo.define('web.View',function(require){"use strict";var core=require('web.core');var data=require('web.data');var data_manager=require('web.data_manager');var pyeval=require('web.pyeval');var Widget=require('web.Widget');var View=Widget.extend({events:{'click a[type=action]':function(ev){ev.preventDefault();var action_data=$(ev.target).attr('name');this.do_action(action_data);}},defaults:{action:{},},display_name:'',searchable:true,searchview_hidden:false,multi_record:true,mobile_friendly:false,icon:'fa-question',require_fields:false,init:function(parent,dataset,fields_view,options){this._super(parent);this.ViewManager=parent;this.dataset=dataset;this.model=dataset.model;this.fields_view=fields_view;this.options=_.defaults({},options,this.defaults);},start:function(){this.$el.toggleClass('o_cannot_create',!this.is_action_enabled('create'));return this._super().then(this.trigger.bind(this,'view_loaded'));},do_execute_action:function(action_data,dataset,record_id,on_closed){var self=this;var result_handler=function(){if(on_closed){on_closed.apply(null,arguments);}
if(self.getParent()&&self.getParent().on_action_executed){return self.getParent().on_action_executed.apply(null,arguments);}};var context=new data.CompoundContext(dataset.get_context(),action_data.context||{});var handler=function(action){if(action&&action.constructor===Object){var ncontext=new data.CompoundContext(_.object(_.reject(_.pairs(dataset.get_context().eval()),function(pair){return pair[0].match('^(?:(?:default_|search_default_|show_).+|.+_view_ref|group_by|group_by_no_leaf|active_id|active_ids)$')!==null;})));ncontext.add(action_data.context||{});ncontext.add({active_model:dataset.model});if(record_id){ncontext.add({active_id:record_id,active_ids:[record_id],});}
ncontext.add(action.context||{});action.context=ncontext;return self.do_action(action,{on_close:result_handler,});}else{self.do_action({"type":"ir.actions.act_window_close"});return result_handler();}};if(action_data.special==='cancel'){return handler({"type":"ir.actions.act_window_close"});}else if(action_data.type==="object"){var args=record_id?[[record_id]]:[dataset.ids];if(action_data.args){try{var additional_args=JSON.parse(action_data.args.replace(/'/g,'"'));args=args.concat(additional_args);}catch(e){console.error("Could not JSON.parse arguments",action_data.args);}}
args.push(context);return dataset.call_button(action_data.name,args).then(handler).then(function(){core.bus.trigger('do_reload_needaction');});}else if(action_data.type==="action"){return data_manager.load_action(action_data.name,_.extend(pyeval.eval('context',context),{active_model:dataset.model,active_ids:dataset.ids,active_id:record_id})).then(handler);}else{return dataset.exec_workflow(record_id,action_data.name).then(handler);}},do_show:function(){this._super();core.bus.trigger('view_shown',this);},do_push_state:function(state){if(this.getParent()&&this.getParent().do_push_state){this.getParent().do_push_state(state);}},do_load_state:function(state,warm){},render_buttons:function($node){},render_sidebar:function($node){},render_pager:function($node){},do_switch_view:function(){this.trigger.apply(this,['switch_mode'].concat(_.toArray(arguments)));},do_search:function(domain,context,group_by){},sidebar_eval_context:function(){return $.when({});},reload:function(){return $.when();},is_action_enabled:function(action){var attrs=this.fields_view.arch.attrs;return(action in attrs)?JSON.parse(attrs[action]):true;},get_context:function(){return{};},destroy:function(){if(this.$buttons){this.$buttons.off();}
return this._super.apply(this,arguments);},set_scrollTop:function(scrollTop){this.scrollTop=scrollTop;},get_scrollTop:function(){return this.scrollTop;}});return View;});;

/* /web/static/src/js/framework/pyeval.js defined in bundle 'web.assets_backend' */
odoo.define('web.pyeval',function(require){"use strict";var core=require('web.core');var session=require('web.session');var utils=require('web.utils');var _t=core._t;var py=window.py;var obj=function(){};obj.prototype=py.object;var asJS=function(arg){if(arg instanceof obj){return arg.toJSON();}
return arg;};var datetime=py.PY_call(py.object);var zero=py.float.fromJSON(0);var DAYS_IN_MONTH=[null,31,28,31,30,31,30,31,31,30,31,30,31];var DAYS_BEFORE_MONTH=[null];var dbm=0;for(var i=1;i<DAYS_IN_MONTH.length;++i){DAYS_BEFORE_MONTH.push(dbm);dbm+=DAYS_IN_MONTH[i];}
function is_leap(year){return year%4===0&&(year%100!==0||year%400===0);}
function days_before_year(year){var y=year-1;return y*365+Math.floor(y/4)-Math.floor(y/100)+Math.floor(y/400);}
function days_in_month(year,month){if(month===2&&is_leap(year)){return 29;}
return DAYS_IN_MONTH[month];}
function days_before_month(year,month){var post_leap_feb=month>2&&is_leap(year);return DAYS_BEFORE_MONTH[month]+(post_leap_feb?1:0);}
function ymd2ord(year,month,day){var dim=days_in_month(year,month);if(!(1<=day&&day<=dim)){throw new Error("ValueError: day must be in 1.."+dim);}
return days_before_year(year)+
days_before_month(year,month)+
day;}
var DI400Y=days_before_year(401);var DI100Y=days_before_year(101);var DI4Y=days_before_year(5);function ord2ymd(n){--n;var n400,n100,n4,n1,n0;utils.divmod(n,DI400Y,function(_n400,n){n400=_n400;utils.divmod(n,DI100Y,function(_n100,n){n100=_n100;utils.divmod(n,DI4Y,function(_n4,n){n4=_n4;utils.divmod(n,365,function(_n1,n){n1=_n1;n0=n;});});});});n=n0;var year=n400*400+1+n100*100+n4*4+n1;if(n1==4||n100==100){utils.assert(n0===0);return{year:year-1,month:12,day:31};}
var leapyear=n1===3&&(n4!==24||n100==3);utils.assert(leapyear==is_leap(year));var month=(n+50)>>5;var preceding=DAYS_BEFORE_MONTH[month]+((month>2&&leapyear)?1:0);if(preceding>n){--month;preceding-=DAYS_IN_MONTH[month]+((month===2&&leapyear)?1:0);}
n-=preceding;return{year:year,month:month,day:n+1};}
function tmxxx(year,month,day,hour,minute,second,microsecond){hour=hour||0;minute=minute||0;second=second||0;microsecond=microsecond||0;if(microsecond<0||microsecond>999999){utils.divmod(microsecond,1000000,function(carry,ms){microsecond=ms;second+=carry;});}
if(second<0||second>59){utils.divmod(second,60,function(carry,s){second=s;minute+=carry;});}
if(minute<0||minute>59){utils.divmod(minute,60,function(carry,m){minute=m;hour+=carry;});}
if(hour<0||hour>23){utils.divmod(hour,24,function(carry,h){hour=h;day+=carry;});}
if(month<1||month>12){utils.divmod(month-1,12,function(carry,m){month=m+1;year+=carry;});}
var dim=days_in_month(year,month);if(day<1||day>dim){if(day===0){--month;if(month>0){day=days_in_month(year,month);}else{--year;month=12;day=31;}}else if(day==dim+1){++month;day=1;if(month>12){month=1;++year;}}else{var r=ord2ymd(ymd2ord(year,month,1)+(day-1));year=r.year;month=r.month;day=r.day;}}
return{year:year,month:month,day:day,hour:hour,minute:minute,second:second,microsecond:microsecond};}
datetime.timedelta=py.type('timedelta',null,{__init__:function(){var args=py.PY_parseArgs(arguments,[['days',zero],['seconds',zero],['microseconds',zero],['milliseconds',zero],['minutes',zero],['hours',zero],['weeks',zero]]);var d=0,s=0,m=0;var days=args.days.toJSON()+args.weeks.toJSON()*7;var seconds=args.seconds.toJSON()
+args.minutes.toJSON()*60
+args.hours.toJSON()*3600;var microseconds=args.microseconds.toJSON()
+args.milliseconds.toJSON()*1000;var daysecondsfrac=utils.modf(days,function(dayfrac,days){d=days;if(dayfrac){return utils.modf(dayfrac*24*3600,function(dsf,dsw){s=dsw;return dsf;});}
return 0;});var secondsfrac=utils.modf(seconds,function(sf,s){seconds=s;return sf+daysecondsfrac;});utils.divmod(seconds,24*3600,function(days,seconds){d+=days;s+=seconds;});microseconds+=secondsfrac*1e6;utils.divmod(microseconds,1000000,function(seconds,microseconds){utils.divmod(seconds,24*3600,function(days,seconds){d+=days;s+=seconds;m+=Math.round(microseconds);});});this.days=d;this.seconds=s;this.microseconds=m;},__str__:function(){var hh,mm,ss;utils.divmod(this.seconds,60,function(m,s){utils.divmod(m,60,function(h,m){hh=h;mm=m;ss=s;});});var s=_.str.sprintf("%d:%02d:%02d",hh,mm,ss);if(this.days){s=_.str.sprintf("%d day%s, %s",this.days,(this.days!=1&&this.days!=-1)?'s':'',s);}
if(this.microseconds){s=_.str.sprintf("%s.%06d",s,this.microseconds);}
return py.str.fromJSON(s);},__eq__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.False;}
return(this.days===other.days&&this.seconds===other.seconds&&this.microseconds===other.microseconds)?py.True:py.False;},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days+other.days),py.float.fromJSON(this.seconds+other.seconds),py.float.fromJSON(this.microseconds+other.microseconds)]);},__radd__:function(other){return this.__add__(other);},__sub__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days-other.days),py.float.fromJSON(this.seconds-other.seconds),py.float.fromJSON(this.microseconds-other.microseconds)]);},__rsub__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return this.__neg__().__add__(other);},__neg__:function(){return py.PY_call(datetime.timedelta,[py.float.fromJSON(-this.days),py.float.fromJSON(-this.seconds),py.float.fromJSON(-this.microseconds)]);},__pos__:function(){return this;},__mul__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
var n=other.toJSON();return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days*n),py.float.fromJSON(this.seconds*n),py.float.fromJSON(this.microseconds*n)]);},__rmul__:function(other){return this.__mul__(other);},__div__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
var usec=((this.days*24*3600)+this.seconds)*1000000
+this.microseconds;return py.PY_call(datetime.timedelta,[zero,zero,py.float.fromJSON(usec/other.toJSON())]);},__floordiv__:function(other){return this.__div__(other);},total_seconds:function(){return py.float.fromJSON(this.days*86400
+this.seconds
+this.microseconds/1000000);},__nonzero__:function(){return(!!this.days||!!this.seconds||!!this.microseconds)?py.True:py.False;}});datetime.datetime=py.type('datetime',null,{__init__:function(){var zero=py.float.fromJSON(0);var args=py.PY_parseArgs(arguments,['year','month','day',['hour',zero],['minute',zero],['second',zero],['microsecond',zero],['tzinfo',py.None]]);for(var key in args){if(!args.hasOwnProperty(key)){continue;}
this[key]=asJS(args[key]);}},replace:function(){var args=py.PY_parseArgs(arguments,[['year',py.None],['month',py.None],['day',py.None],['hour',py.None],['minute',py.None],['second',py.None],['microsecond',py.None]]);var params={};for(var key in args){if(!args.hasOwnProperty(key)){continue;}
var arg=args[key];params[key]=(arg===py.None?this[key]:asJS(arg));}
return py.PY_call(datetime.datetime,params);},strftime:function(){var self=this;var args=py.PY_parseArgs(arguments,'format');return py.str.fromJSON(args.format.toJSON().replace(/%([A-Za-z])/g,function(m,c){switch(c){case'Y':return _.str.sprintf('%04d',self.year);case'm':return _.str.sprintf('%02d',self.month);case'd':return _.str.sprintf('%02d',self.day);case'H':return _.str.sprintf('%02d',self.hour);case'M':return _.str.sprintf('%02d',self.minute);case'S':return _.str.sprintf('%02d',self.second);}
throw new Error('ValueError: No known conversion for '+m);}));},now:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.datetime,[d.getFullYear(),d.getMonth()+1,d.getDate(),d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds()*1000]);}),today:py.classmethod.fromJSON(function(){var dt_class=py.PY_getAttr(datetime,'datetime');return py.PY_call(py.PY_getAttr(dt_class,'now'));}),utcnow:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.datetime,[d.getUTCFullYear(),d.getUTCMonth()+1,d.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()*1000]);}),combine:py.classmethod.fromJSON(function(){var args=py.PY_parseArgs(arguments,'date time');return py.PY_call(datetime.datetime,[py.PY_getAttr(args.date,'year'),py.PY_getAttr(args.date,'month'),py.PY_getAttr(args.date,'day'),py.PY_getAttr(args.time,'hour'),py.PY_getAttr(args.time,'minute'),py.PY_getAttr(args.time,'second')]);}),toJSON:function(){return new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.microsecond/1000);},});datetime.date=py.type('date',null,{__init__:function(){var args=py.PY_parseArgs(arguments,'year month day');this.year=asJS(args.year);this.month=asJS(args.month);this.day=asJS(args.day);},strftime:function(){var self=this;var args=py.PY_parseArgs(arguments,'format');return py.str.fromJSON(args.format.toJSON().replace(/%([A-Za-z])/g,function(m,c){switch(c){case'Y':return self.year;case'm':return _.str.sprintf('%02d',self.month);case'd':return _.str.sprintf('%02d',self.day);}
throw new Error('ValueError: No known conversion for '+m);}));},__eq__:function(other){return(this.year===other.year&&this.month===other.month&&this.day===other.day)?py.True:py.False;},replace:function(){var args=py.PY_parseArgs(arguments,[['year',py.None],['month',py.None],['day',py.None]]);var params={};for(var key in args){if(!args.hasOwnProperty(key)){continue;}
var arg=args[key];params[key]=(arg===py.None?this[key]:asJS(arg));}
return py.PY_call(datetime.date,params);},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
var s=tmxxx(this.year,this.month,this.day+other.days);return datetime.date.fromJSON(s.year,s.month,s.day);},__radd__:function(other){return this.__add__(other);},__sub__:function(other){if(py.PY_isInstance(other,datetime.timedelta)){return py.PY_add(this,py.PY_negative(other));}
if(py.PY_isInstance(other,datetime.date)){return py.PY_call(datetime.timedelta,[py.PY_subtract(py.PY_call(py.PY_getAttr(this,'toordinal')),py.PY_call(py.PY_getAttr(other,'toordinal')))]);}
return py.NotImplemented;},toordinal:function(){return py.float.fromJSON(ymd2ord(this.year,this.month,this.day));},weekday:function(){return py.float.fromJSON((this.toordinal().toJSON()+6)%7);},fromJSON:function(year,month,day){return py.PY_call(datetime.date,[year,month,day]);},today:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.date,[d.getFullYear(),d.getMonth()+1,d.getDate()]);}),});function context_today(){var d=new Date();return py.PY_call(datetime.date,[d.getFullYear(),d.getMonth()+1,d.getDate()]);}
datetime.time=py.type('time',null,{__init__:function(){var zero=py.float.fromJSON(0);var args=py.PY_parseArgs(arguments,[['hour',zero],['minute',zero],['second',zero],['microsecond',zero],['tzinfo',py.None]]);for(var k in args){if(!args.hasOwnProperty(k)){continue;}
this[k]=asJS(args[k]);}}});var time=py.PY_call(py.object);time.strftime=py.PY_def.fromJSON(function(){var args=py.PY_parseArgs(arguments,'format');var dt_class=py.PY_getAttr(datetime,'datetime');var d=py.PY_call(py.PY_getAttr(dt_class,'utcnow'));return py.PY_call(py.PY_getAttr(d,'strftime'),[args.format]);});var args=_.map(('year month day '
+'years months weeks days '
+'weekday leapdays yearday nlyearday').split(' '),function(arg){switch(arg){case'years':case'months':case'days':case'leapdays':case'weeks':return[arg,zero];case'year':case'month':case'day':case'weekday':case'yearday':case'nlyearday':return[arg,null];default:throw new Error("Unknown relativedelta argument "+arg);}});args.unshift('*');var _utils={monthrange:function(year,month){if(month<1||month>12){throw new Error("Illegal month "+month);}
var day1=this.weekday(year,month,1);var ndays=this.mdays[month]+(month==this.February&&this.isleap(year));return[day1,ndays];},weekday:function(year,month,day){var date=py.PY_call(datetime.date,[year,month,day]);return py.PY_call(py.PY_getAttr(date,'weekday'));},isleap:function(year){return year%4===0&&(year%100!==0||year%400===0)},mdays:[0,31,28,31,30,31,30,31,31,30,31,30,31],January:1,February:2};var relativedelta=py.type('relativedelta',null,{__init__:function(){this.ops=py.PY_parseArgs(arguments,args);this.ops.days=py.float.fromJSON(asJS(this.ops.days)+asJS(this.ops.weeks)*7);var yday=zero;if(this.ops.nlyearday){yday=this.ops.nlyearday;}else if(this.ops.yearday){yday=this.ops.yearday;if(asJS(this.ops.yearday)>59){this.ops.leapdays=py.float.fromJS(-1);}}
if(py.PY_isTrue(yday)){var ydayidx=[31,59,90,120,151,181,212,243,273,304,334,366];for(var idx=0;idx<ydayidx.length;++idx){var ydays=ydayidx[idx];if(asJS(yday)<=ydays){this.ops.month=py.float.fromJSON(idx+1);if(!idx){this.ops.day=yday;}else{this.ops.day=py.PY_subtract(yday,py.float.fromJSON(ydayidx[idx-1]));}
break;}}
if(idx===ydayidx.length){throw new Error("Invalid year day ("+asJS(yday)+")");}}
this._fix();},_fix:function(){var months=asJS(this.ops.months);if(Math.abs(months)>11){var s=months>0?1:-1;var r=utils.divmod(months*s,12);this.ops.months=py.float.fromJSON(r.mod*s);this.ops.years=py.float.fromJSON(asJS(this.ops.years)+r.div*s);}
this._has_time=0;},__add__:function(other){if(!py.PY_isInstance(other,datetime.date)){return py.NotImplemented;}
var year=(asJS(this.ops.year)||asJS(other.year))+asJS(this.ops.years);var month=asJS(this.ops.month)||asJS(other.month);var months;if(months=asJS(this.ops.months)){if(Math.abs(months)<1||Math.abs(months)>12){throw new Error("Can only use relative months between -12 and +12");}
month+=months;if(month>12){year+=1;month-=12;}
if(month<1){year-=1;month+=12;}}
var day=Math.min(_utils.monthrange(year,month)[1],asJS(this.ops.day)||asJS(other.day));var repl={year:py.float.fromJSON(year),month:py.float.fromJSON(month),day:py.float.fromJSON(day)};var days=asJS(this.ops.days);if(py.PY_isTrue(this.ops.leapdays)&&month>2&&_utils.isleap(year)){days+=asJS(this.ops.leapdays);}
var ret=py.PY_add(py.PY_call(py.PY_getAttr(other,'replace'),repl),py.PY_call(datetime.timedelta,{days:py.float.fromJSON(days)}));if(this.ops.weekday){var weekday=asJS(this.ops.weekday),nth=1;var jumpdays=(Math.abs(nth)-1)*7;var ret_weekday=asJS(py.PY_call(py.PY_getAttr(ret,'weekday')));if(nth>0){jumpdays+=(7-ret_weekday+weekday)%7;}else{jumpdays+=(ret_weekday-weekday)%7;jumpdays*=-1;}
ret=py.PY_add(ret,py.PY_call(datetime.timedelta,{days:py.float.fromJSON(jumpdays)}));}
return ret;},__radd__:function(other){return this.__add__(other);},__rsub__:function(other){return this.__neg__().__radd__(other);},__neg__:function(){return py.PY_call(relativedelta,{years:py.PY_negative(this.ops.years),months:py.PY_negative(this.ops.months),days:py.PY_negative(this.ops.days),leapdays:this.ops.leapdays,year:this.ops.year,month:this.ops.month,day:this.ops.day,weekday:this.ops.weekday});}});function wrap(value){if(value===null){return py.None;}
switch(typeof value){case'undefined':throw new Error("No conversion for undefined");case'boolean':return py.bool.fromJSON(value);case'number':return py.float.fromJSON(value);case'string':return py.str.fromJSON(value);}
switch(value.constructor){case Object:return wrapping_dict.fromJSON(value);case Array:return wrapping_list.fromJSON(value);}
throw new Error("ValueError: unable to wrap "+value);}
var wrapping_dict=py.type('wrapping_dict',null,{__init__:function(){this._store={};},__getitem__:function(key){var k=key.toJSON();if(!(k in this._store)){throw new Error("KeyError: '"+k+"'");}
return wrap(this._store[k]);},__getattr__:function(key){return this.__getitem__(py.str.fromJSON(key));},__len__:function(){return Object.keys(this._store).length},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},get:function(){var args=py.PY_parseArgs(arguments,['k',['d',py.None]]);if(!(args.k.toJSON()in this._store)){return args.d;}
return this.__getitem__(args.k);},fromJSON:function(d){var instance=py.PY_call(wrapping_dict);instance._store=d;return instance;},toJSON:function(){return this._store;},});var wrapping_list=py.type('wrapping_list',null,{__init__:function(){this._store=[];},__getitem__:function(index){return wrap(this._store[index.toJSON()]);},__len__:function(){return this._store.length;},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},fromJSON:function(ar){var instance=py.PY_call(wrapping_list);instance._store=ar;return instance;},toJSON:function(){return this._store;},});function wrap_context(context){for(var k in context){if(!context.hasOwnProperty(k)){continue;}
var val=context[k];if(val===null){continue;}
if(val.constructor===Array){context[k]=wrapping_list.fromJSON(val);}else if(val.constructor===Object&&!py.PY_isInstance(val,py.object)){context[k]=wrapping_dict.fromJSON(val);}}
return context;}
function eval_contexts(contexts,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});return _(contexts).reduce(function(result_context,ctx){if(_.isEmpty(ctx)){return result_context;}
if(_.isString(ctx)){ctx={__ref:'context',__debug:ctx};}
var evaluated=ctx;switch(ctx.__ref){case'context':evaluation_context.context=evaluation_context;evaluated=py.eval(ctx.__debug,wrap_context(evaluation_context));break;case'compound_context':var eval_context=eval_contexts([ctx.__eval_context]);evaluated=eval_contexts(ctx.__contexts,_.extend({},evaluation_context,eval_context));break;}
_.extend(evaluation_context,evaluated);return _.extend(result_context,evaluated);},{});}
function eval_domains(domains,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});var result_domain=[];_(domains).each(function(domain){if(_.isString(domain)){domain={__ref:'domain',__debug:domain};}
switch(domain.__ref){case'domain':evaluation_context.context=evaluation_context;result_domain.push.apply(result_domain,py.eval(domain.__debug,wrap_context(evaluation_context)));break;case'compound_domain':var eval_context=eval_contexts([domain.__eval_context]);result_domain.push.apply(result_domain,eval_domains(domain.__domains,_.extend({},evaluation_context,eval_context)));break;default:result_domain.push.apply(result_domain,domain);}});return result_domain;}
function eval_groupbys(contexts,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});var result_group=[];_(contexts).each(function(ctx){if(_.isString(ctx)){ctx={__ref:'context',__debug:ctx};}
var group;var evaluated=ctx;switch(ctx.__ref){case'context':evaluation_context.context=evaluation_context;evaluated=py.eval(ctx.__debug,wrap_context(evaluation_context));break;case'compound_context':var eval_context=eval_contexts([ctx.__eval_context]);evaluated=eval_contexts(ctx.__contexts,_.extend({},evaluation_context,eval_context));break;}
group=evaluated.group_by;if(!group){return;}
if(typeof group==='string'){result_group.push(group);}else if(group instanceof Array){result_group.push.apply(result_group,group);}else{throw new Error('Got invalid groupby {{'
+JSON.stringify(group)+'}}');}
_.extend(evaluation_context,evaluated);});return result_group;}
function pycontext(){return _.extend({datetime:datetime,context_today:context_today,time:time,relativedelta:relativedelta,current_date:py.PY_call(time.strftime,[py.str.fromJSON('%Y-%m-%d')]),},session.user_context);}
function pyeval(type,object,context,options){options=options||{};context=_.extend(pycontext(),context||{});switch(type){case'context':case'contexts':if(type==='context')
object=[object];return eval_contexts((options.no_user_context?[]:[session.user_context]).concat(object),context);case'domain':case'domains':if(type==='domain')
object=[object];return eval_domains(object,context);case'groupbys':return eval_groupbys(object,context);}
throw new Error("Unknow evaluation type "+type);}
function eval_arg(arg){if(typeof arg!=='object'||!arg.__ref){return arg;}
switch(arg.__ref){case'domain':case'compound_domain':return pyeval('domains',[arg]);case'context':case'compound_context':return pyeval('contexts',[arg]);default:throw new Error(_t("Unknown nonliteral type ")+' '+arg.__ref);}}
function ensure_evaluated(args,kwargs){for(var i=0;i<args.length;++i){args[i]=eval_arg(args[i]);}
for(var k in kwargs){if(!kwargs.hasOwnProperty(k)){continue;}
kwargs[k]=eval_arg(kwargs[k]);}}
function eval_domains_and_contexts(source){return new $.Deferred(function(d){setTimeout(function(){var result;try{result=sync_eval_domains_and_contexts(source);}
catch(e){result={error:{code:400,message:_t("Evaluation Error"),data:{type:'local_exception',debug:_.str.sprintf(_t("Local evaluation failure\n%s\n\n%s"),e.message,JSON.stringify(source))}}};}
d.resolve(result);},0);});}
function sync_eval_domains_and_contexts(source){var contexts=([session.user_context]||[]).concat(source.contexts);return{context:pyeval('contexts',contexts),domain:pyeval('domains',source.domains),group_by:pyeval('groupbys',source.group_by_seq||[])};}
function py_eval(expr,context){return py.eval(expr,_.extend({},context||{},{"true":true,"false":false,"null":null}));}
return{context:pycontext,ensure_evaluated:ensure_evaluated,eval:pyeval,eval_domains_and_contexts:eval_domains_and_contexts,sync_eval_domains_and_contexts:sync_eval_domains_and_contexts,py_eval:py_eval,};});;

/* /web/static/src/js/action_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.ActionManager',function(require){"use strict";var Bus=require('web.Bus');var ControlPanel=require('web.ControlPanel');var core=require('web.core');var crash_manager=require('web.crash_manager');var data=require('web.data');var data_manager=require('web.data_manager');var Dialog=require('web.Dialog');var framework=require('web.framework');var pyeval=require('web.pyeval');var session=require('web.session');var ViewManager=require('web.ViewManager');var Widget=require('web.Widget');var Action=core.Class.extend({init:function(action){this.action_descr=action;this.title=action.display_name||action.name;},restore:function(){if(this.on_reverse_breadcrumb_callback){return this.on_reverse_breadcrumb_callback();}},detach:function(){},destroy:function(){},set_on_reverse_breadcrumb:function(callback){this.on_reverse_breadcrumb_callback=callback;},set_scrollTop:function(){},set_fragment:function($fragment){this.$fragment=$fragment;},get_scrollTop:function(){return 0;},get_action_descr:function(){return this.action_descr;},get_breadcrumbs:function(){return{title:this.title,action:this};},get_nb_views:function(){return 0;},get_fragment:function(){return this.$fragment;},get_active_view:function(){return'';},});var WidgetAction=Action.extend({init:function(action,widget){this._super(action);this.widget=widget;if(!this.widget.get('title')){this.widget.set('title',this.title);}
this.widget.on('change:title',this,function(widget){this.title=widget.get('title');});},restore:function(){var self=this;return $.when(this._super()).then(function(){return self.widget.do_show();});},detach:function(){$('body > .nvtooltip').remove();return framework.detach([{widget:this.widget}]);},destroy:function(){this.widget.destroy();},});var ViewManagerAction=WidgetAction.extend({restore:function(view_index){var _super=this._super.bind(this);return this.widget.select_view(view_index).then(function(){return _super();});},set_on_reverse_breadcrumb:function(callback,scrollTop){this._super(callback);this.set_scrollTop(scrollTop);},set_scrollTop:function(scrollTop){this.widget.active_view.controller.set_scrollTop(scrollTop);},get_scrollTop:function(){return this.widget.active_view.controller.get_scrollTop();},get_breadcrumbs:function(){var self=this;return this.widget.view_stack.map(function(view,index){return{title:view.controller.get('title')||self.title,index:index,action:self,};});},get_nb_views:function(){return this.widget.view_stack.length;},get_active_view:function(){return this.widget.active_view.type;}});var ActionManager=Widget.extend({template:'ActionManager',on_attach_callback:function(){this.is_in_DOM=true;if(this.inner_widget&&this.inner_widget.on_attach_callback){this.inner_widget.on_attach_callback();}},on_detach_callback:function(){this.is_in_DOM=false;if(this.inner_widget&&this.inner_widget.on_detach_callback){this.inner_widget.on_detach_callback();}},init:function(parent,options){this._super(parent);this.action_stack=[];this.inner_action=null;this.inner_widget=null;this.webclient=options&&options.webclient;this.dialog=null;this.dialog_widget=null;this.on('history_back',this,this.proxy('history_back'));},start:function(){this._super();this.main_control_panel=new ControlPanel(this);this.main_control_panel.on("on_breadcrumb_click",this,_.debounce(function(action,index){this.select_action(action,index);},200,true));core.bus.on('DOM_updated',this,function(){if(this.inner_action){this.trigger_up('scrollTo',{offset:this.inner_action.get_scrollTop()||0});}});return this.main_control_panel.insertBefore(this.$el);},dialog_stop:function(reason){if(this.dialog){this.dialog.destroy(reason);}
this.dialog=null;},push_action:function(widget,action_descr,options){var self=this;var old_action_stack=this.action_stack;var old_action=this.inner_action;var old_widget=this.inner_widget;var actions_to_destroy;options=options||{};if(options.clear_breadcrumbs){actions_to_destroy=this.action_stack;this.action_stack=[];}else if(options.replace_last_action&&this.action_stack.length>0){actions_to_destroy=[this.action_stack.pop()];}
var new_action;if(widget instanceof ViewManager){new_action=new ViewManagerAction(action_descr,widget);}else if(widget instanceof Widget){new_action=new WidgetAction(action_descr,widget);}else{new_action=new Action(action_descr);}
if(this.webclient&&old_action){old_action.set_on_reverse_breadcrumb(options.on_reverse_breadcrumb,this.webclient.get_scrollTop());}
this.action_stack.push(new_action);this.inner_action=new_action;this.inner_widget=widget;if(widget.need_control_panel){widget.set_cp_bus(this.main_control_panel.get_bus());}
var new_widget_fragment=document.createDocumentFragment();return $.when(this.inner_widget.appendTo(new_widget_fragment)).done(function(){if(old_action){old_action.set_fragment(old_action.detach());}
if(!widget.need_control_panel){self.main_control_panel.do_hide();}
framework.append(self.$el,new_widget_fragment,{in_DOM:self.is_in_DOM,callbacks:[{widget:self.inner_widget}],});if(actions_to_destroy){self.clear_action_stack(actions_to_destroy);}
self.toggle_fullscreen();self.trigger_up('current_action_updated',{action:new_action});}).fail(function(){new_action.destroy();self.action_stack=old_action_stack;self.inner_action=old_action;self.inner_widget=old_widget;});},set_scrollTop:function(scrollTop){if(this.inner_action){this.inner_action.set_scrollTop(scrollTop);}},get_breadcrumbs:function(){return _.flatten(_.map(this.action_stack,function(action){return action.get_breadcrumbs();}),true);},get_title:function(){if(this.action_stack.length===1){var action=this.action_stack[0];if(action.get_breadcrumbs().length===1){return action.title;}}
var last_breadcrumb=_.last(this.get_breadcrumbs());return last_breadcrumb?last_breadcrumb.title:"";},get_action_stack:function(){return this.action_stack;},get_inner_action:function(){return this.inner_action;},get_inner_widget:function(){return this.inner_widget;},history_back:function(){var nb_views=this.inner_action.get_nb_views();if(nb_views>1){return this.select_action(this.inner_action,nb_views-2);}
if(this.action_stack.length>1){var action=this.action_stack[this.action_stack.length-2];nb_views=action.get_nb_views();return this.select_action(action,nb_views-1);}
return $.Deferred().reject();},select_action:function(action,index){var self=this;var def=this.webclient&&this.webclient.clear_uncommitted_changes()||$.when();return def.then(function(){var old_action=self.inner_action;var action_index=self.action_stack.indexOf(action);var to_destroy=self.action_stack.splice(action_index+1);self.inner_action=action;self.inner_widget=action.widget;return $.when(action.restore(index)).done(function(){if(!self.inner_widget.need_control_panel){self.main_control_panel.do_hide();}
if(action!==old_action){self.clear_action_stack(to_destroy);framework.append(self.$el,action.get_fragment(),{in_DOM:self.is_in_DOM,callbacks:[{widget:action.widget}],});}
self.trigger_up('current_action_updated',{action:action});});}).fail(function(){return $.Deferred().reject();});},clear_action_stack:function(action_stack){_.map(action_stack||this.action_stack,function(action){action.destroy();});if(!action_stack){this.action_stack=[];this.inner_action=null;this.inner_widget=null;}
this.toggle_fullscreen();},toggle_fullscreen:function(){var is_fullscreen=_.some(this.action_stack,function(action){return action.action_descr.target==="fullscreen";});this.trigger_up("toggle_fullscreen",{fullscreen:is_fullscreen});},do_push_state:function(state){if(!this.webclient||this.dialog){return;}
state=state||{};if(this.inner_action){var inner_action_descr=this.inner_action.get_action_descr();if(inner_action_descr._push_me===false){return;}
state.title=this.get_title();if(inner_action_descr.type=='ir.actions.act_window'){state.model=inner_action_descr.res_model;}
if(inner_action_descr.menu_id){state.menu_id=inner_action_descr.menu_id;}
if(inner_action_descr.id){state.action=inner_action_descr.id;}else if(inner_action_descr.type=='ir.actions.client'){state.action=inner_action_descr.tag;var params={};_.each(inner_action_descr.params,function(v,k){if(_.isString(v)||_.isNumber(v)){params[k]=v;}});state=_.extend(params||{},state);}
if(inner_action_descr.context){var active_id=inner_action_descr.context.active_id;if(active_id){state.active_id=active_id;}
var active_ids=inner_action_descr.context.active_ids;if(active_ids&&!(active_ids.length===1&&active_ids[0]===active_id)){state.active_ids=inner_action_descr.context.active_ids.join(',');}}}
this.webclient.do_push_state(state);},do_load_state:function(state,warm){var self=this;var action_loaded;if(state.action){if(_.isString(state.action)&&core.action_registry.contains(state.action)){var action_client={type:"ir.actions.client",tag:state.action,params:state,_push_me:state._push_me,};if(warm){this.null_action();}
action_loaded=this.do_action(action_client);}else{var run_action=(!this.inner_widget||!this.inner_widget.action)||this.inner_widget.action.id!==state.action;if(run_action){var add_context={};if(state.active_id){add_context.active_id=state.active_id;}
if(state.active_ids){add_context.active_ids=state.active_ids.toString().split(',').map(function(id){return parseInt(id,10)||id;});}else if(state.active_id){add_context.active_ids=[state.active_id];}
add_context.params=state;if(warm){this.null_action();}
action_loaded=this.do_action(state.action,{additional_context:add_context,res_id:state.id,view_type:state.view_type,});}}}else if(state.model&&state.id){if(warm){this.null_action();}
var action={res_model:state.model,res_id:state.id,type:'ir.actions.act_window',views:[[_.isNumber(state.view_id)?state.view_id:false,'form']]};action_loaded=this.do_action(action);}else if(state.sa){if(warm){this.null_action();}
action_loaded=this.rpc('/web/session/get_session_action',{key:state.sa}).then(function(action){if(action){return self.do_action(action);}});}
return $.when(action_loaded||null).done(function(){if(self.inner_widget&&self.inner_widget.do_load_state){return self.inner_widget.do_load_state(state,warm);}});},do_action:function(action,options){options=_.defaults(options||{},{clear_breadcrumbs:false,replace_last_action:false,on_reverse_breadcrumb:function(){},hide_breadcrumb:false,on_close:function(){},action_menu_id:null,additional_context:{},});if(action===false){action={type:'ir.actions.act_window_close'};}else if(_.isString(action)&&core.action_registry.contains(action)){var action_client={type:"ir.actions.client",tag:action,params:{}};return this.do_action(action_client,options);}else if(_.isNumber(action)||_.isString(action)){var self=this;var additional_context={active_id:options.additional_context.active_id,active_ids:options.additional_context.active_ids,active_model:options.additional_context.active_model};return data_manager.load_action(action,additional_context).then(function(result){return self.do_action(result,options);});}
core.bus.trigger('action',action);options.clear_breadcrumbs=(action.target==='main')||options.clear_breadcrumbs;var ncontext=new data.CompoundContext(options.additional_context,action.context||{});action.context=pyeval.eval('context',ncontext);if(action.context.active_id||action.context.active_ids){action.context.search_disable_custom_filters=true;}
if(action.domain){action.domain=pyeval.eval('domain',action.domain,action.context||{});}
if(!action.type){console.error("No type for action",action);return $.Deferred().reject();}
var type=action.type.replace(/\./g,'_');action.menu_id=options.action_menu_id;action.res_id=options.res_id||action.res_id;action.context.params=_.extend({'action':action.id},action.context.params);if(!(type in this)){console.error("Action manager can't handle action of type "+action.type,action);return $.Deferred().reject();}
if(action.res_model==='board.board'&&action.view_mode==='form'){action.target='inline';_.extend(action.flags,{headless:true,views_switcher:false,display_title:false,search_view:false,pager:false,sidebar:false,action_buttons:false});}else{var popup=action.target==='new';var inline=action.target==='inline'||action.target==='inlineview';var form=_.str.startsWith(action.view_mode,'form');action.flags=_.defaults(action.flags||{},{views_switcher:!popup&&!inline,search_view:!(popup&&form)&&!inline,action_buttons:!popup&&!inline,sidebar:!popup&&!inline,pager:(!popup||!form)&&!inline,display_title:!popup,headless:(popup||inline)&&form,search_disable_custom_filters:action.context&&action.context.search_disable_custom_filters,});}
return $.when(this[type](action,options)).then(function(){return action;});},null_action:function(){this.dialog_stop();this.clear_action_stack();},ir_actions_common:function(executor,options){var self=this;if(executor.action.target==='new'){var pre_dialog=(this.dialog&&!this.dialog.isDestroyed())?this.dialog:null;if(pre_dialog){pre_dialog.off('closed',null,pre_dialog.on_close);}
if(this.dialog_widget&&!this.dialog_widget.isDestroyed()){this.dialog_widget.destroy();}
this.dialog_stop(executor.action);this.dialog=new Dialog(this,{title:executor.action.name,dialogClass:executor.klass,buttons:[],size:executor.action.context.dialog_size,});this.dialog.on_close=function(){options.on_close.apply(null,arguments);if(pre_dialog&&pre_dialog.on_close){pre_dialog.on_close();}
if(!pre_dialog){self.dialog=null;}};this.dialog.on("closed",null,this.dialog.on_close);this.dialog_widget=executor.widget();if(this.dialog_widget instanceof ViewManager){_.extend(this.dialog_widget.flags,{$buttons:this.dialog.$footer,footer_to_buttons:true,});if(this.dialog_widget.action.view_mode==='form'){this.dialog_widget.flags.headless=true;}}
if(this.dialog_widget.need_control_panel){this.dialog_widget.set_cp_bus(new Bus());}
this.dialog_widget.setParent(this.dialog);var fragment=document.createDocumentFragment();return this.dialog_widget.appendTo(fragment).then(function(){self.dialog.open().$el.append(fragment);if(options.state&&self.dialog_widget.do_load_state){return self.dialog_widget.do_load_state(options.state);}}).then(function(){return executor.action;});}
var def=this.inner_action&&this.webclient&&this.webclient.clear_uncommitted_changes()||$.when();return def.then(function(){self.dialog_stop(executor.action);return self.push_action(executor.widget(),executor.action,options);}).fail(function(){return $.Deferred().reject();});},ir_actions_act_window:function(action,options){var self=this;var flags=action.flags||{};if(!('auto_search'in flags)){flags.auto_search=action.auto_search!==false;}
options.action=action;options.action_manager=this;var dataset=new data.DataSetSearch(this,action.res_model,action.context,action.domain);if(action.res_id){dataset.ids.push(action.res_id);dataset.index=0;}
var views=action.views;return this.ir_actions_common({widget:function(){return new ViewManager(self,dataset,views,flags,options);},action:action,klass:'o_act_window',},options);},ir_actions_client:function(action,options){var self=this;var ClientWidget=core.action_registry.get(action.tag);if(!ClientWidget){return self.do_warn("Action Error","Could not find client action '"+action.tag+"'.");}
if(!(ClientWidget.prototype instanceof Widget)){var next;if((next=ClientWidget(this,action))){return this.do_action(next,options);}
return $.when();}
return this.ir_actions_common({widget:function(){return new ClientWidget(self,action,options);},action:action,klass:'oe_act_client',},options).then(function(){if(action.tag!=='reload'){self.do_push_state({});}});},ir_actions_act_window_close:function(action,options){if(!this.dialog){options.on_close();}
this.dialog_stop();return $.when();},ir_actions_server:function(action,options){var self=this;return this.rpc('/web/action/run',{action_id:action.id,context:action.context||{}}).then(function(action){return self.do_action(action,options);});},ir_actions_report_xml:function(action,options){var self=this;framework.blockUI();action=_.clone(action);var eval_contexts=([session.user_context]||[]).concat([action.context]);action.context=pyeval.eval('contexts',eval_contexts);if(navigator.userAgent.match(/(iPod|iPhone|iPad)/)){var params={action:JSON.stringify(action),token:new Date().getTime()};var url=self.session.url('/web/report',params);framework.unblockUI();$('<a href="'+url+'" target="_blank"></a>')[0].click();return;}
var c=crash_manager;return $.Deferred(function(d){self.session.get_file({url:'/web/report',data:{action:JSON.stringify(action)},complete:framework.unblockUI,success:function(){if(!self.dialog){options.on_close();}
self.dialog_stop();d.resolve();},error:function(){c.rpc_error.apply(c,arguments);d.reject();}});});},ir_actions_act_url:function(action){var url=action.url;if(session.debug&&url&&url.length&&url[0]==='/'){url=$.param.querystring(url,{debug:session.debug});}
if(action.target==='self'){framework.redirect(url);return $.Deferred();}else{window.open(url,'_blank');}
return $.when();},});return ActionManager;});;

/* /web/static/src/js/control_panel.js defined in bundle 'web.assets_backend' */
odoo.define('web.ControlPanelMixin',function(require){"use strict";var ControlPanelMixin={need_control_panel:true,set_cp_bus:function(cp_bus){this.cp_bus=cp_bus;},update_control_panel:function(cp_status,options){this.cp_bus.trigger("update",cp_status||{},options||{});},};return ControlPanelMixin;});odoo.define('web.ControlPanel',function(require){"use strict";var Bus=require('web.Bus');var data=require('web.data');var Widget=require('web.Widget');var ControlPanel=Widget.extend({template:'ControlPanel',init:function(parent,template){this._super(parent);if(template){this.template=template;}
this.bus=new Bus();this.bus.on("update",this,this.update);},start:function(){this.nodes={$breadcrumbs:this.$('.breadcrumb'),$buttons:this.$('.o_cp_buttons'),$pager:this.$('.o_cp_pager'),$searchview:this.$('.o_cp_searchview'),$searchview_buttons:this.$('.o_search_options'),$sidebar:this.$('.o_cp_sidebar'),$switch_buttons:this.$('.o_cp_switch_buttons'),};this.$el.on('click.bs.dropdown','.o_search_options .dropdown-menu',function(e){e.stopPropagation();});this._toggle_visibility(false);return this._super();},destroy:function(){this._clear_breadcrumbs_handlers();return this._super.apply(this,arguments);},get_bus:function(){return this.bus;},update:function(status,options){this._toggle_visibility(!status.hidden);if(!status.hidden){options=_.defaults({},options,{clear:true,});var new_cp_content=status.cp_content||{};if(status.breadcrumbs){this._clear_breadcrumbs_handlers();this.$breadcrumbs=this._render_breadcrumbs(status.breadcrumbs);new_cp_content.$breadcrumbs=this.$breadcrumbs;}
if(options.clear){this._detach_content(this.nodes);this.nodes.$searchview_buttons.show();}else{this._detach_content(_.pick(this.nodes,_.keys(new_cp_content)));}
this._attach_content(new_cp_content);this._update_search_view(status.searchview,status.search_view_hidden);if(status.active_view_selector){this._update_switch_buttons(status.active_view_selector);}}},_toggle_visibility:function(visible){this.do_toggle(visible);if(!visible&&!this.$content){this.$content=this.$el.contents().detach();}else if(this.$content){this.$content.appendTo(this.$el);this.$content=null;}},_detach_content:function(elements_to_detach){_.each(elements_to_detach,function($nodeset){$nodeset.contents().detach();});},_attach_content:function(content){var self=this;_.each(content,function($nodeset,$element){if($nodeset&&self.nodes[$element]){self.nodes[$element].append($nodeset);}});},_update_switch_buttons:function(active_view_selector){_.each(this.nodes.$switch_buttons.find('button'),function(button){$(button).removeClass('active');});this.$(active_view_selector).addClass('active');},_render_breadcrumbs:function(breadcrumbs){var self=this;return breadcrumbs.map(function(bc,index){return self._render_breadcrumbs_li(bc,index,breadcrumbs.length);});},_render_breadcrumbs_li:function(bc,index,length){var self=this;var is_last=(index===length-1);var li_content=bc.title&&_.escape(bc.title.trim())||data.noDisplayContent;var $bc=$('<li>').append(is_last?li_content:$('<a>').html(li_content)).toggleClass('active',is_last);if(!is_last){$bc.click(function(){self.trigger("on_breadcrumb_click",bc.action,bc.index);});}
return $bc;},_clear_breadcrumbs_handlers:function(){if(this.$breadcrumbs){_.each(this.$breadcrumbs,function($bc){$bc.off();});}},_update_search_view:function(searchview,is_hidden){if(searchview){searchview.$buttons=this.nodes.$searchview_buttons;searchview.toggle_visibility(!is_hidden);}
this.nodes.$searchview.toggle(!is_hidden);this.$el.toggleClass('o_breadcrumb_full',!!is_hidden);},});return ControlPanel;});;

/* /web/static/src/js/view_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.ViewManager',function(require){"use strict";var ControlPanelMixin=require('web.ControlPanelMixin');var core=require('web.core');var data_manager=require('web.data_manager');var framework=require('web.framework');var Model=require('web.DataModel');var pyeval=require('web.pyeval');var SearchView=require('web.SearchView');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var ViewManager=Widget.extend(ControlPanelMixin,{className:"o_view_manager_content",on_attach_callback:function(){this.is_in_DOM=true;if(this.active_view&&this.active_view.controller.on_attach_callback){this.active_view.controller.on_attach_callback();}},on_detach_callback:function(){this.is_in_DOM=false;if(this.active_view&&this.active_view.controller.on_detach_callback){this.active_view.controller.on_detach_callback();}},init:function(parent,dataset,views,flags,options){var self=this;this._super(parent);this.action=options&&options.action||{};this.action_manager=options&&options.action_manager;this.flags=flags||{};this.dataset=dataset;this.view_order=[];this.views={};this.view_stack=[];this.active_view=null;this.registry=core.view_registry;this.title=this.action.name;_.each(views,function(view){var view_type=view[1]||view.view_type;var View=self.registry.get(view_type);if(!View){console.error("View type","'"+view_type+"'","is not present in the view registry.");return;}
var view_label=View.prototype.display_name;var view_descr={accesskey:View.prototype.accesskey,button_label:_.str.sprintf(_t('%(view_type)s view'),{'view_type':(view_label||view_type)}),controller:null,fields_view:view[2]||view.fields_view,icon:View.prototype.icon,label:view_label,mobile_friendly:View.prototype.mobile_friendly,multi_record:View.prototype.multi_record,options:view.options||{},require_fields:View.prototype.require_fields,title:self.title,type:view_type,view_id:view[0]||view.view_id,};self.view_order.push(view_descr);self.views[view_type]=view_descr;});this.first_view=this.views[options&&options.view_type];this.default_view=this.get_default_view();},willStart:function(){var views_def;var first_view_to_display=this.first_view||this.default_view;if(!first_view_to_display.fields_view||(this.flags.search_view&&!this.search_fields_view)){views_def=this.load_views(first_view_to_display.require_fields);}
return $.when(this._super(),views_def);},start:function(){var self=this;_.each(this.views,function(view){view.options=_.extend({action:self.action,},self.flags,self.flags[view.type],view.options);});if(this.flags.search_view){this.search_view_loaded=this.setup_search_view();}
if(this.flags.views_switcher){this.render_switch_buttons();}
if(this.first_view&&!this.first_view.multi_record&&this.default_view.multi_record){this.default_view.controller=this.create_view(this.default_view);this.view_stack.push(this.default_view);}
var view_to_load=this.first_view||this.default_view;var options=this.flags[view_to_load]&&this.flags[view_to_load].options;var main_view_loaded=this.switch_mode(view_to_load.type,options);return $.when(this._super(),main_view_loaded,this.search_view_loaded);},load_views:function(load_fields){var self=this;var views=[];_.each(this.views,function(view){if(!view.fields_view){views.push([view.view_id,view.type]);}});var options={action_id:this.action.id,load_fields:load_fields,toolbar:this.flags.sidebar,};if(this.flags.search_view&&!this.search_fields_view){options.load_filters=true;var searchview_id=this.action.search_view_id&&this.action.search_view_id[0];views.push([searchview_id||false,'search']);}
return data_manager.load_views(this.dataset,views,options).then(function(fields_views){_.each(fields_views,function(fields_view,view_type){if(view_type==='search'){self.search_fields_view=fields_view;}else{self.views[view_type].fields_view=fields_view;}});});},get_default_view:function(){return this.views[this.flags.default_view||this.view_order[0].type];},switch_mode:function(view_type,view_options){var self=this;var view=this.views[view_type];var old_view=this.active_view;if(!view||this.currently_switching){return $.Deferred().reject();}else{this.currently_switching=true;}
var views_def;if(!view.fields_view){views_def=this.load_views(view.require_fields);}
return $.when(views_def).then(function(){if(view.multi_record){self.view_stack=[];}else if(self.view_stack.length>0&&!(_.last(self.view_stack).multi_record)){self.view_stack.pop();}
self.view_stack.push(view);self.active_view=view;if(!view.loaded){if(!view.controller){view.controller=self.create_view(view,view_options);}
view.$fragment=$('<div>');view.loaded=view.controller.appendTo(view.$fragment).done(function(){view.$fragment=view.$fragment.contents();self.trigger("controller_inited",view.type,view.controller);});}
if(self.search_view_loaded&&self.flags.auto_search&&view.controller.searchable!==false){self.active_search=$.Deferred();$.when(self.search_view_loaded,view.loaded).done(function(){self.searchview.do_search();});}
return $.when(view.loaded,self.active_search).then(function(){return self._display_view(view_options,old_view).then(function(){self.trigger('switch_mode',view_type,view_options);});}).fail(function(e){if(!(e&&e.code===200&&e.data.exception_type)){self.do_warn(_t("Error"),view.controller.display_name+_t(" view couldn't be loaded"));}
self.active_view=old_view;self.view_stack.pop();});}).always(function(){self.currently_switching=false;});},_display_view:function(view_options,old_view){var self=this;var view_controller=this.active_view.controller;var view_fragment=this.active_view.$fragment;var view_control_elements=this.render_view_control_elements();return $.when(view_controller.do_show(view_options)).done(function(){var cp_status={active_view_selector:'.o_cp_switch_'+self.active_view.type,breadcrumbs:self.action_manager&&self.action_manager.get_breadcrumbs(),cp_content:_.extend({},self.searchview_elements,view_control_elements),hidden:self.flags.headless,searchview:self.searchview,search_view_hidden:view_controller.searchable===false||view_controller.searchview_hidden,};self.update_control_panel(cp_status);if(old_view&&old_view!==self.active_view){if(self.action_manager&&self.action_manager.webclient){old_view.controller.set_scrollTop(self.action_manager.webclient.get_scrollTop());}
var $to_detach=self.$el.contents().not('.ui-autocomplete');old_view.$fragment=framework.detach([{widget:old_view.controller}],{$to_detach:$to_detach});}
if(old_view&&old_view.controller.multi_record===true&&view_controller.multi_record===false){view_controller.set_scrollTop(0);}
framework.append(self.$el,view_fragment,{in_DOM:self.is_in_DOM,callbacks:[{widget:view_controller}],});});},create_view:function(view,view_options){var self=this;var js_class=view.fields_view.arch.attrs&&view.fields_view.arch.attrs.js_class;var View=this.registry.get(js_class||view.type);var options=_.clone(view.options);if(view.type==="form"&&((this.action.target==='new'||this.action.target==='inline')||(view_options&&view_options.mode==='edit'))){options.initial_mode=options.initial_mode||'edit';}
var controller=new View(this,this.dataset,view.fields_view,options);controller.on('switch_mode',this,this.switch_mode.bind(this));controller.on('history_back',this,function(){if(self.action_manager)self.action_manager.trigger('history_back');});controller.on("change:title",this,function(){if(self.action_manager&&!self.flags.headless){var breadcrumbs=self.action_manager.get_breadcrumbs();self.update_control_panel({breadcrumbs:breadcrumbs},{clear:false});}});return controller;},select_view:function(index){var view_type=this.view_stack[index].type;return this.switch_mode(view_type);},render_switch_buttons:function(){var self=this;var views=_.partition(this.view_order,function(view){return view.multi_record===true;});var multi_record_views=views[0];var mono_record_views=views[1];var _render_switch_buttons=function(views){if(views.length>1){var $switch_buttons=$(QWeb.render('ViewManager.switch-buttons',{views:views}));_.each(views,function(view){$switch_buttons.filter('.o_cp_switch_'+view.type).tooltip();});$switch_buttons.filter('button').click(_.debounce(function(event){var view_type=$(event.target).data('view-type');self.switch_mode(view_type);},200,true));return $switch_buttons;}};this.switch_buttons={};this.switch_buttons.$multi=_render_switch_buttons(multi_record_views);this.switch_buttons.$mono=_render_switch_buttons(mono_record_views);},render_view_control_elements:function(){if(!this.active_view.control_elements){var view_controller=this.active_view.controller;var $buttons=this.flags.$buttons;var elements={};if(!this.flags.headless){elements={$buttons:$("<div>"),$sidebar:$("<div>"),$pager:$("<div>"),};}
view_controller.render_buttons($buttons?$buttons.empty():elements.$buttons);view_controller.render_sidebar(elements.$sidebar);view_controller.render_pager(elements.$pager);elements=_.mapObject(elements,function($node){return $node&&$node.contents();});if(this.switch_buttons){if(this.active_view.multi_record){elements.$switch_buttons=this.switch_buttons.$multi;}else{elements.$switch_buttons=this.switch_buttons.$mono;}}
this.active_view.control_elements=elements;}
return this.active_view.control_elements;},setup_search_view:function(){var self=this;if(this.searchview){this.searchview.destroy();}
var search_defaults={};var context=this.action.context||[];_.each(context,function(value,key){var match=/^search_default_(.*)$/.exec(key);if(match){search_defaults[match[1]]=value;}});var options={hidden:this.flags.search_view===false,disable_custom_filters:this.flags.search_disable_custom_filters,$buttons:$("<div>"),action:this.action,search_defaults:search_defaults,};this.searchview=new SearchView(this,this.dataset,this.search_fields_view,options);this.searchview.on('search_data',this,this.search.bind(this));return $.when(this.searchview.appendTo($("<div>"))).done(function(){self.searchview_elements={};self.searchview_elements.$searchview=self.searchview.$el;self.searchview_elements.$searchview_buttons=self.searchview.$buttons.contents();});},search:function(domains,contexts,groupbys){var self=this;var controller=this.active_view.controller;var action_context=this.action.context||{};var view_context=controller.get_context();pyeval.eval_domains_and_contexts({domains:[this.action.domain||[]].concat(domains||[]),contexts:[action_context,view_context].concat(contexts||[]),group_by_seq:groupbys||[]}).done(function(results){if(results.error){self.active_search.resolve();throw new Error(_.str.sprintf(_t("Failed to evaluate search criterions")+": \n%s",JSON.stringify(results.error)));}
self.dataset._model=new Model(self.dataset.model,results.context,results.domain);var groupby=results.group_by.length?results.group_by:action_context.group_by;if(_.isString(groupby)){groupby=[groupby];}
if(!controller.grouped&&!_.isEmpty(groupby)){self.dataset.set_sort([]);}
$.when(controller.do_search(results.domain,results.context,groupby||[])).then(function(){self.active_search.resolve();});});},do_push_state:function(state){if(this.action_manager){state.view_type=this.active_view.type;this.action_manager.do_push_state(state);}},do_load_state:function(state,warm){if(state.view_type&&state.view_type!==this.active_view.type){this.switch_mode(state.view_type,true);}
this.active_view.controller.do_load_state(state,warm);},destroy:function(){if(this.control_elements){if(this.control_elements.$switch_buttons){this.control_elements.$switch_buttons.off();}}
return this._super.apply(this,arguments);},});return ViewManager;});;

/* /web/static/src/js/abstract_web_client.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractWebClient',function(require){"use strict";var ActionManager=require('web.ActionManager');var core=require('web.core');var crash_manager=require('web.crash_manager');var Loading=require('web.Loading');var NotificationManager=require('web.notification').NotificationManager;var session=require('web.session');var utils=require('web.utils');var Widget=require('web.Widget');var _t=core._t;var WebClient=Widget.extend({custom_events:{notification:function(e){if(this.notification_manager){this.notification_manager.notify(e.data.title,e.data.message,e.data.sticky);}},warning:function(e){if(this.notification_manager){this.notification_manager.warn(e.data.title,e.data.message,e.data.sticky);}},clear_uncommitted_changes:function(e){this.clear_uncommitted_changes().then(e.data.callback);},toggle_fullscreen:function(event){this.toggle_fullscreen(event.data.fullscreen);},current_action_updated:function(e){this.current_action_updated(e.data.action);},perform_rpc:function(event){if(event.data.on_fail){event.data.on_fail();}},perform_model_rpc:function(event){if(event.data.on_fail){event.data.on_fail();}},},init:function(parent){this.client_options={};this._super(parent);this.origin=undefined;this._current_state=null;this.menu_dm=new utils.DropMisordered();this.action_mutex=new utils.Mutex();this.set('title_part',{"zopenerp":"Odoo"});},start:function(){var self=this;this.on("change:title_part",this,this._title_changed);this._title_changed();return session.is_bound.then(function(){self.bind_events();return $.when(self.set_action_manager(),self.set_notification_manager(),self.set_loading());}).then(function(){if(session.session_is_valid()){return self.show_application();}else{return $.when();}}).then(function(){self.action_manager.$el.on('scroll',core.bus.trigger.bind(core.bus,'scroll'));core.bus.trigger('web_client_ready');});},bind_events:function(){var self=this;$('.oe_systray').show();this.$el.on('mouseenter','.oe_systray > div:not([data-toggle=tooltip])',function(){$(this).attr('data-toggle','tooltip').tooltip().trigger('mouseenter');});this.$el.on('click','.oe_dropdown_toggle',function(ev){ev.preventDefault();var $toggle=$(this);var doc_width=$(document).width();var $menu=$toggle.siblings('.oe_dropdown_menu');$menu=$menu.size()>=1?$menu:$toggle.find('.oe_dropdown_menu');var state=$menu.is('.oe_opened');setTimeout(function(){$toggle.add($menu).toggleClass('oe_opened',!state);if(!state){var offset=$menu.offset();var menu_width=$menu.width();var x=doc_width-offset.left-menu_width-2;if(x<0){$menu.offset({left:offset.left+x}).width(menu_width);}}},0);});core.bus.on('click',this,function(ev){$('.tooltip').remove();if(!$(ev.target).is('input[type=file]')){self.$('.oe_dropdown_menu.oe_opened, .oe_dropdown_toggle.oe_opened').removeClass('oe_opened');}});core.bus.on('connection_lost',this,this.on_connection_lost);core.bus.on('connection_restored',this,this.on_connection_restored);session.on('error',crash_manager,crash_manager.rpc_error);window.onerror=function(message,file,line,col,error){var traceback=error?error.stack:'';crash_manager.show_error({type:_t("Client Error"),message:message,data:{debug:file+':'+line+"\n"+_t('Traceback:')+"\n"+traceback}});};},set_action_manager:function(){this.action_manager=new ActionManager(this,{webclient:this});return this.action_manager.appendTo(this.$('.o_main_content'));},set_notification_manager:function(){this.notification_manager=new NotificationManager(this);return this.notification_manager.appendTo(this.$el);},set_loading:function(){this.loading=new Loading(this);return this.loading.appendTo(this.$el);},show_application:function(){},clear_uncommitted_changes:function(){var def=$.Deferred().resolve();core.bus.trigger('clear_uncommitted_changes',function chain_callbacks(callback){def=def.then(callback);});return def;},destroy_content:function(){_.each(_.clone(this.getChildren()),function(el){el.destroy();});this.$el.children().remove();},set_title:function(title){this.set_title_part("action",title);},set_title_part:function(part,title){var tmp=_.clone(this.get("title_part"));tmp[part]=title;this.set("title_part",tmp);},_title_changed:function(){var parts=_.sortBy(_.keys(this.get("title_part")),function(x){return x;});var tmp="";_.each(parts,function(part){var str=this.get("title_part")[part];if(str){tmp=tmp?tmp+" - "+str:str;}},this);document.title=tmp;},do_action:function(){return this.action_manager.do_action.apply(this,arguments);},do_reload:function(){var self=this;return this.session.session_reload().then(function(){session.load_modules(true).then(self.menu.proxy('do_reload'));});},do_push_state:function(state){if('title'in state){this.set_title(state.title);delete state.title;}
var url='#'+$.param(state);this._current_state=$.deparam($.param(state),false);$.bbq.pushState(url);this.trigger('state_pushed',state);},on_connection_lost:function(){this.connection_notification=this.notification_manager.notify(_t('Connection lost'),_t('Trying to reconnect...'),true);},on_connection_restored:function(){if(this.connection_notification){this.connection_notification.destroy();this.notification_manager.notify(_t('Connection restored'),_t('You are back online'),false);this.connection_notification=false;}},current_action_updated:function(){},get_scrollTop:function(){},toggle_fullscreen:function(fullscreen){this.$el.toggleClass('o_fullscreen',fullscreen);},});return WebClient;});;

/* /web/static/src/js/web_client.js defined in bundle 'web.assets_backend' */
odoo.define('web.WebClient',function(require){"use strict";var AbstractWebClient=require('web.AbstractWebClient');var core=require('web.core');var data=require('web.data');var data_manager=require('web.data_manager');var framework=require('web.framework');var Menu=require('web.Menu');var Model=require('web.DataModel');var session=require('web.session');var SystrayMenu=require('web.SystrayMenu');var UserMenu=require('web.UserMenu');return AbstractWebClient.extend({events:{'click .oe_logo_edit_admin':'logo_edit','click .oe_logo img':function(ev){ev.preventDefault();return this.clear_uncommitted_changes().then(function(){framework.redirect("/web"+(core.debug?"?debug":""));});},},show_application:function(){var self=this;this.action_manager.is_in_DOM=true;this.toggle_bars(true);this.set_title();this.update_logo();this.menu=new Menu(this);this.menu.setElement(this.$el.parents().find('.oe_application_menu_placeholder'));this.menu.on('menu_click',this,this.on_menu_action);this.user_menu=new UserMenu(this);var $user_menu_placeholder=$('body').find('.oe_user_menu_placeholder').show();var user_menu_loaded=this.user_menu.appendTo($user_menu_placeholder);this.systray_menu=new SystrayMenu(this);this.systray_menu.setElement(this.$el.parents().find('.oe_systray'));var systray_menu_loaded=this.systray_menu.start();return $.when(systray_menu_loaded,user_menu_loaded).then(function(){self.menu.start();self.bind_hashchange();});},toggle_bars:function(value){this.$('tr:has(td.navbar),.oe_leftbar').toggle(value);},update_logo:function(reload){var company=session.company_id;var img=session.url('/web/binary/company_logo'+'?db='+session.db+(company?'&company='+company:''));this.$('.o_sub_menu_logo img').attr('src','').attr('src',img+(reload?"#"+Date.now():''));this.$('.oe_logo_edit').toggleClass('oe_logo_edit_admin',session.is_superuser);},logo_edit:function(ev){var self=this;ev.preventDefault();self.alive(new Model("res.users").call("read",[[session.uid],["company_id"]])).then(function(data){self.rpc("/web/action/load",{action_id:"base.action_res_company_form"}).done(function(result){result.res_id=data[0].company_id[0];result.target="new";result.views=[[false,'form']];result.flags={action_buttons:true,headless:true,};self.action_manager.do_action(result).then(function(){var form=self.action_manager.dialog_widget.views.form.controller;form.on("on_button_cancel",self.action_manager,self.action_manager.dialog_stop);form.on('record_saved',self,function(){self.action_manager.dialog_stop();self.update_logo();});});});});return false;},bind_hashchange:function(){var self=this;$(window).bind('hashchange',this.on_hashchange);var state=$.bbq.getState(true);if(_.isEmpty(state)||state.action==="login"){self.menu.is_bound.done(function(){new Model("res.users").call("read",[[session.uid],["action_id"]]).done(function(result){var data=result[0];if(data.action_id){self.action_manager.do_action(data.action_id[0]);self.menu.open_action(data.action_id[0]);}else{var first_menu_id=self.menu.$el.find("a:first").data("menu");if(first_menu_id){self.menu.menu_click(first_menu_id);}}});});}else{$(window).trigger('hashchange');}},on_hashchange:function(event){if(this._ignore_hashchange){this._ignore_hashchange=false;return;}
var self=this;this.clear_uncommitted_changes().then(function(){var stringstate=event.getState(false);if(!_.isEqual(self._current_state,stringstate)){var state=event.getState(true);if(!state.action&&state.menu_id){self.menu.is_bound.done(function(){self.menu.menu_click(state.menu_id);});}else{state._push_me=false;self.action_manager.do_load_state(state,!!self._current_state).then(function(){var action=self.action_manager.get_inner_action();if(action){self.menu.open_action(action.action_descr.id);}});}}
self._current_state=stringstate;},function(){if(event){self._ignore_hashchange=true;window.location=event.originalEvent.oldURL;}});},on_menu_action:function(options){var self=this;return this.menu_dm.add(data_manager.load_action(options.action_id)).then(function(result){return self.action_mutex.exec(function(){if(options.needaction){result.context=new data.CompoundContext(result.context,{search_default_message_needaction:true,search_disable_custom_filters:true,});}
var completed=$.Deferred();$.when(self.action_manager.do_action(result,{clear_breadcrumbs:true,action_menu_id:self.menu.current_menu,})).fail(function(){self.menu.open_menu(options.previous_menu_id);}).always(function(){completed.resolve();});setTimeout(function(){completed.resolve();},2000);return completed;});});},toggle_fullscreen:function(fullscreen){this._super(fullscreen);if(!fullscreen){this.menu.reflow();}},});});;

/* /web/static/src/js/framework/data.js defined in bundle 'web.assets_backend' */
odoo.define('web.data',function(require){"use strict";var Class=require('web.Class');var mixins=require('web.mixins');var Model=require('web.Model');var session=require('web.session');var translation=require('web.translation');var pyeval=require('web.pyeval');var utils=require('web.utils');var _t=translation._t;function serialize_sort(criterion){return _.map(criterion,function(criteria){if(criteria[0]==='-'){return criteria.slice(1)+' DESC';}
return criteria+' ASC';}).join(', ');}
function deserialize_sort(criterion){return _.map(criterion,function(criteria){var split=_.without(criteria.split(' '),'');return(split[1]&&split[1].toLowerCase()==='desc'?'-':'')+split[0];});}
var Query=Class.extend({init:function(model,fields){this._model=model;this._fields=fields;this._filter=[];this._context={};this._lazy=true;this._limit=false;this._offset=0;this._order_by=[];},clone:function(to_set){to_set=to_set||{};var q=new Query(this._model,this._fields);q._context=this._context;q._filter=this._filter;q._lazy=this._lazy;q._limit=this._limit;q._offset=this._offset;q._order_by=this._order_by;for(var key in to_set){if(!to_set.hasOwnProperty(key)){continue;}
switch(key){case'filter':q._filter=new CompoundDomain(q._filter,to_set.filter);break;case'context':q._context=new CompoundContext(q._context,to_set.context);break;case'lazy':case'limit':case'offset':case'order_by':q['_'+key]=to_set[key];}}
return q;},_execute:function(options){var self=this;options=options||{};return session.rpc('/web/dataset/search_read',{model:this._model.name,fields:this._fields||false,domain:pyeval.eval('domains',[this._model.domain(this._filter)]),context:pyeval.eval('contexts',[this._model.context(this._context)]),offset:this._offset,limit:this._limit,sort:serialize_sort(this._order_by)},options).then(function(results){self._count=results.length;return results.records;},null);},first:function(options){var self=this;return this.clone({limit:1})._execute(options).then(function(records){delete self._count;if(records.length){return records[0];}
return null;});},all:function(options){return this._execute(options);},count:function(){if(this._count!==undefined){return $.when(this._count);}
return this._model.call('search_count',[this._filter],{context:this._model.context(this._context)});},group_by:function(grouping){var ctx=pyeval.eval('context',this._model.context(this._context));if(_.isUndefined(grouping)){grouping=[];}
if(!(grouping instanceof Array)){grouping=_.toArray(arguments);}
if(_.isEmpty(grouping)&&!ctx.group_by_no_leaf){return null;}
var raw_fields=_.map(grouping.concat(this._fields||[]),function(field){return field.split(':')[0];});var self=this;return this._model.call('read_group',{groupby:grouping,fields:_.uniq(raw_fields),domain:this._model.domain(this._filter),context:ctx,offset:this._offset,lazy:this._lazy,limit:this._limit,orderby:serialize_sort(this._order_by)||false}).then(function(results){return _(results).map(function(result){result.__context=result.__context||{};result.__context.group_by=result.__context.group_by||[];_.defaults(result.__context,ctx);var grouping_fields=self._lazy?[grouping[0]]:grouping;return new QueryGroup(self._model.name,grouping_fields,result);});});},context:function(context){if(!context){return this;}
return this.clone({context:context});},filter:function(domain){if(!domain){return this;}
return this.clone({filter:domain});},lazy:function(lazy){return this.clone({lazy:lazy});},limit:function(limit){return this.clone({limit:limit});},offset:function(offset){return this.clone({offset:offset});},order_by:function(fields){if(fields===undefined){return this;}
if(!(fields instanceof Array)){fields=_.toArray(arguments);}
if(_.isEmpty(fields)){return this;}
return this.clone({order_by:fields});}});var QueryGroup=Class.extend({init:function(model,grouping_fields,read_group_group){var fixed_group=_.extend({__context:{group_by:[]},__domain:[]},read_group_group);var count_key=(grouping_fields[0]&&grouping_fields[0].split(':')[0])+'_count';var aggregates={};_(fixed_group).each(function(value,key){if(key.indexOf('__')===0||_.contains(grouping_fields,key)||(key===count_key)){return;}
aggregates[key]=value||0;});this.model=new Model(model,fixed_group.__context,fixed_group.__domain);var group_size=fixed_group[count_key]||fixed_group.__count||0;var leaf_group=fixed_group.__context.group_by.length===0;var value=(grouping_fields.length===1)?fixed_group[grouping_fields[0]]:_.map(grouping_fields,function(field){return fixed_group[field];});var grouped_on=(grouping_fields.length===1)?grouping_fields[0]:grouping_fields;this.attributes={folded:!!(fixed_group.__fold),grouped_on:grouped_on,length:group_size,value:value,has_children:!(leaf_group&&fixed_group.__context.group_by_no_leaf),aggregates:aggregates};},get:function(key){return this.attributes[key];},subgroups:function(){return this.model.query().group_by(this.model.context().group_by);},query:function(){return this.model.query.apply(this.model,arguments);}});var DataSet=Class.extend(mixins.PropertiesMixin,{init:function(parent,model,context){mixins.PropertiesMixin.init.call(this);this.model=model;this.context=context||{};this.index=null;this._sort=[];this._model=new Model(model,context);this.orderer=new utils.DropMisordered();},previous:function(){this.index-=1;if(!this.ids.length){this.index=null;}else if(this.index<0){this.index=this.ids.length-1;}
return this;},next:function(){this.index+=1;if(!this.ids.length){this.index=null;}else if(this.index>=this.ids.length){this.index=0;}
return this;},select_id:function(id){var idx=this.get_id_index(id);if(idx===null){return false;}else{this.index=idx;return true;}},get_id_index:function(id){for(var i=0,ii=this.ids.length;i<ii;i++){if(id==this.ids[i]){return i;}}
return null;},read_ids:function(ids,fields,options){if(_.isEmpty(ids))
return $.Deferred().resolve([]);options=options||{};var method='read';var ids_arg=ids;var context=this.get_context(options.context);if(options.check_access_rule===true){method='search_read';ids_arg=[['id','in',ids]];context=new CompoundContext(context,{active_test:false});}
return this._model.call(method,[ids_arg,fields||false],{context:context}).then(function(records){if(records.length<=1){return records;}
var indexes={};for(var i=0;i<ids.length;i++){indexes[ids[i]]=i;}
records.sort(function(a,b){return indexes[a.id]-indexes[b.id];});return records;});},read_slice:function(fields,options){var self=this;options=options||{};var query=this._model.query(fields).limit(options.limit||false).offset(options.offset||0).all();return this.orderer.add(query).done(function(records){self.ids=_(records).pluck('id');});},read_index:function(fields,options){options=options||{};return this.read_ids([this.ids[this.index]],fields,options).then(function(records){if(_.isEmpty(records)){return $.Deferred().reject().promise();}
return records[0];});},default_get:function(fields,options){options=options||{};return this._model.call('default_get',[fields],{context:this.get_context(options.context)});},create:function(data,options){var self=this;return this._model.call('create',[data],{context:this.get_context()}).done(function(){self.trigger('dataset_changed',data,options);});},write:function(id,data,options){options=options||{};var self=this;return this._model.call('write',[[id],data],{context:this.get_context(options.context)}).done(function(){self.trigger('dataset_changed',id,data,options);});},unlink:function(ids){var self=this;return this._model.call('unlink',[ids],{context:this.get_context()}).done(function(){self.trigger('dataset_changed',ids);});},call:function(method,args){return this._model.call(method,args);},call_button:function(method,args){return this._model.call_button(method,args);},name_get:function(ids){return this._model.call('name_get',[ids],{context:this.get_context()});},name_search:function(name,domain,operator,limit){return this._model.call('name_search',{name:name||'',args:domain||false,operator:operator||'ilike',context:this._model.context(),limit:limit||0});},name_create:function(name,context){return this._model.call('name_create',[name],{context:this.get_context(context)});},exec_workflow:function(id,signal){return this._model.exec_workflow(id,signal);},get_context:function(request_context){return this._model.context(request_context);},sort:function(field,force_reverse){if(!field){return serialize_sort(this._sort);}
var reverse=force_reverse||(this._sort[0]===field);this._sort.splice.apply(this._sort,[0,this._sort.length].concat(_.without(this._sort,field,'-'+field)));this._sort.unshift((reverse?'-':'')+field);return undefined;},set_sort:function(fields_list){this._sort=deserialize_sort(fields_list);},size:function(){return this.ids.length;},alter_ids:function(n_ids){this.ids=n_ids;},remove_ids:function(ids){this.alter_ids(_(this.ids).difference(ids));},add_ids:function(ids,at){var args=[at,0].concat(_.difference(ids,this.ids));this.ids.splice.apply(this.ids,args);},resequence:function(ids,options){options=options||{};return session.rpc('/web/dataset/resequence',{model:this.model,ids:ids,context:pyeval.eval('context',this.get_context(options.context)),}).then(function(results){return results;});},});var DataSetStatic=DataSet.extend({init:function(parent,model,context,ids){this._super(parent,model,context);this.ids=ids||[];},read_slice:function(fields,options){options=options||{};fields=fields||{};var offset=options.offset||0,limit=options.limit||false;var end_pos=limit&&limit!==-1?offset+limit:this.ids.length;return this.read_ids(this.ids.slice(offset,end_pos),fields,options);},set_ids:function(ids){this.ids=ids;if(ids.length===0){this.index=null;}else if(this.index>=ids.length-1){this.index=ids.length-1;}},unlink:function(ids){this.set_ids(_.without.apply(null,[this.ids].concat(ids)));this.trigger('unlink',ids);return $.Deferred().resolve({result:true});},});var DataSetSearch=DataSet.extend({init:function(parent,model,context,domain){this._super(parent,model,context);this.domain=domain||[];this._length=null;this.ids=[];this._model=new Model(model,context,domain);},read_slice:function(fields,options){options=options||{};var self=this;var q=this._model.query(fields||false).filter(options.domain).context(options.context).offset(options.offset||0).limit(options.limit||false);q=q.order_by.apply(q,this._sort);return this.orderer.add(q.all()).done(function(records){q.count().done(function(count){self._length=count;});self.ids=_(records).pluck('id');});},get_domain:function(other_domain){return this._model.domain(other_domain);},alter_ids:function(ids){this._super(ids);if(this.index!==null&&this.index>=this.ids.length){this.index=this.ids.length>0?this.ids.length-1:0;}},remove_ids:function(ids){var before=this.ids.length;this._super(ids);if(this._length){this._length-=(before-this.ids.length);}},add_ids:function(ids,at){var before=this.ids.length;this._super(ids,at);if(this._length){this._length+=(this.ids.length-before);}},unlink:function(ids,callback,error_callback){var self=this;return this._super(ids).done(function(){self.remove_ids(ids);self.trigger("dataset_changed",ids,callback,error_callback);});},size:function(){if(this._length!==null){return this._length;}
return this._super();}});var BufferedDataSet=DataSetStatic.extend({virtual_id_prefix:"one2many_v_id_",debug_mode:true,init:function(){this._super.apply(this,arguments);this.reset_ids([]);this.last_default_get={};this.running_reads=[];this.mutex=new utils.Mutex();},default_get:function(fields,options){var self=this;return this._super(fields,options).done(function(res){self.last_default_get=_.clone(res);});},get_cache:function(id){if(!this.cache[id]){this.cache[id]={'id':id,'values':{},'from_read':{},'changes':{},'readonly_fields':{},'to_create':false,'to_delete':false};}
return this.cache[id];},_update_cache:function(id,options){var cached=this.get_cache(id);if(options){_.extend(cached.from_read,options.from_read);_.extend(cached.changes,options.changes);_.extend(cached.readonly_fields,options.readonly_fields);if(options.to_create!==undefined)cached.to_create=options.to_create;if(options.to_delete!==undefined)cached.to_delete=options.to_delete;}
cached.values=_.extend({'id':id},cached.from_read,cached.changes,cached.readonly_fields);return cached;},create:function(data,options){var changes=_.extend({},this.last_default_get,data);var cached=this._update_cache(_.uniqueId(this.virtual_id_prefix),_.extend({'changes':changes,'to_create':true},options));this.trigger("dataset_changed",data,options);return $.Deferred().resolve(cached.id);},write:function(id,data,options){var self=this;var cached=this.get_cache(id);cached.to_delete=false;var def=$.Deferred();this.mutex.exec(function(){var dirty=false;for(var k in data){if(!_.isEqual(data[k],cached.values[k])){dirty=true;if(_.isEqual(data[k],cached.from_read[k])){delete cached.changes[k];}else{cached.changes[k]=data[k];}}else{delete data[k];}}
self._update_cache(id,options);if(dirty){self.trigger("dataset_changed",id,data,options);}
return def.resolve(data).promise();});return def;},unlink:function(ids,callback,error_callback){var self=this;_.each(ids,function(id){self.get_cache(id).to_delete=true;});this.set_ids(_.difference(this.ids,_.pluck(_.filter(this.cache,function(c){return c.to_delete;}),'id')));this.trigger("dataset_changed",ids,callback,error_callback);return utils.async_when({result:true}).done(callback);},reset_ids:function(ids,options){var self=this;this.set_ids(ids);if(!options||!options.keep_read_data){this.cache={};}else{_.each(this.cache,function(cache){self._update_cache(cache.id,{'changes':{},'to_delete':false});});}
this.delete_all=false;this.cancel_read();},cancel_read:function(){_.invoke(_.clone(this.running_reads),'reject');},read_ids:function(ids,fields,options){var self=this;var to_get=_.filter(ids,function(id){var cache=self.get_cache(id);return!cache.to_create&&_.any(fields,function(x){return cache.from_read[x]===undefined;});});options=options||{};var return_records=function(){var records=_.map(ids,function(id){return _.clone(self.get_cache(id).values);});if(self.debug_mode){if(_.include(records,undefined)){throw"Record not correctly loaded";}}
var sort_fields=self._sort,compare=function(v1,v2){return(v1<v2)?-1:(v1>v2)?1:0;};if(sort_fields.length){records.sort(function(a,b){return _.reduce(sort_fields,function(acc,field){if(acc){return acc;}
var sign=1;if(field[0]==='-'){sign=-1;field=field.slice(1);}
if(!a[field]&&a[field]!==0){return sign;}
if(!b[field]&&b[field]!==0){return(sign==-1)?1:-1;}
if(_.isArray(a[field])&&a[field].length==2&&_.isString(a[field][1])){return sign*compare(a[field][1],b[field][1]);}
return sign*compare(a[field],b[field]);},0);});}
return $.when(records);};if(to_get.length>0){var def=$.Deferred();self.running_reads.push(def);def.always(function(){self.running_reads=_.without(self.running_reads,def);});var _super=this._super;this.mutex.exec(function(){if(def.state()!=="pending")return;_super.call(self,to_get,fields,options).then(_.bind(def.resolve,def),_.bind(def.reject,def));return def;});return def.then(function(records){_.each(records,function(record,index){var id=to_get[index];self._update_cache(id,_.extend(options,{'from_read':record}));});return return_records();});}else{return return_records();}},evict_record:function(id){this.get_cache(id).from_read={};this._update_cache(id);},call_button:function(method,args){this.evict_record(args[0][0]);return this._super(method,args);},exec_workflow:function(id,signal){this.evict_record(id);return this._super(id,signal);},alter_ids:function(n_ids,options){var dirty=!_.isEqual(this.ids,n_ids);this._super(n_ids,options);if(dirty){this.trigger("dataset_changed",n_ids,options);}},});BufferedDataSet.virtual_id_regex=/^one2many_v_id_.*$/;var ProxyDataSet=DataSetSearch.extend({init:function(){this._super.apply(this,arguments);this.create_function=null;this.write_function=null;this.read_function=null;this.default_get_function=null;this.unlink_function=null;},read_ids:function(ids,fields,options){if(this.read_function){return this.read_function(ids,fields,options,this._super);}else{return this._super.apply(this,arguments);}},default_get:function(fields,options){if(this.default_get_function){return this.default_get_function(fields,options,this._super);}else{return this._super.apply(this,arguments);}},create:function(data,options){if(this.create_function){return this.create_function(data,options,this._super);}else{return this._super.apply(this,arguments);}},write:function(id,data,options){if(this.write_function){return this.write_function(id,data,options,this._super);}else{return this._super.apply(this,arguments);}},unlink:function(ids){if(this.unlink_function){return this.unlink_function(ids,this._super);}else{return this._super.apply(this,arguments);}},});var CompoundContext=Class.extend({init:function(){this.__ref="compound_context";this.__contexts=[];this.__eval_context=null;var self=this;_.each(arguments,function(x){self.add(x);});},add:function(context){this.__contexts.push(context);return this;},set_eval_context:function(eval_context){this.__eval_context=eval_context;return this;},get_eval_context:function(){return this.__eval_context;},eval:function(){return pyeval.eval('context',this,undefined,{no_user_context:true});},});var CompoundDomain=Class.extend({init:function(){this.__ref="compound_domain";this.__domains=[];this.__eval_context=null;var self=this;_.each(arguments,function(x){self.add(x);});},add:function(domain){this.__domains.push(domain);return this;},set_eval_context:function(eval_context){this.__eval_context=eval_context;return this;},get_eval_context:function(){return this.__eval_context;},eval:function(){return pyeval.eval('domain',this);},});function compute_domain(expr,fields){if(!(expr instanceof Array))
return!!expr;var stack=[];for(var i=expr.length-1;i>=0;i--){var ex=expr[i];if(ex.length==1){var top=stack.pop();switch(ex){case'|':stack.push(stack.pop()||top);continue;case'&':stack.push(stack.pop()&&top);continue;case'!':stack.push(!top);continue;default:throw new Error(_.str.sprintf(_t("Unknown operator %s in domain %s"),ex,JSON.stringify(expr)));}}
var field=fields[ex[0]];if(!field){throw new Error(_.str.sprintf(_t("Unknown field %s in domain %s"),ex[0],JSON.stringify(expr)));}
var field_value=field.get_value?field.get_value():field.value;var op=ex[1];var val=ex[2];switch(op.toLowerCase()){case'=':case'==':stack.push(_.isEqual(field_value,val));break;case'!=':case'<>':stack.push(!_.isEqual(field_value,val));break;case'<':stack.push(field_value<val);break;case'>':stack.push(field_value>val);break;case'<=':stack.push(field_value<=val);break;case'>=':stack.push(field_value>=val);break;case'in':if(!_.isArray(val))val=[val];stack.push(_(val).contains(field_value));break;case'not in':if(!_.isArray(val))val=[val];stack.push(!_(val).contains(field_value));break;default:console.warn(_t("Unsupported operator %s in domain %s"),op,JSON.stringify(expr));}}
return _.all(stack,_.identity);}
return{Query:Query,DataSet:DataSet,DataSetStatic:DataSetStatic,DataSetSearch:DataSetSearch,BufferedDataSet:BufferedDataSet,ProxyDataSet:ProxyDataSet,CompoundContext:CompoundContext,CompoundDomain:CompoundDomain,compute_domain:compute_domain,noDisplayContent:"<em class=\"text-warning\">"+_t("Unnamed")+"</em>",};});;

/* /web/static/src/js/compatibility.js defined in bundle 'web.assets_backend' */
odoo.define('web.compatibility',function(require){"use strict";var ActionManager=require('web.ActionManager');var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var FavoriteMenu=require('web.FavoriteMenu');var form_common=require('web.form_common');var formats=require('web.formats');var FormView=require('web.FormView');var form_relational=require('web.form_relational');var form_widgets=require('web.form_widgets');var framework=require('web.framework');var ListView=require('web.ListView');var Model=require('web.DataModel');var pyeval=require('web.pyeval');var Registry=require('web.Registry');var SearchView=require('web.SearchView');var session=require('web.session');var Sidebar=require('web.Sidebar');var SystrayMenu=require('web.SystrayMenu');var time=require('web.time');var UserMenu=require('web.UserMenu');var utils=require('web.utils');var View=require('web.View');var ViewManager=require('web.ViewManager');var WebClient=require('web.WebClient');var Widget=require('web.Widget');var client_started=$.Deferred();var OldRegistry=Registry.extend({add:function(key,path){},get_object:function(key){return get_object(this.map[key]);},});window.openerp=window.openerp||{};$.Mutex=utils.Mutex;openerp._session_id="instance0";openerp._t=core._t;openerp.get_cookie=utils.get_cookie;openerp.qweb=core.qweb;openerp.session=session;openerp.web=openerp.web||{};openerp.web._t=core._t;openerp.web._lt=core._lt;openerp.web.ActionManager=ActionManager;openerp.web.auto_str_to_date=time.auto_str_to_date;openerp.web.blockUI=framework.blockUI;openerp.web.BufferedDataSet=data.BufferedDataSet;openerp.web.bus=core.bus;openerp.web.Class=core.Class;openerp.web.client_actions=make_old_registry(core.action_registry);openerp.web.CompoundContext=data.CompoundContext;openerp.web.CompoundDomain=data.CompoundDomain;openerp.web.DataSetSearch=data.DataSetSearch;openerp.web.DataSet=data.DataSet;openerp.web.date_to_str=time.date_to_str;openerp.web.Dialog=Dialog;openerp.web.DropMisordered=utils.DropMisordered;openerp.web.form=openerp.web.form||{};openerp.web.form.AbstractField=form_common.AbstractField;openerp.web.form.compute_domain=data.compute_domain;openerp.web.form.DefaultFieldManager=form_common.DefaultFieldManager;openerp.web.form.FieldChar=core.form_widget_registry.get('char');openerp.web.form.FieldFloat=core.form_widget_registry.get('float');openerp.web.form.FieldStatus=core.form_widget_registry.get('statusbar');openerp.web.form.FieldMany2ManyTags=core.form_widget_registry.get('many2many_tags');openerp.web.form.FieldMany2One=core.form_widget_registry.get('many2one');openerp.web.form.FormWidget=form_common.FormWidget;openerp.web.form.tags=make_old_registry(core.form_tag_registry);openerp.web.form.widgets=make_old_registry(core.form_widget_registry);openerp.web.form.custom_widgets=make_old_registry(core.form_custom_registry);openerp.web.format_value=formats.format_value;openerp.web.FormView=FormView;openerp.web.json_node_to_xml=utils.json_node_to_xml;openerp.web.ListView=ListView;openerp.web.Model=Model;openerp.web.normalize_format=time.strftime_to_moment_format;openerp.web.py_eval=pyeval.py_eval;openerp.web.pyeval=pyeval;openerp.web.qweb=core.qweb;openerp.web.Registry=OldRegistry;openerp.web.search={};openerp.web.search.FavoriteMenu=FavoriteMenu;openerp.web.SearchView=SearchView;openerp.web.Sidebar=Sidebar;openerp.web.str_to_date=time.str_to_date;openerp.web.str_to_datetime=time.str_to_datetime;openerp.web.SystrayItems=SystrayMenu.Items;openerp.web.unblockUI=framework.unblockUI;openerp.web.UserMenu=UserMenu;openerp.web.View=View;openerp.web.ViewManager=ViewManager;openerp.web.views=make_old_registry(core.view_registry);openerp.web.WebClient=WebClient;openerp.web.Widget=Widget;openerp.Widget=openerp.web.Widget;openerp.Widget.prototype.session=session;WebClient.include({init:function(){openerp.client=this;openerp.webclient=this;start_modules();client_started.resolve();this._super.apply(this,arguments);},});function make_old_registry(registry){return{add:function(key,path){client_started.done(function(){registry.add(key,get_object(path));});},};}
function get_object(path){var object_match=openerp;path=path.split('.');for(var i=1;i<path.length;++i){object_match=object_match[path[i]];}
return object_match;}
var inited=false;function start_modules(modules){if(modules===undefined){modules=odoo._modules;}
modules=_.without(modules,"web");if(inited){throw new Error("OpenERP was already inited");}
inited=true;for(var i=0;i<modules.length;i++){var fct=openerp[modules[i]];if(typeof(fct)==="function"){openerp[modules[i]]={};for(var k in fct){openerp[modules[i]][k]=fct[k];}
fct(openerp,openerp[modules[i]]);}}
openerp._modules=['web'].concat(modules);return openerp;};ListView.include({willStart:function(){if(this.fields_view.arch.attrs.colors){this.colors=_(this.fields_view.arch.attrs.colors.split(';')).chain().compact().map(function(color_pair){var pair=color_pair.split(':'),color=pair[0],expr=pair[1];return[color,py.parse(py.tokenize(expr)),expr];}).value();}
if(this.fields_view.arch.attrs.fonts){this.fonts=_(this.fields_view.arch.attrs.fonts.split(';')).chain().compact().map(function(font_pair){var pair=font_pair.split(':'),font=pair[0],expr=pair[1];return[font,py.parse(py.tokenize(expr)),expr];}).value();}
return this._super();},style_for:function(record){var len,style='';var context=_.extend({},record.attributes,{uid:session.uid,current_date:moment().format('YYYY-MM-DD')});var i;var pair;var expression;if(this.fonts){for(i=0,len=this.fonts.length;i<len;++i){pair=this.fonts[i];var font=pair[0];expression=pair[1];if(py.PY_isTrue(py.evaluate(expression,context))){switch(font){case'bold':style+='font-weight: bold;';break;case'italic':style+='font-style: italic;';break;case'underline':style+='text-decoration: underline;';break;}}}}
if(!this.colors){return style;}
for(i=0,len=this.colors.length;i<len;++i){pair=this.colors[i];var color=pair[0];expression=pair[1];if(py.PY_isTrue(py.evaluate(expression,context))){return style+='color: '+color+';';}}
return style;},});if(typeof(console)==="undefined"){window.console={};('log error debug info warn assert clear dir dirxml trace group'
+' groupCollapsed groupEnd time timeEnd profile profileEnd count'
+' exception').split(/\s+/).forEach(function(property){console[property]=_.identity;});}
if(!('placeholder'in document.createElement('input'))){document.addEventListener("DOMNodeInserted",function(event){var nodename=event.target.nodeName.toLowerCase();if(nodename==="input"||nodename==="textarea"){$(event.target).placeholder();}});}});;

/* /web/static/src/js/framework/misc.js defined in bundle 'web.assets_backend' */
odoo.define('web.framework',function(require){"use strict";var core=require('web.core');var crash_manager=require('web.crash_manager');var ajax=require('web.ajax');var Widget=require('web.Widget');var _t=core._t;var messages_by_seconds=function(){return[[0,_t("Loading...")],[20,_t("Still loading...")],[60,_t("Still loading...<br />Please be patient.")],[120,_t("Don't leave yet,<br />it's still loading...")],[300,_t("You may not believe it,<br />but the application is actually loading...")],[420,_t("Take a minute to get a coffee,<br />because it's loading...")],[3600,_t("Maybe you should consider reloading the application by pressing F5...")]];};var Throbber=Widget.extend({template:"Throbber",start:function(){this.start_time=new Date().getTime();this.act_message();},act_message:function(){var self=this;setTimeout(function(){if(self.isDestroyed())
return;var seconds=(new Date().getTime()-self.start_time)/1000;var mes;_.each(messages_by_seconds(),function(el){if(seconds>=el[0])
mes=el[1];});self.$(".oe_throbber_message").html(mes);self.act_message();},1000);},});if($.blockUI){$.blockUI.defaults.baseZ=1100;$.blockUI.defaults.message='<div class="openerp oe_blockui_spin_container" style="background-color: transparent;">';$.blockUI.defaults.css.border='0';$.blockUI.defaults.css["background-color"]='';}
var throbbers=[];function blockUI(){var tmp=$.blockUI.apply($,arguments);var throbber=new Throbber();throbbers.push(throbber);throbber.appendTo($(".oe_blockui_spin_container"));$('body').addClass('o_ui_blocked');return tmp;}
function unblockUI(){_.invoke(throbbers,'destroy');throbbers=[];$('body').removeClass('o_ui_blocked');return $.unblockUI.apply($,arguments);}
function redirect(url,wait){crash_manager.disable();var load=function(){var old=""+window.location;var old_no_hash=old.split("#")[0];var url_no_hash=url.split("#")[0];location.assign(url);if(old_no_hash===url_no_hash){location.reload(true);}};var wait_server=function(){ajax.rpc("/web/webclient/version_info",{}).done(load).fail(function(){setTimeout(wait_server,250);});};if(wait){setTimeout(wait_server,1000);}else{load();}}
function Reload(parent,action){var params=action.params||{};var menu_id=params.menu_id||false;var l=window.location;var sobj=$.deparam(l.search.substr(1));if(params.url_search){sobj=_.extend(sobj,params.url_search);}
var search='?'+$.param(sobj);var hash=l.hash;if(menu_id){hash="#menu_id="+menu_id;}
var url=l.protocol+"//"+l.host+l.pathname+search+hash;redirect(url,params.wait);}
core.action_registry.add("reload",Reload);function Home(parent,action){var url='/'+(window.location.search||'');redirect(url,action&&action.params&&action.params.wait);}
core.action_registry.add("home",Home);function HistoryBack(parent){parent.history_back().fail(function(){Home(parent);});}
core.action_registry.add("history_back",HistoryBack);function login(){redirect('/web/login');}
core.action_registry.add("login",login);function logout(){redirect('/web/session/logout');return $.Deferred();}
core.action_registry.add("logout",logout);function ReloadContext(parent,action){ajax.rpc("/web/session/get_session_info",{}).then(function(){Reload(parent,action);});}
core.action_registry.add("reload_context",ReloadContext);if('nv'in window){nv.dev=false;nv.utils.onWindowResize=function(fun){if(fun===null)return;window.addEventListener('resize',fun);};nv.utils.windowResize=nv.utils.onWindowResize;nv.utils.offWindowResize=function(fun){if(fun===null)return;window.removeEventListener('resize',fun);};nv.tooltip.cleanup=function(){$('.nvtooltip').remove();};var originalCalcTooltipPosition=nv.tooltip.calcTooltipPosition;nv.tooltip.calcTooltipPosition=function(){var container=originalCalcTooltipPosition.apply(this,arguments);container.style.top=container.style.top.split('px')[0]<0?0+'px':container.style.top;return container;};}
$.fn.tooltip.Constructor.DEFAULTS.placement='auto top';$.fn.tooltip.Constructor.DEFAULTS.html=true;$.fn.tooltip.Constructor.DEFAULTS.trigger='hover focus click';$.fn.tooltip.Constructor.DEFAULTS.container='body';$.fn.tooltip.Constructor.DEFAULTS.delay={show:1000,hide:0};var bootstrap_show_function=$.fn.tooltip.Constructor.prototype.show;$.fn.modal.Constructor.prototype.enforceFocus=function(){};$.fn.tooltip.Constructor.prototype.show=function(){$('.tooltip').remove();var e=$.Event('show.bs.'+this.type);var inDom=$.contains(document.documentElement,this.$element[0]);if(e.isDefaultPrevented()||!inDom)return;return bootstrap_show_function.call(this);};jQuery.expr[":"].Contains=jQuery.expr.createPseudo(function(arg){return function(elem){return jQuery(elem).text().toUpperCase().indexOf(arg.toUpperCase())>=0;};});$.fn.getAttributes=function(){var o={};if(this.length){for(var attr,i=0,attrs=this[0].attributes,l=attrs.length;i<l;i++){attr=attrs.item(i);o[attr.nodeName]=attr.value;}}
return o;};$.fn.openerpClass=function(additionalClass){additionalClass=additionalClass||'';if(!!$.browser.msie){additionalClass+=' openerp_ie';}
return this.each(function(){$(this).addClass('openerp '+additionalClass);});};$.fn.openerpBounce=function(){return this.each(function(){$(this).css('box-sizing','content-box').effect('bounce',{distance:18,times:5},250);});};var proto=$.ui.autocomplete.prototype,initSource=proto._initSource;function filter(array,term){var matcher=new RegExp($.ui.autocomplete.escapeRegex(term),"i");return $.grep(array,function(value_){return matcher.test($("<div>").html(value_.label||value_.value||value_).text());});}
$.extend(proto,{_initSource:function(){if(this.options.html&&$.isArray(this.options.source)){this.source=function(request,response){response(filter(this.options.source,request.term));};}else{initSource.call(this);}},_renderItem:function(ul,item){return $("<li></li>").data("item.autocomplete",item).append($("<a></a>")[this.options.html?"html":"text"](item.label)).appendTo(ul).addClass(item.classname);}});function _notify(content,callbacks){_.each(callbacks,function(c){if(c.widget&&c.widget.on_attach_callback){c.widget.on_attach_callback(c.callback_args);}});core.bus.trigger('DOM_updated',content);}
function append($target,content,options){$target.append(content);if(options&&options.in_DOM){_notify(content,options.callbacks);}}
function prepend($target,content,options){$target.prepend(content);if(options&&options.in_DOM){_notify(content,options.callbacks);}}
function detach(to_detach,options){_.each(to_detach,function(d){if(d.widget.on_detach_callback){d.widget.on_detach_callback(d.callback_args);}});var $to_detach=options&&options.$to_detach;if(!$to_detach){$to_detach=$(_.map(to_detach,function(d){return d.widget.el;}));}
return $to_detach.detach();}
function getPosition(e){var position={left:0,top:0};while(e){position.left+=e.offsetLeft;position.top+=e.offsetTop;e=e.offsetParent;}
return position;}
return{blockUI:blockUI,unblockUI:unblockUI,redirect:redirect,append:append,prepend:prepend,detach:detach,getPosition:getPosition,};});odoo.define('web.IFrameWidget',function(require){"use strict";var Widget=require('web.Widget');var IFrameWidget=Widget.extend({tagName:'iframe',init:function(parent,url){this._super(parent);this.url=url;},start:function(){this.$el.css({height:'100%',width:'100%',border:0});this.$el.attr({src:this.url});this.$el.on("load",this.bind_events.bind(this));return this._super();},bind_events:function(){this.$el.contents().click(this.iframe_clicked.bind(this));},iframe_clicked:function(e){}});return IFrameWidget;});;

/* /web/static/src/js/framework/crash_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.CrashManager',function(require){"use strict";var ajax=require('web.ajax');var core=require('web.core');var Dialog=require('web.Dialog');var QWeb=core.qweb;var _t=core._t;var _lt=core._lt;var map_title={user_error:_lt('Warning'),warning:_lt('Warning'),access_error:_lt('Access Error'),missing_error:_lt('Missing Record'),validation_error:_lt('Validation Error'),except_orm:_lt('Global Business Error'),access_denied:_lt('Access Denied'),};var CrashManager=core.Class.extend({init:function(){this.active=true;},enable:function(){this.active=true;},disable:function(){this.active=false;},rpc_error:function(error){var self=this;if(!this.active){return;}
if(this.connection_lost){return;}
if(error.code==-32098){core.bus.trigger('connection_lost');this.connection_lost=true;var timeinterval=setInterval(function(){ajax.jsonRpc('/web/webclient/version_info').then(function(){clearInterval(timeinterval);core.bus.trigger('connection_restored');self.connection_lost=false;});},2000);return;}
var handler=core.crash_registry.get(error.data.name,true);if(handler){new(handler)(this,error).display();return;}
if(error.data.name==="openerp.http.SessionExpiredException"||error.data.name==="werkzeug.exceptions.Forbidden"){this.show_warning({type:"Session Expired",data:{message:_t("Your Odoo session expired. Please refresh the current web page.")}});return;}
if(_.has(map_title,error.data.exception_type)){if(error.data.exception_type=='except_orm'){if(error.data.arguments[1]){error=_.extend({},error,{data:_.extend({},error.data,{message:error.data.arguments[1],title:error.data.arguments[0]!=='Warning'?(" - "+error.data.arguments[0]):'',})});}
else{error=_.extend({},error,{data:_.extend({},error.data,{message:error.data.arguments[0],title:'',})});}}
else{error=_.extend({},error,{data:_.extend({},error.data,{message:error.data.arguments[0],title:map_title[error.data.exception_type]!=='Warning'?(" - "+map_title[error.data.exception_type]):'',})});}
this.show_warning(error);}else{this.show_error(error);}},show_warning:function(error){if(!this.active){return;}
new Dialog(this,{size:'medium',title:"Odoo "+(_.str.capitalize(error.type)||_t("Warning")),subtitle:error.data.title,$content:$('<div>').html(QWeb.render('CrashManager.warning',{error:error}))}).open();},show_error:function(error){if(!this.active){return;}
new Dialog(this,{title:"Odoo "+_.str.capitalize(error.type),$content:QWeb.render('CrashManager.error',{error:error})}).open();},show_message:function(exception){this.show_error({type:_t("Client Error"),message:exception,data:{debug:""}});},});var ExceptionHandler={init:function(parent,error){},display:function(){},};var RedirectWarningHandler=Dialog.extend(ExceptionHandler,{init:function(parent,error){this._super(parent);this.error=error;},display:function(){var self=this;var error=this.error;error.data.message=error.data.arguments[0];new Dialog(this,{size:'medium',title:"Odoo "+(_.str.capitalize(error.type)||"Warning"),buttons:[{text:error.data.arguments[2],classes:"btn-primary",click:function(){window.location.href='#action='+error.data.arguments[1];self.destroy();}},{text:_t("Cancel"),click:function(){self.destroy();},close:true}],$content:QWeb.render('CrashManager.warning',{error:error}),}).open();}});core.crash_registry.add('openerp.exceptions.RedirectWarning',RedirectWarningHandler);return CrashManager;});;

/* /web/static/src/js/framework/data_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.DataManager',function(require){"use strict";var core=require('web.core');var Model=require('web.DataModel');var session=require('web.session');var utils=require('web.utils');function traverse(tree,f){if(f(tree)){_.each(tree.children,function(c){traverse(c,f);});}}
return core.Class.extend({init:function(){this.Filters=new Model('ir.filters');this._init_cache();},_init_cache:function(){this._cache={actions:{},fields_views:{},fields:{},filters:{},views:{},};},invalidate:function(){this._init_cache();},load_action:function(action_id,additional_context){var self=this;var key=this._gen_key(action_id,additional_context||{});if(!this._cache.actions[key]){this._cache.actions[key]=session.rpc("/web/action/load",{action_id:action_id,additional_context:additional_context,}).then(function(action){self._cache.actions[key]=action.no_cache?null:self._cache.actions[key];return action;},this._invalidate.bind(this,this._cache.actions,key));}
return this._cache.actions[key].then(function(action){return $.extend(true,{},action);});},load_views:function(dataset,views_descr,options){var self=this;var model=dataset.model;var context=dataset.get_context();var key=this._gen_key(model,views_descr,options||{},context);if(!this._cache.views[key]){options.load_fields=options.load_fields&&!this._cache.fields[model];var filters_key;if(options.load_filters){filters_key=this._gen_key(model,options.action_id);options.load_filters=!this._cache.filters[filters_key];}
this._cache.views[key]=dataset.call('load_views',{views:views_descr,options:options,context:context,}).then(function(result){result.fields_views=_.mapObject(result.fields_views,self._postprocess_fvg.bind(self));_.each(views_descr,function(view_descr){var toolbar=options.toolbar&&view_descr[1]!=='search';var fv_key=self._gen_key(model,view_descr[0],view_descr[1],toolbar,context);self._cache.fields_views[fv_key]=$.when(result.fields_views[view_descr[1]]);});if(result.filters){self._cache.filters[filters_key]=$.when(result.filters);}
if(result.fields){self._cache.fields[model]=$.when(result.fields);}
return result.fields_views;},this._invalidate.bind(this,this._cache.views,key));}
return this._cache.views[key];},load_fields_view:function(dataset,view_id,view_type,toolbar){var key=this._gen_key(dataset.model,view_id,view_type,toolbar,dataset.get_context());if(!this._cache.fields_views[key]){this._cache.fields_views[key]=dataset.call('fields_view_get',{view_id:view_id,view_type:view_type,toolbar:toolbar,context:dataset.get_context(),}).then(this._postprocess_fvg.bind(this),this._invalidate.bind(this,this._cache.fields_views,key));}
return this._cache.fields_views[key];},load_fields:function(dataset){if(!this._cache.fields[dataset.model]){this._cache.fields[dataset.model]=dataset.call('fields_get',{context:dataset.get_context(),}).fail(this._invalidate.bind(this,this._cache.fields,dataset.model));}
return this._cache.fields[dataset.model];},load_filters:function(dataset,action_id){var key=this._gen_key(dataset.model,action_id);if(!this._cache.filters[key]){this._cache.filters[key]=this.Filters.call('get_filters',[dataset.model,action_id],{context:dataset.get_context(),}).fail(this._invalidate.bind(this,this._cache.filters,key));}
return this._cache.filters[key];},create_filter:function(filter){var self=this;return this.Filters.call('create_or_replace',[filter]).then(function(filter_id){var key=[filter.model_id,filter.action_id||false,].join(',');self._invalidate(self._cache.filters,key);return filter_id;});},delete_filter:function(filter){var self=this;return this.Filters.call('unlink',[filter.id]).then(function(){self._cache.filters={};});},_postprocess_fvg:function(fields_view){var self=this;var doc=$.parseXML(fields_view.arch).documentElement;var fields=fields_view.fields;fields_view.arch=utils.xml_to_json(doc,(doc.nodeName.toLowerCase()!=='kanban'));traverse(fields_view.arch,function(node){if(typeof node==='string'){return false;}
if(node.tag==='field'){fields[node.attrs.name].__attrs=node.attrs;if(fields[node.attrs.name].type==='many2one'){if(node.attrs.widget==='statusbar'||node.attrs.widget==='radio'){fields[node.attrs.name].__fetch_status=true;}else if(node.attrs.widget==='selection'){fields[node.attrs.name].__fetch_selection=true;}}
if(node.attrs.widget==='many2many_checkboxes'){fields[node.attrs.name].__fetch_many2manys=true;}
return false;}
return node.tag!=='arch';});if('id'in fields_view.fields){var id_field=fields_view.fields.id;id_field.original_type=id_field.type;id_field.type='id';}
_.each(fields_view.fields,function(field){_.each(field.views||{},function(view){self._postprocess_fvg(view);});});return fields_view;},_gen_key:function(){return _.map(Array.prototype.slice.call(arguments),function(arg){if(!arg){return false;}
return _.isObject(arg)?JSON.stringify(arg):arg;}).join(',');},_invalidate:function(cache,key){delete cache[key];},});});;

/* /web/static/src/js/services/crash_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.crash_manager',function(require){"use strict";var CrashManager=require('web.CrashManager');return new CrashManager();});;

/* /web/static/src/js/services/data_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.data_manager',function(require){"use strict";var DataManager=require('web.DataManager');var data_manager=new DataManager();return data_manager;});;

/* /web/static/src/js/services/session.js defined in bundle 'web.assets_backend' */
odoo.define('web.session',function(require){"use strict";var Session=require('web.Session');var modules=odoo._modules;var session=new Session(undefined,undefined,{modules:modules,use_cors:false});session.is_bound=session.session_bind();return session;});;

/* /web/static/src/js/widgets/auto_complete.js defined in bundle 'web.assets_backend' */
odoo.define('web.AutoComplete',function(require){"use strict";var Widget=require('web.Widget');return Widget.extend({template:"SearchView.autocomplete",init:function(parent,options){this._super(parent);this.$input=parent.$el;this.source=options.source;this.select=options.select;this.get_search_string=options.get_search_string;this.current_result=null;this.searching=true;this.search_string='';this.current_search=null;},start:function(){var self=this;this.$input.on('keyup',function(ev){if(ev.which===$.ui.keyCode.RIGHT){self.searching=true;ev.preventDefault();return;}
if(ev.which===$.ui.keyCode.ENTER){if(self.search_string.length){self.select_item(ev);}
return;}
var search_string=self.get_search_string();if(self.search_string!==search_string){if(search_string.length){self.search_string=search_string;self.initiate_search(search_string);}else{self.close();}}});this.$input.on('keypress',function(ev){self.search_string=self.search_string+String.fromCharCode(ev.which);if(self.search_string.length){self.searching=true;var search_string=self.search_string;self.initiate_search(search_string);}else{self.close();}});this.$input.on('keydown',function(ev){switch(ev.which){case $.ui.keyCode.ENTER:case $.ui.keyCode.TAB:if(self.search_string.length){self.select_item(ev);}
break;case $.ui.keyCode.DOWN:self.move('down');self.searching=false;ev.preventDefault();break;case $.ui.keyCode.UP:self.move('up');self.searching=false;ev.preventDefault();break;case $.ui.keyCode.RIGHT:self.searching=false;var current=self.current_result;if(current&&current.expand&&!current.expanded){self.expand();self.searching=true;}
ev.preventDefault();break;case $.ui.keyCode.ESCAPE:self.close();self.searching=false;break;}});},initiate_search:function(query){if(query===this.search_string&&query!==this.current_search){this.search(query);}},search:function(query){var self=this;this.current_search=query;this.source({term:query},function(results){if(results.length){self.render_search_results(results);self.focus_element(self.$('li:first-child'));}else{self.close();}});},render_search_results:function(results){var self=this;var $list=this.$el;$list.empty();results.forEach(function(result){var $item=self.make_list_item(result).appendTo($list);result.$el=$item;});this.show();},make_list_item:function(result){var self=this;var $li=$('<li>').hover(function(){self.focus_element($li);}).mousedown(function(ev){if(ev.button===0){self.select(ev,{item:{facet:result.facet}});self.close();}}).data('result',result);if(result.expand){var $expand=$('<a class="o-expand" href="#">').appendTo($li);$expand.mousedown(function(ev){ev.stopPropagation();ev.preventDefault();if(result.expanded){self.fold();}else{self.expand();}});$expand.click(function(ev){ev.preventDefault();});result.expanded=false;}
if(result.indent)$li.addClass('o-indent');$li.append($('<a href="#">').html(result.label));return $li;},expand:function(){var self=this;var current_result=this.current_result;current_result.expand(this.get_search_string()).then(function(results){(results||[{label:'(no result)'}]).reverse().forEach(function(result){result.indent=true;var $li=self.make_list_item(result);current_result.$el.after($li);});self.current_result.expanded=true;self.current_result.$el.find('a.o-expand').removeClass('o-expand').addClass('o-expanded');});},fold:function(){var $next=this.current_result.$el.next();while($next.hasClass('o-indent')){$next.remove();$next=this.current_result.$el.next();}
this.current_result.expanded=false;this.current_result.$el.find('a.o-expanded').removeClass('o-expanded').addClass('o-expand');},focus_element:function($li){this.$('li').removeClass('o-selection-focus');$li.addClass('o-selection-focus');this.current_result=$li.data('result');},select_item:function(ev){if(this.current_result.facet){this.select(ev,{item:{facet:this.current_result.facet}});this.close();}},show:function(){this.$el.show();},close:function(){this.current_search=null;this.search_string='';this.searching=true;this.$el.hide();},move:function(direction){var $next;if(direction==='down'){$next=this.$('li.o-selection-focus').next();if(!$next.length)$next=this.$('li').first();}else{$next=this.$('li.o-selection-focus').prev();if(!$next.length)$next=this.$('li').last();}
this.focus_element($next);},is_expandable:function(){return!!this.$('.o-selection-focus .o-expand').length;},});});;

/* /web/static/src/js/widgets/change_password.js defined in bundle 'web.assets_backend' */
odoo.define('web.ChangePassword',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var Widget=require('web.Widget');var web_client=require('web.web_client');var _t=core._t;var ChangePassword=Widget.extend({template:"ChangePassword",start:function(){var self=this;web_client.set_title(_t("Change Password"));var $button=self.$('.oe_form_button');$button.appendTo(this.getParent().$footer);$button.eq(1).click(function(){self.$el.parents('.modal').modal('hide');});$button.eq(0).click(function(){self.rpc("/web/session/change_password",{'fields':$("form[name=change_password_form]").serializeArray()}).done(function(result){if(result.error){self.display_error(result);return;}else{self.do_action('logout');}});});},display_error:function(error){return new Dialog(this,{size:'medium',title:error.title,$content:$('<div>').html(error.error)}).open();},});core.action_registry.add("change_password",ChangePassword);return ChangePassword;});;

/* /web/static/src/js/widgets/debug_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.DebugManager',function(require){"use strict";var ActionManager=require('web.ActionManager');var common=require('web.form_common');var core=require('web.core');var Dialog=require('web.Dialog');var formats=require('web.formats');var framework=require('web.framework');var Model=require('web.Model');var session=require('web.session');var SystrayMenu=require('web.SystrayMenu');var utils=require('web.utils');var ViewManager=require('web.ViewManager');var WebClient=require('web.WebClient');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var ADD=function(id){return[4,id,false];},REMOVE=function(id){return[3,id,false];};var DebugManager=Widget.extend({template:"WebClient.DebugManager",events:{"click a[data-action]":"perform_callback","mouseover .o_debug_dropdowns > li:not(.open)":function(e){var $opened=this.$('.o_debug_dropdowns > li.open');if($opened.length){$opened.removeClass('open');$(e.currentTarget).addClass('open').find('> a').focus();}},},init:function(){this._super.apply(this,arguments);this._update_stats=_.throttle(this._update_stats.bind(this),1000/15,{leading:false});this._events=null;if(document.querySelector('meta[name=debug]')){this._events=[];}},start:function(){core.bus.on('rpc:result',this,function(req,resp){this._debug_events(resp.debug);});this.on('update-stats',this,this._update_stats);var init;if((init=document.querySelector('meta[name=debug]'))){this._debug_events(JSON.parse(init.getAttribute('value')));}
this.$dropdown=this.$(".o_debug_dropdown");this._features_group=null;this._has_features=false;this._is_admin=session.is_admin;return $.when(new Model('res.users').call('check_access_rights',{operation:'write',raise_exception:false}),session.user_has_group('base.group_no_one'),new Model('ir.model.data').call('xmlid_to_res_id',{xmlid:'base.group_no_one'}),this._super()).then(function(can_write_user,has_group_no_one,group_no_one_id){this._features_group=can_write_user&&group_no_one_id;this._has_features=has_group_no_one;return this.update();}.bind(this));},leave_debug_mode:function(){var qs=$.deparam.querystring();delete qs.debug;window.location.search='?'+$.param(qs);},perform_callback:function(evt){evt.preventDefault();var params=$(evt.target).data();var callback=params.action;if(callback&&this[callback]){this[callback](params,evt);}else{console.warn("No handler for ",callback);}},_debug_events:function(events){if(!this._events){return;}
if(events&&events.length){this._events.push(events);}
this.trigger('update-stats',this._events);},requests_clear:function(){if(!this._events){return;}
this._events=[];this.trigger('update-stats',this._events);},_update_stats:function(rqs){var requests=0,rtime=0,queries=0,qtime=0;for(var r=0;r<rqs.length;++r){for(var i=0;i<rqs[r].length;i++){var event=rqs[r][i];var query_start,request_start;switch(event[0]){case'request-start':request_start=event[3]*1e3;break;case'request-end':++requests;rtime+=(event[3]*1e3-request_start)|0;break;case'sql-start':query_start=event[3]*1e3;break;case'sql-end':++queries;qtime+=(event[3]*1e3-query_start)|0;break;}}}
this.$('#debugmanager_requests_stats').text(_.str.sprintf(_t("%d requests (%d ms) %d queries (%d ms)"),requests,rtime,queries,qtime));},show_timelines:function(){if(this._overlay){this._overlay.destroy();this._overlay=null;return;}
this._overlay=new RequestsOverlay(this);this._overlay.appendTo(document.body);},update:function(){this.$dropdown.empty().append(QWeb.render('WebClient.DebugManager.Global',{manager:this,}));return $.when();},select_view:function(){var self=this;new common.SelectCreateDialog(this,{res_model:'ir.ui.view',title:_t('Select a view'),disable_multiple_selection:true,on_selected:function(element_ids){new Model('ir.ui.view').query(['name','model','type']).filter([['id','=',element_ids[0]]]).first().then(function(view){self.do_action({type:'ir.actions.act_window',name:view.name,res_model:view.model,views:[[view.id,view.type]]});});}}).open();},perform_js_tests:function(){this.do_action({name:_t("JS Tests"),target:'new',type:'ir.actions.act_url',url:'/web/tests?mod=*'});},toggle_technical_features:function(){if(!this._features_group){return;}
var command=this._has_features?REMOVE(this._features_group):ADD(this._features_group);new Model('res.users').call('write',[session.uid,{groups_id:[command]}]).then(function(){window.location.reload();});},split_assets:function(){window.location=$.param.querystring(window.location.href,'debug=assets');},});DebugManager.include({update:function(tag,descriptor){if(tag==='action'){this._action=descriptor;}
return this._super().then(function(){this.$dropdown.find(".o_debug_leave_section").before(QWeb.render('WebClient.DebugManager.Action',{manager:this,action:this._action}));}.bind(this));},edit:function(params,evt){this.do_action({res_model:params.model,res_id:params.id,name:evt.target.text,type:'ir.actions.act_window',views:[[false,'form']],view_mode:'form',target:'new',flags:{action_buttons:true,headless:true}});},get_view_fields:function(){var self=this;var model=this._action.res_model;new Model(model).call('fields_get',{attributes:['string','searchable','required','readonly','type','store','sortable','relation','help']}).done(function(fields){new Dialog(self,{title:_.str.sprintf(_t("Fields of %s"),model),$content:$(QWeb.render('WebClient.DebugManager.Action.Fields',{fields:fields}))}).open();});},manage_filters:function(){this.do_action({res_model:'ir.filters',name:_t('Manage Filters'),views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',context:{search_default_my_filters:true,search_default_model_id:this._action.res_model}});},edit_workflow:function(){return this.do_action({res_model:'workflow',name:_t('Edit Workflow'),domain:[['osv','=',this._action.res_model]],views:[[false,'list'],[false,'form'],[false,'diagram']],type:'ir.actions.act_window',view_type:'list',view_mode:'list'});},translate:function(){var model=this._action.res_model;new Model("ir.translation").call('get_technical_translations',[model]).then(this.do_action);}});DebugManager.include({start:function(){this._can_edit_views=false;return $.when(this._super(),new Model('ir.ui.view').call('check_access_rights',{operation:'write',raise_exception:false}).then(function(ar){this._can_edit_views=ar;}.bind(this)));},update:function(tag,descriptor,widget){switch(tag){case'action':if(!(widget instanceof ViewManager)){this._active_view=null;this._view_manager=null;break;}
this._view_manager=widget;widget.on('switch_mode',this,function(){this.update('view',null,widget);});case'view':this._active_view=widget.active_view;}
return this._super(tag,descriptor).then(function(){this.$dropdown.find(".o_debug_leave_section").before(QWeb.render('WebClient.DebugManager.View',{manager:this,action:this._action,view:this._active_view,can_edit:this._can_edit_views,searchview:this._view_manager&&this._view_manager.searchview,}));}.bind(this));},get_metadata:function(){var ds=this._view_manager.dataset;if(!this._active_view.controller.get_selected_ids().length){console.warn(_t("No metadata available"));return}
ds.call('get_metadata',[this._active_view.controller.get_selected_ids()]).done(function(result){new Dialog(this,{title:_.str.sprintf(_t("Metadata (%s)"),ds.model),size:'medium',$content:QWeb.render('WebClient.DebugViewLog',{perm:result[0],format:formats.format_value})}).open();});},set_defaults:function(){this._active_view.controller.open_defaults_dialog();},fvg:function(){var dialog=new Dialog(this,{title:_t("Fields View Get")}).open();$('<pre>').text(utils.json_node_to_xml(this._active_view.controller.fields_view.arch,true)).appendTo(dialog.$el);},print_workflow:function(){var ids=this._active_view.controller.get_selected_ids();framework.blockUI();var action={context:{active_ids:ids},report_name:"workflow.instance.graph",datas:{model:this._view_manager.dataset.model,id:ids[0],nested:true,}};session.get_file({url:'/web/report',data:{action:JSON.stringify(action)},complete:framework.unblockUI});},});function make_context(width,height,fn){var canvas=document.createElement('canvas');canvas.width=width;canvas.height=height;canvas.style.position='relative';var ctx=canvas.getContext('2d');ctx.imageSmoothingEnabled=false;ctx.mozImageSmoothingEnabled=false;ctx.oImageSmoothingEnabled=false;ctx.webkitImageSmoothingEnabled=false;fn&&fn(ctx);return ctx;}
var RequestsOverlay=Widget.extend({template:'WebClient.DebugManager.RequestsOverlay',TRACKS:8,TRACK_WIDTH:9,events:{mousemove:function(e){this.$tooltip.hide();}},init:function(){this._super.apply(this,arguments);this._render=_.throttle(this._render.bind(this),1000/15,{leading:false});},start:function(){var _super=this._super();this.$tooltip=this.$('div.o_debug_tooltip');this.getParent().on('update-stats',this,this._render);this._render();return _super;},tooltip:function(text,start,end,x,y){var top=y-this.el.offsetTop+this.el.scrollTop+1;var left=x-this.el.offsetLeft+this.el.scrollLeft+1;this.$tooltip.css({top:top,left:left}).show()[0].innerHTML=['<p>',text,' (',(end-start),'ms)','</p>'].join('');},_render:function(){var $summary=this.$('header'),w=$summary[0].clientWidth,$requests=this.$('.o_debug_requests');$summary.find('canvas').attr('width',w);var tracks=document.getElementById('o_debug_requests_summary');_.invoke(this.getChildren(),'destroy');var requests=this.getParent()._events;var bounds=this._get_bounds(requests);var scale=w/(bounds.high-bounds.low);var track_ends=_(this.TRACKS).times(_.constant(-Infinity));var ctx=tracks.getContext('2d');ctx.lineWidth=this.TRACK_WIDTH;for(var i=0;i<requests.length;i++){var request=requests[i];var rstart=Math.floor(request[0][3]*1e3);var rend=Math.ceil(request[request.length-1][3]*1e3);for(var track=0;track<track_ends.length;++track){if(track_ends[track]<rstart){break;}}
if(track>=track_ends.length){console.warn("could not find an empty summary track");continue;}
track_ends[track]=rend;ctx.save();ctx.translate(Math.floor((rstart-bounds.low)*scale),track*(this.TRACK_WIDTH+1));this._draw_request(request,ctx,0,scale);ctx.restore();new RequestDetails(this,request,scale).appendTo($requests);}},_draw_request:function(request,to_context,step,hscale,handle_event){var surfaces={request:make_context(to_context.canvas.width,to_context.canvas.height,function(ctx){ctx.strokeStyle='blue';ctx.fillStyle='#88f';ctx.lineJoin='round';ctx.lineWidth=1;}),sql:make_context(to_context.canvas.width,to_context.canvas.height,function(ctx){ctx.strokeStyle='red';ctx.fillStyle='#f88';ctx.lineJoin='round';ctx.lineWidth=1;}),template:make_context(to_context.canvas.width,to_context.canvas.height,function(ctx){ctx.strokeStyle='green';ctx.fillStyle='#8f8';ctx.lineJoin='round';ctx.lineWidth=1;})};var stacks={},start=Math.floor(request[0][3]*1e3*hscale);var event_idx=0;var rect_width=to_context.lineWidth;for(var i=0;i<request.length;i++){var type,m,event=request[i];var tag=event[0],timestamp=Math.floor(event[3]*1e3*hscale)-start;if(m=/(\w+)-start/.exec(tag)){type=m[1];if(!(type in stacks)){stacks[type]=[];}
handle_event&&handle_event(event_idx,timestamp,event);stacks[type].push({timestamp:timestamp,idx:event_idx++});}else if(m=/(\w+)-end/.exec(tag)){type=m[1];var stack=stacks[type];var estart=stack.pop(),duration=Math.ceil(timestamp-estart.timestamp);handle_event&&handle_event(estart.idx,timestamp,event);var surface=surfaces[type];if(!surface){continue;}
var y=step*estart.idx;surface.rect(estart.timestamp+0.5,y+0.5,duration||1,rect_width);}}
var keys=['request','template','sql'];for(var j=0;j<keys.length;++j){var ctx=surfaces[keys[j]];ctx.fill();ctx.stroke();to_context.drawImage(ctx.canvas,0,0);}},_get_bounds:function(requests){var low=+Infinity;var high=-+Infinity;for(var i=0;i<requests.length;i++){var request=requests[i];for(var j=0;j<request.length;j++){var event=request[j];var timestamp=event[3];low=Math.min(low,timestamp);high=Math.max(high,timestamp);}}
return{low:Math.floor(low*1e3),high:Math.ceil(high*1e3)};}});var RequestDetails=Widget.extend({events:{click:function(){this._open=!this._open;this.render();},'mousemove canvas':function(e){e.stopPropagation();var y=e.y||e.offsetY||e.layerY;if(!y){return;}
var event=this._payloads[Math.floor(y/this._REQ_HEIGHT)];if(!event){return;}
this.getParent().tooltip(event.payload,event.start,event.stop,e.clientX,e.clientY);}},init:function(parent,request,scale){this._super.apply(this,arguments);this._request=request;this._open=false;this._scale=scale;this._REQ_HEIGHT=20;},start:function(){this.el.style.borderBottom='1px solid black';this.render();return this._super();},render:function(){var request_cell_height=this._REQ_HEIGHT,TITLE_WIDTH=200;var request=this._request;var req_start=request[0][3]*1e3;var req_duration=request[request.length-1][3]*1e3-req_start;var height=request_cell_height*(this._open?request.length/2:1);var cell_center=request_cell_height/2;var ctx=make_context(210+Math.ceil(req_duration*this._scale),height,function(ctx){ctx.lineWidth=cell_center;});this.$el.empty().append(ctx.canvas);var payloads=this._payloads=[];var text_ctx=make_context(TITLE_WIDTH,height,function(ctx){ctx.font='12px sans-serif';ctx.textAlign='right';ctx.textBaseline='middle';ctx.translate(0,cell_center);});ctx.save();ctx.translate(TITLE_WIDTH+10,((request_cell_height/4)|0));this.getParent()._draw_request(request,ctx,this._open?request_cell_height:0,this._scale,function(idx,timestamp,event){if(/-start$/g.test(event[0])){payloads.push({payload:event[2],start:timestamp,stop:null});var title=event[2];title=title.replace(/\s+$/,'');title=title.length<=50?title:('…'+title.slice(-49));while(text_ctx.measureText(title).width>200){title='…'+title.slice(2);}
text_ctx.fillText(title,TITLE_WIDTH,request_cell_height*idx);}else if(/-end$/g.test(event[0])){payloads[idx].stop=timestamp;}});ctx.restore();ctx.drawImage(text_ctx.canvas,0,0);}});if(core.debug){SystrayMenu.Items.push(DebugManager);WebClient.include({current_action_updated:function(action){this._super.apply(this,arguments);var action_descr=action&&action.action_descr;var action_widget=action&&action.widget;var debug_manager=_.find(this.systray_menu.widgets,function(item){return item instanceof DebugManager;});debug_manager.update('action',action_descr,action_widget);},});Dialog.include({open:function(){var self=this;var parent=self.getParent();if(parent instanceof ActionManager&&parent.dialog_widget){this.opened(function(){self.debug_manager=new DebugManager(self);var $header=self.$modal.find('.modal-header');return self.debug_manager.prependTo($header).then(function(){self.debug_manager.update('action',parent.dialog_widget.action,parent.dialog_widget);});});}
return this._super.apply(this,arguments);},});}
return DebugManager;});;

/* /web/static/src/js/widgets/data_export.js defined in bundle 'web.assets_backend' */
odoo.define('web.DataExport',function(require){"use strict";var core=require('web.core');var crash_manager=require('web.crash_manager');var data=require('web.data');var Dialog=require('web.Dialog');var framework=require('web.framework');var pyeval=require('web.pyeval');var QWeb=core.qweb;var _t=core._t;var DataExport=Dialog.extend({template:'ExportDialog',events:{'click .o_expand_parent':function(e){this.on_expand_action(this.records[$(e.target).closest('.o_export_tree_item').data('id')]);},'click .o_export_tree_item':function(e){e.stopPropagation();var $elem=$(e.currentTarget);var row_index=$elem.prevAll('.o_export_tree_item').length;var row_index_level=$elem.parents('.o_export_tree_item').length;if(e.shiftKey&&row_index_level===this.row_index_level){var minIndex=Math.min(row_index,this.row_index);var maxIndex=Math.max(row_index,this.row_index);this.$records.filter(function(){return($elem.parent()[0]===$(this).parent()[0]);}).slice(minIndex,maxIndex+1).addClass('o_selected').filter(':not(:last)').each(process_children);}
this.row_index=row_index;this.row_index_level=row_index_level;if(e.ctrlKey){$elem.toggleClass('o_selected').focus();}else if(e.shiftKey){$elem.addClass('o_selected').focus();}else{this.$(".o_selected").removeClass("o_selected")
$elem.addClass("o_selected").focus();}
function process_children(){var $this=$(this);if($this.hasClass('open')){$this.children('.o_export_tree_item').addClass('o_selected').each(process_children);}}},'dblclick .o_export_tree_item':function(e){var $elem=$(e.currentTarget);$elem.removeClass('o_selected');this.add_field($elem.data('id'),$elem.find('.o_tree_column').first().text());},'keydown .o_export_tree_item':function(e){e.stopPropagation();var $elem=$(e.currentTarget);var record=this.records[$elem.data('id')];switch(e.keyCode||e.which){case $.ui.keyCode.LEFT:if($elem.hasClass('open')){this.on_expand_action(record);}
break;case $.ui.keyCode.RIGHT:if(!$elem.hasClass('open')){this.on_expand_action(record);}
break;case $.ui.keyCode.UP:var $prev=$elem.prev('.o_export_tree_item');if($prev.length===1){while($prev.hasClass('open')){$prev=$prev.children('.o_export_tree_item').last();}}else{$prev=$elem.parent('.o_export_tree_item');if($prev.length===0){break;}}
$elem.removeClass("o_selected").blur();$prev.addClass("o_selected").focus();break;case $.ui.keyCode.DOWN:var $next;if($elem.hasClass('open')){$next=$elem.children('.o_export_tree_item').first();}else{$next=$elem.next('.o_export_tree_item');if($next.length===0){$next=$elem.parent('.o_export_tree_item').next('.o_export_tree_item');if($next.length===0){break;}}}
$elem.removeClass("o_selected").blur();$next.addClass("o_selected").focus();break;}},'click .o_add_field':function(){var self=this;this.$('.o_field_tree_structure .o_selected').removeClass('o_selected').each(function(){var $this=$(this);self.add_field($this.data('id'),$this.children('.o_tree_column').text());});},'click .o_remove_field':function(){this.$fields_list.find('option:selected').remove();},'click .o_remove_all_field':function(){this.$fields_list.empty();},'click .o_move_up':function(){var $selected_rows=this.$fields_list.find('option:selected');var $prev_row=$selected_rows.first().prev();if($prev_row.length){$prev_row.before($selected_rows.detach());}},'click .o_move_down':function(){var $selected_rows=this.$fields_list.find('option:selected');var $next_row=$selected_rows.last().next();if($next_row.length){$next_row.after($selected_rows.detach());}},'click .o_toggle_save_list':function(e){e.preventDefault();var $saveList=this.$(".o_save_list");if($saveList.is(':empty')){$saveList.append(QWeb.render('Export.SaveList'));}else{if($saveList.is(':hidden')){$saveList.show();$saveList.find(".o_export_list_input").val("");}else{$saveList.hide();}}},'click .o_save_list > button':function(e){var $saveList=this.$(".o_save_list");var value=$saveList.find("input").val();if(!value){Dialog.alert(this,_t("Please enter save field list name"));return;}
var fields=this.get_fields();if(fields.length===0){return;}
$saveList.hide();var self=this;this.exports.create({name:value,resource:this.dataset.model,export_fields:_.map(fields,function(field){return[0,0,{name:field}];}),}).then(function(export_list_id){if(!export_list_id){return;}
var $select=self.$(".o_exported_lists_select");if($select.length===0||$select.is(":hidden")){self.show_exports_list();}
$select.append(new Option(value,export_list_id));});},},init:function(parent,dataset){var options={title:_t("Export Data"),buttons:[{text:_t("Export To File"),click:this.export_data,classes:"btn-primary"},{text:_t("Close"),close:true},],};this._super(parent,options);this.records={};this.dataset=dataset;this.exports=new data.DataSetSearch(this,'ir.exports',this.dataset.get_context());this.row_index=0;this.row_index_level=0;},start:function(){var self=this;var waitFor=[this._super.apply(this,arguments)];this.$fields_list=this.$('.o_fields_list');this.$import_compat_radios=this.$('.o_import_compat input');waitFor.push(this.rpc('/web/export/formats',{}).then(do_setup_export_formats));var got_fields=new $.Deferred();this.$import_compat_radios.change(function(e){self.$('.o_field_tree_structure').remove();self.rpc("/web/export/get_fields",{model:self.dataset.model,import_compat:!!$(e.target).val(),}).done(function(records){var compatible_fields=_.map(records,function(record){return record.id});self.$fields_list.find('option').filter(function(){var option_field=$(this).attr('value');if(compatible_fields.indexOf(option_field)===-1){return true;}}).remove();got_fields.resolve();self.on_show_data(records);});}).eq(0).change();waitFor.push(got_fields);waitFor.push(this.getParent().get_active_domain().then(function(domain){if(domain===undefined){self.ids_to_export=self.getParent().get_selected_ids();self.domain=self.dataset.domain;}else{self.ids_to_export=false;self.domain=domain;}
self.on_show_domain();}));waitFor.push(this.show_exports_list());return $.when.apply($,waitFor);function do_setup_export_formats(formats){var $fmts=self.$('.o_export_format');_.each(formats,function(format,i){var $radio=$('<input/>',{type:'radio',value:format.tag,name:'o_export_format_name'});var $label=$('<label/>',{html:format.label});if(format.error){$radio.prop('disabled',true);$label.html(_.str.sprintf("%s — %s",format.label,format.error));}
$fmts.append($("<div/>").append($radio,$label));});self.$export_format_inputs=$fmts.find('input');self.$export_format_inputs.first().prop('checked',true);}},show_exports_list:function(){if(this.$('.o_exported_lists_select').is(':hidden')){this.$('.o_exported_lists').show();return $.when();}
var self=this;return this.exports.read_slice(['name'],{domain:[['resource','=',this.dataset.model]]}).then(function(export_list){if(!export_list.length){return;}
self.$('.o_exported_lists').append(QWeb.render('Export.SavedList',{'existing_exports':export_list}));self.$('.o_exported_lists_select').on('change',function(){self.$fields_list.empty();var export_id=self.$('.o_exported_lists_select option:selected').val();if(export_id){self.rpc('/web/export/namelist',{model:self.dataset.model,export_id:parseInt(export_id,10),}).then(do_load_export_field);}});self.$('.o_delete_exported_list').click(function(){var select_exp=self.$('.o_exported_lists_select option:selected');if(select_exp.val()){self.exports.unlink([parseInt(select_exp.val(),10)]);select_exp.remove();self.$fields_list.empty();if(self.$('.o_exported_lists_select option').length<=1){self.$('.o_exported_lists').hide();}}});});function do_load_export_field(field_list){_.each(field_list,function(field){self.$fields_list.append(new Option(field.label,field.name));});}},on_expand_action:function(record){if(!record['children']){return;}
var model=record['params']['model'];var prefix=record['params']['prefix'];var name=record['params']['name'];var exclude_fields=[];if(record['relation_field']){exclude_fields.push(record['relation_field']);}
if(!record.loaded){var self=this;this.rpc("/web/export/get_fields",{model:model,prefix:prefix,parent_name:name,import_compat:!!this.$import_compat_radios.filter(':checked').val(),parent_field_type:record['field_type'],exclude:exclude_fields}).done(function(results){record.loaded=true;self.on_show_data(results,record.id);});}else{this.show_content(record.id);}},on_show_domain:function(){this.$('p').first().after(QWeb.render('Export.DomainMessage',{record:this}));},on_show_data:function(records,expansion){var self=this;if(expansion){this.$('.o_export_tree_item[data-id="'+expansion+'"]').addClass('open').find('.o_expand_parent').toggleClass('fa-plus fa-minus').next().after(QWeb.render('Export.TreeItems',{'fields':records}));}else{this.$('.o_left_field_panel').empty().append($("<div/>").addClass('o_field_tree_structure').append(QWeb.render('Export.TreeItems',{'fields':records})));}
_.extend(this.records,_.object(_.pluck(records,'id'),records));this.$records=this.$(".o_export_tree_item");this.$records.each(function(i,el){var $elem=$(el);$elem.find('.o_tree_column').first().toggleClass('o_required',!!self.records[$elem.data('id')].required);});},show_content:function(id){var $this=this.$('.o_export_tree_item[data-id="'+id+'"]');$this.toggleClass('open');var is_open=$this.hasClass('open');$this.children('.o_expand_parent').toggleClass('fa-minus',!!is_open).toggleClass('fa-plus',!is_open);var $child_field=$this.find('.o_export_tree_item');var child_len=(id.split("/")).length+1;for(var i=0;i<$child_field.length;i++){var $child=$child_field.eq(i);if(!is_open){$child.hide();}else if(child_len===$child_field.eq(i).data('id').split("/").length){if($child.hasClass('open')){$child.removeClass('open');$child.children('.o_expand_parent').removeClass('fa-minus').addClass('fa-plus');}
$child.show();}}},add_field:function(field_id,string){var $field_list=this.$('.o_fields_list');field_id=this.records[field_id].value||field_id;if($field_list.find("option[value='"+field_id+"']").length===0){$field_list.append(new Option(string,field_id));}},get_fields:function(){var $export_fields=this.$(".o_fields_list option").map(function(){return $(this).val();}).get();if($export_fields.length===0){Dialog.alert(this,_t("Please select fields to save export list..."));}
return $export_fields;},export_data:function(){var self=this;var exported_fields=this.$('.o_fields_list option').map(function(){return{name:(self.records[this.value]||this).value,label:this.textContent||this.innerText};}).get();if(_.isEmpty(exported_fields)){Dialog.alert(this,_t("Please select fields to export..."));return;}
exported_fields.unshift({name:'id',label:'External ID'});var export_format=this.$export_format_inputs.filter(':checked').val();framework.blockUI();this.session.get_file({url:'/web/export/'+export_format,data:{data:JSON.stringify({model:this.dataset.model,fields:exported_fields,ids:this.ids_to_export,domain:this.domain,context:pyeval.eval('contexts',[this.dataset._model.context()]),import_compat:!!this.$import_compat_radios.filter(':checked').val(),})},complete:framework.unblockUI,error:crash_manager.rpc_error.bind(crash_manager),});},});return DataExport;});;

/* /web/static/src/js/widgets/date_picker.js defined in bundle 'web.assets_backend' */
odoo.define('web.datepicker',function(require){"use strict";var core=require('web.core');var formats=require('web.formats');var time=require('web.time');var Widget=require('web.Widget');var _t=core._t;var DateWidget=Widget.extend({template:"web.datepicker",type_of_date:"date",events:{'dp.change':'change_datetime','dp.show':'set_datetime_default','change .o_datepicker_input':'change_datetime',},init:function(parent,options){this._super.apply(this,arguments);var l10n=_t.database.parameters;this.name=parent.name;this.options=_.defaults(options||{},{pickTime:this.type_of_date==='datetime',useSeconds:this.type_of_date==='datetime',startDate:moment({y:1900}),endDate:moment().add(200,"y"),calendarWeeks:true,icons:{time:'fa fa-clock-o',date:'fa fa-calendar',up:'fa fa-chevron-up',down:'fa fa-chevron-down'},language:moment.locale(),format:time.strftime_to_moment_format((this.type_of_date==='datetime')?(l10n.date_format+' '+l10n.time_format):l10n.date_format),});},start:function(){this.$input=this.$('input.o_datepicker_input');this.$el.datetimepicker(this.options);this.picker=this.$el.data('DateTimePicker');this.set_readonly(false);this.set_value(false);},set_value:function(value){this.set({'value':value});this.$input.val((value)?this.format_client(value):'');this.picker.setValue(this.format_client(value));},get_value:function(){return this.get('value');},set_value_from_ui:function(){var value=this.$input.val()||false;this.set_value(this.parse_client(value));},set_readonly:function(readonly){this.readonly=readonly;this.$input.prop('readonly',this.readonly);},is_valid:function(){var value=this.$input.val();if(value===""){return true;}else{try{this.parse_client(value);return true;}catch(e){return false;}}},parse_client:function(v){return formats.parse_value(v,{"widget":this.type_of_date});},format_client:function(v){return formats.format_value(v,{"widget":this.type_of_date});},set_datetime_default:function(){var value=moment().second(0);if(this.$input.val().length!==0&&this.is_valid()){value=this.$input.val();}
var saved_picktime=this.picker.options.pickTime;this.picker.options.pickTime=true;this.picker.setValue(value);this.picker.options.pickTime=saved_picktime;},change_datetime:function(e){if(this.is_valid()){this.set_value_from_ui();this.trigger("datetime_changed");}},commit_value:function(){this.change_datetime();},destroy:function(){this.picker.destroy();this._super.apply(this,arguments);},});var DateTimeWidget=DateWidget.extend({type_of_date:"datetime"});return{DateWidget:DateWidget,DateTimeWidget:DateTimeWidget,};});;

/* /web/static/src/js/widgets/loading.js defined in bundle 'web.assets_backend' */
odoo.define('web.Loading',function(require){"use strict";var core=require('web.core');var framework=require('web.framework');var session=require('web.session');var Widget=require('web.Widget');var _t=core._t;var Loading=Widget.extend({template:"Loading",init:function(parent){this._super(parent);this.count=0;this.blocked_ui=false;session.on("request",this,this.request_call);session.on("response",this,this.response_call);session.on("response_failed",this,this.response_call);},destroy:function(){this.on_rpc_event(-this.count);this._super();},request_call:function(){this.on_rpc_event(1);},response_call:function(){this.on_rpc_event(-1);},on_rpc_event:function(increment){var self=this;if(!this.count&&increment===1){this.long_running_timer=setTimeout(function(){self.blocked_ui=true;framework.blockUI();},3000);}
this.count+=increment;if(this.count>0){if(session.debug){this.$el.text(_.str.sprintf(_t("Loading (%d)"),this.count));}else{this.$el.text(_t("Loading"));}
this.$el.show();this.getParent().$el.addClass('oe_wait');}else{this.count=0;clearTimeout(this.long_running_timer);if(self.blocked_ui){this.blocked_ui=false;framework.unblockUI();}
this.$el.fadeOut();this.getParent().$el.removeClass('oe_wait');}}});return Loading;});;

/* /web/static/src/js/widgets/notification.js defined in bundle 'web.assets_backend' */
odoo.define('web.notification',function(require){"use strict";var core=require('web.core');var Widget=require('web.Widget');var Notification=Widget.extend({template:'Notification',events:{'click .o_close':function(e){e.preventDefault();this.destroy(true);}},init:function(parent,title,text,sticky){this._super.apply(this,arguments);this.title=title;this.text=text;this.sticky=!!sticky;},start:function(){this._super.apply(this,arguments);var self=this;this.$el.animate({opacity:1.0},400,"swing",function(){if(!self.sticky){setTimeout(function(){self.destroy(true);},2500);}});},destroy:function(animate){if(!animate){return this._super.apply(this,arguments);}
var self=this,superDestroy=this._super;this.$el.animate({opacity:0.0},400,"swing",function(){self.$el.animate({height:0},400,"swing",function(){superDestroy.call(self);});});},});var Warning=Notification.extend({template:'Warning',});var NotificationManager=Widget.extend({className:'o_notification_manager',display:function(notification){notification.appendTo(this.$el);return notification;},notify:function(title,text,sticky){return this.display(new Notification(this,title,text,sticky));},warn:function(title,text,sticky){return this.display(new Warning(this,title,text,sticky));},});return{Notification:Notification,Warning:Warning,NotificationManager:NotificationManager,};});;

/* /web/static/src/js/widgets/sidebar.js defined in bundle 'web.assets_backend' */
odoo.define('web.Sidebar',function(require){"use strict";var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var framework=require('web.framework');var pyeval=require('web.pyeval');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var Sidebar=Widget.extend({init:function(parent,options){var self=this;this._super(parent);this.options=_.defaults(options||{},{'editable':true});this.sections=options.sections||[{name:'print',label:_t('Print')},{name:'other',label:_t('Action')},];this.items=options.items||{print:[],other:[],};this.fileupload_id=_.uniqueId('oe_fileupload');$(window).on(this.fileupload_id,function(){var args=[].slice.call(arguments).slice(1);self.do_attachement_update(self.dataset,self.model_id,args);framework.unblockUI();});},start:function(){var self=this;this._super(this);this.$el.addClass('btn-group');this.redraw();this.$el.on('click','.dropdown-menu li a',function(event){var section=$(this).data('section');var index=$(this).data('index');var item=self.items[section][index];if(item.callback){item.callback.apply(self,[item]);}else if(item.action){self.on_item_action_clicked(item);}else if(item.url){return true;}
event.preventDefault();});},destroy:function(){$(window).off(this.fileupload_id);return this._super.apply(this,arguments);},redraw:function(){this.$el.html(QWeb.render('Sidebar',{widget:this}));this.$('.o_dropdown').each(function(){if(!$(this).find('li').length){$(this).hide();}});this.$("[title]").tooltip({delay:{show:500,hide:0}});this.$('.o_sidebar_add_attachment .o_form_binary_form').change(this.on_attachment_changed);this.$('.o_sidebar_delete_attachment').click(this.on_attachment_delete);},add_items:function(section_code,items){if(items){this.items[section_code].unshift.apply(this.items[section_code],items);this.redraw();}},add_toolbar:function(toolbar){var self=this;_.each(['print','action','relate'],function(type){var items=toolbar[type];if(items){var actions=_.map(items,function(item){return{label:item.name,action:item,};});self.add_items(type==='print'?'print':'other',actions);}});},on_item_action_clicked:function(item){var self=this;self.getParent().sidebar_eval_context().done(function(sidebar_eval_context){var ids=self.getParent().get_selected_ids();var domain;if(self.getParent().get_active_domain){domain=self.getParent().get_active_domain();}
else{domain=$.Deferred().resolve(undefined);}
if(ids.length===0){new Dialog(this,{title:_t("Warning"),size:'medium',$content:$("<div/>").html(_t("You must choose at least one record."))}).open();return false;}
var dataset=self.getParent().dataset;var active_ids_context={active_id:ids[0],active_ids:ids,active_model:dataset.model,};$.when(domain).done(function(domain){if(domain!==undefined){active_ids_context.active_domain=domain;}
var c=pyeval.eval('context',new data.CompoundContext(sidebar_eval_context,active_ids_context));self.rpc("/web/action/load",{action_id:item.action.id,context:new data.CompoundContext(dataset.get_context(),active_ids_context).eval()}).done(function(result){result.context=new data.CompoundContext(result.context||{},active_ids_context).set_eval_context(c);result.flags=result.flags||{};result.flags.new_window=true;self.do_action(result,{on_close:function(){self.getParent().reload();},});});});});},do_attachement_update:function(dataset,model_id,args){this.dataset=dataset;this.model_id=model_id;if(args&&args[0].error){this.do_warn(_t('Uploading Error'),args[0].error);}
if(!model_id){this.on_attachments_loaded([]);}else{var dom=[['res_model','=',dataset.model],['res_id','=',model_id],['type','in',['binary','url']]];var ds=new data.DataSetSearch(this,'ir.attachment',dataset.get_context(),dom);ds.read_slice(['name','url','type','create_uid','create_date','write_uid','write_date'],{}).done(this.on_attachments_loaded);}},on_attachments_loaded:function(attachments){_.each(attachments,function(a){a.label=a.name;if(a.type==="binary"){a.url='/web/content/'+a.id+'?download=true';}});this.items.files=attachments;this.redraw();},on_attachment_changed:function(e){var $e=$(e.target);if($e.val()!==''){this.$('form.o_form_binary_form').submit();$e.parent().find('input[type=file]').prop('disabled',true);$e.parent().find('button').prop('disabled',true).find('img, span').toggle();this.$('.o_sidebar_add_attachment a').text(_t('Uploading...'));framework.blockUI();}},on_attachment_delete:function(e){e.preventDefault();e.stopPropagation();var self=this;var $e=$(e.currentTarget);var options={confirm_callback:function(){new data.DataSet(this,'ir.attachment').unlink([parseInt($e.attr('data-id'),10)]).done(function(){self.do_attachement_update(self.dataset,self.model_id);});}};Dialog.confirm(this,_t("Do you really want to delete this attachment ?"),options);}});return Sidebar;});;

/* /web/static/src/js/widgets/priority.js defined in bundle 'web.assets_backend' */
odoo.define('web.Priority',function(require){"use strict";var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var Priority=Widget.extend({template:"Priority",events:{'mouseover > a':function(e){clearTimeout(this.hover_timer);this.$stars.removeClass('fa-star-o').addClass('fa-star');$(e.target).nextAll().removeClass('fa-star').addClass('fa-star-o');},'mouseout > a':function(e){clearTimeout(this.hover_timer);var self=this;this.hover_timer=setTimeout(function(){self._render_value();},200);},'click > a':function(e){e.preventDefault();e.stopPropagation();var old_value=this.value;this.value=String($(e.target).data('value'));if(old_value===this.value){this.value=this.empty_value;}
this._render_value();this.trigger('update',{value:this.value});},},init:function(parent,options){this._super.apply(this,arguments);options=_.defaults(options||{},{readonly:true,value:0,values:[[0,_t("Normal")],[1,_t("Low")],[2,_t("High")],[3,_t("Very High")]],});this.readonly=options.readonly;this.value=options.value;this.values=options.values;this.empty_value=this.values[0][0];},start:function(){this._render_value();return this._super();},set_value:function(value){this.value=value;this._render_value();},_render_value:function(){var current_value=this.value;this.$stars=this.$('.o_priority_star');this.$stars.each(function(i,el){var $star=$(el);var star_value=$star.data('value');$star.toggleClass('fa-star',(star_value<=current_value)).toggleClass('fa-star-o',(star_value>current_value));});},});return Priority;});;

/* /web/static/src/js/widgets/progress_bar.js defined in bundle 'web.assets_backend' */
odoo.define('web.ProgressBar',function(require){"use strict";var core=require('web.core');var utils=require('web.utils');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var ProgressBar=Widget.extend({template:"ProgressBar",events:{'change input':'on_change_input','input input':'on_change_input','keyup input':function(e){if(e.which===$.ui.keyCode.ENTER){this.on_change_input(e);}},},init:function(parent,options){this._super(parent);options=_.defaults(options||{},{readonly:true,edit_on_click:false,value:0,max_value:100,title:'',edit_max_value:false,});this.readonly=options.readonly;this.edit_on_click=options.edit_on_click;this.value=options.value;this.max_value=options.max_value;this.title=options.title;this.edit_max_value=options.edit_max_value;},start:function(){this._render_value();if(!this.readonly){if(this.edit_on_click){var self=this;this.$el.on('click','.o_progress',function(e){var $target=$(e.currentTarget);self.value=Math.floor((e.pageX-$target.offset().left)/$target.outerWidth()*self.max_value);self._render_value();self.trigger('update',{value:self.value,max_value:self.max_value,changed_value:self.value});});}else{this.$el.on('blur','input',_.bind(this.on_change_input,this));}
this.$('.o_progressbar_value').focus().select()}
return this._super();},on_change_input:function(e){var $input=$(e.target);if(e.type==='change'&&!$input.is(':focus')){return;}
if(isNaN($input.val())){this.do_warn(_t("Wrong value entered!"),_t("Only Integer Value should be valid."));}else{if(e.type==='input'){this._render_value($input.val());if(parseFloat($input.val())===0){$input.select();}}else{if(this.edit_max_value){this.max_value=$(e.target).val();}else{this.value=$(e.target).val()||0;}
this._render_value();this.trigger('update',{value:this.value,max_value:this.max_value,changed_value:(this.edit_max_value)?this.max_value:this.value});}}},set_value:function(v){this.value=v;this._render_value();},_render_value:function(v){var value=this.value;var max_value=this.max_value;if(!isNaN(v)){if(this.edit_max_value){max_value=v;}else{value=v;}}
value=value||0;max_value=max_value||0;var widthComplete;if(value<=max_value){widthComplete=value/max_value*100;}else{widthComplete=100;}
this.$('.o_progress').toggleClass('o_progress_overflow',value>max_value);this.$('.o_progressbar_complete').css('width',widthComplete+'%');if(this.readonly){if(max_value!==100){this.$('.o_progressbar_value').html(utils.human_number(value)+" / "+utils.human_number(max_value));}else{this.$('.o_progressbar_value').html(utils.human_number(value)+"%");}}else if(isNaN(v)){this.$('.o_progressbar_value').val(this.edit_max_value?max_value:value);}}});return ProgressBar;});;

/* /web/static/src/js/widgets/pager.js defined in bundle 'web.assets_backend' */
odoo.define('web.Pager',function(require){"use strict";var utils=require('web.utils');var Widget=require('web.Widget');var direction={previous:-1,next:1,};var Pager=Widget.extend({template:"Pager",events:{'click .o_pager_previous':'previous','click .o_pager_next':'next','click .o_pager_value':'_edit',},init:function(parent,size,current_min,limit,options){this.state={size:size,current_min:current_min,limit:limit,};Object.defineProperty(this.state,'current_max',{get:function(){return Math.min(this.current_min+this.limit-1,this.size);}});this.options=_.defaults({},options,{can_edit:true,single_page_hidden:false,validate:function(){return $.Deferred().resolve();},});this._super(parent);},start:function(){this.$value=this.$('.o_pager_value');this.$limit=this.$('.o_pager_limit');this._render();return this._super();},update_state:function(state){_.extend(this.state,state);this._render();},previous:function(){this._change_selection(direction.previous);},next:function(){this._change_selection(direction.next);},disable:function(){this.$('button').prop("disabled",true);},enable:function(){this.$('button').prop("disabled",false);},_edit:function(){if(this.options.can_edit){var self=this;var $input=$('<input>',{type:'text',value:this.$value.html()});this.$value.html($input);$input.focus();$input.click(function(ev){ev.stopPropagation();});$input.blur(function(ev){self._save($(ev.target));});$input.on('keydown',function(ev){ev.stopPropagation();if(ev.which===$.ui.keyCode.ENTER){self._save($(ev.target));}else if(ev.which===$.ui.keyCode.ESCAPE){self._render();}});}},_save:function($input){var self=this;this.options.validate().then(function(){var value=$input.val().split("-");var min=utils.confine(parseInt(value[0],10),1,self.state.size);var max=utils.confine(parseInt(value[1],10),1,self.state.size);if(!isNaN(min)){self.state.current_min=min;if(!isNaN(max)){self.state.limit=utils.confine(max-min+1,1,self.state.size);}else{self.state.limit=1;}
self.trigger('pager_changed',_.clone(self.state));}}).always(function(){self._render();});},_change_selection:function(direction){var self=this;this.options.validate().then(function(){var size=self.state.size;var current_min=self.state.current_min;var limit=self.state.limit;current_min=(current_min+limit*direction);if(current_min>size){current_min=1;}else if((current_min<1)&&(limit===1)){current_min=size;}else if((current_min<1)&&(limit>1)){current_min=size-((size%limit)||limit)+1;}
self.state.current_min=current_min;self.trigger('pager_changed',_.clone(self.state));self._render();});},_render:function(){var size=this.state.size;var current_min=this.state.current_min;var current_max=this.state.current_max;var single_page=1===current_min&&current_max===size;if(size===0||(single_page&&this.options.single_page_hidden)){this.do_hide();}else{this.do_show();if(single_page){this.disable();}else{this.enable();}
var value=""+current_min;if(this.state.limit>1){value+="-"+current_max;}
this.$value.html(value);this.$limit.html(size);}},});return Pager;});;

/* /web/static/src/js/widgets/systray_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.SystrayMenu',function(require){"use strict";var Widget=require('web.Widget');var SystrayMenu=Widget.extend({init:function(parent){this._super(parent);this.items=[];this.widgets=[];this.load=$.Deferred();},start:function(){var self=this;self._super.apply(this,arguments);self.load_items();$.when.apply($,self.items).always(function(){self.load.resolve();});return self.load;},load_items:function(){var self=this;SystrayMenu.Items=_.sortBy(SystrayMenu.Items,function(item){return!_.isUndefined(item.prototype.sequence)?item.prototype.sequence:50;});_.each(SystrayMenu.Items,function(widgetCls){var cur_systray_item=new widgetCls(self);self.widgets.push(cur_systray_item);self.items.push(cur_systray_item.prependTo(self.$el));});},});SystrayMenu.Items=[];return SystrayMenu;});;

/* /web/static/src/js/widgets/switch_company_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.SwitchCompanyMenu',function(require){"use strict";var Model=require('web.Model');var session=require('web.session');var SystrayMenu=require('web.SystrayMenu');var Widget=require('web.Widget');var SwitchCompanyMenu=Widget.extend({template:'SwitchCompanyMenu',willStart:function(){if(!session.user_companies){return $.Deferred().reject();}
return this._super();},start:function(){var self=this;this.$el.on('click','.dropdown-menu li a[data-menu]',_.debounce(function(ev){ev.preventDefault();var company_id=$(ev.currentTarget).data('company-id');new Model('res.users').call('write',[[session.uid],{'company_id':company_id}]).then(function(){location.reload();});},1500,true));self.$('.oe_topbar_name').text(session.user_companies.current_company[1]);var companies_list='';_.each(session.user_companies.allowed_companies,function(company){var a='';if(company[0]===session.user_companies.current_company[0]){a='<i class="fa fa-check o_current_company"></i>';}else{a='<span class="o_company"/>';}
companies_list+='<li><a href="#" data-menu="company" data-company-id="'+company[0]+'">'+a+company[1]+'</a></li>';});self.$('.dropdown-menu').html(companies_list);return this._super();},});SystrayMenu.Items.push(SwitchCompanyMenu);});;

/* /web/static/src/js/widgets/user_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.UserMenu',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var framework=require('web.framework');var Model=require('web.Model');var session=require('web.session');var Widget=require('web.Widget');var _t=core._t;var QWeb=core.qweb;var UserMenu=Widget.extend({template:"UserMenu",start:function(){var self=this;this.$el.on('click','.dropdown-menu li a[data-menu]',function(ev){ev.preventDefault();var f=self['on_menu_'+$(this).data('menu')];if(f){f($(this));}});return this._super.apply(this,arguments).then(function(){return self.do_update();});},do_update:function(){var $avatar=this.$('.oe_topbar_avatar');if(!session.uid){$avatar.attr('src',$avatar.data('default-src'));return $.when();}
var topbar_name=session.name;if(session.debug){topbar_name=_.str.sprintf("%s (%s)",topbar_name,session.db);}
this.$('.oe_topbar_name').text(topbar_name);var avatar_src=session.url('/web/image',{model:'res.users',field:'image_small',id:session.uid});$avatar.attr('src',avatar_src);},on_menu_documentation:function(){window.open('https://www.odoo.com/documentation/user','_blank');},on_menu_support:function(){window.open('https://www.odoo.com/buy','_blank');},on_menu_settings:function(){var self=this;this.trigger_up('clear_uncommitted_changes',{callback:function(){self.rpc("/web/action/load",{action_id:"base.action_res_users_my"}).done(function(result){result.res_id=session.uid;self.do_action(result);});},});},on_menu_account:function(){this.trigger_up('clear_uncommitted_changes',{callback:function(){var P=new Model('ir.config_parameter');P.call('get_param',['database.uuid']).then(function(dbuuid){var state={'d':session.db,'u':window.location.protocol+'//'+window.location.host,};var params={response_type:'token',client_id:dbuuid||'',state:JSON.stringify(state),scope:'userinfo',};framework.redirect('https://accounts.odoo.com/oauth2/auth?'+$.param(params));}).fail(function(result,ev){ev.preventDefault();framework.redirect('https://accounts.odoo.com/account');});},});},on_menu_logout:function(){this.trigger_up('clear_uncommitted_changes',{callback:this.do_action.bind(this,'logout'),});},});return UserMenu;});;

/* /web/static/src/js/menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.Menu',function(require){"use strict";var core=require('web.core');var session=require('web.session');var Widget=require('web.Widget');var QWeb=core.qweb;var Menu=Widget.extend({init:function(){var self=this;this._super.apply(this,arguments);this.is_bound=$.Deferred();this.data={data:{children:[]}};this.on("menu_bound",this,function(){var $all_menus=self.$el.parents('.o_web_client').find('.o_sub_menu').find('[data-menu]');var all_menu_ids=_.map($all_menus,function(menu){return parseInt($(menu).attr('data-menu'),10);});if(!_.isEmpty(all_menu_ids)){this.do_load_needaction(all_menu_ids);}});core.bus.on('do_reload_needaction',this,this.do_reload_needaction);core.bus.on('change_menu_section',this,this.on_change_top_menu);},start:function(){this._super.apply(this,arguments);return this.bind_menu();},do_reload:function(){var self=this;self.bind_menu();},bind_menu:function(){var self=this;this.$secondary_menus=this.$el.parents().find('.o_sub_menu');this.$secondary_menus.on('click','a[data-menu]',this.on_menu_click);this.$el.on('click','a[data-menu]',function(event){event.preventDefault();var menu_id=$(event.currentTarget).data('menu');var needaction=$(event.target).is('div#menu_counter');core.bus.trigger('change_menu_section',menu_id,needaction);});this.$secondary_menus.find('.oe_menu_toggler').siblings('.oe_secondary_submenu').addClass('o_hidden');if(self.current_menu){self.open_menu(self.current_menu);}
this.trigger('menu_bound');var lazyreflow=_.debounce(this.reflow.bind(this),200);core.bus.on('resize',this,function(){if($(window).width()<768){lazyreflow('all_outside');}else{lazyreflow();}});core.bus.trigger('resize');this.is_bound.resolve();},do_load_needaction:function(menu_ids){var self=this;menu_ids=_.compact(menu_ids);if(_.isEmpty(menu_ids)){return $.when();}
return this.rpc("/web/menu/load_needaction",{'menu_ids':menu_ids}).done(function(r){self.on_needaction_loaded(r);});},on_needaction_loaded:function(data){var self=this;this.needaction_data=data;_.each(this.needaction_data,function(item,menu_id){var $item=self.$secondary_menus.find('a[data-menu="'+menu_id+'"]');$item.find('.badge').remove();if(item.needaction_counter&&item.needaction_counter>0){$item.append(QWeb.render("Menu.needaction_counter",{widget:item}));}});},reflow:function(behavior){var self=this;var $more_container=this.$('#menu_more_container').hide();var $more=this.$('#menu_more');var $systray=this.$el.parents().find('.oe_systray');$more.children('li').insertBefore($more_container);if(behavior==='all_outside'){self.$el.show();this.$el.find('li').show();$more_container.hide();return;}
var $toplevel_items=this.$el.find('li').not($more_container).not($systray.find('li')).hide();self.$el.show();$toplevel_items.each(function(){var remaining_space=self.$el.parent().width()-$more_container.outerWidth();self.$el.parent().children(':visible').each(function(){remaining_space-=$(this).outerWidth();});if($(this).width()>=remaining_space){return false;}
$(this).show();});$more.append($toplevel_items.filter(':hidden').show());$more_container.toggle(!!$more.children().length);var $toplevel=self.$el.children("li:visible");if($toplevel.length===1){$toplevel.hide();}},open_menu:function(id){this.current_menu=id;session.active_id=id;var $clicked_menu,$sub_menu,$main_menu;$clicked_menu=this.$el.add(this.$secondary_menus).find('a[data-menu='+id+']');this.trigger('open_menu',id,$clicked_menu);if(this.$secondary_menus.has($clicked_menu).length){$sub_menu=$clicked_menu.parents('.oe_secondary_menu');$main_menu=this.$el.find('a[data-menu='+$sub_menu.data('menu-parent')+']');}else{$sub_menu=this.$secondary_menus.find('.oe_secondary_menu[data-menu-parent='+$clicked_menu.attr('data-menu')+']');$main_menu=$clicked_menu;}
this.$el.find('.active').removeClass('active');$main_menu.parent().addClass('active');this.$secondary_menus.find('.oe_secondary_menu').hide();$sub_menu.show();this.$secondary_menus.toggleClass('o_hidden',!$sub_menu.children().length);this.$secondary_menus.find('.active').removeClass('active');if($main_menu!==$clicked_menu){$clicked_menu.parents().removeClass('o_hidden');if($clicked_menu.is('.oe_menu_toggler')){$clicked_menu.toggleClass('oe_menu_opened').siblings('.oe_secondary_submenu:first').toggleClass('o_hidden');}else{$clicked_menu.parent().addClass('active');}}
this.$secondary_menus.find('.oe_secondary_submenu li a span').each(function(){$(this).tooltip(this.scrollWidth>this.clientWidth?{title:$(this).text().trim(),placement:'right'}:'destroy');});},open_action:function(id){var $menu=this.$el.add(this.$secondary_menus).find('a[data-action-id="'+id+'"]');var menu_id=$menu.data('menu');if(menu_id){this.open_menu(menu_id);}},menu_click:function(id,needaction){if(!id){return;}
var $item=this.$el.find('a[data-menu='+id+']');if(!$item.length){$item=this.$secondary_menus.find('a[data-menu='+id+']');}
var action_id=$item.data('action-id');if(!action_id){if(this.$el.has($item).length){var $sub_menu=this.$secondary_menus.find('.oe_secondary_menu[data-menu-parent='+id+']');var $items=$sub_menu.find('a[data-action-id]').filter('[data-action-id!=""]');if($items.length){action_id=$items.data('action-id');id=$items.data('menu');}}}
if(action_id){this.trigger('menu_click',{action_id:action_id,needaction:needaction,id:id,previous_menu_id:this.current_menu},$item);}else{console.log('Menu no action found web test 04 will fail');}
this.open_menu(id);},do_reload_needaction:function(){var self=this;if(self.current_menu){self.do_load_needaction([self.current_menu]).then(function(){self.trigger("need_action_reloaded");});}},on_change_top_menu:function(menu_id,needaction){var self=this;var $secondary_menu=this.$el.parents().find('.oe_secondary_menu[data-menu-parent='+menu_id+']');var $menu_leaves=$secondary_menu.children().find('.oe_menu_leaf');var menu_ids=_.map($menu_leaves,function(leave){return parseInt($(leave).attr('data-menu'),10);});self.do_load_needaction(menu_ids).then(function(){self.trigger("need_action_reloaded");});this.$el.parents().find(".oe_secondary_menus_container").scrollTop(0,0);this.menu_click(menu_id,needaction);},on_menu_click:function(ev){ev.preventDefault();var needaction=$(ev.target).is('div#menu_counter');this.menu_click($(ev.currentTarget).data('menu'),needaction);},});return Menu;});;

/* /web/static/src/js/views/list_common.js defined in bundle 'web.assets_backend' */
odoo.define('web.list_common',function(require){"use strict";var core=require('web.core');var _t=core._t;var Class=core.Class;var Events={bind:function(event,handler){var calls=this['_callbacks']||(this._callbacks={});if(event in calls){calls[event].push(handler);}else{calls[event]=[handler];}
return this;},unbind:function(event,handler){var calls=this._callbacks||{};if(!(event in calls)){return this;}
if(!handler){delete calls[event];}else{var handlers=calls[event];handlers.splice(_(handlers).indexOf(handler),1);}
return this;},trigger:function(event){var calls;if(!(calls=this._callbacks)){return this;}
var callbacks=(calls[event]||[]).concat(calls[null]||[]);for(var i=0,length=callbacks.length;i<length;++i){callbacks[i].apply(this,arguments);}
return this;}};var Record=Class.extend({init:function(data){this.attributes=data||{};},get:function(key){return this.attributes[key];},set:function(key,value,options){options=options||{};var old_value=this.attributes[key];if(old_value===value){return this;}
this.attributes[key]=value;if(!options.silent){this.trigger('change:'+key,this,value,old_value);this.trigger('change',this,key,value,old_value);}
return this;},toForm:function(){var form_data={},attrs=this.attributes;for(var k in attrs){form_data[k]={value:attrs[k]};}
return{data:form_data};},toContext:function(){var output={},attrs=this.attributes;for(var k in attrs){var val=attrs[k];if(typeof val!=='object'){output[k]=val;}else if(val instanceof Array){output[k]=val[0];}else{throw new Error(_.str.sprintf(_t("Can't convert value %s to context"),val));}}
return output;}});Record.include(Events);var Collection=Class.extend({init:function(records,options){options=options||{};_.bindAll(this,'_onRecordEvent');this.length=0;this.records=[];this._byId={};this._proxies={};this._key=options.key;this._parent=options.parent;if(records){this.add(records);}},add:function(record,options){options=options||{};var records=record instanceof Array?record:[record];for(var i=0,length=records.length;i<length;++i){var instance_=(records[i]instanceof Record)?records[i]:new Record(records[i]);instance_.bind(null,this._onRecordEvent);this._byId[instance_.get('id')]=instance_;if(options.at===undefined||options.at===null){this.records.push(instance_);if(!options.silent){this.trigger('add',this,instance_,this.records.length-1);}}else{var insertion_index=options.at+i;this.records.splice(insertion_index,0,instance_);if(!options.silent){this.trigger('add',this,instance_,insertion_index);}}
this.length++;}
return this;},at:function(index,group){if(group){var groups=group.split('.');return this._proxies[groups[0]].at(index,groups.join('.'));}
return this.records[index];},get:function(id){if(!_(this._proxies).isEmpty()){var record=null;_(this._proxies).detect(function(proxy){record=proxy.get(id);return record;});return record;}
return this._byId[id];},proxy:function(section){this._proxies[section]=new Collection(null,{parent:this,key:section}).bind(null,this._onRecordEvent);return this._proxies[section];},reset:function(records,options){options=options||{};_(this._proxies).each(function(proxy){proxy.reset();});this._proxies={};_(this.records).invoke('unbind',null,this._onRecordEvent);this.length=0;this.records=[];this._byId={};if(records){this.add(records);}
if(!options.silent){this.trigger('reset',this);}
return this;},remove:function(record,options){var index=this.indexOf(record);if(index===-1){_(this._proxies).each(function(proxy){proxy.remove(record);});return this;}
record.unbind(null,this._onRecordEvent);this.records.splice(index,1);delete this._byId[record.get('id')];this.length--;if(!options||!options.silent){this.trigger('remove',record,this);}
return this;},_onRecordEvent:function(event){switch(event){case'reset':return;case'change:id':var record=arguments[1];var new_value=arguments[2];var old_value=arguments[3];if(this._byId[old_value]===record){delete this._byId[old_value];this._byId[new_value]=record;}
break;}
this.trigger.apply(this,arguments);},find:function(callback){var record;for(var section in this._proxies){if(!this._proxies.hasOwnProperty(section)){continue;}
if((record=this._proxies[section].find(callback))){return record;}}
for(var i=0;i<this.length;++i){record=this.records[i];if(callback(record)){return record;}}},each:function(callback){for(var section in this._proxies){if(this._proxies.hasOwnProperty(section)){this._proxies[section].each(callback);}}
for(var i=0;i<this.length;++i){callback(this.records[i]);}},map:function(callback){var results=[];this.each(function(record){results.push(callback(record));});return results;},pluck:function(fieldname){return this.map(function(record){return record.get(fieldname);});},indexOf:function(record){return _(this.records).indexOf(record);},succ:function(record,options){options=options||{wraparound:false};var result;for(var section in this._proxies){if(!this._proxies.hasOwnProperty(section)){continue;}
if((result=this._proxies[section].succ(record,options))){return result;}}
var index=this.indexOf(record);if(index===-1){return null;}
var next_index=index+1;if(options.wraparound&&(next_index===this.length)){return this.at(0);}
return this.at(next_index);},pred:function(record,options){options=options||{wraparound:false};var result;for(var section in this._proxies){if(!this._proxies.hasOwnProperty(section)){continue;}
if((result=this._proxies[section].pred(record,options))){return result;}}
var index=this.indexOf(record);if(index===-1){return null;}
var next_index=index-1;if(options.wraparound&&(next_index===-1)){return this.at(this.length-1);}
return this.at(next_index);}});Collection.include(Events);return{Events:Events,Record:Record,Collection:Collection};});;

/* /web/static/src/js/views/list_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.ListView',function(require){"use strict";var core=require('web.core');var data=require('web.data');var data_manager=require('web.data_manager');var DataExport=require('web.DataExport');var formats=require('web.formats');var common=require('web.list_common');var Model=require('web.DataModel');var Pager=require('web.Pager');var pyeval=require('web.pyeval');var session=require('web.session');var Sidebar=require('web.Sidebar');var utils=require('web.utils');var View=require('web.View');var Class=core.Class;var _t=core._t;var _lt=core._lt;var QWeb=core.qweb;var list_widget_registry=core.list_widget_registry;var row_decoration=['decoration-bf','decoration-it','decoration-danger','decoration-info','decoration-muted','decoration-primary','decoration-success','decoration-warning'];var ListView=View.extend({_template:'ListView',accesskey:"l",require_fields:true,defaults:_.extend({},View.prototype.defaults,{selectable:true,deletable:false,header:true,addable:_lt("Create"),sortable:true,reorderable:true,action_buttons:true,disable_editable_mode:false,}),display_name:_lt('List'),events:{'click thead th.o_column_sortable[data-id]':'sort_by_column','click .oe_view_nocontent':function(){if(this.$buttons){this.$buttons.width(this.$buttons.width()+1).openerpBounce();}},},icon:'fa-list-ul',init:function(){var self=this;this._super.apply(this,arguments);this.options=_.defaults(this.options,{GroupsType:ListView.Groups,ListType:ListView.List,});this.previous_colspan=null;this.decoration=null;this.columns=[];this.records=new common.Collection();this.set_groups(new(this.options.GroupsType)(this));if(this.dataset instanceof data.DataSetStatic){this.groups.datagroup=new StaticDataGroup(this.dataset);}else{this.groups.datagroup=new DataGroup(this,this.model,this.dataset.get_domain(),this.dataset.get_context());this.groups.datagroup.sort=this.dataset._sort;}
this.records.bind('change',function(event,record,key){if(!_(self.aggregate_columns).chain().pluck('name').contains(key).value()){return;}
self.compute_aggregates();});this.no_leaf=false;this.grouped=false;if(!this.options.$pager||!this.options.$pager.length){this.options.$pager=false;}
this.options.deletable=this.options.deletable&&this.is_action_enabled('delete');this.name=""+this.fields_view.arch.attrs.string;this._limit=(this.options.limit||this.defaults.limit||(this.getParent().action||{}).limit||parseInt(this.fields_view.arch.attrs.limit,10)||80);this.current_min=1;var default_order=this.fields_view.arch.attrs.default_order;var unsorted=!this.dataset._sort.length;if(unsorted&&default_order&&!this.grouped){this.dataset.set_sort(default_order.split(','));}},willStart:function(){var self=this;this.decoration=_.pick(this.fields_view.arch.attrs,function(value,key){return row_decoration.indexOf(key)>=0;});this.decoration=_.mapObject(this.decoration,function(value){return py.parse(py.tokenize(value));});var fields_def=data_manager.load_fields(this.dataset).then(function(fields_get){self.fields_get=fields_get;});return $.when(this._super(),fields_def);},set_groups:function(groups){var self=this;if(this.groups){$(this.groups).unbind("selected deleted action row_link");delete this.groups;}
this.groups=groups;$(this.groups).bind({'selected':function(e,ids,records,deselected){self.do_select(ids,records,deselected);},'deleted':function(e,ids){self.do_delete(ids);},'action':function(e,action_name,id,callback){self.do_button_action(action_name,id,callback);},'row_link':function(e,id,dataset,view){self.do_activate_record(dataset.index,id,dataset,view);}});},compute_decoration_classnames:function(record){var classnames='';var context=_.extend({},record.attributes,{uid:session.uid,current_date:moment().format('YYYY-MM-DD')});_.each(this.decoration,function(expr,decoration){if(py.PY_isTrue(py.evaluate(expr,context))){classnames+=' '+decoration.replace('decoration','text');}});return classnames;},load_list:function(){var self=this;this.$el.html(QWeb.render(this._template,this));this.$el.addClass(this.fields_view.arch.attrs['class']);if(this.grouped){this.$('.o_list_view').addClass('o_list_view_grouped');}
this.$('.o_list_view').append(this.groups.elements);this.compute_aggregates();this.$('thead .o_list_record_selector input').click(function(){self.$('tbody .o_list_record_selector input').prop('checked',$(this).prop('checked')||false);var selection=self.groups.get_selection();$(self.groups).trigger('selected',[selection.ids,selection.records]);});if(this.dataset._sort.length){if(this.dataset._sort[0].indexOf('-')===-1){this.$('th[data-id='+this.dataset._sort[0]+']').addClass("o-sort-down");}else{this.$('th[data-id='+this.dataset._sort[0].split('-')[1]+']').addClass("o-sort-up");}}
this.trigger('list_view_loaded',data,this.grouped);return $.when();},render_buttons:function($node){if(!this.$buttons){this.$buttons=$(QWeb.render("ListView.buttons",{'widget':this}));this.$buttons.on('click','.o_list_button_add',this.proxy('do_add_record'));this.$buttons.appendTo($node);}},render_sidebar:function($node){if(!this.sidebar&&this.options.sidebar){this.sidebar=new Sidebar(this,{editable:this.is_action_enabled('edit')});if(this.fields_view.toolbar){this.sidebar.add_toolbar(this.fields_view.toolbar);}
this.sidebar.add_items('other',_.compact([{label:_t("Export"),callback:this.on_sidebar_export},this.fields_view.fields.active&&{label:_t("Archive"),callback:this.do_archive_selected},this.fields_view.fields.active&&{label:_t("Unarchive"),callback:this.do_unarchive_selected},this.is_action_enabled('delete')&&{label:_t('Delete'),callback:this.do_delete_selected}]));$node=$node||this.options.$sidebar;this.sidebar.appendTo($node);this.sidebar.do_hide();}},render_pager:function($node,options){if(!this.pager&&this.options.pager){this.pager=new Pager(this,this.dataset.size(),1,this._limit,options);this.pager.appendTo($node||this.options.$pager);this.pager.on('pager_changed',this,function(new_state){var self=this;var limit_changed=(this._limit!==new_state.limit);this._limit=new_state.limit;this.current_min=new_state.current_min;this.reload_content().then(function(){if(!limit_changed){self.set_scrollTop(0);self.trigger_up('scrollTo',{offset:0});}});});}},update_pager:function(dataset,current_min){this.dataset.ids=dataset.ids;if(dataset._length!==undefined){this.dataset._length=dataset._length;}
if(this.pager&&!this.grouped){var new_state={size:this.dataset.size(),limit:this._limit};if(current_min){new_state.current_min=current_min;}
this.pager.update_state(new_state);}},sort_by_column:function(e){e.stopPropagation();var $column=$(e.currentTarget);var col_name=$column.data('id');var field=this.fields_view.fields[col_name];if(field&&!field.sortable){return false;}
this.dataset.sort(col_name);if($column.hasClass("o-sort-down")||$column.hasClass("o-sort-up")){$column.toggleClass("o-sort-up o-sort-down");}else{$column.addClass("o-sort-down");}
$column.siblings('.o_column_sortable').removeClass("o-sort-up o-sort-down");return this.reload_content();},setup_columns:function(fields,grouped){this.columns.splice(0,this.columns.length);this.columns.push.apply(this.columns,_(this.fields_view.arch.children).map(function(field){var id=field.attrs.name;return for_(id,fields[id],field);}));if(grouped){this.columns.unshift(new ListView.MetaColumn('_group'));}
this.visible_columns=_.filter(this.columns,function(column){return column.invisible!=='1';});this.aggregate_columns=_(this.visible_columns).invoke('to_aggregate');},select_record:function(index,view){view=view||index===null||index===undefined?'form':'form';this.dataset.index=index;_.delay(_.bind(function(){this.do_switch_view(view);},this));},do_show:function(){this._super();if(this.sidebar){this.sidebar.do_hide();}},reload_content:synchronized(function(){var self=this;this.setup_columns(this.fields_view.fields,this.grouped);this.$('tbody .o_list_record_selector input').prop('checked',false);this.records.reset();var reloaded=$.Deferred();this.groups.render(function(){if(self.dataset.index===null){if(self.records.length){self.dataset.index=0;}}else if(self.dataset.index>=self.records.length){self.dataset.index=self.records.length?0:null;}
self.load_list().then(function(){if(!self.grouped&&self.display_nocontent_helper()){self.no_result();}
reloaded.resolve();});});this.do_push_state({min:this.current_min,limit:this._limit});return reloaded.promise();}),reload:function(){return this.reload_content();},reload_record:function(record){var self=this;var fields=this.fields_view.fields;return this.dataset.read_ids([record.get('id')],_.pluck(_(this.columns).filter(function(r){return r.tag==='field';}),'name'),{check_access_rule:true}).then(function(records){var values=records[0];if(!values){self.records.remove(record);return;}
for(var key in values){if(fields[key]&&fields[key].type==='many2many')
record.set(key+'__display',false,{silent:true});record.set(key,values[key],{silent:true});}
record.trigger('change',record);var def=$.Deferred();setTimeout(function(){def.resolve(records);},100);return def;});},do_load_state:function(state,warm){var reload=false;if(state.min&&this.current_min!==state.min){this.current_min=state.min;reload=true;}
if(state.limit){if(_.isString(state.limit)){state.limit=null;}
if(state.limit!==this._limit){this._limit=state.limit;reload=true;}}
if(reload){this.reload_content();}},on_sidebar_export:function(){new DataExport(this,this.dataset).open();},do_search:function(domain,context,group_by){this.current_min=1;this.groups.datagroup=new DataGroup(this,this.model,domain,context,group_by);this.groups.datagroup.sort=this.dataset._sort;if(_.isEmpty(group_by)&&!context['group_by_no_leaf']){group_by=null;}
this.no_leaf=!!context['group_by_no_leaf'];this.grouped=!!group_by;if(this.pager&&this.grouped){this.pager.do_hide();}
return this.reload_content();},do_delete:function(ids){if(!(ids.length&&confirm(_t("Do you really want to remove these records?")))){return;}
var self=this;return $.when(this.dataset.unlink(ids)).done(function(){_(ids).each(function(id){self.records.remove(self.records.get(id));});if(self.display_nocontent_helper()){self.no_result();}else{if(self.records.length&&self.current_min===1){self.reload();}else if(self.records.length&&self.dataset.size()>0){self.pager.previous();}
if(self.current_min+self._limit-1<self.dataset.size()){self.reload();}}
self.update_pager(self.dataset);self.compute_aggregates();});},do_select:function(ids,records,deselected){if(deselected){this.$('thead .o_list_record_selector input').prop('checked',false);}
if(!ids.length){this.dataset.index=0;if(this.sidebar){this.sidebar.do_hide();}
this.compute_aggregates();return;}
this.dataset.index=_(this.dataset.ids).indexOf(ids[0]);if(this.sidebar){this.sidebar.do_show();}
this.compute_aggregates(_(records).map(function(record){return{count:1,values:record};}));},do_button_action:function(name,id,callback){this.handle_button(name,id,callback);},handle_button:function(name,id,callback){var action=_.detect(this.columns,function(field){return field.name===name;});if(!action){return;}
if('confirm'in action&&!window.confirm(action.confirm)){return;}
var c=new data.CompoundContext();c.set_eval_context(_.extend({active_id:id,active_ids:[id],active_model:this.model},this.records.get(id).toContext()));if(action.context){c.add(action.context);}
action.context=c;this.do_execute_action(action,this.dataset,id,_.bind(callback,null,id));},do_activate_record:function(index,id,dataset,view){this.dataset.ids=dataset.ids;this.select_record(index,view);},do_add_record:function(){this.select_record(null);},do_delete_selected:function(){var ids=this.groups.get_selection().ids;if(ids.length){this.do_delete(this.groups.get_selection().ids);}else{this.do_warn(_t("Warning"),_t("You must select at least one record."));}},do_archive_selected:function(){var records=this.groups.get_selection().records;this.do_archive(records,true);},do_unarchive_selected:function(){var records=this.groups.get_selection().records;this.do_archive(records,false);},do_archive:function(records,archive){var active_value=!archive;var record_ids=[];_.each(records,function(record){if(record.active!=active_value){record_ids.push(record.id);}});if(record_ids.length){this.dataset.call('write',[record_ids,{active:active_value}]).done(_.bind(this.reload,this));}},compute_aggregates:function(records){var columns=_(this.aggregate_columns).filter(function(column){return column['function'];});if(_.isEmpty(columns)){return;}
if(_.isEmpty(records)){records=this.groups.get_records();}
records=_(records).compact();var count=0,sums={};_(columns).each(function(column){switch(column['function']){case'max':sums[column.id]=-Infinity;break;case'min':sums[column.id]=Infinity;break;default:sums[column.id]=0;}});_(records).each(function(record){count+=record.count||1;_(columns).each(function(column){var field=column.id,value=record.values[field];switch(column['function']){case'sum':sums[field]+=value;break;case'avg':sums[field]+=record.count*value;break;case'min':if(sums[field]>value){sums[field]=value;}
break;case'max':if(sums[field]<value){sums[field]=value;}
break;}});});var aggregates={};_(columns).each(function(column){var field=column.id;switch(column['function']){case'avg':aggregates[field]={value:sums[field]/count};break;default:aggregates[field]={value:sums[field]};}});this.display_aggregates(aggregates);},display_aggregates:function(aggregation){var $footer_cells=this.$('tfoot td');_(this.aggregate_columns).each(function(column){if(!column['function']){return;}
$footer_cells.filter(_.str.sprintf('[data-field=%s]',column.id)).addClass('o_list_number').html(column.format(aggregation,{process_modifiers:false}));});},get_selected_ids:function(){var ids=this.groups.get_selection().ids;return ids;},get_active_domain:function(){var self=this;if(this.$('thead .o_list_record_selector input').prop('checked')){var search_view=this.getParent().searchview;var search_data=search_view.build_search_data();return pyeval.eval_domains_and_contexts({domains:search_data.domains,contexts:search_data.contexts,group_by_seq:search_data.groupbys||[]}).then(function(results){var domain=self.dataset.domain.concat(results.domain||[]);return domain;});}
else{return $.Deferred().resolve();}},pad_columns:function(count,options){options=options||{};var $first_header=this.$('thead tr:first th');var colspan=$first_header.attr('colspan');if(colspan){if(!this.previous_colspan){this.previous_colspan=colspan;}
$first_header.attr('colspan',parseInt(colspan,10)+count);}
var $rows=this.$el.find('.oe_list_header_columns, tr:not(thead tr)').not(options['except']);var newcols=new Array(count+1).join('<td class="oe_list_padding"></td>');if(options.position==='before'){$rows.prepend(newcols);}else{$rows.append(newcols);}},unpad_columns:function(){this.$('.oe_list_padding').remove();if(this.previous_colspan){this.$el.find('thead tr:first th').attr('colspan',this.previous_colspan);this.previous_colspan=null;}},display_nocontent_helper:function(){return(this.dataset.size()===0);},no_result:function(){this.$('.oe_view_nocontent').remove();if(this.groups.group_by||!this.options.action||!this.options.action.help){return;}
this.$('table:first').hide();this.$el.prepend($('<div class="oe_view_nocontent">').html(this.options.action.help));}});core.view_registry.add('list',ListView);ListView.List=Class.extend({init:function(group,opts){var self=this;this.group=group;this.view=group.view;this.session=this.view.session;this.options=opts.options;this.columns=opts.columns;this.dataset=opts.dataset;this.records=opts.records;this.record_callbacks={'remove':function(event,record){var id=record.get('id');self.dataset.remove_ids([id]);var $row=self.$current.children('[data-id='+id+']');var index=$row.data('index');$row.remove();},'reset':function(){return self.on_records_reset();},'change':function(event,record,attribute,value,old_value){var $row;if(attribute==='id'){if(old_value){throw new Error(_.str.sprintf(_t("Setting 'id' attribute on existing record %s"),JSON.stringify(record.attributes)));}
self.dataset.add_ids([value],self.records.indexOf(record));$row=self.$current.children('[data-id=false]');}else{$row=self.$current.children('[data-id='+record.get('id')+']');}
var $newRow=$(self.render_record(record));$newRow.find('.o_list_record_selector input').prop('checked',!!$row.find('.o_list_record_selector input').prop('checked'));$row.replaceWith($newRow);},'add':function(ev,records,record,index){var $new_row=$(self.render_record(record));var id=record.get('id');if(id){self.dataset.add_ids([id],index);}
if(index===0){$new_row.prependTo(self.$current);}else{var previous_record=records.at(index-1),$previous_sibling=self.$current.children('[data-id='+previous_record.get('id')+']');$new_row.insertAfter($previous_sibling);}}};_(this.record_callbacks).each(function(callback,event){this.records.bind(event,callback);},this);this.$current=$('<tbody>').delegate('input[readonly=readonly]','click',function(e){e.preventDefault();}).delegate('td.o_list_record_selector','click',function(e){e.stopPropagation();var selection=self.get_selection();var checked=$(e.currentTarget).find('input').prop('checked');$(self).trigger('selected',[selection.ids,selection.records,!checked]);}).delegate('td.o_list_record_delete','click',function(e){e.stopPropagation();var $row=$(e.target).closest('tr');$(self).trigger('deleted',[[self.row_id($row)]]);if(document.hasFocus&&!document.hasFocus()){$('<input />').appendTo('body').focus().remove();}}).delegate('td button','click',function(e){e.stopPropagation();var $target=$(e.currentTarget),field=$target.closest('td').data('field'),$row=$target.closest('tr'),record_id=self.row_id($row);if($target.attr('disabled')){return;}
$target.attr('disabled','disabled');$(self).trigger('action',[field.toString(),record_id,function(id){$target.removeAttr('disabled');return self.reload_record(self.records.get(id));}]);}).delegate('a','click',function(e){e.stopPropagation();}).delegate('tr','click',function(e){var row_id=self.row_id(e.currentTarget);if(row_id){e.stopPropagation();if(!self.dataset.select_id(row_id)){throw new Error(_t("Could not find id in dataset"));}
self.row_clicked(e);}});},row_clicked:function(e,view){$(this).trigger('row_link',[this.dataset.ids[this.dataset.index],this.dataset,view]);},render_cell:function(record,column){var value;if(column.type==='reference'){value=record.get(column.id);var ref_match;if(value&&(ref_match=/^([\w\.]+),(\d+)$/.exec(value))){var model=ref_match[1],id=parseInt(ref_match[2],10);new data.DataSet(this.view,model).name_get([id]).done(function(names){if(!names.length){return;}
record.set(column.id+'__display',names[0][1]);});}}else if(column.type==='many2one'){value=record.get(column.id);if(typeof value==='number'||value instanceof Number){new data.DataSet(this.view,column.relation).name_get([value]).done(function(names){if(!names.length){return;}
record.set(column.id,names[0]);});}}else if(column.type==='many2many'){value=record.get(column.id);if(value instanceof Array&&!_.isEmpty(value)&&!record.get(column.id+'__display')){var ids;if(value[0]instanceof Array){_.each(value,function(command){switch(command[0]){case 4:ids.push(command[1]);break;case 5:ids=[];break;case 6:ids=command[2];break;default:throw new Error(_.str.sprintf(_t("Unknown m2m command %s"),command[0]));}});}else{ids=value;}
new Model(column.relation).call('name_get',[ids,this.dataset.get_context()]).done(function(names){record.set(column.id+'__display',_(names).pluck(1).join(', '));record.set(column.id,ids);});record.set(column.id+'__display',false);}}
return column.format(record.toForm().data,{model:this.dataset.model,id:record.get('id')});},render:function(){var self=this;this.$current.html(QWeb.render('ListView.rows',_.extend({},this,{render_cell:function(){return self.render_cell.apply(self,arguments);}})));this.pad_table_to(4);},pad_table_to:function(count){if(this.records.length>=count||_(this.columns).any(function(column){return column.meta;})){return;}
var cells=[];if(this.options.selectable){cells.push('<td class="o_list_record_selector"></td>');}
_(this.columns).each(function(column){if(column.invisible==='1'){return;}
cells.push('<td title="'+column.string+'">&nbsp;</td>');});if(this.options.deletable){cells.push('<td class="o_list_record_delete"></td>');}
cells.unshift('<tr>');cells.push('</tr>');var row=cells.join('');this.$current.children('tr:not([data-id])').remove().end().append(new Array(count-this.records.length+1).join(row));},get_selection:function(){var result={ids:[],records:[]};if(!this.options.selectable){return result;}
var records=this.records;this.$current.find('td.o_list_record_selector input:checked').closest('tr').each(function(){var record=records.get($(this).data('id'));result.ids.push(record.get('id'));result.records.push(record.attributes);});return result;},row_id:function(row){return $(row).data('id');},on_records_reset:function(){_(this.record_callbacks).each(function(callback,event){this.records.unbind(event,callback);},this);},get_records:function(){return this.records.map(function(record){return{count:1,values:record.attributes};});},reload_record:function(record){return this.view.reload_record(record);},render_record:function(record){var self=this;var index=this.records.indexOf(record);return QWeb.render('ListView.row',{columns:this.columns,options:this.options,record:record,row_parity:(index%2===0)?'even':'odd',view:this.view,render_cell:function(){return self.render_cell.apply(self,arguments);}});}});ListView.Groups=Class.extend({passthrough_events:'action deleted row_link',init:function(view,options){options=options||{};this.view=view;this.records=options.records||view.records;this.options=options.options||view.options;this.columns=options.columns||view.columns;this.datagroup=null;this.$row=null;this.children={};this.pager=null;var self=this;this.records.bind('reset',function(){return self.on_records_reset();});},make_fragment:function(){return document.createDocumentFragment();},point_insertion:function(row){var $row=$(row);var red_letter_tboday=$row.closest('tbody')[0];var $next_siblings=$row.nextAll();if($next_siblings.length){var $root_kanal=$('<tbody>').insertAfter(red_letter_tboday);$root_kanal.append($next_siblings);this.elements.splice(_.indexOf(this.elements,red_letter_tboday),0,$root_kanal[0]);}
return red_letter_tboday;},render_group_pager:function(){var self=this;if(this.datagroup.length>this.view._limit){this.pager=new Pager(this,this.datagroup.length,1,this.view._limit);this.pager.on('pager_changed',this,function(state){self.view._limit=state.limit;self.current_min=state.current_min;self.render().then(function(){self.$row.closest('tbody').next().replaceWith($(self.elements));});});var $last_cell=this.$row.children().last();$last_cell.addClass('o_group_pager');$last_cell.click(function(e){e.stopPropagation();});this.pager.appendTo($last_cell);}},open:function(point_insertion){this.render();$(this.elements).insertAfter(point_insertion);var no_subgroups=_(this.datagroup.group_by).isEmpty(),records_terminated=!this.datagroup.context['group_by_no_leaf'];if(no_subgroups&&records_terminated){this.render_group_pager();}},close:function(){if(this.pager){this.pager.destroy();}
this.records.reset();this.$to_be_removed.remove();},indent:function($node,level){return $('<span>').css({'float':'left','white-space':'pre'}).text(new Array(level).join('   ')).prependTo($node);},render_groups:function(datagroups){var self=this;var placeholder=this.make_fragment();_(datagroups).each(function(group){if(self.children[group.value]){self.records.proxy(group.value).reset();delete self.children[group.value];}
var child=self.children[group.value]=new(self.view.options.GroupsType)(self.view,{records:self.records.proxy(group.value),options:self.options,columns:self.columns});self.bind_child_events(child);child.datagroup=group;var $row=child.$row=$('<tr class="o_group_header">');if(group.openable&&group.length){$row.click(function(e){if(!$row.data('open')){$row.data('open',true).find('span.fa').removeClass('fa-caret-right').addClass('fa-caret-down');child.open(self.point_insertion(e.currentTarget));}else{$row.removeData('open').find('span.fa').removeClass('fa-caret-down').addClass('fa-caret-right');child.close();var selection=self.get_selection();$(self).trigger('selected',[selection.ids,this.records]);}});}
placeholder.appendChild($row[0]);var $group_column=$('<th class="o_group_name">').appendTo($row);if(group.grouped_on){var row_data={};row_data[group.grouped_on]=group;var group_label=_t("Undefined");var group_column=_(self.columns).detect(function(column){return column.id===group.grouped_on;});if(group_column){try{group_label=group_column.format(row_data,{value_if_empty:_t("Undefined"),process_modifiers:false});}catch(e){group_label=_.str.escapeHTML(row_data[group_column.id].value);}}else{group_label=group.value;var grouped_on_field=self.view.fields_get[group.grouped_on];if(grouped_on_field&&grouped_on_field.type==='selection'){group_label=_.find(grouped_on_field.selection,function(selection){return selection[0]===group.value;});}
if(group_label instanceof Array){group_label=group_label[1];}
if(group_label===false){group_label=_t('Undefined');}
group_label=_.str.escapeHTML(group_label);}
$group_column.html(_.str.sprintf("%s (%d)",group_label,group.length));if(group.length&&group.openable){$group_column.prepend('<span class="fa fa-caret-right" style="padding-right: 5px;">');}else{$group_column.prepend('<span class="fa">');}}
self.indent($group_column,group.level);if(self.options.selectable){$row.append('<td>');}
_(self.columns).chain().filter(function(column){return column.invisible!=='1';}).each(function(column){if(column.meta){}else if(column.id in group.aggregates){var r={};r[column.id]={value:group.aggregates[column.id]};$('<td class="oe_number">').html(column.format(r,{process_modifiers:false})).appendTo($row);}else{$row.append('<td>');}});if(self.options.deletable){$row.append('<td class="oe_list_group_pagination">');}});return placeholder;},bind_child_events:function(child){var $this=$(this),self=this;$(child).bind('selected',function(e,_0,_1,deselected){var selection=self.get_selection();$this.trigger(e,[selection.ids,selection.records,deselected]);}).bind(this.passthrough_events,function(e){var args=Array.prototype.slice.call(arguments,1);$this.trigger.call($this,e,args);});},render_dataset:function(dataset){var self=this,list=new(this.view.options.ListType)(this,{options:this.options,columns:this.columns,dataset:dataset,records:this.records});this.bind_child_events(list);var view=this.view;var current_min=this.datagroup.openable?this.current_min:view.current_min;var fields=_.pluck(_.select(this.columns,function(x){return x.tag=="field";}),'name');var options={offset:current_min-1,limit:view._limit,context:{bin_size:true}};return utils.async_when().then(function(){return dataset.read_slice(fields,options).then(function(records){if(self.records.length){self.records.reset(null,{silent:true});}
if(!self.datagroup.openable){view.update_pager(dataset,current_min);}
self.records.add(records,{silent:true});list.render();return list;});});},setup_resequence_rows:function(list,dataset){var sequence_field=_(this.columns).findWhere({'widget':'handle'});var seqname=sequence_field?sequence_field.name:'sequence';if((dataset.sort&&[seqname,seqname+' ASC',''].indexOf(dataset.sort())===-1)||!_(this.columns).findWhere({'name':seqname})){return;}
list.$current.sortable({axis:'y',items:'> tr[data-id]',helper:'clone'});if(sequence_field){list.$current.sortable('option','handle','.o_row_handle');}
list.$current.sortable('option',{start:function(e,ui){ui.placeholder.height(ui.item.height());},stop:function(event,ui){var to_move=list.records.get(ui.item.data('id')),target_id=ui.item.prev().data('id'),from_index=list.records.indexOf(to_move),target=list.records.get(target_id);if(list.records.at(from_index-1)==target){return;}
list.records.remove(to_move,{silent:true});var to=target_id?list.records.indexOf(target)+1:0;list.records.add(to_move,{at:to,silent:true});var record,index=to,seq=to?list.records.at(to-1).get(seqname):0;var defs=[];var fct=function(dataset,id,seq){defs.push(utils.async_when().then(function(){var attrs={};attrs[seqname]=seq;return dataset.write(id,attrs,{internal_dataset_changed:true});}));};while(++seq,(record=list.records.at(index++))){fct(dataset,record.get('id'),seq);record.set(seqname,seq);}
$.when.apply($,defs).then(function(){dataset.trigger("dataset_changed");});}});},render:function(post_render){var self=this;var $el=$('<tbody>');this.elements=[$el[0]];return this.datagroup.list(_(this.view.visible_columns).chain().filter(function(column){return column.tag==='field';}).pluck('name').value(),function(groups){$el[0].appendChild(self.render_groups(groups));if(post_render){post_render();}},function(dataset){return self.render_dataset(dataset).then(function(list){self.children[null]=list;self.elements=[list.$current.replaceAll($el)[0]];self.setup_resequence_rows(list,dataset);}).always(function(){if(post_render){post_render();}
self.view.trigger('view_list_rendered');});});},get_selection:function(){var ids=[],records=[];_(this.children).each(function(child){var selection=child.get_selection();ids.push.apply(ids,selection.ids);records.push.apply(records,selection.records);});return{ids:ids,records:records};},on_records_reset:function(){this.$to_be_removed=$(this.elements);_.each(this.children,function(child){this.$to_be_removed=this.$to_be_removed.add(child.$to_be_removed);}.bind(this));this.children={};},get_records:function(){if(_(this.children).isEmpty()){if(!this.datagroup.length){return;}
return{count:this.datagroup.length,values:this.datagroup.aggregates};}
return _(this.children).chain().map(function(child){return child.get_records();}).flatten().value();}});function synchronized(fn){var fn_mutex=new utils.Mutex();return function(){var obj=this;var args=_.toArray(arguments);return fn_mutex.exec(function(){if(obj.isDestroyed()){return $.when();}
return fn.apply(obj,args);});};}
var DataGroup=Class.extend({init:function(parent,model,domain,context,group_by,level){this.model=new Model(model,context,domain);this.group_by=group_by;this.context=context;this.domain=domain;this.level=level||0;},list:function(fields,ifGroups,ifRecords){var self=this;if(!_.isEmpty(this.group_by)){fields=_.unique((fields||[]).concat(this.group_by));}
var query=this.model.query(fields).order_by(this.sort).group_by(this.group_by);return $.when(query).then(function(querygroups){if(!querygroups){var ds=new data.DataSetSearch(self,self.model.name,self.model.context(),self.model.domain());ds._sort=self.sort;return ifRecords(ds);}
var child_datagroups=_(querygroups).map(function(group){var child_context=_.extend({},self.model.context(),group.model.context());var child_dg=new DataGroup(self,self.model.name,group.model.domain(),child_context,group.model._context.group_by,self.level+1);child_dg.sort=self.sort;child_dg.__context=child_context;child_dg.__domain=group.model.domain();child_dg.folded=group.get('folded');child_dg.grouped_on=group.get('grouped_on');child_dg.length=group.get('length');child_dg.value=group.get('value');child_dg.openable=group.get('has_children');child_dg.aggregates=group.get('aggregates');return child_dg;});ifGroups(child_datagroups);});}});var StaticDataGroup=DataGroup.extend({init:function(dataset){this.dataset=dataset;},list:function(fields,ifGroups,ifRecords){return ifRecords(this.dataset);}});var Column=Class.extend({init:function(id,tag,attrs){_.extend(attrs,{id:id,tag:tag});this.modifiers=attrs.modifiers?JSON.parse(attrs.modifiers):{};delete attrs.modifiers;_.extend(this,attrs);if(this.modifiers['tree_invisible']){this.invisible='1';}else{delete this.invisible;}},modifiers_for:function(fields){var out={};var domain_computer=data.compute_domain;for(var attr in this.modifiers){if(!this.modifiers.hasOwnProperty(attr)){continue;}
var modifier=this.modifiers[attr];out[attr]=_.isBoolean(modifier)?modifier:domain_computer(modifier,fields);}
return out;},to_aggregate:function(){if(this.type!=='integer'&&this.type!=='float'&&this.type!=='monetary'){return{};}
var aggregation_func=(this.sum&&'sum')||(this.avg&&'avg')||(this.max&&'max')||(this.min&&'min');if(!aggregation_func){return{};}
var C=function(fn,label){this['function']=fn;this.label=label;};C.prototype=this;return new C(aggregation_func,this[aggregation_func]);},heading:function(){return _.escape(this.string);},width:function(){},format:function(row_data,options){options=options||{};var attrs={};if(options.process_modifiers!==false){attrs=this.modifiers_for(row_data);}
if(attrs.invisible){return'';}
if(!row_data[this.id]){return options.value_if_empty===undefined?'':options.value_if_empty;}
var f=this._format(row_data,options);return(f!=='')?f:'&nbsp;';},_format:function(row_data,options){return _.escape(formats.format_value(row_data[this.id].value,this,options.value_if_empty));}});ListView.Column=Column;var MetaColumn=Column.extend({meta:true,init:function(id,string){this._super(id,'',{string:string});}});ListView.MetaColumn=MetaColumn;var ColumnButton=Column.extend({format:function(row_data,options){options=options||{};var attrs={};if(options.process_modifiers!==false){attrs=this.modifiers_for(row_data);}
if(attrs.invisible){return'';}
var template=this.icon&&'ListView.row.button'||'ListView.row.text_button';return QWeb.render(template,{widget:this,prefix:session.prefix,disabled:attrs.readonly||isNaN(row_data.id.value)||data.BufferedDataSet.virtual_id_regex.test(row_data.id.value)});}});var ColumnBoolean=Column.extend({_format:function(row_data,options){return _.str.sprintf('<div class="o_checkbox"><input type="checkbox" %s disabled="disabled"/><span/></div>',row_data[this.id].value?'checked="checked"':'');}});var ColumnBinary=Column.extend({_format:function(row_data,options){var text=_t("Download"),filename=_t('Binary file');var value=row_data[this.id].value;if(!value){return options.value_if_empty||'';}
var download_url;if(value.substr(0,10).indexOf(' ')==-1){download_url="data:application/octet-stream;base64,"+value;}else{download_url=session.url('/web/content',{model:options.model,field:this.id,id:options.id,download:true});if(this.filename){download_url+='&filename_field='+this.filename;}}
if(this.filename&&row_data[this.filename]){text=_.str.sprintf(_t("Download \"%s\""),formats.format_value(row_data[this.filename].value,{type:'char'}));filename=row_data[this.filename].value;}
return _.template('<a download="<%-download%>" href="<%-href%>"><%-text%></a> (<%-size%>)')({text:text,href:download_url,size:utils.binary_to_binsize(value),download:filename,});}});var ColumnChar=Column.extend({replacement:'*',_format:function(row_data,options){var value=row_data[this.id].value;if(value&&this.password==='True'){return value.replace(/[\s\S]/g,_.escape(this.replacement));}
return this._super(row_data,options);}});var ColumnProgressBar=Column.extend({_format:function(row_data,options){return _.template('<progress value="<%-value%>" max="100"><%-value%>%</progress>')({value:_.str.sprintf("%.0f",row_data[this.id].value||0)});}});var ColumnHandle=Column.extend({init:function(){this._super.apply(this,arguments);this.modifiers.readonly=true;this.string="";},heading:function(){return'<span class="o_row_handle fa fa-arrows invisible"></span>';},width:function(){return 1;},_format:function(row_data,options){return'<span class="o_row_handle fa fa-arrows"/>';}});var ColumnMany2OneButton=Column.extend({_format:function(row_data,options){this.has_value=!!row_data[this.id].value;this.icon=this.has_value?'fa-circle o_toggle_button_success':'fa-circle text-danger';this.string=this.has_value?_t('View'):_t('Create');return QWeb.render('Many2OneButton.cell',{'widget':this,'prefix':session.prefix,});},});var ColumnMany2Many=Column.extend({_format:function(row_data,options){if(!_.isEmpty(row_data[this.id].value)){row_data[this.id]=row_data[this.id+'__display'];}
return this._super(row_data,options);}});var ColumnReference=Column.extend({_format:function(row_data,options){if(!_.isEmpty(row_data[this.id].value)){if(!!row_data[this.id+'__display']){row_data[this.id]=row_data[this.id+'__display'];}else{row_data[this.id]={'value':''};}}
return this._super(row_data,options);}});var ColumnUrl=Column.extend({PROTOCOL_REGEX:/^(?!\w+:?\/\/)/,_format:function(row_data,options){var value=row_data[this.id].value;if(value){return _.template("<a href='<%-href%>' target='_blank'><%-text%></a>")({href:value.trim().replace(this.PROTOCOL_REGEX,'//'),text:value});}
return this._super(row_data,options);}});var ColumnMonetary=Column.extend({_format:function(row_data,options){var options=pyeval.py_eval(this.options||'{}');var currency_field=(_.isEmpty(options)===false&&options.currency_field)||this.currency_field||'currency_id';var currency_id=row_data[currency_field]&&row_data[currency_field].value[0];var currency=session.get_currency(currency_id);var digits_precision=this.digits||(currency&&currency.digits);var value=formats.format_value(row_data[this.id].value||0,{type:this.type,digits:digits_precision},options.value_if_empty);if(currency){if(currency.position==="after"){value+='&nbsp;'+currency.symbol;}else{value=currency.symbol+'&nbsp;'+value;}}
return value;},});var ColumnToggleButton=Column.extend({format:function(row_data,options){this._super(row_data,options);var button_tips=JSON.parse(this.options);var fieldname=this.field_name;var has_value=row_data[fieldname]&&!!row_data[fieldname].value;this.icon=has_value?'fa-circle o_toggle_button_success':'fa-circle text-muted';this.string=has_value?(button_tips?button_tips['active']:''):(button_tips?button_tips['inactive']:'');return QWeb.render('toggle_button',{widget:this,prefix:session.prefix,});},});list_widget_registry.add('field',Column).add('field.boolean',ColumnBoolean).add('field.binary',ColumnBinary).add('field.char',ColumnChar).add('field.progressbar',ColumnProgressBar).add('field.handle',ColumnHandle).add('button',ColumnButton).add('field.many2onebutton',ColumnMany2OneButton).add('field.reference',ColumnReference).add('field.many2many',ColumnMany2Many).add('field.url',ColumnUrl).add('button.toggle_button',ColumnToggleButton).add('field.monetary',ColumnMonetary);function for_(id,field,node){var description=_.extend({tag:node.tag},field,node.attrs);var tag=description.tag;var Type=list_widget_registry.get_any([tag+'.'+description.widget,tag+'.'+description.type,tag]);return new Type(id,node.tag,description);}
return ListView;});;

/* /web/static/src/js/views/form_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.FormView',function(require){"use strict";var common=require('web.form_common');var core=require('web.core');var crash_manager=require('web.crash_manager');var data=require('web.data');var Dialog=require('web.Dialog');var FormRenderingEngine=require('web.FormRenderingEngine');var Model=require('web.DataModel');var Pager=require('web.Pager');var Sidebar=require('web.Sidebar');var utils=require('web.utils');var View=require('web.View');var _t=core._t;var _lt=core._lt;var QWeb=core.qweb;var FormView=View.extend(common.FieldManagerMixin,{className:"o_form_view",defaults:_.extend({},View.prototype.defaults,{not_interactible_on_create:false,initial_mode:"view",disable_autofocus:false,footer_to_buttons:false,}),display_name:_lt('Form'),icon:'fa-edit',multi_record:false,searchable:false,on_attach_callback:function(){this.trigger('attached');this.autofocus();},on_detach_callback:function(){this.trigger('detached');},init:function(){var self=this;this._super.apply(this,arguments);this.fields={};this.fields_order=[];this.datarecord={};this._onchange_specs={};this.onchanges_mutex=new utils.Mutex();this.default_focus_field=null;this.default_focus_button=null;this.fields_registry=core.form_widget_registry;this.tags_registry=core.form_tag_registry;this.widgets_registry=core.form_custom_registry;this.has_been_loaded=$.Deferred();this.translatable_fields=[];this.is_initialized=$.Deferred();this.record_loaded=$.Deferred();this.mutating_mutex=new utils.Mutex();this.save_list=[];this.render_value_defs=[];this.reload_mutex=new utils.Mutex();this.__clicked_inside=false;this.__blur_timeout=null;this.rendering_engine=new FormRenderingEngine(this);this.set({actual_mode:this.options.initial_mode});this.has_been_loaded.done(function(){self._build_onchange_specs();self.on("change:actual_mode",self,self.toggle_buttons);self.on("change:actual_mode",self,self.toggle_sidebar);});self.on("load_record",self,self.load_record);core.bus.on('clear_uncommitted_changes',this,function(chain_callbacks){var self=this;chain_callbacks(function(){return self.can_be_discarded();});});},start:function(){if(this.$pager){this.$pager.off();}
var self=this;this.rendering_engine.set_fields_registry(this.fields_registry);this.rendering_engine.set_tags_registry(this.tags_registry);this.rendering_engine.set_widgets_registry(this.widgets_registry);this.rendering_engine.set_fields_view(this.fields_view);this.rendering_engine.render_to(this.$el);this.$el.on('mousedown.formBlur',function(){self.__clicked_inside=true;});this.has_been_loaded.resolve();this.$(".oe_title,.o_group").on('click',function(e){if(self.get("actual_mode")==="view"&&self.$buttons&&!$(e.target).is('[data-toggle]')){self.$buttons.find(".o_form_button_edit").openerpBounce();core.bus.trigger('click',e);}});return this._super();},destroy:function(){_.each(this.get_widgets(),function(w){w.off('focused blurred');w.destroy();});if(this.$el){this.$el.off('.formBlur');}
this._super();},render_buttons:function($node){this.$buttons=$('<div/>');var $footer=this.$('footer');if(this.options.action_buttons!==false||this.options.footer_to_buttons&&$footer.children().length===0){this.$buttons.append(QWeb.render("FormView.buttons",{'widget':this}));}
if(this.options.footer_to_buttons){$footer.appendTo(this.$buttons);}
this.toggle_buttons();this.$buttons.on('click','.o_form_button_create',this.on_button_create);this.$buttons.on('click','.o_form_button_edit',this.on_button_edit);this.$buttons.on('click','.o_form_button_save',this.on_button_save);this.$buttons.on('click','.o_form_button_cancel',this.on_button_cancel);this.$buttons.appendTo($node);},render_sidebar:function($node){if(!this.sidebar&&this.options.sidebar){this.sidebar=new Sidebar(this,{editable:this.is_action_enabled('edit')});if(this.fields_view.toolbar){this.sidebar.add_toolbar(this.fields_view.toolbar);}
this.sidebar.add_items('other',_.compact([this.is_action_enabled('delete')&&{label:_t('Delete'),callback:this.on_button_delete},this.is_action_enabled('create')&&{label:_t('Duplicate'),callback:this.on_button_duplicate}]));this.sidebar.appendTo($node);this.toggle_sidebar();}},render_pager:function($node){if(this.options.pager){var self=this;var options={validate:_.bind(this.can_be_discarded,this),};this.pager=new Pager(this,this.dataset.ids.length,this.dataset.index+1,1,options);this.pager.on('pager_changed',this,function(new_state){this.pager.disable();this.dataset.index=new_state.current_min-1;this.trigger('pager_action_executed');$.when(this.reload()).then(function(){self.pager.enable();});});this.pager.appendTo($node=$node||this.options.$pager);if(this.get("actual_mode")==="create"){this.pager.do_hide();}}},toggle_buttons:function(){var view_mode=this.get("actual_mode")==="view";if(this.$buttons){this.$buttons.find('.o_form_buttons_view').toggle(view_mode);this.$buttons.find('.o_form_buttons_edit').toggle(!view_mode);}},toggle_sidebar:function(){if(this.sidebar){this.sidebar.do_toggle(this.get("actual_mode")==="view");}},update_pager:function(){if(this.pager){if(this.get("actual_mode")==="create"){this.pager.do_hide();}else{this.pager.update_state({size:this.dataset.ids.length,current_min:this.dataset.index+1});}}},widgetFocused:function(){this.__clicked_inside=false;if(this.__blur_timeout){clearTimeout(this.__blur_timeout);this.__blur_timeout=null;}},widgetBlurred:function(){if(this.__clicked_inside){this.__clicked_inside=false;return;}
var self=this;this.widgetFocused();this.__blur_timeout=setTimeout(function(){self.trigger('blurred');},0);},do_load_state:function(state,warm){if(state.id&&this.datarecord.id!=state.id){if(this.dataset.get_id_index(state.id)===null){this.dataset.ids.push(state.id);}
this.dataset.select_id(state.id);this.do_show();}},do_show:function(options){var self=this;options=options||{};this.$el.removeClass('oe_form_dirty');var shown=this.has_been_loaded;if(options.reload!==false){shown=shown.then(function(){if(self.dataset.index===null){return self.on_button_new();}
var fields=_.keys(self.fields_view.fields);fields.push('display_name');fields.push('__last_update');return self.dataset.read_index(fields,{context:{'bin_size':true}}).then(function(r){self.trigger('load_record',r);});});}
return $.when(shown,this._super()).then(function(){self._actualize_mode(options.mode||self.options.initial_mode);core.bus.trigger('form_view_shown',self);});},load_record:function(record){var self=this,set_values=[];if(!record){this.set({'title':undefined});this.do_warn(_t("Form"),_t("The record could not be found in the database."),true);return $.Deferred().reject();}
this.datarecord=record;this.record_loaded=$.Deferred();_(this.fields).each(function(field,f){field._dirty_flag=false;field._inhibit_on_change_flag=true;var result=field.set_value(self.datarecord[f]||false);field._inhibit_on_change_flag=false;set_values.push(result);});this._actualize_mode();this.set({'title':record.id?record.display_name:_t("New")});this.update_pager();return $.when.apply(null,set_values).then(function(){if(!record.id){self.do_onchange(null);}
self.on_form_changed();self.rendering_engine.init_fields().then(function(){self.is_initialized.resolve();self.record_loaded.resolve();if(self.sidebar){self.sidebar.do_attachement_update(self.dataset,self.datarecord.id);}
if(record.id){self.do_push_state({id:record.id});}else{self.do_push_state({});}
self.$el.removeClass('oe_form_dirty');});});},load_defaults:function(){var self=this;var keys=_.keys(this.fields_view.fields);if(keys.length){return this.dataset.default_get(keys).then(function(r){self.trigger('load_record',_.clone(r));});}
return $.when().then(this.trigger.bind(this,'load_record',{}));},on_form_changed:function(){this.trigger("view_content_has_changed");},do_notify_change:function(){this.$el.addClass('oe_form_dirty');},_build_onchange_specs:function(){var self=this;var find=function(field_name,root){var fields=[root];while(fields.length){var node=fields.pop();if(!node){continue;}
if(node.tag==='field'&&node.attrs.name===field_name){return node.attrs.on_change||"";}
fields=_.union(fields,node.children);}
return"";};self._onchange_fields=[];self._onchange_specs={};_.each(this.fields,function(field,name){self._onchange_fields.push(name);self._onchange_specs[name]=find(name,field.node);_.each(field.field.views,function(view){_.each(view.fields,function(_,subname){self._onchange_specs[name+'.'+subname]=find(subname,view.arch);});});});},_get_onchange_values:function(){var field_values=this.get_fields_values();if(field_values.id.toString().match(data.BufferedDataSet.virtual_id_regex)){delete field_values.id;}
if(this.dataset.parent_view){var parent_view=this.dataset.parent_view;var child_name=this.dataset.child_name;var parent_name=parent_view.get_field_desc(child_name).relation_field;if(parent_name){var parent_values=parent_view.get_fields_values();delete parent_values[child_name];field_values[parent_name]=parent_values;}}
return field_values;},do_onchange:function(widget){var self=this;var onchange_specs=self._onchange_specs;try{var def=$.when({});var change_spec=widget?onchange_specs[widget.name]:null;if(!widget||(!_.isEmpty(change_spec)&&change_spec!=="0")){var ids=[],trigger_field_name=widget?widget.name:self._onchange_fields,values=self._get_onchange_values(),context=new data.CompoundContext(self.dataset.get_context());if(widget&&widget.build_context()){context.add(widget.build_context());}
if(self.dataset.parent_view){var parent_name=self.dataset.parent_view.get_field_desc(self.dataset.child_name).relation_field;context.add({field_parent:parent_name});}
if(self.datarecord.id&&!data.BufferedDataSet.virtual_id_regex.test(self.datarecord.id)){ids.push(self.datarecord.id);}
def=self.alive(self.dataset.call("onchange",[ids,values,trigger_field_name,onchange_specs,context]));}
this.onchanges_mutex.exec(function(){return def.then(function(response){var fields={};if(widget){fields[widget.name]=widget.field;}
else{fields=self.fields_view.fields;}
var defs=[];_.each(fields,function(field,fieldname){if(field&&field.change_default){var value_;if(response.value&&(fieldname in response.value)){value_=response.value[fieldname];}else{value_=self.fields[fieldname].get_value();}
var condition=fieldname+'='+value_;if(value_){defs.push(self.alive(new Model('ir.values').call('get_defaults',[self.model,condition])).then(function(results){if(!results.length){return response;}
if(!response.value){response.value={};}
for(var i=0;i<results.length;++i){var triplet=results[i];response.value[triplet[1]]=triplet[2];}
return response;}));}}});return _.isEmpty(defs)?response:$.when.apply(null,defs);}).then(function(response){return self.on_processed_onchange(response);});});return this.onchanges_mutex.def;}catch(e){console.error(e);crash_manager.show_message(e);return $.Deferred().reject();}},on_processed_onchange:function(result){try{var fields=this.fields;_(result.domain).each(function(domain,fieldname){var field=fields[fieldname];if(!field){return;}
field.node.attrs.domain=domain;});var def=$.when(!_.isEmpty(result.value)&&this._internal_set_values(result.value));if(!_.isEmpty(result.warning)){this.warning_displayed=true;var dialog=new Dialog(this,{size:'medium',title:result.warning.title,$content:QWeb.render("CrashManager.warning",result.warning)});dialog.open();dialog.on('closed',this,function(){this.warning_displayed=false;});}
return def;}catch(e){console.error(e);crash_manager.show_message(e);return $.Deferred().reject();}},_process_operations:function(){var self=this;return this.mutating_mutex.exec(function(){function onchanges_mutex(){return self.onchanges_mutex.def;}
function iterate(){var mutex=new utils.Mutex();mutex.exec(onchanges_mutex);_.each(self.fields,function(field){mutex.exec(function(){return field.commit_value();});mutex.exec(onchanges_mutex);});return mutex.def.then(function(){var save_obj=self.save_list.pop();if(save_obj){return self._process_save(save_obj).then(function(){save_obj.ret=_.toArray(arguments);return iterate();},function(){save_obj.error=true;});}
return $.when();}).fail(function(){self.save_list.pop();return $.when();});}
return iterate();});},_internal_set_values:function(values){for(var f in values){if(!values.hasOwnProperty(f)){continue;}
var field=this.fields[f];if(field){var value_=values[f];if(field.get_value()!==value_){field._inhibit_on_change_flag=true;field.set_value(value_);field._inhibit_on_change_flag=false;field._dirty_flag=true;}}}
this.on_form_changed();},set_values:function(values){var self=this;return this.mutating_mutex.exec(function(){self._internal_set_values(values);});},to_view_mode:function(){this._actualize_mode("view");this.trigger('to_view_mode');},to_edit_mode:function(){this.onchanges_mutex=new utils.Mutex();this._actualize_mode("edit");this.trigger('to_edit_mode');},_actualize_mode:function(switch_to){var mode=switch_to||this.get("actual_mode");if(!this.datarecord.id){mode="create";}else if(mode==="create"){mode="edit";}
var viewMode=(mode==="view");this.$el.toggleClass('o_form_readonly',viewMode).toggleClass('o_form_editable',!viewMode);this.render_value_defs=[];this.set({actual_mode:mode});if(!viewMode){this.autofocus();}},autofocus:function(){if(this.get("actual_mode")!=="view"&&!this.options.disable_autofocus){var fields_order=this.fields_order.slice(0);if(this.default_focus_field){fields_order.unshift(this.default_focus_field.name);}
for(var i=0;i<fields_order.length;i+=1){var field=this.fields[fields_order[i]];if(!field.get('effective_invisible')&&!field.get('effective_readonly')&&field.$label){if(field.focus()!==false){break;}}}}},disable_button:function(){this.$('.oe_form_buttons,.o_statusbar_buttons').add(this.$buttons).find('button').addClass('o_disabled').prop('disabled',true);this.is_disabled=true;},enable_button:function(){this.$('.oe_form_buttons,.o_statusbar_buttons').add(this.$buttons).find('button.o_disabled').removeClass('o_disabled').prop('disabled',false);this.is_disabled=false;},on_button_save:function(){var self=this;if(this.is_disabled){return;}
this.disable_button();return this.save().then(function(result){self.trigger("save",result);return self.reload().then(function(){self.to_view_mode();core.bus.trigger('do_reload_needaction');core.bus.trigger('form_view_saved',self);}).always(function(){self.enable_button();});}).fail(function(){self.enable_button();});},on_button_cancel:function(){var self=this;this.can_be_discarded().then(function(){if(self.get('actual_mode')==='create'){self.trigger('history_back');}else{self.to_view_mode();$.when.apply(null,self.render_value_defs).then(function(){self.trigger('load_record',self.datarecord);});}});this.trigger('on_button_cancel');return false;},on_button_new:function(){return $.when(this.has_been_loaded).then(this.can_be_discarded.bind(this)).then(this.load_defaults.bind(this));},on_button_edit:function(){return this.to_edit_mode();},on_button_create:function(){this.dataset.index=null;this.do_show();},on_button_duplicate:function(){var self=this;return this.has_been_loaded.then(function(){return self.dataset.call('copy',[self.datarecord.id,{},self.dataset.context]).then(function(new_id){self.record_created(new_id);self.to_edit_mode();});});},on_button_delete:function(){var self=this;var def=$.Deferred();this.has_been_loaded.done(function(){if(self.datarecord.id&&confirm(_t("Do you really want to delete this record?"))){self.dataset.unlink([self.datarecord.id]).done(function(){if(self.dataset.size()){self.reload();self.update_pager();}else{self.do_action('history_back');}
def.resolve();});}else{utils.async_when().done(function(){def.reject();});}});return def.promise();},can_be_discarded:function(message){if(!this.$el.is('.oe_form_dirty')){return $.Deferred().resolve();}
message=message||_t("The record has been modified, your changes will be discarded. Are you sure you want to leave this page ?");var self=this;var def=$.Deferred();var options={title:_t("Warning"),confirm_callback:function(){self.$el.removeClass('oe_form_dirty');this.on('closed',null,function(){def.resolve();});},cancel_callback:function(){def.reject();},};var dialog=Dialog.confirm(this,message,options);dialog.$modal.on('hidden.bs.modal',function(){def.reject();});return def;},save:function(prepend_on_create){var self=this;var save_obj={prepend_on_create:prepend_on_create,ret:null};this.save_list.push(save_obj);return self._process_operations().then(function(){if(save_obj.error)
return $.Deferred().reject();return $.when.apply($,save_obj.ret);}).done(function(result){self.$el.removeClass('oe_form_dirty');});},_process_save:function(save_obj){var self=this;var prepend_on_create=save_obj.prepend_on_create;var def_process_save=$.Deferred();try{var form_invalid=false,values={},first_invalid_field=null,readonly_values={},deferred=[];$.when.apply($,deferred).always(function(){_.each(self.fields,function(f){if(!f.is_valid()){form_invalid=true;if(!first_invalid_field){first_invalid_field=f;}}else if(f.name!=='id'&&(!self.datarecord.id||f._dirty_flag)){if(!f.get("readonly")){values[f.name]=f.get_value(true);}else{readonly_values[f.name]=f.get_value(true);}}});if(!self.datarecord.id&&self.fields.sequence&&!_.has(values,'sequence')&&!_.isEmpty(self.dataset.cache)){var current=_[prepend_on_create?"min":"max"](_.map(self.dataset.cache,function(o){return o.values.sequence}));values['sequence']=prepend_on_create?current-1:current+1;}
if(form_invalid){self.set({'display_invalid_fields':true});first_invalid_field.focus();self.on_invalid();def_process_save.reject();}else{self.set({'display_invalid_fields':false});var save_deferral;if(!self.datarecord.id){save_deferral=self.dataset.create(values,{readonly_fields:readonly_values}).then(function(r){self.display_translation_alert(values);return self.record_created(r,prepend_on_create);},null);}else if(_.isEmpty(values)){save_deferral=$.Deferred().resolve({}).promise();}else{save_deferral=self.dataset.write(self.datarecord.id,values,{readonly_fields:readonly_values}).then(function(r){self.display_translation_alert(values);return self.record_saved(r);},null);}
save_deferral.then(function(result){def_process_save.resolve(result);}).fail(function(){def_process_save.reject();});}});}catch(e){console.error(e);return def_process_save.reject();}
return def_process_save;},on_invalid:function(){var warnings=_(this.fields).chain().filter(function(f){return!f.is_valid();}).map(function(f){return _.str.sprintf('<li>%s</li>',_.escape(f.string));}).value();warnings.unshift('<ul>');warnings.push('</ul>');this.do_warn(_t("The following fields are invalid:"),warnings.join(''));},record_saved:function(r){this.trigger('record_saved',r);if(!r){return $.Deferred().reject();}
return r;},record_created:function(r,prepend_on_create){var self=this;if(!r){this.trigger('record_created',r);return $.Deferred().reject();}else{this.datarecord.id=r;if(!prepend_on_create){this.dataset.alter_ids(this.dataset.ids.concat([this.datarecord.id]));this.dataset.index=this.dataset.ids.length-1;}else{this.dataset.alter_ids([this.datarecord.id].concat(this.dataset.ids));this.dataset.index=0;}
this.update_pager();if(this.sidebar){this.sidebar.do_attachement_update(this.dataset,this.datarecord.id);}
return $.when(this.reload()).then(function(){self.trigger('record_created',r);return _.extend(r,{created:true});});}},on_action:function(action){console.debug('Executing action',action);},reload:function(){var self=this;return this.reload_mutex.exec(function(){if(self.dataset.index===null||self.dataset.index===undefined){self.trigger("previous_view");return $.Deferred().reject().promise();}
if(self.dataset.index<0){return $.when(self.on_button_new());}else{var fields=_.keys(self.fields_view.fields);fields.push('display_name');fields.push('__last_update');return self.dataset.read_index(fields,{context:{'bin_size':true},check_access_rule:true}).then(function(r){self.trigger('load_record',r);}).fail(function(){self.do_action('history_back');});}});},get_widgets:function(){return _.filter(this.getChildren(),function(obj){return obj instanceof common.FormWidget;});},get_fields_values:function(){var values={};var ids=this.get_selected_ids();values["id"]=ids.length>0?ids[0]:false;_.each(this.fields,function(value_,key){values[key]=value_.get_value();});return values;},get_selected_ids:function(){var id=this.dataset.ids[this.dataset.index];return id?[id]:[];},recursive_save:function(){var self=this;return $.when(this.save()).then(function(res){if(self.dataset.parent_view)
return self.dataset.parent_view.recursive_save();});},recursive_reload:function(){var self=this;var pre=$.when();if(self.dataset.parent_view)
pre=self.dataset.parent_view.recursive_reload();return pre.then(function(){return self.reload();});},is_dirty:function(){return _.any(this.fields,function(value_){return value_._dirty_flag;});},is_interactible_record:function(){var id=this.datarecord.id;if(!id){if(this.options.not_interactible_on_create)
return false;}else if(typeof(id)==="string"){if(data.BufferedDataSet.virtual_id_regex.test(id))
return false;}
return true;},sidebar_eval_context:function(){return $.when(this.build_eval_context());},display_translation_alert:function(values){if(_t.database.multi_lang){var alert_fields=_.filter(this.translatable_fields,function(field){return _.has(values,field.name)});if(alert_fields.length){var $content=$(QWeb.render('translation-alert',{fields:alert_fields,lang:_t.database.parameters.name}));$content.find('.oe_field_translate').click(function(ev){ev.preventDefault();_.find(alert_fields,{'name':ev.target.name}).on_translate();});this.once('to_view_mode',this,function(){this.notify_in_form($content);});}}},notify_in_form:function($content,options){options=options||{};var type=options.type||'info';var $box=$(QWeb.render('notification-box',{type:type}));$box.append($content);var events=options.events||'to_edit_mode view_content_has_changed';this.once(events,null,function(){$box.remove();});var $target=this.$('.o_form_sheet_bg').length?this.$('.o_form_sheet_bg'):this.$el;$target.prepend($box);},open_defaults_dialog:function(){var self=this;var display=function(field,value){var FieldSelection=core.form_widget_registry.get('selection');var FieldMany2One=core.form_widget_registry.get('many2one');if(!value){return value;}
if(field instanceof FieldSelection){return _(field.get('values')).find(function(option){return option[0]===value;})[1];}else if(field instanceof FieldMany2One){return field.get_displayed();}
return value;};var fields=_.chain(this.fields).map(function(field){var value=field.get_value();if(!value||field.get('invisible')||field.get("readonly")||field.field.type==='one2many'||field.field.type==='many2many'||field.field.type==='binary'||field.password){return false;}
return{name:field.name,string:field.string,value:value,displayed:display(field,value),};}).compact().sortBy(function(field){return field.string;}).value();var conditions=_.chain(self.fields).filter(function(field){return field.field.change_default;}).map(function(field){var value=field.get_value();return{name:field.name,string:field.string,value:value,displayed:display(field,value),};}).value();var d=new Dialog(this,{title:_t("Set Default"),buttons:[{text:_t("Close"),close:true},{text:_t("Save default"),click:function(){var $defaults=d.$el.find('#formview_default_fields');var field_to_set=$defaults.val();if(!field_to_set){$defaults.parent().addClass('o_form_invalid');return;}
var condition=d.$el.find('#formview_default_conditions').val(),all_users=d.$el.find('#formview_default_all').is(':checked');new data.DataSet(self,'ir.values').call('set_default',[self.model,field_to_set,self.fields[field_to_set].get_value(),all_users,true,condition||false]).done(function(){d.close();});}}]});d.args={fields:fields,conditions:conditions};d.template='FormView.set_default';d.open();},register_field:function(field,name){this.fields[name]=field;this.fields_order.push(name);if(JSON.parse(field.node.attrs.default_focus||"0")){this.default_focus_field=field;}
field.on('focused',null,this.proxy('widgetFocused')).on('blurred',null,this.proxy('widgetBlurred'));if(this.get_field_desc(name).translate){this.translatable_fields.push(field);}
field.on('changed_value',this,function(){if(field.is_syntax_valid()){this.trigger('field_changed:'+name);}
if(field._inhibit_on_change_flag){return;}
field._dirty_flag=true;if(field.is_syntax_valid()){this.do_onchange(field);this.on_form_changed(true);this.do_notify_change();}});},get_field_desc:function(field_name){return this.fields_view.fields[field_name];},get_field_value:function(field_name){return this.fields[field_name].get_value();},compute_domain:function(expression){return data.compute_domain(expression,this.fields);},_build_view_fields_values:function(){var a_dataset=this.dataset;var fields_values=this.get_fields_values();var active_id=a_dataset.ids[a_dataset.index];_.extend(fields_values,{active_id:active_id||false,active_ids:active_id?[active_id]:[],active_model:a_dataset.model,parent:{}});if(a_dataset.parent_view){fields_values.parent=a_dataset.parent_view.get_fields_values();}
return fields_values;},build_eval_context:function(){var a_dataset=this.dataset;return new data.CompoundContext(a_dataset.get_context(),this._build_view_fields_values());},});core.view_registry.add('form',FormView);return FormView;});odoo.define('web.FormRenderingEngine',function(require){"use strict";var common=require('web.form_common');var core=require('web.core');var utils=require('web.utils');var _t=core._t;var QWeb=core.qweb;return core.Class.extend({init:function(view){this.view=view;},set_fields_view:function(fvg){this.fvg=fvg;this.version=parseFloat(this.fvg.arch.attrs.version);if(isNaN(this.version)){this.version=7.0;}},set_tags_registry:function(tags_registry){this.tags_registry=tags_registry;},set_fields_registry:function(fields_registry){this.fields_registry=fields_registry;},set_widgets_registry:function(widgets_registry){this.widgets_registry=widgets_registry;},process_version:function(){if(this.version<7.0){this.$form.find('form:first').wrapInner('<group col="4"/>');this.$form.find('page').each(function(){if(!$(this).parents('field').length){$(this).wrapInner('<group col="4"/>');}});}},get_arch_fragment:function(){var doc=$.parseXML(utils.json_node_to_xml(this.fvg.arch)).documentElement;$('button',doc).each(function(){$(this).attr('data-button-type',$(this).attr('type')).attr('type','button');});$('board',doc).each(function(){$(this).attr('layout',$(this).attr('style'));});return $(utils.xml_to_str(doc));},render_to:function($target){var self=this;this.$target=$target;this.$form=this.get_arch_fragment();this.process_version();this.fields_to_init=[];this.tags_to_init=[];this.widgets_to_init=[];this.labels={};this.process(this.$form);this.$form.contents().appendTo(this.$target);this.handle_common_properties(this.$target,this.$form);this.to_replace=[];_.each(this.fields_to_init,function($elem){var name=$elem.attr("name");if(!self.fvg.fields[name]){throw new Error(_.str.sprintf(_t("Field '%s' specified in view could not be found."),name));}
var obj=self.fields_registry.get_any([$elem.attr('widget'),self.fvg.fields[name].type]);if(!obj){throw new Error(_.str.sprintf(_t("Widget type '%s' is not implemented"),$elem.attr('widget')||self.fvg.fields[name].type));}
var w=new(obj)(self.view,utils.xml_to_json($elem[0]));var $label=self.labels[$elem.attr("name")];if($label){w.set_input_id($label.attr("for"));}
self.alter_field(w);self.view.register_field(w,$elem.attr("name"));self.to_replace.push([w,$elem]);});_.each(this.tags_to_init,function($elem){var tag_name=$elem[0].tagName.toLowerCase();var obj=self.tags_registry.get(tag_name);var w=new(obj)(self.view,utils.xml_to_json($elem[0]));self.to_replace.push([w,$elem]);});_.each(this.widgets_to_init,function($elem){var widget_type=$elem.attr("type");var obj=self.widgets_registry.get(widget_type);var w=new(obj)(self.view,utils.xml_to_json($elem[0]));self.to_replace.push([w,$elem]);});},init_fields:function(){var defs=[];_.each(this.to_replace,function(el){defs.push(el[0].replace(el[1]));if(el[1].children().length){el[0].$el.append(el[1].children());}});this.to_replace=[];return $.when.apply($,defs);},render_element:function(template){var dicts=[].slice.call(arguments).slice(1);var dict=_.extend.apply(_,dicts);dict['classnames']=dict['class']||'';return $(QWeb.render(template,dict));},alter_field:function(field){},toggle_layout_debugging:function(){if(!this.$target.has('.oe_layout_debug_cell:first').length){this.$target.find('[title]').removeAttr('title');this.$target.find('.oe_form_group_cell').each(function(){var text='W:'+($(this).attr('width')||'')+' - C:'+$(this).attr('colspan');$(this).attr('title',text);});}
this.$target.toggleClass('oe_layout_debugging');},process:function($tag){var self=this;var tagname=$tag[0].nodeName.toLowerCase();if(this.tags_registry.contains(tagname)){this.tags_to_init.push($tag);return(tagname==='button')?this.process_button($tag):$tag;}
var fn=self['process_'+tagname];if(fn){var args=[].slice.call(arguments);args[0]=$tag;return fn.apply(self,args);}else{$tag.children().each(function(){self.process($(this));});self.handle_common_properties($tag,$tag);$tag.removeAttr("modifiers");return $tag;}},process_button:function($button){var self=this;$button.children().each(function(){self.process($(this));});return $button;},process_widget:function($widget){this.widgets_to_init.push($widget);return $widget;},process_sheet:function($sheet){var $new_sheet=this.render_element('FormRenderingSheet',$sheet.getAttributes());this.handle_common_properties($new_sheet,$sheet);var $dst=$new_sheet.find('.o_form_sheet');$sheet.contents().appendTo($dst);$sheet.before($new_sheet).remove();this.process($new_sheet);},process_form:function($form){if($form.find('> sheet').length===0){$form.addClass('o_form_nosheet');}
var $new_form=this.render_element('FormRenderingForm',$form.getAttributes());this.handle_common_properties($new_form,$form);$form.contents().appendTo($new_form);if($form[0]===this.$form[0]){this.$form=$new_form;}else{$form.before($new_form).remove();}
this.process($new_form);},preprocess_field:function($field){var self=this;var name=$field.attr('name'),field_colspan=parseInt($field.attr('colspan'),10),field_modifiers=JSON.parse($field.attr('modifiers')||'{}');if($field.attr('nolabel')==='1')
return;$field.attr('nolabel','1');var found=false;this.$form.find('label[for="'+name+'"]').each(function(i,el){$(el).parents().each(function(unused,tag){var name=tag.tagName.toLowerCase();if(name==="field"||name in self.tags_registry.map)
found=true;});});if(found)
return;var $label=$('<label/>').attr({'for':name,"modifiers":JSON.stringify({invisible:field_modifiers.invisible}),"string":$field.attr('string'),"help":$field.attr('help'),"class":$field.attr('class'),});$label.insertBefore($field);if(field_colspan>1){$field.attr('colspan',field_colspan-1);}
return $label;},process_field:function($field){if($field.parent().is('group')){var $label=this.preprocess_field($field);if($label){this.process($label);}}
this.fields_to_init.push($field);return $field;},process_group:function($group){var self=this;var _process_outer_group=function(col){var $new_group=self.render_element('FormRenderingOuterGroup',$group.getAttributes());$group.children().each(function(){var $child=$(this);var tagName=$child[0].tagName.toLowerCase();var colspan=parseInt($child.attr('colspan')||1,10);if(tagName==='newline'){$new_group.append($('<br>'));return;}
$child.addClass('o_group_col_'+Math.min(Math.floor(colspan/col*12),12));$new_group.append($child);children.push($child[0]);});return $new_group;};var _process_inner_group=function(col){var $new_group=self.render_element('FormRenderingInnerGroup',$group.getAttributes());$new_group.find('td').attr('colspan',col);var row_col=col;var $row=null;$group.children().each(function(){var $child=$(this);var tagName=$child[0].tagName.toLowerCase();var colspan=parseInt($child.attr('colspan')||1,10);if(tagName==='newline'){$row=null;return;}
row_col-=colspan;if(!$row||row_col<0){$row=$('<tr>').appendTo($new_group);row_col=col-colspan;}
$('<td>').attr('colspan',colspan).append($child).appendTo($row);children.push($child[0]);});$new_group.find('tr').each(function(){var $tr=$(this);var nonlabel_width=100/(col-$tr.find('td > label:first-child').length);$tr.find('td').each(function(){var $td=$(this);var $child=$td.children(':first');if($child.is("label")){$td.addClass("o_td_label");}else{$td.css("width",(nonlabel_width*parseInt($td.attr('colspan')))+"%");}});});return $new_group;};$group.children('field').each(function(){self.preprocess_field($(this));});var nested_groups=$group.children('group').length;var children=[];var col=parseInt($group.attr('col')||2,10);var $new_group;if(nested_groups){$new_group=_process_outer_group(col);}else{$new_group=_process_inner_group(col);}
this.handle_common_properties($new_group,$group);$group.before($new_group).remove();_.each(children,function(el){self.process($(el));});return $new_group;},process_notebook:function($notebook){var self=this;var pages=[];$notebook.find('> page').each(function(){var $page=$(this);var page_attrs=$page.getAttributes();page_attrs.id=_.uniqueId('notebook_page_');page_attrs.contents=$page.html();page_attrs.ref=$page;pages.push(page_attrs);});var $new_notebook=self.render_element('FormRenderingNotebook',{'pages':pages});$notebook.before($new_notebook).remove();var pageid_to_display;_.each(pages,function(page){var $tab=$new_notebook.find('a[href=#'+page.id+']').parent();var $content=$new_notebook.find('#'+page.id);self.attach_node_attr($tab,page.ref,'autofocus');self.attach_node_attr($content,page.ref,'autofocus');if(!pageid_to_display&&page.autofocus){pageid_to_display=page.id;}
self.handle_common_properties($tab,page.ref,common.NotebookInvisibilityChanger);self.handle_common_properties($content,page.ref,common.NotebookInvisibilityChanger);});if(!pageid_to_display){pageid_to_display=$new_notebook.find('div[role="tabpanel"]:not(.o_form_invisible):first').attr('id');}
$new_notebook.find('a[href=#'+pageid_to_display+']').parent().addClass('active');$new_notebook.find('#'+pageid_to_display).addClass('active');self.process($new_notebook.children());self.handle_common_properties($new_notebook,$notebook);return $new_notebook;},process_separator:function($separator){var $new_separator=this.render_element('FormRenderingSeparator',$separator.getAttributes());$separator.before($new_separator).remove();this.handle_common_properties($new_separator,$separator);return $new_separator;},process_label:function($label){var name=$label.attr("for"),field_orm=this.fvg.fields[name];var dict={string:$label.attr('string')||(field_orm||{}).string||'',help:$label.attr('help')||(field_orm||{}).help||'',_for:name?_.uniqueId('o_field_input_'):undefined,};var $new_label=this.render_element('FormRenderingLabel',dict);$label.before($new_label).remove();this.handle_common_properties($new_label,$label);if(name){this.labels[name]=$new_label;}
return $new_label;},handle_common_properties:function($new_element,$node,InvisibilityChanger){var str_modifiers=$node.attr("modifiers")||"{}";var modifiers=JSON.parse(str_modifiers);var ic=null;if(modifiers.invisible!==undefined){var InvisibilityChangerCls=InvisibilityChanger||common.InvisibilityChanger;ic=new InvisibilityChangerCls(this.view,this.view,modifiers.invisible,$new_element);}
$new_element.addClass($node.attr("class")||"");$new_element.attr('style',$node.attr('style'));return{invisibility_changer:ic,};},attach_node_attr:function($new_element,$node,attr){$new_element.data(attr,$node.attr(attr));}});});;

/* /web/static/src/js/views/form_common.js defined in bundle 'web.assets_backend' */
odoo.define('web.form_common',function(require){"use strict";var core=require('web.core');var data=require('web.data');var data_manager=require('web.data_manager');var Dialog=require('web.Dialog');var ListView=require('web.ListView');var pyeval=require('web.pyeval');var SearchView=require('web.SearchView');var session=require('web.session');var utils=require('web.utils');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var FieldManagerMixin={get_field_desc:function(field_name){},get_field_value:function(field_name){},set_values:function(values){},compute_domain:function(expression){},build_eval_context:function(){},};var DefaultFieldManager=Widget.extend({init:function(parent,eval_context){this._super(parent);this.field_descs={};this.eval_context=eval_context||{};this.set({display_invalid_fields:false,actual_mode:'create',});},get_field_desc:function(field_name){if(this.field_descs[field_name]===undefined){this.field_descs[field_name]={string:field_name,};}
return this.field_descs[field_name];},extend_field_desc:function(fields){var self=this;_.each(fields,function(v,k){_.extend(self.get_field_desc(k),v);});},get_field_value:function(field_name){return false;},set_values:function(values){},compute_domain:function(expression){return data.compute_domain(expression,{});},build_eval_context:function(){return new data.CompoundContext(this.eval_context);},});var ReinitializeWidgetMixin={start:function(){this.initialize_field();this._super();},initialize_field:function(){this.on("change:effective_readonly",this,this.reinitialize);this.initialize_content();},reinitialize:function(){this.destroy_content();this.renderElement();this.initialize_content();},destroy_content:function(){},initialize_content:function(){},};var ReinitializeFieldMixin=_.extend({},ReinitializeWidgetMixin,{reinitialize:function(){ReinitializeWidgetMixin.reinitialize.call(this);if(!this.no_rerender){var res=this.render_value();if(this.view&&this.view.render_value_defs){this.view.render_value_defs.push(res);}}},});var CompletionFieldMixin={init:function(){this.limit=7;this.orderer=new utils.DropMisordered();this.can_create=this.node.attrs.can_create||true;this.can_write=this.node.attrs.can_write||true;},get_search_result:function(search_val){var self=this;var dataset=new data.DataSet(this,this.field.relation,self.build_context());this.last_query=search_val;var exclusion_domain=[],ids_blacklist=this.get_search_blacklist();if(!_(ids_blacklist).isEmpty()){exclusion_domain.push(['id','not in',ids_blacklist]);}
return this.orderer.add(dataset.name_search(search_val,new data.CompoundDomain(self.build_domain(),exclusion_domain),'ilike',this.limit+1,self.build_context())).then(function(_data){self.last_search=_data;var values=_.map(_data,function(x){x[1]=x[1].split("\n")[0];return{label:_.str.escapeHTML(x[1].trim())||data.noDisplayContent,value:x[1],name:x[1],id:x[0],};});if(values.length>self.limit){values=values.slice(0,self.limit);values.push({label:_t("Search More..."),action:function(){dataset.name_search(search_val,self.build_domain(),'ilike',160).done(function(_data){self._search_create_popup("search",_data);});},classname:'o_m2o_dropdown_option'});}
var raw_result=_(_data.result).map(function(x){return x[1];});if(search_val.length>0&&!_.include(raw_result,search_val)&&!(self.options&&(self.options.no_create||self.options.no_quick_create))){self.can_create&&values.push({label:_.str.sprintf(_t('Create "<strong>%s</strong>"'),$('<span />').text(search_val).html()),action:function(){self._quick_create(search_val);},classname:'o_m2o_dropdown_option'});}
if(!(self.options&&(self.options.no_create||self.options.no_create_edit))&&self.can_create){values.push({label:_t("Create and Edit..."),action:function(){self._search_create_popup("form",undefined,self._create_context(search_val));},classname:'o_m2o_dropdown_option'});}
else if(values.length===0){values.push({label:_t("No results to show..."),action:function(){},classname:'o_m2o_dropdown_option'});}
return values;});},get_search_blacklist:function(){return[];},_quick_create:function(name){var self=this;var slow_create=function(){self._search_create_popup("form",undefined,self._create_context(name));};if(self.options.quick_create===undefined||self.options.quick_create){new data.DataSet(this,this.field.relation,self.build_context()).name_create(name).done(function(data){if(!self.get('effective_readonly'))
self.add_id(data[0]);}).fail(function(error,event){event.preventDefault();slow_create();});}else
slow_create();},_search_create_popup:function(view,ids,context){var self=this;new SelectCreateDialog(this,_.extend({},(this.options||{}),{res_model:self.field.relation,domain:self.build_domain(),context:new data.CompoundContext(self.build_context(),context||{}),title:(view==='search'?_t("Search: "):_t("Create: "))+this.string,initial_ids:ids?_.map(ids,function(x){return x[0];}):undefined,initial_view:view,disable_multiple_selection:true,on_selected:function(element_ids){self.add_id(element_ids[0]);self.focus();}})).open();},add_id:function(id){},_create_context:function(name){var tmp={};var field=(this.options||{}).create_name_field;if(field===undefined)
field="name";if(field!==false&&name&&(this.options||{}).quick_create!==false)
tmp["default_"+field]=name;return tmp;},};var InvisibilityChangerMixin={init:function(field_manager,invisible_domain){var self=this;this._ic_field_manager=field_manager;this._ic_invisible_modifier=invisible_domain;this._ic_field_manager.on("view_content_has_changed",this,function(){var result=self._ic_invisible_modifier===undefined?false:self._ic_field_manager.compute_domain(self._ic_invisible_modifier);self.set({"invisible":result});});this.set({invisible:this._ic_invisible_modifier===true,force_invisible:false});var check=function(){if(self.get("invisible")||self.get('force_invisible')){self.set({"effective_invisible":true});}else{self.set({"effective_invisible":false});}};this.on('change:invisible',this,check);this.on('change:force_invisible',this,check);check.call(this);},start:function(){this.on("change:effective_invisible",this,this._check_visibility);this._check_visibility();},_check_visibility:function(){this.$el.toggleClass('o_form_invisible',this.get("effective_invisible"));},};var InvisibilityChanger=core.Class.extend(core.mixins.PropertiesMixin,InvisibilityChangerMixin,{init:function(parent,field_manager,invisible_domain,$el){this.setParent(parent);core.mixins.PropertiesMixin.init.call(this);InvisibilityChangerMixin.init.call(this,field_manager,invisible_domain);this.$el=$el;this.start();},});var NotebookInvisibilityChanger=InvisibilityChanger.extend({start:function(){this.on("change:effective_invisible",this,this._check_visibility);},_check_visibility:function(){this._super();if(this.get("effective_invisible")===true){if(this.$el.hasClass('active')){this.$el.removeClass('active');var visible_siblings=this.$el.siblings(':not(.o_form_invisible)');if(visible_siblings.length){$(visible_siblings[0]).addClass('active');}}}else{var visible_active_sibling=this.$el.siblings(':not(.o_form_invisible).active');if(!(visible_active_sibling.length)){this.$el.addClass('active');}else if(!$(visible_active_sibling[0]).data('autofocus')&&this._ic_field_manager.get('actual_mode')==="edit"){this.$el.addClass('active');$(visible_active_sibling[0]).removeClass('active');}}},});var FormWidget=Widget.extend(InvisibilityChangerMixin,{init:function(field_manager,node){this._super(field_manager);this.field_manager=field_manager;this.view=this.field_manager;this.node=node;this.session=session;this.modifiers=JSON.parse(this.node.attrs.modifiers||'{}');InvisibilityChangerMixin.init.call(this,this.field_manager,this.modifiers.invisible);this.field_manager.on("view_content_has_changed",this,this.process_modifiers);this.set({required:false,readonly:false,});var self=this;var test_effective_readonly=function(){self.set({"effective_readonly":self.get("readonly")||self.field_manager.get("actual_mode")==="view"});};this.on("change:readonly",this,test_effective_readonly);this.field_manager.on("change:actual_mode",this,test_effective_readonly);test_effective_readonly.call(this);},renderElement:function(){this.process_modifiers();this._super();this.$el.addClass(this.node.attrs["class"]||"");this.$el.attr('style',this.node.attrs.style);},destroy:function(){$.fn.tooltip('destroy');this._super.apply(this,arguments);},setupFocus:function($e){var self=this;$e.on({focus:function(){self.trigger('focused');},blur:function(){self.trigger('blurred');}});},process_modifiers:function(){var to_set={};for(var a in this.modifiers){if(!this.modifiers.hasOwnProperty(a)){continue;}
if(!_.include(["invisible"],a)){var val=this.field_manager.compute_domain(this.modifiers[a]);to_set[a]=val;}}
this.set(to_set);},do_attach_tooltip:function(widget,trigger,options){widget=widget||this;trigger=trigger||this.$el;options=_.extend({delay:{show:1000,hide:0},title:function(){var template=widget.template+'.tooltip';if(!QWeb.has_template(template)){template='WidgetLabel.tooltip';}
return QWeb.render(template,{debug:session.debug,widget:widget});}},options||{});if(session.debug||widget.node.attrs.help||(widget.field&&widget.field.help)){$(trigger).tooltip(options);}},build_context:function(){var v_context=this.node.attrs.context;if(!v_context){v_context=(this.field||{}).context||{};}
if(v_context.__ref||true){var fields_values=this.field_manager.build_eval_context();v_context=new data.CompoundContext(v_context).set_eval_context(fields_values);}
return v_context;},build_domain:function(){var f_domain=this.field.domain||[];var n_domain=this.node.attrs.domain||null;var final_domain=n_domain!==null?n_domain:f_domain;if(!(final_domain instanceof Array)||true){var fields_values=this.field_manager.build_eval_context();final_domain=new data.CompoundDomain(final_domain).set_eval_context(fields_values);}
return final_domain;}});var commands={CREATE:0,'create':function(values){return[commands.CREATE,false,values];},UPDATE:1,'update':function(id,values){return[commands.UPDATE,id,values];},DELETE:2,'delete':function(id){return[commands.DELETE,id,false];},FORGET:3,'forget':function(id){return[commands.FORGET,id,false];},LINK_TO:4,'link_to':function(id){return[commands.LINK_TO,id,false];},DELETE_ALL:5,'delete_all':function(){return[5,false,false];},REPLACE_WITH:6,'replace_with':function(ids){return[6,false,ids];}};var FieldInterface={init:function(field_manager,node){},set_value:function(value_){},get_value:function(){},set_input_id:function(id){},is_valid:function(){},is_syntax_valid:function(){},focus:function(){},on_translate:function(){},commit_value:function(){},};var AbstractField=FormWidget.extend(FieldInterface,{init:function(field_manager,node){this._super(field_manager,node);this.name=this.node.attrs.name;this.field=this.field_manager.get_field_desc(this.name);this.widget=this.node.attrs.widget;this.string=this.node.attrs.string||this.field.string||this.name;this.options=pyeval.py_eval(this.node.attrs.options||'{}');this.set({'value':false});this.on("change:value",this,function(){this.trigger('changed_value');this._check_css_flags();});this.$translate=(_t.database.multi_lang&&this.field.translate)?$('<button/>',{type:'button',}).addClass('o_field_translate fa fa-globe btn btn-link'):$();},renderElement:function(){var self=this;this._super();this.$el.addClass('o_form_field');this.$label=this.view?this.view.$('label[for='+this.id_for_label+']'):$();this.do_attach_tooltip(this,this.$label[0]||this.$el);if(session.debug){this.$label.off('dblclick').on('dblclick',function(){console.log("Field '%s' of type '%s' in View: %o",self.name,(self.node.attrs.widget||self.field.type),self.view);window.w=self;console.log("window.w =",window.w);});}
if(!this.disable_utility_classes){this.off("change:required",this,this._set_required);this.on("change:required",this,this._set_required);this._set_required();}
this._check_visibility();this.field_manager.off("change:display_invalid_fields",this,this._check_css_flags);this.field_manager.on("change:display_invalid_fields",this,this._check_css_flags);this._check_css_flags();},start:function(){this._super();this.on("change:value",this,function(){if(!this.no_rerender){this.render_value();}
this._toggle_label();});this.on("change:effective_readonly",this,function(){this._toggle_label();});this.render_value();this._toggle_label();if(this.view){this.$translate.insertAfter(this.$el).on('click',_.bind(this.on_translate,this));}},_toggle_label:function(){var empty=this.get('effective_readonly')&&this.is_false();this.$label.toggleClass('o_form_label_empty',empty).toggleClass('o_form_label_false',this.get('effective_readonly')&&this.get('value')===false);this.$el.toggleClass('o_form_field_empty',empty);},_set_required:function(){this.$el.toggleClass('o_form_required',this.get("required"));},set_value:function(value_){this.set({'value':value_});},get_value:function(){return this.get('value');},internal_set_value:function(value_){var tmp=this.no_rerender;this.no_rerender=true;this.set({'value':value_});this.no_rerender=tmp;},render_value:function(){},is_valid:function(){return this.is_syntax_valid()&&!(this.get('required')&&this.is_false());},is_syntax_valid:function(){return true;},is_false:function(){return this.get('value')===false;},_check_css_flags:function(){var show_translate=(!this.get('effective_readonly')&&this.field_manager.get('actual_mode')!=="create");this.$translate.toggleClass('o_translate_active',!!show_translate);this.$el.add(this.$label).toggleClass('o_form_invalid',!this.disable_utility_classes&&!!this.field_manager.get('display_invalid_fields')&&!this.is_valid());},focus:function(){return false;},set_input_id:function(id){this.id_for_label=id;},on_translate:function(){var self=this;var trans=new data.DataSet(this,'ir.translation');return trans.call_button('translate_fields',[this.view.model,this.view.datarecord.id,this.name,this.view.dataset.get_context()]).done(function(r){self.do_action(r);});},set_dimensions:function(height,width){this.$el.css({width:width,height:height,});},commit_value:function(){return $.when();},});var ViewDialog=Dialog.extend({init:function(parent,options){options=options||{};options.dialogClass=options.dialogClass||'';options.dialogClass+=' o_act_window';this._super(parent,$.extend(true,{},options));this.res_model=options.res_model||null;this.res_id=options.res_id||null;this.domain=options.domain||[];this.context=options.context||{};this.options=_.extend(this.options||{},options||{});this.on_selected=options.on_selected||(function(){});},init_dataset:function(){var self=this;this.created_elements=[];this.dataset=new data.ProxyDataSet(this,this.res_model,this.context);this.dataset.read_function=this.options.read_function;this.dataset.create_function=function(data,options,sup){var fct=self.options.create_function||sup;return fct.call(this,data,options).done(function(r){self.trigger('create_completed saved',r);self.created_elements.push(r);});};this.dataset.write_function=function(id,data,options,sup){var fct=self.options.write_function||sup;return fct.call(this,id,data,options).done(function(r){self.trigger('write_completed saved',r);});};this.dataset.parent_view=this.options.parent_view;this.dataset.child_name=this.options.child_name;this.on('closed',this,this.select);},select:function(){if(this.created_elements.length>0){this.on_selected(this.created_elements);this.created_elements=[];}}});var FormViewDialog=ViewDialog.extend({init:function(parent,options){var self=this;var multi_select=!_.isNumber(options.res_id)&&!options.disable_multiple_selection;var readonly=_.isNumber(options.res_id)&&options.readonly;if(!options||!options.buttons){options=options||{};options.buttons=[{text:(readonly?_t("Close"):_t("Discard")),classes:"btn-default o_form_button_cancel",close:true,click:function(){self.view_form.trigger('on_button_cancel');}}];if(!readonly){options.buttons.splice(0,0,{text:_t("Save")+((multi_select)?" "+_t(" & Close"):""),classes:"btn-primary",click:function(){self.view_form.onchanges_mutex.def.then(function(){if(!self.view_form.warning_displayed){$.when(self.view_form.save()).done(function(){self.view_form.reload_mutex.exec(function(){self.trigger('record_saved');self.close();});});}});}});if(multi_select){options.buttons.splice(1,0,{text:_t("Save & New"),classes:"btn-primary",click:function(){$.when(self.view_form.save()).done(function(){self.view_form.reload_mutex.exec(function(){self.view_form.on_button_new();});});}});}}}
this._super(parent,options);},open:function(){var self=this;var _super=this._super.bind(this);this.init_dataset();if(this.res_id){this.dataset.ids=[this.res_id];this.dataset.index=0;}else{this.dataset.index=null;}
var options=_.clone(this.options.form_view_options)||{};if(this.res_id!==null){options.initial_mode=this.options.readonly?"view":"edit";}
_.extend(options,{$buttons:this.$buttons,});var FormView=core.view_registry.get('form');var fields_view_def;if(this.options.alternative_form_view){fields_view_def=$.when(this.options.alternative_form_view);}else{fields_view_def=data_manager.load_fields_view(this.dataset,this.options.view_id,'form',false);}
fields_view_def.then(function(fields_view){self.view_form=new FormView(self,self.dataset,fields_view,options);var fragment=document.createDocumentFragment();self.view_form.appendTo(fragment).then(function(){self.view_form.do_show().then(function(){_super().$el.append(fragment);self.view_form.autofocus();});});});return this;},});var SelectCreateListView=ListView.extend({do_add_record:function(){this.popup.create_edit_record();},select_record:function(index){this.popup.on_selected([this.dataset.ids[index]]);this.popup.close();},do_select:function(ids,records){this._super.apply(this,arguments);this.popup.on_click_element(ids);}});var SelectCreateDialog=ViewDialog.extend({init:function(parent,options){this._super(parent,options);_.defaults(this.options,{initial_view:"search"});this.initial_ids=this.options.initial_ids;},open:function(){if(this.options.initial_view!=="search"){return this.create_edit_record();}
var _super=this._super.bind(this);this.init_dataset();var context=pyeval.sync_eval_domains_and_contexts({domains:[],contexts:[this.context]}).context;var search_defaults={};_.each(context,function(value_,key){var match=/^search_default_(.*)$/.exec(key);if(match){search_defaults[match[1]]=value_;}});data_manager.load_views(this.dataset,[[false,'list'],[false,'search']],{}).then(this.setup.bind(this,search_defaults)).then(function(fragment){_super().$el.append(fragment);});return this;},setup:function(search_defaults,fields_views){var self=this;if(this.searchview){this.searchview.destroy();}
var fragment=document.createDocumentFragment();var $header=$('<div/>').addClass('o_modal_header').appendTo(fragment);var $pager=$('<div/>').addClass('o_pager').appendTo($header);var options={$buttons:$('<div/>').addClass('o_search_options').appendTo($header),search_defaults:search_defaults,};this.searchview=new SearchView(this,this.dataset,fields_views.search,options);this.searchview.on('search_data',this,function(domains,contexts,groupbys){if(this.initial_ids){this.do_search(domains.concat([[["id","in",this.initial_ids]],this.domain]),contexts.concat(this.context),groupbys);this.initial_ids=undefined;}else{this.do_search(domains.concat([this.domain]),contexts.concat(this.context),groupbys);}});return this.searchview.prependTo($header).then(function(){self.searchview.toggle_visibility(true);self.view_list=new SelectCreateListView(self,self.dataset,fields_views.list,_.extend({'deletable':false,'selectable':!self.options.disable_multiple_selection,'import_enabled':false,'$buttons':self.$buttons,'disable_editable_mode':true,'pager':true,},self.options.list_view_options||{}));self.view_list.on('edit:before',self,function(e){e.cancel=true;});self.view_list.popup=self;self.view_list.on('list_view_loaded',self,function(){this.on_view_list_loaded();});var buttons=[{text:_t("Cancel"),classes:"btn-default o_form_button_cancel",close:true}];if(!self.options.no_create){buttons.splice(0,0,{text:_t("Create"),classes:"btn-primary",click:function(){self.create_edit_record();}});}
if(!self.options.disable_multiple_selection){buttons.splice(0,0,{text:_t("Select"),classes:"btn-primary o_selectcreatepopup_search_select",disabled:true,close:true,click:function(){self.on_selected(self.selected_ids);}});}
self.set_buttons(buttons);return self.view_list.appendTo(fragment).then(function(){self.view_list.do_show();self.view_list.render_pager($pager);if(self.options.initial_facet){self.searchview.query.reset([self.options.initial_facet],{preventSearch:true,});}
self.searchview.do_search();return fragment;});});},do_search:function(domains,contexts,groupbys){var results=pyeval.sync_eval_domains_and_contexts({domains:domains||[],contexts:contexts||[],group_by_seq:groupbys||[]});this.view_list.do_search(results.domain,results.context,results.group_by);},on_click_element:function(ids){this.selected_ids=ids||[];this.$footer.find(".o_selectcreatepopup_search_select").prop('disabled',this.selected_ids.length<=0);},create_edit_record:function(){this.close();return new FormViewDialog(this.__parentedParent,this.options).open();},on_view_list_loaded:function(){},});var DomainEditorDialog=SelectCreateDialog.extend({init:function(parent,options){options=_.defaults(options,{initial_facet:{category:_t("Custom Filter"),icon:'fa-star',field:{get_context:function(){return options.context;},get_groupby:function(){return[];},get_domain:function(){return options.default_domain;},},values:[{label:_t("Selected domain"),value:null}],}});this._super(parent,options);},get_domain:function(selected_ids){var group_domain=[];var domain;if(this.$('.o_list_record_selector input').prop('checked')){if(this.view_list.grouped){group_domain=_.chain(_.values(this.view_list.groups.children)).filter(function(child){return child.records.length;}).map(function(c){return c.datagroup.domain;}).value();group_domain=_.flatten(group_domain,true);group_domain=_.times(group_domain.length-1,_.constant('|')).concat(group_domain);}
var search_data=this.searchview.build_search_data();domain=pyeval.sync_eval_domains_and_contexts({domains:search_data.domains,contexts:search_data.contexts,group_by_seq:search_data.groupbys||[]}).domain;}
else{domain=[["id","in",selected_ids]];}
return this.dataset.domain.concat(group_domain).concat(domain||[]);},on_view_list_loaded:function(){this.$('.o_list_record_selector input').prop('checked',true);this.$footer.find(".o_selectcreatepopup_search_select").prop('disabled',false);},});return{FieldManagerMixin:FieldManagerMixin,ReinitializeWidgetMixin:ReinitializeWidgetMixin,ReinitializeFieldMixin:ReinitializeFieldMixin,CompletionFieldMixin:CompletionFieldMixin,FormWidget:FormWidget,DefaultFieldManager:DefaultFieldManager,InvisibilityChanger:InvisibilityChanger,NotebookInvisibilityChanger:NotebookInvisibilityChanger,commands:commands,AbstractField:AbstractField,ViewDialog:ViewDialog,FormViewDialog:FormViewDialog,SelectCreateDialog:SelectCreateDialog,DomainEditorDialog:DomainEditorDialog,};});;

/* /web/static/src/js/views/form_widgets.js defined in bundle 'web.assets_backend' */
odoo.define('web.form_widgets',function(require){"use strict";var ajax=require('web.ajax');var core=require('web.core');var crash_manager=require('web.crash_manager');var data=require('web.data');var datepicker=require('web.datepicker');var dom_utils=require('web.dom_utils');var Priority=require('web.Priority');var ProgressBar=require('web.ProgressBar');var Dialog=require('web.Dialog');var common=require('web.form_common');var formats=require('web.formats');var framework=require('web.framework');var Model=require('web.DataModel');var pyeval=require('web.pyeval');var session=require('web.session');var utils=require('web.utils');var _t=core._t;var QWeb=core.qweb;var WidgetButton=common.FormWidget.extend({template:'WidgetButton',init:function(field_manager,node){node.attrs.type=node.attrs['data-button-type'];this._super(field_manager,node);this.force_disabled=false;this.string=(this.node.attrs.string||'').replace(/_/g,'');if(JSON.parse(this.node.attrs.default_focus||"0")){this.view.default_focus_button=this;}
if(this.node.attrs.icon){this.fa_icon=this.node.attrs.icon.indexOf('fa-')===0;}},start:function(){this._super.apply(this,arguments);this.view.on('view_content_has_changed',this,this.check_disable);this.check_disable();this.$el.click(this.on_click);if(this.node.attrs.help||session.debug){this.do_attach_tooltip();}
this.setupFocus(this.$el);},on_click:function(){var self=this;if(this.view.is_disabled){return;}
this.force_disabled=true;this.check_disable();this.view.disable_button();this.execute_action().always(function(){self.view.enable_button();self.force_disabled=false;self.check_disable();if(self.$el.hasClass('o_wow')){self.show_wow();}});},execute_action:function(){var self=this;var exec_action=function(){if(self.node.attrs.confirm){var def=$.Deferred();Dialog.confirm(self,self.node.attrs.confirm,{confirm_callback:self.on_confirmed}).on("closed",null,function(){def.resolve();});return def.promise();}else{return self.on_confirmed();}};if(!this.node.attrs.special){return this.view.recursive_save().then(exec_action);}else{return exec_action();}},on_confirmed:function(){var self=this;var context=this.build_context();return this.view.do_execute_action(_.extend({},this.node.attrs,{context:context}),this.view.dataset,this.view.datarecord.id,function(reason){if(!_.isObject(reason)){self.view.recursive_reload();}}).fail(function(){self.view.recursive_reload();});},check_disable:function(){var disabled=(this.force_disabled||!this.view.is_interactible_record());this.$el.prop('disabled',disabled);this.$el.css('color',disabled?'grey':'');},show_wow:function(){var class_to_add='o_wow_thumbs';if(Math.random()>0.9){var other_classes=['o_wow_peace','o_wow_heart'];class_to_add=other_classes[Math.floor(Math.random()*other_classes.length)];}
var $body=$('body');$body.addClass(class_to_add);setTimeout(function(){$body.removeClass(class_to_add);},1000);}});var FieldChar=common.AbstractField.extend(common.ReinitializeFieldMixin,{template:'FieldChar',events:{'change':'store_dom_value',},init:function(field_manager,node){this._super(field_manager,node);this.password=this.node.attrs.password==='True'||this.node.attrs.password==='1';},initialize_content:function(){if(!this.get('effective_readonly')&&!this.$input){this.$input=this.$el;}
this.setupFocus(this.$el);},destroy_content:function(){this.$input=undefined;},store_dom_value:function(){if(this.$input&&this.is_syntax_valid()){this.internal_set_value(this.parse_value(this.$input.val()));}},commit_value:function(){this.store_dom_value();return this._super();},render_value:function(){var show_value=this.format_value(this.get('value'),'');if(this.$input){this.$input.val(show_value);}else{if(this.password){show_value=new Array(show_value.length+1).join('*');}
this.$el.text(show_value);}},is_syntax_valid:function(){if(this.$input){try{this.parse_value(this.$input.val(),'');}catch(e){return false;}}
return true;},parse_value:function(val,def){return formats.parse_value(val,this,def);},format_value:function(val,def){return formats.format_value(val,this,def);},is_false:function(){return this.get('value')===''||this._super();},focus:function(){if(this.$input){return this.$input.focus();}
return false;},});var KanbanSelection=common.AbstractField.extend({template:"FormSelection",events:{'click a':function(e){e.preventDefault();},'mouseup a':function(e){e.stopPropagation();},'click li':'set_kanban_selection'},start:function(){this.view.on('view_content_has_changed',this,function(){this.render_value();});return this._super();},prepare_dropdown_selection:function(){var self=this;var _data=[];var current_stage_id=self.view.datarecord.stage_id&&self.view.datarecord.stage_id[0];var stage_data={id:current_stage_id,legend_normal:self.view.datarecord.legend_normal||undefined,legend_blocked:self.view.datarecord.legend_blocked||undefined,legend_done:self.view.datarecord.legend_done||undefined,};_.map(self.field.selection||[],function(selection_item){var value={'name':selection_item[0],'tooltip':selection_item[1],};if(selection_item[0]==='normal'){value.state_name=stage_data.legend_normal?stage_data.legend_normal:selection_item[1];}else if(selection_item[0]==='done'){value.state_class='oe_kanban_status_green';value.state_name=stage_data.legend_done?stage_data.legend_done:selection_item[1];}else{value.state_class='oe_kanban_status_red';value.state_name=stage_data.legend_blocked?stage_data.legend_blocked:selection_item[1];}
_data.push(value);});return _data;},render_value:function(){this._super();this.states=this.prepare_dropdown_selection();var self=this;var current_state=_.find(this.states,function(state){return state.name===self.get('value');});this.$('.oe_kanban_status').removeClass('oe_kanban_status_red oe_kanban_status_green').addClass(current_state.state_class);var $items=$(QWeb.render('FormSelection.items',{states:_.without(this.states,current_state)}));var $dropdown=this.$el.find('.dropdown-menu');$dropdown.children().remove();$items.appendTo($dropdown);},set_kanban_selection:function(ev){var self=this;ev.preventDefault();var li=$(ev.target).closest('li');if(li.length){var value=String(li.data('value'));if(this.view.get('actual_mode')==='view'){var write_values={};write_values[self.name]=value;return this.view.dataset._model.call('write',[[this.view.datarecord.id],write_values,self.view.dataset.get_context()]).done(self.reload_record.bind(self));}
else{return this.set_value(value);}}},reload_record:function(){this.view.reload();},});var FieldPriority=common.AbstractField.extend({events:{'mouseup':function(e){e.stopPropagation();},},start:function(){this.priority=new Priority(this,{readonly:this.get('readonly'),value:this.get('value'),values:this.field.selection||[],});this.priority.on('update',this,function(update){var view=this.view;if(view.get('actual_mode')==='view'){var write_values={};write_values[this.name]=update.value;view.dataset._model.call('write',[[view.datarecord.id],write_values,view.dataset.get_context()]).done(function(){view.reload();});}else{this.set_value(update.value);}});this.on('change:readonly',this,function(){this.priority.readonly=this.get('readonly');var $div=$('<div/>').insertAfter(this.$el);this.priority.replace($div);this.setElement(this.priority.$el);});var self=this;return $.when(this._super(),this.priority.appendTo('<div>').then(function(){self.priority.$el.addClass(self.$el.attr('class'));self.replaceElement(self.priority.$el);}));},render_value:function(){this.priority.set_value(this.get('value'));},});var FieldID=FieldChar.extend({process_modifiers:function(){this._super();this.set({readonly:true});},});var FieldEmail=FieldChar.extend({template:'FieldEmail',prefix:'mailto',init:function(){this._super.apply(this,arguments);this.clickable=true;},render_value:function(){this._super();if(this.get("effective_readonly")&&this.clickable){this.$el.attr('href',this.prefix+':'+this.get('value'));}}});var FieldUrl=FieldEmail.extend({render_value:function(){this._super();if(this.get("effective_readonly")){var tmp=this.get('value');var s=/(\w+):(.+)|^\.{0,2}\//.exec(tmp);if(!s){tmp="http://"+this.get('value');}
var text=this.get('value')?this.node.attrs.text||tmp:'';this.$el.attr('href',tmp).text(text);}}});var FieldFloat=FieldChar.extend({init:function(field_manager,node){this._super(field_manager,node);this.internal_set_value(0);if(this.node.attrs.digits){this.digits=this.node.attrs.digits;}else{this.digits=this.field.digits;}},initialize_content:function(){this._super();this.$el.addClass('o_form_field_number');},set_value:function(value_){if(value_===false||value_===undefined){value_=0;}
if(this.digits!==undefined&&this.digits.length===2){value_=utils.round_decimals(value_,this.digits[1]);}
this._super(value_);}});var FieldCharDomain=common.AbstractField.extend(common.ReinitializeFieldMixin,{template:"FieldCharDomain",events:{'click button':'on_click','change .o_debug_input':function(e){this.set('value',$(e.target).val());}},init:function(){this._super.apply(this,arguments);this.debug=session.debug;},start:function(){var self=this;var tmp=this._super();if(this.options.model_field){this.field_manager.fields[this.options.model_field].on("change:value",this,function(){if(self.view&&self.view.record_loaded.state=="resolved"&&self.view.onchanges_mutex){self.view.onchanges_mutex.def.then(function(){self.render_value();});}});}
return tmp;},render_value:function(){var self=this;if(this.get('value')){var model=this.options.model||this.field_manager.get_field_value(this.options.model_field);try{var domain=pyeval.eval('domain',this.get('value'));}
catch(e){this.do_warn(_t('Error: Bad domain'),_t('The domain is wrong.'));return;}
var ds=new data.DataSetStatic(self,model,self.build_context());ds.call('search_count',[domain,ds.get_context()]).then(function(results){self.$('.o_count').text(results+' '+_t(' selected records'));if(self.get('effective_readonly')){self.$('button').text(_t('See selection '));}
else{self.$('button').text(_t('Change selection '));}
self.$('button').append($("<span/>").addClass('fa fa-arrow-right'));});if(this.debug){this.$('.o_debug_input').val(this.get('value'));}}else{this.$('.o_form_input').val('');this.$('.o_count').text(_t('No selected record'));var $arrow=this.$('button span').detach();this.$('button').text(_t('Select records ')).append($("<span/>").addClass('fa fa-arrow-right'));}},on_click:function(event){event.preventDefault();var self=this;var dialog=new common.DomainEditorDialog(this,{res_model:this.options.model||this.field_manager.get_field_value(this.options.model_field),default_domain:this.get('value'),title:this.get('effective_readonly')?_t('Selected records'):_t('Select records...'),readonly:this.get('effective_readonly'),disable_multiple_selection:this.get('effective_readonly'),no_create:this.get('effective_readonly'),on_selected:function(selected_ids){if(!self.get('effective_readonly')){self.set_value(dialog.get_domain(selected_ids));}}}).open();},});var FieldDate=common.AbstractField.extend(common.ReinitializeFieldMixin,{tagName:"span",className:"o_form_field_date",build_widget:function(){return new datepicker.DateWidget(this);},initialize_content:function(){if(this.datewidget){this.datewidget.destroy();this.datewidget=undefined;}
if(!this.get("effective_readonly")){this.datewidget=this.build_widget();this.datewidget.on('datetime_changed',this,function(){this.internal_set_value(this.datewidget.get_value());});var self=this;this.datewidget.appendTo('<div>').done(function(){self.datewidget.$el.addClass(self.$el.attr('class'));self.replaceElement(self.datewidget.$el);self.datewidget.$input.addClass('o_form_input');self.setupFocus(self.datewidget.$input);});}},render_value:function(){if(this.get("effective_readonly")){this.$el.text(formats.format_value(this.get('value'),this,''));}else{this.datewidget.set_value(this.get('value'));}},is_syntax_valid:function(){return this.get("effective_readonly")||!this.datewidget||this.datewidget.is_valid();},is_false:function(){return this.get('value')===''||this._super();},focus:function(){if(!this.get("effective_readonly")){return this.datewidget.$input.focus();}
return false;},});var FieldDatetime=FieldDate.extend({build_widget:function(){return new datepicker.DateTimeWidget(this);},});var FieldText=common.AbstractField.extend(common.ReinitializeFieldMixin,{template:'FieldText',events:{'keyup':function(e){if(e.which===$.ui.keyCode.ENTER){e.stopPropagation();}},'keypress':function(e){if(e.which===$.ui.keyCode.ENTER){e.stopPropagation();}},'change':'store_dom_value',},initialize_content:function(){if(!this.get("effective_readonly")){this.auto_sized=false;this.setupFocus(this.$el);}},commit_value:function(){if(!this.get("effective_readonly")){this.store_dom_value();}
return this._super();},store_dom_value:function(){this.internal_set_value(formats.parse_value(this.$el.val(),this));},render_value:function(){if(this.get("effective_readonly")){var txt=this.get("value")||'';this.$el.text(txt);}else{var show_value=formats.format_value(this.get('value'),this,'');this.$el.val(show_value);dom_utils.autoresize(this.$el,{parent:this});}},is_syntax_valid:function(){if(!this.get("effective_readonly")){try{formats.parse_value(this.$el.val(),this,'');}catch(e){return false;}}
return true;},is_false:function(){return this.get('value')===''||this._super();},focus:function($el){if(!this.get("effective_readonly")){return this.$el.focus();}
return false;},set_dimensions:function(height,width){this.$el.css({width:width,minHeight:height,});},});var FieldBoolean=common.AbstractField.extend({template:'FieldBoolean',events:{'click':function(){this.internal_set_value(this.$checkbox.prop('checked'));}},start:function(){this.$checkbox=this.$('input');this.$checkbox.prop('disabled',this.get("effective_readonly"));this.on("change:effective_readonly",this,function(){this.$checkbox.prop('disabled',this.get("effective_readonly"));});this.setupFocus(this.$checkbox);return this._super();},render_value:function(){this.$checkbox.prop('checked',this.get('value'));},focus:function(){return this.$checkbox.focus();},set_dimensions:function(height,width){},is_false:function(){return false;},});var FieldBooleanButton=common.AbstractField.extend({className:'o_stat_info',init:function(){this._super.apply(this,arguments);switch(this.options["terminology"]){case"active":this.string_true=_t("Active");this.hover_true=_t("Deactivate");this.string_false=_t("Inactive");this.hover_false=_t("Activate");break;case"archive":this.string_true=_t("Active");this.hover_true=_t("Archive");this.string_false=_t("Archived");this.hover_false=_t("Unarchive");break;default:var terms=typeof this.options["terminology"]==='string'?{}:this.options["terminology"];this.string_true=_t(terms.string_true||"On");this.hover_true=_t(terms.hover_true||terms.string_false||"Switch Off");this.string_false=_t(terms.string_false||"Off");this.hover_false=_t(terms.hover_false||terms.string_true||"Switch On");}},render_value:function(){this._super();this.$el.html(QWeb.render("BooleanButton",{widget:this}));},is_false:function(){return false;},});var FieldProgressBar=common.AbstractField.extend(common.ReinitializeFieldMixin,{initialize_content:function(){if(this.progressbar){this.progressbar.destroy();}
this.progressbar=new ProgressBar(this,{readonly:this.get('effective_readonly'),edit_on_click:true,value:this.get('value')||0,});var self=this;this.progressbar.appendTo('<div>').done(function(){self.progressbar.$el.addClass(self.$el.attr('class'));self.replaceElement(self.progressbar.$el);self.progressbar.on('update',self,function(update){self.set('value',update.changed_value);});});},render_value:function(){this.progressbar.set_value(this.get('value'));},is_false:function(){return false;},});var FieldPercentPie=common.AbstractField.extend({template:'FieldPercentPie',start:function(){this.$left_mask=this.$('.o_mask').first();this.$right_mask=this.$('.o_mask').last();this.$pie_value=this.$('.o_pie_value');return this._super();},render_value:function(){var value=this.get('value')||0,degValue=360*value/100;this.$right_mask.toggleClass('o_full',degValue>=180);var leftDeg='rotate('+((degValue<180)?180:degValue)+'deg)';var rightDeg='rotate('+((degValue<180)?degValue:0)+'deg)';this.$left_mask.css({transform:leftDeg,msTransform:leftDeg,mozTransform:leftDeg,webkitTransform:leftDeg});this.$right_mask.css({transform:rightDeg,msTransform:rightDeg,mozTransform:rightDeg,webkitTransform:rightDeg});this.$pie_value.html(Math.round(value)+'%');},is_false:function(){return false;}});var FieldSelection=common.AbstractField.extend(common.ReinitializeFieldMixin,{template:'FieldSelection',events:{'change':'store_dom_value',},init:function(field_manager,node){this._super(field_manager,node);this.set("value",false);this.set("values",[]);this.records_orderer=new utils.DropMisordered();this.field_manager.on("view_content_has_changed",this,function(){var domain=new data.CompoundDomain(this.build_domain()).eval();if(!_.isEqual(domain,this.get("domain"))){this.set("domain",domain);}});},initialize_field:function(){common.ReinitializeFieldMixin.initialize_field.call(this);this.on("change:domain",this,this.query_values);this.set("domain",new data.CompoundDomain(this.build_domain()).eval());this.on("change:values",this,this.render_value);},query_values:function(){var self=this;var def;if(this.field.type==="many2one"){var model=new Model(this.field.relation);def=model.call("name_search",['',this.get("domain")],{"context":this.build_context()});}else{var values=_.reject(this.field.selection,function(v){return v[0]===false&&v[1]==='';});def=$.when(values);}
this.records_orderer.add(def).then(function(values){if(!_.isEqual(values,self.get("values"))){self.set("values",values);}});},initialize_content:function(){if(!this.get('effective_readonly')){var ischanging=false;this.$el.change(function(){ischanging=true;}).click(function(){ischanging=false;}).keyup(function(e){if(e.which!==13||!ischanging){return;}
e.stopPropagation();ischanging=false;});this.setupFocus(this.$el);}},commit_value:function(){this.store_dom_value();return this._super();},store_dom_value:function(){if(!this.get('effective_readonly')){this.internal_set_value(JSON.parse(this.$el.val()));}},set_value:function(value_){value_=value_===null?false:value_;value_=value_ instanceof Array?value_[0]:value_;this._super(value_);},render_value:function(){var values=this.get("values");values=[[false,this.node.attrs.placeholder||'']].concat(values);var found=_.find(values,function(el){return el[0]===this.get("value");},this);if(!found){found=[this.get("value"),_t('Unknown')];values=[found].concat(values);}
if(!this.get("effective_readonly")){this.$el.empty();for(var i=0;i<values.length;i++){this.$el.append($('<option/>',{value:JSON.stringify(values[i][0]),html:values[i][1]}))}
this.$el.val(JSON.stringify(found[0]));}else{this.$el.text(found[1]);}},focus:function(){if(!this.get("effective_readonly")){return this.$el.focus();}
return false;},});var TimezoneMismatch=FieldSelection.extend({initialize_content:function(){this._super.apply(this,arguments);this.tz_offset_field=(this.options&&this.options.tz_offset_field)||this.tz_offset_field||'tz_offset';this.set({"tz_offset":this.field_manager.get_field_value(this.tz_offset_field)});this.on("change:tz_offset",this,this.render_value);},start:function(){this._super.apply(this,arguments);this.field_manager.on("field_changed:"+this.tz_offset_field,this,function(){this.set({"tz_offset":this.field_manager.get_field_value(this.tz_offset_field)});});},check_timezone:function(){var user_offset=this.get('tz_offset');if(user_offset){var offset=-(new Date().getTimezoneOffset());var browser_offset=(offset<0)?"-":"+";browser_offset+=_.str.sprintf("%02d",Math.abs(offset/60));browser_offset+=_.str.sprintf("%02d",Math.abs(offset%60));return(browser_offset!==user_offset);}
return false;},render_value:function(){this._super.apply(this,arguments);this.$label.next('.o_tz_warning').remove();if(this.check_timezone()){var options=_.extend({delay:{show:501,hide:0},title:_t("Timezone Mismatch : The timezone of your browser doesn't match the selected one. The time in Odoo is displayed according to your field timezone."),});$('<span/>').addClass('fa fa-exclamation-triangle o_tz_warning').insertAfter(this.$label).tooltip(options);}}});var LabelSelection=FieldSelection.extend({init:function(field_manager,node){this._super(field_manager,node);this.classes=this.options&&this.options.classes||{};},render_value:function(){this._super.apply(this,arguments);if(this.get("effective_readonly")){var bt_class=this.classes[this.get('value')]||'default';this.$el.html($('<span/>',{html:this.$el.html()}).addClass('label label-'+bt_class));}},});var FieldRadio=common.AbstractField.extend(common.ReinitializeFieldMixin,{template:'FieldRadio',events:{'click input':'click_change_value'},init:function(field_manager,node){this._super(field_manager,node);this.selection=_.clone(this.field.selection)||[];this.domain=false;this.uniqueId=_.uniqueId("radio");},initialize_content:function(){this.field_manager.on("view_content_has_changed",this,this.get_selection);this.get_selection();},click_change_value:function(event){var val=$(event.target).val();val=this.field.type=="selection"?val:+val;if(val!==this.get_value()){this.set_value(val);}},get_selection:function(){var self=this;var selection=[];var def=$.Deferred();if(self.field.type=="many2one"){var domain=pyeval.eval('domain',this.build_domain())||[];if(!_.isEqual(self.domain,domain)){self.domain=domain;var ds=new data.DataSetStatic(self,self.field.relation,self.build_context());ds.call('search',[self.domain]).then(function(records){ds.name_get(records).then(function(records){selection=records;def.resolve();});});}else{selection=self.selection;def.resolve();}}
else if(self.field.type=="selection"){selection=self.field.selection||[];def.resolve();}
return def.then(function(){if(!_.isEqual(selection,self.selection)){self.selection=_.clone(selection);self.renderElement();self.render_value();}});},set_value:function(value_){if(this.field.type=="selection"){value_=_.find(this.field.selection,function(sel){return sel[0]==value_;});}
else if(!this.selection.length){this.selection=[value_];}
this._super(value_);},get_value:function(){var value=this.get('value');value=((value instanceof Array)?value[0]:value);return _.isUndefined(value)?false:value;},render_value:function(){var self=this;if(this.get('effective_readonly')){this.$el.html(this.get('value')?this.get('value')[1]:"");}else{this.$("input").prop("checked",false).filter(function(){return this.value==self.get_value();}).prop("checked",true);}}});var FieldReference=common.AbstractField.extend(common.ReinitializeFieldMixin,{className:'o_row',init:function(field_manager,node){this._super(field_manager,node);this.reference_ready=true;},destroy_content:function(){if(this.fm){this.fm.destroy();this.fm=undefined;}},initialize_content:function(){var self=this;this.fm=new common.DefaultFieldManager(this);this.fm.extend_field_desc({"selection":{selection:this.field_manager.get_field_desc(this.name).selection,type:"selection",},"m2o":{relation:null,type:"many2one",},});this.selection=new FieldSelection(this.fm,{attrs:{name:'selection',modifiers:JSON.stringify({readonly:this.get('effective_readonly')}),}});this.selection.on("change:value",this,this.on_selection_changed);this.selection.appendTo(this.$el);this.selection.on('focused',null,function(){self.trigger('focused');}).on('blurred',null,function(){self.trigger('blurred');});var FieldMany2One=core.form_widget_registry.get('many2one');this.m2o=new FieldMany2One(this.fm,{attrs:{name:'Referenced Document',modifiers:JSON.stringify({readonly:this.get('effective_readonly')}),context:this.build_context().eval(),}});this.m2o.on("change:value",this,this.data_changed);this.m2o.appendTo(this.$el);this.m2o.on('focused',null,function(){self.trigger('focused');}).on('blurred',null,function(){self.trigger('blurred');});},on_selection_changed:function(){if(this.reference_ready){this.internal_set_value([this.selection.get_value(),false]);this.render_value();}},data_changed:function(){if(this.reference_ready){this.internal_set_value([this.selection.get_value(),this.m2o.get_value()]);}},set_value:function(val){if(val){val=val.split(',');val[0]=val[0]||false;val[1]=val[0]?(val[1]?parseInt(val[1],10):val[1]):false;}
this._super(val||[false,false]);},get_value:function(){return this.get('value')[0]&&this.get('value')[1]?(this.get('value')[0]+','+this.get('value')[1]):false;},render_value:function(){this.reference_ready=false;if(!this.get("effective_readonly")){this.selection.set_value(this.get('value')[0]);}
this.m2o.field.relation=this.get('value')[0];this.m2o.set_value(this.get('value')[1]);this.m2o.do_toggle(!!this.get('value')[0]);this.reference_ready=true;},is_false:function(){return!this.get_value();},});var FieldBinary=common.AbstractField.extend(common.ReinitializeFieldMixin,{init:function(field_manager,node){var self=this;this._super(field_manager,node);this.binary_value=false;this.useFileAPI=!!window.FileReader;this.max_upload_size=25*1024*1024;if(!this.useFileAPI){this.fileupload_id=_.uniqueId('o_fileupload');$(window).on(this.fileupload_id,function(){var args=[].slice.call(arguments).slice(1);self.on_file_uploaded.apply(self,args);});}},stop:function(){if(!this.useFileAPI){$(window).off(this.fileupload_id);}
this._super.apply(this,arguments);},initialize_content:function(){this.$inputFile=this.$('.o_form_input_file');this.$inputFile.change(this.on_file_change);var self=this;this.$('.o_select_file_button').click(function(){self.$inputFile.click();});this.$('.o_clear_file_button').click(this.on_clear);},on_file_change:function(e){var self=this;var file_node=e.target;if((this.useFileAPI&&file_node.files.length)||(!this.useFileAPI&&$(file_node).val()!=='')){if(this.useFileAPI){var file=file_node.files[0];if(file.size>this.max_upload_size){var msg=_t("The selected file exceed the maximum file size of %s.");this.do_warn(_t("File upload"),_.str.sprintf(msg,utils.human_size(this.max_upload_size)));return false;}
var filereader=new FileReader();filereader.readAsDataURL(file);filereader.onloadend=function(upload){var data=upload.target.result;data=data.split(',')[1];self.on_file_uploaded(file.size,file.name,file.type,data);};}else{this.$('form.o_form_binary_form input[name=session_id]').val(this.session.session_id);this.$('form.o_form_binary_form').submit();}
this.$('.o_form_binary_progress').show();this.$('button').hide();}},on_file_uploaded:function(size,name){if(size===false){this.do_warn(_t("File Upload"),_t("There was a problem while uploading your file"));console.warn("Error while uploading file : ",name);}else{this.on_file_uploaded_and_valid.apply(this,arguments);}
this.$('.o_form_binary_progress').hide();this.$('button').show();},on_file_uploaded_and_valid:function(size,name,content_type,file_base64){this.binary_value=true;this.set_filename(name);this.set_value(file_base64);},on_save_as:function(ev){var value=this.get('value');if(!value){this.do_warn(_t("Save As..."),_t("The field is empty, there's nothing to save !"));ev.stopPropagation();}else{framework.blockUI();var c=crash_manager;var filename_fieldname=this.node.attrs.filename;var filename_field=this.view.fields&&this.view.fields[filename_fieldname];this.session.get_file({'url':'/web/content','data':{'model':this.view.dataset.model,'id':this.view.datarecord.id,'field':this.name,'filename_field':filename_fieldname,'filename':filename_field?filename_field.get('value'):null,'download':true,'data':utils.is_bin_size(value)?null:value,},'complete':framework.unblockUI,'error':c.rpc_error.bind(c)});ev.stopPropagation();}},set_filename:function(value){var filename=this.node.attrs.filename;if(filename){var field=this.field_manager.fields[filename];if(field){field.set_value(value);field._dirty_flag=true;}}},on_clear:function(){this.binary_value=false;this.set_filename('');this.set_value(false);}});var FieldBinaryFile=FieldBinary.extend({template:'FieldBinaryFile',initialize_content:function(){var self=this;this._super();if(this.get("effective_readonly")){this.$el.click(function(ev){if(self.get('value')){self.on_save_as(ev);}
return false;});}else{this.$input=this.$('.o_form_input').eq(0);this.$input.on('click',function(){self.$inputFile.click();});}},render_value:function(){var filename=this.view.datarecord[this.node.attrs.filename];if(this.get("effective_readonly")){this.do_toggle(!!this.get('value'));if(this.get('value')){this.$el.empty().append($("<span/>").addClass('fa fa-download'));if(filename){this.$el.append(" "+filename);}}}else{if(this.get('value')){this.$el.children().removeClass('o_hidden');this.$('.o_select_file_button').first().addClass('o_hidden');this.$input.val(filename||this.get('value'));}else{this.$el.children().addClass('o_hidden');this.$('.o_select_file_button').first().removeClass('o_hidden');}}}});var FieldBinaryImage=FieldBinary.extend({template:'FieldBinaryImage',placeholder:"/web/static/src/img/placeholder.png",render_value:function(){var url=this.placeholder;if(this.get('value')){if(!utils.is_bin_size(this.get('value'))){url='data:image/png;base64,'+this.get('value');}else{url=session.url('/web/image',{model:this.view.dataset.model,id:JSON.stringify(this.view.datarecord.id||null),field:(this.options.preview_image)?this.options.preview_image:this.name,unique:(this.view.datarecord.__last_update||'').replace(/[^0-9]/g,''),});}}
var $img=$(QWeb.render("FieldBinaryImage-img",{widget:this,url:url}));var self=this;$img.click(function(e){if(self.view.get("actual_mode")=="view"){var $button=$(".o_form_button_edit");$button.openerpBounce();e.stopPropagation();}});this.$('> img').remove();if(self.options.size){$img.css("width",""+self.options.size[0]+"px");$img.css("height",""+self.options.size[1]+"px");}
this.$el.prepend($img);$img.on('error',function(){self.on_clear();$img.attr('src',self.placeholder);self.do_warn(_t("Image"),_t("Could not display the selected image."));});},set_value:function(value_){var changed=value_!==this.get_value();this._super.apply(this,arguments);if(!changed){this.trigger("change:value",this,{oldValue:value_,newValue:value_});}},is_false:function(){return false;},set_dimensions:function(height,width){this.$el.css({maxWidth:width,minHeight:height,});},});var FieldStatus=common.AbstractField.extend({template:"FieldStatus",init:function(field_manager,node){this._super(field_manager,node);this.options.clickable=this.options.clickable||(this.node.attrs||{}).clickable||false;this.options.visible=this.options.visible||(this.node.attrs||{}).statusbar_visible||false;this.set({value:false});this.selection={'unfolded':[],'folded':[]};this.set("selection",{'unfolded':[],'folded':[]});this.selection_dm=new utils.DropMisordered();this.dataset=new data.DataSetStatic(this,this.field.relation,this.build_context());},start:function(){this.field_manager.on("view_content_has_changed",this,this.calc_domain);this.calc_domain();this.on("change:value",this,this.get_selection);this.on("change:evaluated_selection_domain",this,this.get_selection);this.on("change:selection",this,function(){this.selection=this.get("selection");this.render_value();});this.get_selection();if(this.options.clickable){this.bind_stage_click();}
this._super();},bind_stage_click:function(){this.$el.on('click','li[data-id]',this.on_click_stage);},set_value:function(value_){if(value_ instanceof Array){value_=value_[0];}
this._super(value_);},render_value:function(){var self=this;var content=QWeb.render("FieldStatus.content",{'widget':self,'value_folded':_.find(self.selection.folded,function(i){return i[0]===self.get('value');})});self.$el.html(content);},calc_domain:function(){var d=pyeval.eval('domain',this.build_domain());var domain=[];if(d.length){domain=['|',['id','=',this.get('value')]].concat(d);}
if(!_.isEqual(domain,this.get("evaluated_selection_domain"))){this.set("evaluated_selection_domain",domain);}},get_selection:function(){var self=this;var selection_unfolded=[];var selection_folded=[];var fold_field=this.options.fold_field;var calculation=_.bind(function(){if(this.field.type==="many2one"){return self.get_distant_fields().then(function(){return new data.DataSetSearch(self,self.field.relation,self.build_context(),self.get("evaluated_selection_domain")).read_slice(_.union(_.keys(self.distant_fields),['id']),{}).then(function(records){var ids=_.pluck(records,'id');return self.dataset.name_get(ids).then(function(records_name){_.each(records,function(record){var name=_.find(records_name,function(val){return val[0]===record.id;})[1];if(fold_field&&record[fold_field]&&record.id!==self.get('value')){selection_folded.push([record.id,name]);}else{selection_unfolded.push([record.id,name]);}});});});});}else{var select=this.field.selection;for(var i=0;i<select.length;i++){var key=select[i][0];if(key===this.get('value')||!this.options.visible||this.options.visible.indexOf(key)!==-1){selection_unfolded.push(select[i]);}}
return $.when();}},this);this.selection_dm.add(calculation()).then(function(){var selection={'unfolded':selection_unfolded,'folded':selection_folded};if(!_.isEqual(selection,self.get("selection"))){self.set("selection",selection);}});},get_distant_fields:function(){var self=this;if(!this.options.fold_field){this.distant_fields={};}
if(this.distant_fields){return $.when(this.distant_fields);}
return new Model(self.field.relation).call("fields_get",[[this.options.fold_field]]).then(function(fields){self.distant_fields=fields;return fields;});},on_click_stage:_.debounce(function(ev){var self=this;var $li=$(ev.currentTarget);var ul=$li.closest('.oe_form_field_status');if(this.view.is_disabled){return;}
var val;if(ul.attr('disabled')){return;}
if(this.field.type==="many2one"){val=parseInt($li.data("id"),10);}else{val=$li.data("id");}
if(val!==self.get('value')){if(!this.view.datarecord.id||this.view.datarecord.id.toString().match(data.BufferedDataSet.virtual_id_regex)){self.set_value(val);}
else{this.view.recursive_save().done(function(){var change={};change[self.name]=val;ul.attr('disabled',true);self.view.dataset.write(self.view.datarecord.id,change).done(function(){self.view.reload();}).always(function(){ul.removeAttr('disabled');});});}}},300,true),});var FieldMonetary=FieldFloat.extend({template:'FieldMonetary',init:function(){this._super.apply(this,arguments);this.set({"currency":false});var currency_field=(this.options&&this.options.currency_field)||this.field.currency_field||'currency_id';if(currency_field){this.field_manager.on("field_changed:"+currency_field,this,function(){this.set({"currency":this.field_manager.get_field_value(currency_field)});});}
this.on("change:currency",this,this.get_currency_info);this.get_currency_info();},start:function(){var tmp=this._super();this.on("change:currency_info",this,this.update);return tmp;},initialize_content:function(){if(!this.get('effective_readonly')){this.$input=this.$('input');this.add_symbol();}else{this.$input=undefined;}
this._super();},add_symbol:function(){var currency=this.get('currency_info');if(currency){var before=(currency.position==='before');this.$el[(before)?'prepend':'append']($('<span/>',{html:currency.symbol}));}},get_currency_info:function(){var self=this;if(this.get("currency")===false){this.set({"currency_info":null});return;}
return self.set({"currency_info":session.get_currency(self.get("currency"))});},update:function(){if(this.view.options.is_list_editable){return;}else{return this.reinitialize();}},render_value:function(){this._super();if(this.get('effective_readonly')){this.add_symbol();}},get_digits_precision:function(){return this.node.attrs.digits||this.field.digits||(this.get('currency_info')&&this.get('currency_info').digits);},parse_value:function(val,def){return formats.parse_value(val,{type:"float",digits:this.get_digits_precision()},def);},format_value:function(val,def){return formats.format_value(val,{type:"float",digits:this.get_digits_precision()},def);},});var StatInfo=common.AbstractField.extend({is_field_number:true,init:function(){this._super.apply(this,arguments);this.internal_set_value(0);},set_value:function(value_){if(value_===false||value_===undefined){value_=0;}
this._super.apply(this,[value_]);},render_value:function(){var options={value:this.get("value")||0,};if(!this.node.attrs.nolabel){if(this.options.label_field&&this.view.datarecord[this.options.label_field]){options.text=this.view.datarecord[this.options.label_field];}
else{options.text=this.string;}}
this.$el.html(QWeb.render("StatInfo",options));this.$el.addClass('o_stat_info');},});var FieldToggleBoolean=common.AbstractField.extend({template:"toggle_button",events:{'click':'set_toggle_button'},render_value:function(){var class_name=this.get_value()?'o_toggle_button_success':'text-muted';this.$('i').attr('class',('fa fa-circle '+class_name));},set_toggle_button:function(){var self=this;var toggle_value=!this.get_value();if(this.view.get('actual_mode')=='view'){var rec_values={};rec_values[self.node.attrs.name]=toggle_value;return this.view.dataset._model.call('write',[[this.view.datarecord.id],rec_values,self.view.dataset.get_context()]).done(function(){self.reload_record();});}
else{this.set_value(toggle_value);}},reload_record:function(){this.view.reload();},is_false:function(){return false;},});var AceEditor=common.AbstractField.extend(common.ReinitializeFieldMixin,{template:"AceEditor",willStart:function(){if(!window.ace&&!this.loadJS_def){this.loadJS_def=ajax.loadJS('/web/static/lib/ace/ace.odoo-custom.js').then(function(){return $.when(ajax.loadJS('/web/static/lib/ace/mode-python.js'),ajax.loadJS('/web/static/lib/ace/mode-xml.js'));});}
return $.when(this._super(),this.loadJS_def);},initialize_content:function(){if(!this.get("effective_readonly")){var self=this;this.aceEditor=ace.edit(this.$('.ace-view-editor')[0]);this.aceEditor.setOptions({"maxLines":Infinity});this.aceEditor.$blockScrolling=true;var scrollIntoViewIfNeeded=_.throttle(function(){var node=self.aceEditor.renderer.textarea;if(node.scrollIntoViewIfNeeded){node.scrollIntoViewIfNeeded(false);}else{var offsetParent=node.offsetParent;while(offsetParent){var elY=0;var elH=node.offsetHeight+20;var parent=node;while(offsetParent&&parent){elY+=node.offsetTop;parent=node.parentNode;while(parent!=offsetParent&&(parent.tagName==="BODY"||["auto","scroll"].indexOf(window.getComputedStyle(parent).overflowY)===-1)){parent=parent.parentNode;}
node=parent;if(parent!==offsetParent){elY-=parent.offsetTop;parent=null;}
offsetParent=node.offsetParent;}
if((node.tagName==="BODY"||["auto","scroll"].indexOf(window.getComputedStyle(node).overflowY)!==-1)&&(node.scrollTop+node.clientHeight)<(elY+elH)){node.scrollTop=(elY+elH)-node.clientHeight;}}}});var $moveTextAreaToCursor=this.aceEditor.renderer.$moveTextAreaToCursor;self.aceEditor.renderer.$moveTextAreaToCursor=function(){$moveTextAreaToCursor.call(this);if(parseInt($(self.aceEditor.renderer.textarea).css('top'),10)>=0){scrollIntoViewIfNeeded();}};this.aceSession=this.aceEditor.getSession();this.aceSession.setUseWorker(false);this.aceSession.setMode("ace/mode/"+(this.options.mode||'xml'));this.aceEditor.on("blur",function(){if(self.aceSession.getUndoManager().hasUndo()){self.set_value(self.aceSession.getValue());}});}},destroy_content:function(){if(this.aceEditor){this.aceEditor.destroy();}},render_value:function(){if(!this.get("effective_readonly")){var value=formats.format_value(this.get('value'),this);this.aceSession.setValue(value);}else{var txt=this.get("value")||'';this.$(".oe_form_text_content").text(txt);}},focus:function(){return this.aceEditor.focus();},});core.form_widget_registry.add('char',FieldChar).add('id',FieldID).add('email',FieldEmail).add('url',FieldUrl).add('text',FieldText).add('char_domain',FieldCharDomain).add('date',FieldDate).add('datetime',FieldDatetime).add('selection',FieldSelection).add('radio',FieldRadio).add('reference',FieldReference).add('boolean',FieldBoolean).add('boolean_button',FieldBooleanButton).add('toggle_button',FieldToggleBoolean).add('float',FieldFloat).add('percentpie',FieldPercentPie).add('integer',FieldFloat).add('float_time',FieldFloat).add('progressbar',FieldProgressBar).add('image',FieldBinaryImage).add('binary',FieldBinaryFile).add('statusbar',FieldStatus).add('monetary',FieldMonetary).add('priority',FieldPriority).add('kanban_state_selection',KanbanSelection).add('statinfo',StatInfo).add('timezone_mismatch',TimezoneMismatch).add('label_selection',LabelSelection).add('ace',AceEditor);core.form_tag_registry.add('button',WidgetButton);return{FieldBoolean:FieldBoolean,FieldChar:FieldChar,FieldEmail:FieldEmail,FieldFloat:FieldFloat,FieldRadio:FieldRadio,FieldStatus:FieldStatus,FieldMonetary:FieldMonetary,WidgetButton:WidgetButton};});;

/* /web/static/src/js/views/form_upgrade_widgets.js defined in bundle 'web.assets_backend' */
odoo.define('web.form_upgrade_widgets',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var form_widgets=require('web.form_widgets');var framework=require('web.framework');var Model=require('web.DataModel');var _t=core._t;var QWeb=core.qweb;var AbstractFieldUpgrade={events:{'click input':'on_click_input',},start:function(){this._super.apply(this,arguments);this.get_enterprise_label().after($("<span>",{text:"Enterprise",'class':"label label-primary oe_inline"}));},open_dialog:function(){var message=$(QWeb.render('EnterpriseUpgrade'));var buttons=[{text:_t("Upgrade now"),classes:'btn-primary',close:true,click:this.confirm_upgrade,},{text:_t("Cancel"),close:true,},];return new Dialog(this,{size:'medium',buttons:buttons,$content:$('<div>',{html:message,}),title:_t("Odoo Enterprise"),}).open();},confirm_upgrade:function(){new Model("res.users").call("search_count",[[["share","=",false]]]).then(function(data){framework.redirect("https://www.odoo.com/odoo-enterprise/upgrade?num_users="+data);});},get_enterprise_label:function(){},on_click_input:function(){},};var UpgradeBoolean=form_widgets.FieldBoolean.extend(AbstractFieldUpgrade,{template:"FieldUpgradeBoolean",get_enterprise_label:function(){return this.$label;},on_click_input:function(){if(this.$checkbox.prop("checked")){this.open_dialog().on('closed',this,function(){this.$checkbox.prop("checked",false);});}},});var UpgradeRadio=form_widgets.FieldRadio.extend(AbstractFieldUpgrade,{get_enterprise_label:function(){this.$('label').addClass('mr4');return this.$('label').last();},on_click_input:function(event){if($(event.target).val()==="1"){this.open_dialog().on('closed',this,function(){this.$('input').first().prop("checked",true);});}},});core.form_widget_registry.add('upgrade_boolean',UpgradeBoolean).add('upgrade_radio',UpgradeRadio);});;

/* /web/static/src/js/views/form_relational_widgets.js defined in bundle 'web.assets_backend' */
odoo.define('web.form_relational',function(require){"use strict";var ControlPanel=require('web.ControlPanel');var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var common=require('web.form_common');var ListView=require('web.ListView');require('web.ListEditor');var Model=require('web.DataModel');var session=require('web.session');var utils=require('web.utils');var ViewManager=require('web.ViewManager');var _t=core._t;var QWeb=core.qweb;var COMMANDS=common.commands;var list_widget_registry=core.list_widget_registry;var M2ODialog=Dialog.extend({template:"M2ODialog",init:function(parent){this.name=parent.string;this._super(parent,{title:_.str.sprintf(_t("Create a %s"),parent.string),size:'medium',buttons:[{text:_t('Create'),classes:'btn-primary',click:function(e){if(this.$("input").val()!==''){this.getParent()._quick_create(this.$("input").val());this.close();}else{e.preventDefault();this.$("input").focus();}}},{text:_t('Create and edit'),classes:'btn-primary',close:true,click:function(){this.getParent()._search_create_popup("form",undefined,this.getParent()._create_context(this.$("input").val()));}},{text:_t('Cancel'),close:true}]});},start:function(){var text=_.str.sprintf(_t("You are creating a new %s, are you sure it does not exist yet?"),this.name);this.$("p").text(text);this.$("input").val(this.getParent().$input.val());},});var FieldMany2One=common.AbstractField.extend(common.CompletionFieldMixin,common.ReinitializeFieldMixin,{template:"FieldMany2One",events:{'keydown input':function(e){switch(e.which){case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:e.stopPropagation();}},},init:function(field_manager,node){this._super(field_manager,node);common.CompletionFieldMixin.init.call(this);this.display_value={};this.display_value_backup={};this.last_search=[];this.floating=false;this.current_display=null;this.is_started=false;this.ignore_focusout=false;},reinit_value:function(val){this.internal_set_value(val);this.floating=false;if(this.is_started&&!this.no_rerender){this.render_value();}},initialize_field:function(){this.is_started=true;core.bus.on('click',this,function(){if(!this.get("effective_readonly")&&this.$input&&this.$input.autocomplete('widget').is(':visible')){this.$input.autocomplete("close");}});common.ReinitializeFieldMixin.initialize_field.call(this);},initialize_content:function(){if(!this.get("effective_readonly")){this.render_editable();}},destroy_content:function(){if(this.$dropdown){this.$dropdown.off('click');delete this.$dropdown;}
if(this.$input){if(this.$input.data('ui-autocomplete')){this.$input.autocomplete("destroy");}
this.$input.closest(".modal .modal-content").off('scroll');this.$input.off('keyup blur autocompleteclose autocompleteopen '+'focus focusout change keydown');delete this.$input;}
if(this.$follow_button){this.$follow_button.off('blur focus click');delete this.$follow_button;}},destroy:function(){this.destroy_content();return this._super();},init_error_displayer:function(){},hide_error_displayer:function(){},show_error_displayer:function(){new M2ODialog(this).open();},render_editable:function(){var self=this;this.$input=this.$("input");this.init_error_displayer();self.$input.on('focus',function(){self.hide_error_displayer();});this.$dropdown=this.$(".o_dropdown_button");this.$follow_button=this.$(".o_external_button");this.$follow_button.click(function(ev){ev.preventDefault();if(!self.get('value')){self.focus();return;}
var context=self.build_context().eval();var model_obj=new Model(self.field.relation);model_obj.call('get_formview_id',[[self.get("value")],context]).then(function(view_id){var pop=new common.FormViewDialog(self,{res_model:self.field.relation,res_id:self.get("value"),context:self.build_context(),title:_t("Open: ")+self.string,view_id:view_id,readonly:!self.can_write}).open();pop.on('write_completed',self,function(){self.display_value={};self.display_value_backup={};self.render_value();self.focus();self.trigger('changed_value');});});});var input_changed=function(){if(self.current_display!==self.$input.val()){self.current_display=self.$input.val();if(self.$input.val()===""){self.internal_set_value(false);self.floating=false;}else{self.floating=true;}}};this.$input.keydown(input_changed);this.$input.change(input_changed);this.$input.on('click',function(){if(self.$input.autocomplete("widget").is(":visible")){self.$input.autocomplete("close");}else{if(self.get("value")&&!self.floating){self.$input.autocomplete("search","");}else{self.$input.autocomplete("search");}}});var close_autocomplete=_.debounce(function(){if(self.$input.autocomplete("widget").is(":visible")){self.$input.autocomplete("close");}},50);this.$input.closest(".modal .modal-content").on('scroll',this,close_autocomplete);self.ed_def=$.Deferred();self.uned_def=$.Deferred();var ed_delay=200;var ed_duration=15000;var anyoneLoosesFocus=function(e){if(self.ignore_focusout){return;}
var used=false;if(self.floating){if(self.last_search.length>0){if(self.last_search[0][0]!=self.get("value")){self.display_value={};self.display_value_backup={};self.display_value[""+self.last_search[0][0]]=self.last_search[0][1];self.reinit_value(self.last_search[0][0]);self.last_search=[];}else{used=true;self.render_value();}}else{used=true;}
self.floating=false;}
var has_changed=(self.get("value")===false||self.display_value[""+self.get("value")]!==self.$input.val());if(used&&has_changed&&!self.no_ed&&!(self.options&&(self.options.no_create||self.options.no_quick_create))){self.ed_def.reject();self.uned_def.reject();self.ed_def=$.Deferred();self.ed_def.done(function(){self.can_create&&self.$input&&self.show_error_displayer();ignore_blur=false;self.trigger('focused');});ignore_blur=true;setTimeout(function(){self.ed_def.resolve();self.uned_def.reject();self.uned_def=$.Deferred();self.uned_def.done(function(){self.hide_error_displayer();});setTimeout(function(){self.uned_def.resolve();},ed_duration);},ed_delay);}else{self.no_ed=false;self.ed_def.reject();}};var ignore_blur=false;this.$input.on({focusout:anyoneLoosesFocus,focus:function(){self.trigger('focused');},autocompleteopen:function(){ignore_blur=true;},autocompleteclose:function(){setTimeout(function(){ignore_blur=false;},0);},blur:function(){if(ignore_blur){$(this).focus();return;}
if(_(self.getChildren()).any(function(child){return child instanceof common.ViewDialog;})){return;}
self.trigger('blurred');}});var isSelecting=false;this.$input.autocomplete({source:function(req,resp){self.get_search_result(req.term).done(function(result){resp(result);});},select:function(event,ui){isSelecting=true;var item=ui.item;if(item.id){self.display_value={};self.display_value_backup={};self.display_value[""+item.id]=item.name;self.reinit_value(item.id);}else if(item.action){item.action();self.trigger('focused');}
return false;},focus:function(e,ui){e.preventDefault();},autoFocus:true,html:true,minLength:0,delay:200,});this.$input.autocomplete("option","position",{my:"left top",at:"left bottom"});this.$input.keyup(function(e){if(e.which===13){if(isSelecting)
e.stopPropagation();}
isSelecting=false;});this.setupFocus(this.$follow_button);},render_value:function(no_recurse){var self=this;if(!this.get("value")){this.display_string(null);return;}
var display=this.display_value[""+this.get("value")];if(display){this.display_string(display);return;}
if(!no_recurse){var dataset=new data.DataSetStatic(this,this.field.relation,self.build_context());var def=this.alive(dataset.name_get([self.get("value")])).done(function(data){if(!data[0]){self.do_warn(_t("Render"),_.str.sprintf(_t("No value found for the field %s for value %s"),self.field.string,self.get("value")));return;}
self.display_value[""+self.get("value")]=data[0][1];self.render_value(true);}).fail(function(data,event){event.preventDefault();self.display_value[""+self.get("value")]=self.display_value_backup[""+self.get("value")];self.render_value(true);});if(this.view&&this.view.render_value_defs){this.view.render_value_defs.push(def);}}},display_string:function(str){var noValue=(str===null);if(!this.get("effective_readonly")){this.$input.val(noValue?"":(str.split("\n")[0].trim()||$(data.noDisplayContent).text()));this.current_display=this.$input.val();this.$follow_button.toggle(!this.is_false());this.$el.toggleClass('o_with_button',!!this.$follow_button&&this.$follow_button.length>0&&!this.is_false());}else{this.$el.html(noValue?"":(_.escape(str.trim()).split("\n").join("<br/>")||data.noDisplayContent));if(!this.options.no_open){this.$el.off('click');var execute_formview_action_once=_.once(this.execute_formview_action.bind(this));this.$el.click(function(ev){ev.preventDefault();execute_formview_action_once();});}}},execute_formview_action:function(){var self=this;var context=self.build_context().eval();(new Model(self.field.relation)).call('get_formview_action',[[self.get("value")],context]).then(function(action){self.do_action(action);});},set_value:function(value_){if(value_ instanceof Array){this.display_value={};this.display_value_backup={};if(!this.options.always_reload){this.display_value[""+value_[0]]=value_[1];}
else{this.display_value_backup[""+value_[0]]=value_[1];}
value_=value_[0];}
value_=value_||false;this.reinit_value(value_);},get_displayed:function(){return this.display_value[""+this.get("value")];},add_id:function(id){this.display_value={};this.display_value_backup={};this.reinit_value(id);},is_false:function(){return!this.get("value");},focus:function(){var input=!this.get('effective_readonly')&&this.$input&&this.$input[0];return input?input.focus():false;},_quick_create:function(){this.no_ed=true;this.ed_def.reject();return common.CompletionFieldMixin._quick_create.apply(this,arguments);},_search_create_popup:function(){this.no_ed=true;this.ed_def.reject();this.ignore_focusout=true;this.reinit_value(false);var res=common.CompletionFieldMixin._search_create_popup.apply(this,arguments);this.ignore_focusout=false;this.no_ed=false;return res;},});var AbstractManyField=common.AbstractField.extend({init:function(field_manager,node){var self=this;this._super(field_manager,node);this.dataset=new X2ManyDataSet(this,this.field.relation,this.build_context());this.dataset.x2m=this;this.dataset.parent_view=this.view;this.dataset.child_name=this.name;this.set('value',[]);this.starting_ids=[];this.mutex=new utils.Mutex();this.view.on("load_record",this,this._on_load_record);this.dataset.on('dataset_changed',this,function(){var options=_.clone(_.last(arguments));if(!_.isObject(options)||_.isArray(options)){options={};}
if(!self.internal_dataset_changed&&!options.internal_dataset_changed){self.trigger("change:commands",options);}});this.on("change:commands",this,function(options){self._inhibit_on_change_flag=!!options._inhibit_on_change_flag;self.set({'value':self.dataset.ids.slice()});self._inhibit_on_change_flag=false;});},_on_load_record:function(record){this.starting_ids=[];if(record.id&&record[this.name]&&(!isNaN(record.id)||record.id.indexOf(this.dataset.virtual_id_prefix)===-1)){this.starting_ids=this.get('value').slice();}
this.trigger("load_record",record);},set_value:function(ids){ids=(ids||[]).slice();if(_.find(ids,function(id){return typeof(id)==="string";})){throw new Error("set_value of '"+this.name+"' must receive an list of ids without virtual ids.",ids);}
if(_.find(ids,function(id){return typeof(id)!=="number";})){return this.send_commands(ids,{'_inhibit_on_change_flag':this._inhibit_on_change_flag});}
this.dataset.reset_ids(ids);return $.when(this._super(ids));},internal_set_value:function(ids){if(_.isEqual(ids,this.get("value"))){return;}
var tmp=this.no_rerender;this.no_rerender=true;var def=this.data_replace(ids.slice());this.no_rerender=tmp;return def;},commit_value:function(){return this.mutex.def;},data_create:function(data,options){return this.send_commands([COMMANDS.create(data)],options);},data_update:function(id,data,options){return this.send_commands([COMMANDS.update(id,data)],options);},data_link:function(id,options){return this.send_commands([COMMANDS.link_to(id)],options);},data_link_multi:function(ids,options){return this.send_commands(_.map(ids,function(id){return COMMANDS.link_to(id);}),options);},data_delete:function(id){return this.send_commands([COMMANDS.delete(id)]);},data_forget:function(id){return this.send_commands([COMMANDS.forget(id)]);},data_replace:function(ids,options){return this.send_commands([COMMANDS.replace_with(ids)],options);},data_read:function(ids,fields,options){return this.dataset.read_ids(ids,fields,options);},send_commands:function(command_list,options){var self=this;var def=$.Deferred();var dataset=this.dataset;var res=true;options=options||{};var internal_options=_.extend({},options,{'internal_dataset_changed':true});_.each(command_list,function(command){self.mutex.exec(function(){var id=command[1];switch(command[0]){case COMMANDS.CREATE:var data=_.clone(command[2]);delete data.id;return dataset.create(data,internal_options).then(function(id){dataset.ids.push(id);res=id;});case COMMANDS.UPDATE:return dataset.write(id,command[2],internal_options).then(function(){if(dataset.ids.indexOf(id)===-1){dataset.ids.push(id);res=id;}});case COMMANDS.FORGET:return dataset.unlink([id]);case COMMANDS.DELETE:return dataset.unlink([id]);case COMMANDS.LINK_TO:if(dataset.ids.indexOf(id)===-1){return dataset.add_ids([id],internal_options);}
return;case COMMANDS.DELETE_ALL:return dataset.reset_ids([],{keep_read_data:true});case COMMANDS.REPLACE_WITH:dataset.ids=[];return dataset.alter_ids(command[2],internal_options);default:throw new Error("send_commands to '"+self.name+"' receive a non command value."+"\n"+JSON.stringify(command_list));}});});this.mutex.def.then(function(){self.trigger("change:commands",options);def.resolve(res);});return def;},get_value:function(){var self=this,is_one2many=this.field.type==="one2many",not_delete=this.options.not_delete,starting_ids=this.starting_ids.slice(),replace_with_ids=[],add_ids=[],command_list=[],id,index,record;_.each(this.get('value'),function(id){index=starting_ids.indexOf(id);if(index!==-1){starting_ids.splice(index,1);}
var record=self.dataset.get_cache(id);if(!_.isEmpty(record.changes)){var values=_.clone(record.changes);for(var k in values){if((values[k]instanceof Array)&&values[k].length===2&&typeof values[k][0]==="number"&&typeof values[k][1]==="string"){values[k]=values[k][0];}}
if(record.to_create){command_list.push(COMMANDS.create(values));}else{command_list.push(COMMANDS.update(record.id,values));}
return;}
if(!is_one2many||not_delete||self.dataset.delete_all){replace_with_ids.push(id);}else{command_list.push(COMMANDS.link_to(id));}});if((!is_one2many||not_delete||self.dataset.delete_all)&&(replace_with_ids.length||starting_ids.length)){_.each(command_list,function(command){if(command[0]===COMMANDS.UPDATE){replace_with_ids.push(command[1]);}});command_list.unshift(COMMANDS.replace_with(replace_with_ids));}
_.each(starting_ids,function(id){if(is_one2many&&!not_delete){command_list.push(COMMANDS.delete(id));}else if(is_one2many&&!self.dataset.delete_all){command_list.push(COMMANDS.forget(id));}});return command_list;},is_valid:function(){return this.mutex.def.state()==="resolved"&&this._super();},is_false:function(){return _(this.get('value')).isEmpty();},destroy:function(){this.view.off("load_record",this,this._on_load_record);this._super();}});var FieldX2Many=AbstractManyField.extend({multi_selection:false,disable_utility_classes:true,x2many_views:{},view_options:{},default_view:'tree',init:function(field_manager,node){this._super(field_manager,node);this.is_loaded=$.Deferred();this.initial_is_loaded=this.is_loaded;this.is_started=false;this.set_value([]);},start:function(){this._super.apply(this,arguments);var self=this;this.load_views();var destroy=function(){self.is_loaded=self.is_loaded.then(function(){self.renderElement();self.viewmanager.destroy();return $.when(self.load_views()).done(function(){self.reload_current_view();});});};this.is_loaded.done(function(){self.on("change:effective_readonly",self,destroy);});this.view.on("on_button_cancel",this,destroy);this.is_started=true;this.reload_current_view();},load_views:function(){var self=this;var view_types=this.node.attrs.mode;view_types=!!view_types?view_types.split(","):[this.default_view];var views=[];_.each(view_types,function(view_type){if(!_.include(["list","tree","graph","kanban"],view_type)){throw new Error(_.str.sprintf(_t("View type '%s' is not supported in X2Many."),view_type));}
var view={view_id:false,view_type:view_type==="tree"?"list":view_type,fields_view:self.field.views&&self.field.views[view_type],options:{},};if(view.view_type==="list"){_.extend(view.options,{action_buttons:false,addable:null,selectable:self.multi_selection,sortable:true,import_enabled:false,deletable:true});if(self.get("effective_readonly")){_.extend(view.options,{deletable:null,reorderable:false,});}}else if(view.view_type==="kanban"){_.extend(view.options,{action_buttons:true,confirm_on_delete:false,});if(self.get("effective_readonly")){_.extend(view.options,{action_buttons:false,quick_creatable:false,creatable:false,read_only_mode:true,});}}
views.push(view);});this.views=views;this.viewmanager=new X2ManyViewManager(this,this.dataset,views,this.view_options,this.x2many_views);this.viewmanager.x2m=self;var def=$.Deferred().done(function(){self.initial_is_loaded.resolve();});this.viewmanager.on("controller_inited",self,function(view_type,controller){controller.x2m=self;if(view_type=="list"){if(self.get("effective_readonly")){controller.on('edit:before',self,function(e){e.cancel=true;});_(controller.columns).find(function(column){if(!(column instanceof list_widget_registry.get('field.handle'))){return false;}
column.modifiers.invisible=true;return true;});}}else if(view_type=="graph"){self.reload_current_view();}
def.resolve();});this.viewmanager.on("switch_mode",self,function(n_mode){$.when(self.commit_value()).done(function(){if(n_mode==="list"){utils.async_when().done(function(){self.reload_current_view();});}});});utils.async_when().done(function(){self.$el.addClass('o_view_manager_content');self.alive(self.viewmanager.attachTo(self.$el));});return def;},reload_current_view:function(){var self=this;self.is_loaded=self.is_loaded.then(function(){var view=self.get_active_view();if(view.type==="list"){view.controller.current_min=1;return view.controller.reload_content();}else if(view.controller.do_search){return view.controller.do_search(self.build_domain(),self.dataset.get_context(),[]);}},undefined);return self.is_loaded;},get_active_view:function(){return(this.viewmanager&&this.viewmanager.active_view);},set_value:function(value_){var self=this;this._super(value_).then(function(){if(self.is_started&&!self.no_rerender){return self.reload_current_view();}});},commit_value:function(){var view=this.get_active_view();if(view&&view.type==="list"&&view.controller.__focus){return $.when(this.mutex.def,view.controller._on_blur_one2many());}
return this.mutex.def;},is_syntax_valid:function(){var view=this.get_active_view();if(!view){return true;}
switch(this.viewmanager.active_view.type){case'form':return _(view.controller.fields).chain().invoke('is_valid').all(_.identity).value();case'list':return view.controller.is_valid();}
return true;},is_false:function(){return _(this.dataset.ids).isEmpty();},});var X2ManyDataSet=data.BufferedDataSet.extend({get_context:function(){this.context=this.x2m.build_context();var self=this;_.each(arguments,function(context){self.context.add(context);});return this.context;},});var X2ManyViewManager=ViewManager.extend({custom_events:{'scrollTo':function(){},},init:function(parent,dataset,views,flags,x2many_views){flags=_.extend({},flags,{headless:false,search_view:false,action_buttons:true,pager:true,sidebar:false,});this.control_panel=new ControlPanel(parent,"X2ManyControlPanel");this.set_cp_bus(this.control_panel.get_bus());this._super(parent,dataset,views,flags);this.registry=core.view_registry.extend(x2many_views);},start:function(){this.control_panel.prependTo(this.$el);return this._super();},switch_mode:function(mode,unused){if(mode!=='form'){return this._super(mode,unused);}
var self=this;var id=self.x2m.dataset.index!==null?self.x2m.dataset.ids[self.x2m.dataset.index]:null;var pop=new common.FormViewDialog(this,{res_model:self.x2m.field.relation,res_id:id,context:self.x2m.build_context(),title:_t("Open: ")+self.x2m.string,create_function:function(data,options){return self.x2m.data_create(data,options);},write_function:function(id,data,options){return self.x2m.data_update(id,data,options).done(function(){self.x2m.reload_current_view();});},alternative_form_view:self.x2m.field.views?self.x2m.field.views.form:undefined,parent_view:self.x2m.view,child_name:self.x2m.name,read_function:function(ids,fields,options){return self.x2m.data_read(ids,fields,options);},form_view_options:{'not_interactible_on_create':true},readonly:self.x2m.get("effective_readonly")}).open();pop.on("elements_selected",self,function(){self.x2m.reload_current_view();});},});var X2ManyListView=ListView.extend({is_valid:function(){if(!this.fields_view||!this.editable()){return true;}
if(_.isEmpty(this.records.records)){return true;}
var fields=this.editor.form.fields;var current_values={};_.each(fields,function(field){field._inhibit_on_change_flag=true;field.__no_rerender=field.no_rerender;field.no_rerender=true;current_values[field.name]=field.get('value');});var cached_records=_.filter(this.dataset.cache,function(item){return!_.isEmpty(item.values)&&!item.to_delete;});var valid=_.every(cached_records,function(record){_.each(fields,function(field){var value=record.values[field.name];field._inhibit_on_change_flag=true;field.no_rerender=true;field.set_value(_.isArray(value)&&_.isArray(value[0])?[COMMANDS.delete_all()].concat(value):value);});return _.every(fields,function(field){field.process_modifiers();field._check_css_flags();return field.is_valid();});});_.each(fields,function(field){field.set('value',current_values[field.name],{silent:true});field._inhibit_on_change_flag=false;field.no_rerender=field.__no_rerender;});return valid;},render_pager:function($node,options){options=_.extend(options||{},{single_page_hidden:true,});this._super($node,options);},display_nocontent_helper:function(){return false;},});var X2ManyList=ListView.List.extend({pad_table_to:function(count){if(!this.view.is_action_enabled('create')||this.view.x2m.get('effective_readonly')){this._super(count);return;}
this._super(count>0?count-1:0);var self=this;var columns=_(this.columns).filter(function(column){return column.invisible!=='1';}).length;if(this.options.selectable){columns++;}
if(this.options.deletable){columns++;}
var $cell=$('<td>',{colspan:columns,'class':'o_form_field_x2many_list_row_add'}).append($('<a>',{href:'#'}).text(_t("Add an item")).click(function(e){e.preventDefault();e.stopPropagation();var def;if(self.view.editable()){if(self.view.editor.form.__blur_timeout){clearTimeout(self.view.editor.form.__blur_timeout);self.view.editor.form.__blur_timeout=false;}
def=self.view.save_edition();}
$.when(def).done(self.view.do_add_record.bind(self));}));var $padding=this.$current.find('tr:not([data-id]):first');var $newrow=$('<tr>').append($cell);if($padding.length){$padding.before($newrow);}else{this.$current.append($newrow);}},});var One2ManyListView=X2ManyListView.extend({init:function(){this._super.apply(this,arguments);this.options=_.extend(this.options,{GroupsType:One2ManyGroups,ListType:X2ManyList});this.on('edit:after',this,this.proxy('_after_edit'));this.on('save:before cancel:before',this,this.proxy('_before_unedit'));core.bus.on('click',this,this._on_click_outside);this.dataset.on('dataset_changed',this,function(){this._dataset_changed=true;this.dataset.x2m._dirty_flag=true;});this.dataset.x2m.on('load_record',this,function(){this._dataset_changed=false;});this.on('warning',this,function(e){if(this.editable()){e.stop_propagation();}});},do_add_record:function(){if(this.editable()){this._super.apply(this,arguments);}else{var self=this;new common.SelectCreateDialog(this,{res_model:self.x2m.field.relation,domain:self.x2m.build_domain(),context:self.x2m.build_context(),title:_t("Create: ")+self.x2m.string,initial_view:"form",alternative_form_view:self.x2m.field.views?self.x2m.field.views.form:undefined,create_function:function(data,options){return self.x2m.data_create(data,options);},read_function:function(ids,fields,options){return self.x2m.data_read(ids,fields,options);},parent_view:self.x2m.view,child_name:self.x2m.name,form_view_options:{'not_interactible_on_create':true},on_selected:function(){self.x2m.reload_current_view();}}).open();}},do_activate_record:function(index,id){var self=this;new common.FormViewDialog(self,{res_model:self.x2m.field.relation,res_id:id,context:self.x2m.build_context(),title:_t("Open: ")+self.x2m.string,write_function:function(id,data,options){return self.x2m.data_update(id,data,options).done(function(){self.x2m.reload_current_view();});},alternative_form_view:self.x2m.field.views?self.x2m.field.views.form:undefined,parent_view:self.x2m.view,child_name:self.x2m.name,read_function:function(ids,fields,options){return self.x2m.data_read(ids,fields,options);},form_view_options:{'not_interactible_on_create':true},readonly:!this.is_action_enabled('edit')||self.x2m.get("effective_readonly")}).open();},do_button_action:function(name,id,callback){if(!_.isNumber(id)){this.do_warn(_t("Action Button"),_t("The o2m record must be saved before an action can be used"));return;}
var parent_form=this.x2m.view;var self=this;this.save_edition().then(function(){if(parent_form){return parent_form.save();}else{return $.when();}}).done(function(){var ds=self.x2m.dataset;var changed_records=_.find(ds.cache,function(record){return record.to_create||record.to_delete||!_.isEmpty(record.changes);});if(!self.x2m.options.reload_on_button&&!changed_records){self.handle_button(name,id,callback);}else{self.handle_button(name,id,function(){self.x2m.view.reload();});}});},start_edition:function(record,options){if(!this.__focus){this._on_focus_one2many();}
return this._super(record,options);},reload_content:function(){var self=this;if(self.__focus){self._on_blur_one2many();return this._super().then(function(){var record_being_edited=self.records.get(self.editor.form.datarecord.id);if(record_being_edited){self.start_edition(record_being_edited);}});}
return this._super();},_on_focus_one2many:function(){if(!this.editor.is_editing()){return;}
this.dataset.x2m.internal_dataset_changed=true;this._dataset_changed=false;this.__focus=true;},_on_click_outside:function(e){if(this.__ignore_blur||!this.editor.is_editing()){return;}
var $target=$(e.target);var click_outside=($target.closest('.ui-autocomplete,.btn,.modal-backdrop').length===0);var $o2m=$target.closest(".o_list_editable");if($o2m.length&&$o2m[0]===this.el){click_outside=false;}
var $modal=$target.closest(".modal");if($modal.length){var $currentModal=this.$el.closest(".modal");if($currentModal.length===0||$currentModal[0]!==$modal[0]){click_outside=false;}}
if(click_outside){this._on_blur_one2many();}},_on_blur_one2many:function(){if(this.__ignore_blur){return $.when();}
this.__ignore_blur=true;this.__focus=false;this.dataset.x2m.internal_dataset_changed=false;var self=this;return this.save_edition(true).done(function(){if(self._dataset_changed){self.dataset.trigger('dataset_changed');}}).always(function(){self.__ignore_blur=false;});},_after_edit:function(){this.editor.form.on('blurred',this,this._on_blur_one2many);this.editor.form.widgetFocused();},_before_unedit:function(){this.editor.form.off('blurred',this,this._on_blur_one2many);},do_delete:function(ids){var confirm=window.confirm;window.confirm=function(){return true;};try{return this._super(ids);}finally{window.confirm=confirm;}},reload_record:function(record,options){if(!options||!options.do_not_evict){this.dataset.evict_record(record.get('id'));}
return this._super(record);},});var One2ManyGroups=ListView.Groups.extend({setup_resequence_rows:function(){if(!this.view.x2m.get('effective_readonly')){this._super.apply(this,arguments);}}});var FieldOne2Many=FieldX2Many.extend({init:function(){this._super.apply(this,arguments);this.x2many_views={kanban:core.view_registry.get('one2many_kanban'),list:One2ManyListView,};},start:function(){this.$el.addClass('o_form_field_one2many');return this._super.apply(this,arguments);},commit_value:function(){var self=this;return this.is_loaded.then(function(){var view=self.viewmanager.active_view;if(view.type==="list"&&view.controller.editable()){return self.mutex.def.then(function(){return view.controller.save_edition();});}
return self.mutex.def;});},is_false:function(){return false;},});var Many2ManyListView=X2ManyListView.extend({init:function(){this._super.apply(this,arguments);this.options=_.extend(this.options,{ListType:X2ManyList,});this.on('edit:after',this,this.proxy('_after_edit'));this.on('save:before cancel:before',this,this.proxy('_before_unedit'));},do_add_record:function(){var self=this;new common.SelectCreateDialog(this,{res_model:this.model,domain:new data.CompoundDomain(this.x2m.build_domain(),["!",["id","in",this.x2m.dataset.ids]]),context:this.x2m.build_context(),title:_t("Add: ")+this.x2m.string,alternative_form_view:this.x2m.field.views?this.x2m.field.views.form:undefined,no_create:this.x2m.options.no_create||!this.is_action_enabled('create'),on_selected:function(element_ids){return self.x2m.data_link_multi(element_ids).then(function(){self.x2m.reload_current_view();});}}).open();},do_activate_record:function(index,id){var self=this;var pop=new common.FormViewDialog(this,{res_model:this.model,res_id:id,context:this.x2m.build_context(),title:_t("Open: ")+this.x2m.string,alternative_form_view:this.x2m.field.views?this.x2m.field.views.form:undefined,readonly:!this.is_action_enabled('edit')||self.x2m.get("effective_readonly"),}).open();pop.on('write_completed',self,function(){self.dataset.evict_record(id);self.reload_content();});},do_button_action:function(name,id,callback){var self=this;var _sup=_.bind(this._super,this);if(!this.x2m.options.reload_on_button){return _sup(name,id,callback);}else{return this.x2m.view.save().then(function(){return _sup(name,id,function(){self.x2m.view.reload();});});}},_after_edit:function(){this.editor.form.on('blurred',this,this._on_blur_many2many);},_before_unedit:function(){this.editor.form.off('blurred',this,this._on_blur_many2many);},_on_blur_many2many:function(){return this.save_edition().done(function(){if(self._dataset_changed){self.dataset.trigger('dataset_changed');}});},});var FieldMany2Many=FieldX2Many.extend({init:function(){this._super.apply(this,arguments);this.x2many_views={list:Many2ManyListView,kanban:core.view_registry.get('many2many_kanban'),};},start:function(){this.$el.addClass('o_form_field_many2many');return this._super.apply(this,arguments);}});var FieldMany2ManyKanban=FieldMany2Many.extend({default_view:'kanban',init:function(){this._super.apply(this,arguments);this.view_options=_.extend({},this.view_options,{'create_text':_t("Add"),});}});var FieldMany2ManyTags=AbstractManyField.extend(common.CompletionFieldMixin,common.ReinitializeFieldMixin,{className:"o_form_field_many2manytags",tag_template:"FieldMany2ManyTag",events:{'click .o_delete':function(e){this.remove_id($(e.target).parent().data('id'));},'click .badge':'open_color_picker','mousedown .o_colorpicker span':'update_color','focusout .o_colorpicker':'close_color_picker',},init:function(field_manager,node){this._super(field_manager,node);common.CompletionFieldMixin.init.call(this);this.set({"value":[]});},willStart:function(){var self=this;return this.dataset.call('fields_get',[]).then(function(fields){self.fields=fields;});},commit_value:function(){this.dataset.cancel_read();return this._super();},initialize_content:function(){if(!this.get("effective_readonly")){this.many2one=new FieldMany2One(this.field_manager,this.node);this.many2one.options.no_open=true;this.many2one.on('changed_value',this,function(){var newValue=this.many2one.get('value');if(newValue){this.add_id(newValue);this.many2one.set({'value':false});}});this.many2one.prependTo(this.$el);var self=this;this.many2one.$('input').on('keydown',function(e){if(!$(e.target).val()&&e.which===8){var $badges=self.$('.badge');if($badges.length){self.remove_id($badges.last().data('id'));}}});this.many2one.get_search_blacklist=function(){return self.get('value');};}},destroy_content:function(){if(this.many2one){this.many2one.destroy();this.many2one=undefined;}},get_render_data:function(ids){this.dataset.cancel_read();var fields=this.fields.color?['display_name','name','color']:['display_name','name'];return this.dataset.read_ids(ids,fields);},render_tag:function(data){this.$('.badge').remove();this.$el.prepend(QWeb.render(this.tag_template,{elements:data,readonly:this.get('effective_readonly')}));},render_value:function(){var self=this;var values=this.get("value");var handle_names=function(_data){_.each(_data,function(el){el.display_name=el.display_name.trim()?_.str.escapeHTML(el.display_name):data.noDisplayContent;});self.render_tag(_data);};if(!values||values.length>0){return this.alive(this.get_render_data(values)).done(handle_names);}else{handle_names([]);}},add_id:function(id){this.set({'value':_.uniq(this.get('value').concat([id]))});},remove_id:function(id){this.set({'value':_.without(this.get("value"),id)});},focus:function(){if(!this.get("effective_readonly")){return this.many2one.focus();}
return false;},set_dimensions:function(height,width){if(this.many2one){this.many2one.$el.css('height','auto');}
this.$el.css({width:width,minHeight:height,});if(this.many2one){this.many2one.$el.css('height',this.$el.height());}},open_color_picker:function(ev){if(this.fields.color){this.$color_picker=$(QWeb.render('FieldMany2ManyTag.colorpicker',{'widget':this,'tag_id':$(ev.currentTarget).data('id'),}));$(ev.currentTarget).append(this.$color_picker);this.$color_picker.dropdown('toggle');this.$color_picker.attr("tabindex",1).focus();}},close_color_picker:function(){this.$color_picker.remove();},update_color:function(ev){ev.preventDefault();var color=$(ev.currentTarget).data('color');var id=$(ev.currentTarget).data('id');var self=this;this.dataset.call('write',[id,{'color':color}]).done(function(){self.dataset.cache[id].from_read={};self.dataset.evict_record(id);var tag=self.$el.find("span.badge[data-id='"+id+"']");var old_color=tag.data('color');tag.removeClass('o_tag_color_'+old_color);tag.data('color',color);tag.addClass('o_tag_color_'+color);});},});var FieldMany2ManyBinaryMultiFiles=AbstractManyField.extend(common.ReinitializeFieldMixin,{template:"FieldBinaryFileUploader",events:{'click .o_attach':function(e){this.$('.o_form_input_file').click();},'change .o_form_input_file':function(e){e.stopPropagation();var $target=$(e.target);var value=$target.val();if(value!==''){if(this.data[0]&&this.data[0].upload){return false;}
var filename=value.replace(/.*[\\\/]/,'');for(var id in this.get('value')){if(this.data[id]&&(this.data[id].filename||this.data[id].name)==filename&&!this.data[id].no_unlink){this.ds_file.unlink([id]);}}
if(this.node.attrs.blockui>0){framework.blockUI();}
this.$('form.o_form_binary_form').submit();this.$(".oe_fileupload").hide();this.data[0]={id:0,name:filename,filename:filename,url:'',upload:true,};}},'click .oe_delete':function(e){e.preventDefault();e.stopPropagation();var file_id=$(e.currentTarget).data("id");if(file_id){var files=_.without(this.get('value'),file_id);if(!this.data[file_id].no_unlink){this.ds_file.unlink([file_id]);}
this.set({'value':files});}},},init:function(field_manager,node){this._super.apply(this,arguments);this.session=session;if(this.field.type!="many2many"||this.field.relation!='ir.attachment'){throw _.str.sprintf(_t("The type of the field '%s' must be a many2many field with a relation to 'ir.attachment' model."),this.field.string);}
this.data={};this.set_value([]);this.ds_file=new data.DataSetSearch(this,'ir.attachment');this.fileupload_id=_.uniqueId('oe_fileupload_temp');$(window).on(this.fileupload_id,_.bind(this.on_file_loaded,this));},get_file_url:function(attachment){return'/web/content/'+attachment.id+'?download=true';},read_name_values:function(){var self=this;var ids=this.get('value');var _value=_.filter(ids,function(id){return self.data[id]===undefined;});if(_value.length){return this.ds_file.call('read',[_value,['id','name','datas_fname','mimetype']]).then(process_data);}else{return $.when(ids);}
function process_data(datas){_.each(datas,function(data){data.no_unlink=true;data.url=self.get_file_url(data);self.data[data.id]=data;});return ids;}},render_value:function(){var self=this;this.read_name_values().then(function(ids){self.$('.oe_placeholder_files, .oe_attachments').replaceWith($(QWeb.render('FieldBinaryFileUploader.files',{'widget':self,'values':ids})));var $input=self.$('.o_form_input_file');$input.after($input.clone(true)).remove();self.$(".oe_fileupload").show();self.$(".o_image[data-mimetype^='image']").each(function(){var $img=$(this);if(/gif|jpe|jpg|png/.test($img.data('mimetype'))&&$img.data('src')){$img.css('background-image',"url('"+$img.data('src')+"')");}});});},on_file_loaded:function(e,result){if(this.node.attrs.blockui>0){framework.unblockUI();}
if(result.error||!result.id){this.do_warn(_t('Uploading Error'),result.error);delete this.data[0];}else{if(this.data[0]&&this.data[0].filename===result.filename&&this.data[0].upload){delete this.data[0];}
result.url=this.get_file_url(result);this.data[result.id]=result;var values=_.clone(this.get('value'));values.push(result.id);this.set({value:values});}
this.render_value();},});var FieldMany2ManyCheckBoxes=AbstractManyField.extend(common.ReinitializeFieldMixin,{className:"oe_form_many2many_checkboxes",init:function(){this._super.apply(this,arguments);this.set("records",[]);this.field_manager.on("view_content_has_changed",this,function(){var domain=new data.CompoundDomain(this.build_domain()).eval();if(!_.isEqual(domain,this.get("domain"))){this.set("domain",domain);}});this.records_orderer=new utils.DropMisordered();},initialize_field:function(){common.ReinitializeFieldMixin.initialize_field.call(this);this.on("change:domain",this,this.query_records);this.set("domain",new data.CompoundDomain(this.build_domain()).eval());this.on("change:records",this,this.render_value);},query_records:function(){var self=this;var model=new Model(this.field.relation);this.records_orderer.add(model.call("search",[this.get("domain")],{"context":this.build_context()}).then(function(record_ids){return model.call("name_get",[record_ids],{"context":self.build_context()});})).then(function(res){self.set("records",res);});},render_value:function(){this.$el.html(QWeb.render("FieldMany2ManyCheckBoxes",{widget:this}));var $inputs=this.$("input");$inputs.change(_.bind(this.from_dom,this));if(this.get("effective_readonly")){$inputs.attr("disabled","true");}},from_dom:function(){var new_value=this.$("input:checked").map(function(){return+$(this).data("record-id");}).get();if(!_.isEqual(new_value,this.get("value"))){this.internal_set_value(new_value);}},is_false:function(){return false;},});core.form_widget_registry.add('many2one',FieldMany2One).add('many2many',FieldMany2Many).add('many2many_tags',FieldMany2ManyTags).add('many2many_kanban',FieldMany2ManyKanban).add('one2many',FieldOne2Many).add('one2many_list',FieldOne2Many).add('many2many_binary',FieldMany2ManyBinaryMultiFiles).add('many2many_checkboxes',FieldMany2ManyCheckBoxes);core.one2many_view_registry.add('list',One2ManyListView);return{FieldMany2ManyTags:FieldMany2ManyTags,AbstractManyField:AbstractManyField,FieldMany2One:FieldMany2One,};});;

/* /web/static/src/js/views/list_view_editable.js defined in bundle 'web.assets_backend' */
odoo.define('web.ListEditor',function(require){"use strict";var core=require('web.core');var data=require('web.data');var FormView=require('web.FormView');var common=require('web.list_common');var ListView=require('web.ListView');var utils=require('web.utils');var Widget=require('web.Widget');var _t=core._t;var Editor=Widget.extend({init:function(parent,options){this._super(parent);this.options=options||{};_.defaults(this.options,{formView:FormView,delegate:this.getParent(),});this.delegate=this.options.delegate;this.record=null;},start:function(){var self=this;var form_fields_view=this._validate_view(this.delegate.edition_view(this));this.form=new(this.options.formView)(this,this.delegate.dataset,form_fields_view,{initial_mode:'edit',is_list_editable:true,disable_autofocus:true,$buttons:$(),$pager:$(),});return $.when(this._super(),this.form.appendTo($('<div/>')).then(function(){self.form.$el.addClass(self.$el.attr('class'));self.replaceElement(self.form.$el);}).done(this.proxy('do_hide')));},_validate_view:function(edition_view){if(!edition_view){throw new Error("editor delegate's #edition_view must return a view descriptor");}
var arch=edition_view.arch;if(!(arch&&arch.children instanceof Array)){throw new Error("Editor delegate's #edition_view must have a non-empty arch");}
if(arch.tag!=="form"){throw new Error("Editor delegate's #edition_view must have a 'form' root node");}
if(!(arch.attrs&&arch.attrs.version==="7.0")){throw new Error("Editor delegate's #edition_view must be a version 7 view");}
if(!/\bo_list_editable_form\b/.test(arch.attrs['class'])){throw new Error("Editor delegate's #edition_view must have the class "+"'o_list_editable_form' on its root element");}
return edition_view;},is_editing:function(){return!!this.record;},is_creating:function(){return(this.is_editing()&&!this.record.id);},edit:function(record,configureField){var self=this;var loaded;if(record){this.form.trigger('load_record',_.extend({},record));loaded=this.form.record_loaded;}else{loaded=this.form.load_defaults().then(function(){return self.form.record_loaded;});}
return loaded.then(function(){return self.do_show({reload:false});}).then(function(){self.record=self.form.datarecord;_(self.form.fields).each(function(field,name){configureField(name,field);});return self.form;});},save:function(){var self=this;return this.form.save(this.delegate.prepends_on_create()).then(function(result){if(result.created&&!self.record.id){self.record.id=result.result;}
return self.record;});},cancel:function(force){var self=this;if(force){return do_cancel();}
var message=_t("The line has been modified, your changes will be discarded. Are you sure you want to discard the changes ?");return this.form.can_be_discarded(message).then(do_cancel);function do_cancel(){var record=self.record;self.record=null;self.do_hide();return $.when(record);}},do_hide:function(){this.form.do_hide.apply(this.form,arguments);this.form.set({display_invalid_fields:false});},do_show:function(){this.form.do_show.apply(this.form,arguments);},});ListView.prototype.defaults.editable=null;ListView.include({init:function(){var self=this;this._super.apply(this,arguments);this.saving_mutex=new utils.Mutex();this._force_editability=null;this._context_editable=false;this.editor=new Editor(this);this.fields_for_resize=[];core.bus.on('resize',this,this.resize_fields);$(this.groups).bind({'edit':function(e,id,dataset){self.do_edit(dataset.index,id,dataset);},'saved':function(){if(self.groups.get_selection().length){return;}
self.configure_pager(self.dataset);self.compute_aggregates();}});this.records.bind('remove',function(){if(self.editor.is_editing()){self.cancel_edition();}});this.on('edit:before',this,function(event){if(!self.editable()||self.editor.is_editing()){event.cancel=true;}});this.on('edit:after',this,function(){self.$el.add(self.$buttons).addClass('o-editing');self.$('.ui-sortable').sortable('disable');});this.on('save:after cancel:after',this,function(){self.$('.ui-sortable').sortable('enable');self.$el.add(self.$buttons).removeClass('o-editing');});},destroy:function(){core.bus.off('resize',this,this.resize_fields);this._super();},do_hide:function(){if(this.editor.is_editing()){this.cancel_edition(true);}
this._super();},sort_by_column:function(e){e.stopPropagation();if(!this.editor.is_editing()){this._super.apply(this,arguments);}},do_edit:function(index,id,dataset){_.extend(this.dataset,dataset);},do_delete:function(ids){var nonfalse=_.compact(ids);var _super=this._super.bind(this);var next=(this.editor.is_editing())?this.cancel_edition(true):$.when();return next.then(function(){return _super(nonfalse);});},editable:function(){return!this.grouped&&!this.options.disable_editable_mode&&(this.fields_view.arch.attrs.editable||this._context_editable||this.options.editable);},do_search:function(domain,context,group_by){var self=this;var _super=this._super;var args=arguments;var ready=(this.editor.is_editing())?this.cancel_edition(true):$.when();return ready.then(function(){self._context_editable=!!context.set_editable;return _super.apply(self,args);});},do_add_record:function(){if(this.editable()){this.$('table:first').show();this.$('.oe_view_nocontent').remove();this.start_edition();}else{this._super.apply(this,arguments);}},load_list:function(data,grouped){var result=this._super.apply(this,arguments);this.editor.destroy();this.editor=new Editor(this);if(this.editable()){this.$el.addClass('o_list_editable');return $.when(result,this.editor.prependTo(this.$el).done(this.proxy('setup_events')));}else{this.$el.removeClass('o_list_editable');}
return result;},render_buttons:function(){var add_button=!this.$buttons;var result=this._super.apply(this,arguments);if(add_button&&(this.editable()||this.grouped)){var self=this;this.$buttons.off('click','.o_list_button_save').on('click','.o_list_button_save',this.proxy('save_edition')).off('click','.o_list_button_discard').on('click','.o_list_button_discard',function(e){e.preventDefault();self.cancel_edition();});}
return result;},do_button_action:function(name,id,callback){var self=this;this.save_edition().done(function(data){if(!id&&data.created){id=data.record.get('id');}
self.handle_button(name,id,callback);});},make_empty_record:function(id){var attrs={id:id};_(this.columns).chain().filter(function(x){return x.tag==='field';}).pluck('name').each(function(field){attrs[field]=false;});return new common.Record(attrs);},start_edition:function(record,options){var self=this;var item=false;if(record){item=record.attributes;this.dataset.select_id(record.get('id'));}else{record=this.make_empty_record(false);this.records.add(record,{at:(this.prepends_on_create())?0:null});}
return this.save_edition().then(function(){return $.when.apply($,self.editor.form.render_value_defs);}).then(function(){var $recordRow=self.groups.get_row_for(record);var cells=self.get_cells_for($recordRow);var fields={};self.fields_for_resize.splice(0,self.fields_for_resize.length);return self.with_event('edit',{record:record.attributes,cancel:false,},function(){return self.editor.edit(item,function(field_name,field){var cell=cells[field_name];if(!cell){return;}
field.$el.attr('data-fieldname',field_name);fields[field_name]=field;self.fields_for_resize.push({field:field,cell:cell});},options).then(function(){$recordRow.addClass('o_row_edition');self.resize_fields();var is_focusable=function(field){return field&&field.$el.is(':visible:not(.o_readonly)');};var focus_field=options&&options.focus_field?options.focus_field:undefined;if(!is_focusable(fields[focus_field])){focus_field=_.find(self.editor.form.fields_order,function(field){return is_focusable(fields[field]);});}
if(fields[focus_field]){fields[focus_field].$el.find('input, textarea').andSelf().filter('input, textarea').select();}
return record.attributes;});}).fail(function(){if(!record.get('id')){self.records.remove(record);}});},function(){return $.Deferred().resolve();});},get_cells_for:function($row){var cells={};$row.children('td').each(function(index,el){cells[el.getAttribute('data-field')]=el;});return cells;},resize_fields:function(){if(!this.editor.is_editing()){return;}
for(var i=0,len=this.fields_for_resize.length;i<len;i++){var item=this.fields_for_resize[i];this.resize_field(item.field,item.cell);}},resize_field:function(field,cell){var $cell=$(cell);field.set_dimensions($cell.outerHeight(),$cell.outerWidth());position_element(field.$el,'left top');position_element(field.$translate,'right top');if(field.get('effective_readonly')){field.$el.addClass('o_readonly');}
if(field.widget=="handle"){field.$el.addClass('o_row_handle');}
if(window.getComputedStyle(field.el.parentElement).webkitOverflowScrolling){field.el.style.zIndex=1;}
function position_element($el,pos){$el.addClass('o_temp_visible').css({top:0,left:0}).position({my:pos,at:pos,of:$cell,}).removeClass('o_temp_visible');}},save_edition:function(cancel_onfail){var self=this;return self.saving_mutex.exec(function(){if(!self.editor.is_editing()){return $.when();}
return self.with_event('save',{editor:self.editor,form:self.editor.form,cancel:false,},function(){return self.editor.save().then(function(attrs){var created=false;var record=self.records.get(attrs.id);if(!record){created=true;record=self.records.find(function(r){return!r.get('id');}).set('id',attrs.id);}
return self.cancel_edition(true).then(function(){return self.handle_onwrite(record);}).then(function(){return self.reload_record(record);}).then(function(){return{created:created,record:record};});},function(){if(cancel_onfail){return self.cancel_edition();}});});});},cancel_edition:function(force){var self=this;return this.with_event('cancel',{editor:this.editor,form:this.editor.form,cancel:false},function(){return this.editor.cancel(force).then(function(attrs){if(attrs.id){var record=self.records.get(attrs.id);if(!record){return;}
return self.reload_record(record,{do_not_evict:true});}
var to_delete=self.records.find(function(r){return!r.get('id');});if(to_delete){self.records.remove(to_delete);}});});},with_event:function(event_name,event,action){var self=this;event=event||{};this.trigger(event_name+':before',event);if(event.cancel){return $.Deferred().reject({message:_.str.sprintf("Event %s:before cancelled",event_name)});}
return $.when(action.call(this)).done(function(){self.trigger.apply(self,[event_name+':after'].concat(_.toArray(arguments)));});},edition_view:function(editor){var view=$.extend(true,{},this.fields_view);view.arch.tag='form';_.extend(view.arch.attrs,{'class':'o_list_editable_form',version:'7.0'});_(view.arch.children).chain().zip(_(this.columns).filter(function(c){return!(c instanceof ListView.MetaColumn);})).each(function(ar){var widget=ar[0],column=ar[1];var modifiers=_.extend({},column.modifiers);widget.attrs.nolabel=true;if(modifiers['tree_invisible']||widget.tag==='button'){modifiers.invisible=true;}
widget.attrs.modifiers=JSON.stringify(modifiers);});return view;},handle_onwrite:function(source_record){var self=this;var on_write_callback=self.fields_view.arch.attrs.on_write;if(!on_write_callback){return $.when();}
var context=new data.CompoundContext(self.dataset.get_context(),{'on_write_domain':self.dataset.domain}).eval();return this.dataset.call(on_write_callback,[source_record.get('id'),context]).then(function(ids){return $.when.apply(null,_(ids).map(_.bind(self.handle_onwrite_record,self,source_record)));});},handle_onwrite_record:function(source_record,id){var record=this.records.get(id);if(!record){var index=this.records.indexOf(source_record)+1;record=this.make_empty_record(id);this.records.add(record,{at:index});}
return this.reload_record(record);},prepends_on_create:function(){return(this.editable()==='top');},setup_events:function(){var self=this;_.each(this.editor.form.fields,function(field,field_name){field.on("change:effective_readonly",self,function(){var item=_(self.fields_for_resize).find(function(item){return item.field===field;});if(item){setTimeout(function(){self.resize_field(item.field,item.cell);},0);}});});this.editor.$el.on('keyup keypress keydown',function(e){if(!self.editor.is_editing()){return true;}
var key=_($.ui.keyCode).chain().map(function(v,k){return{name:k,code:v};}).find(function(o){return o.code===e.which;}).value();if(!key){return true;}
var method=e.type+'_'+key.name;if(!(method in self)){return true;}
return self[method](e);});},_next:function(next_record,options){next_record=next_record||'succ';var self=this;return this.save_edition().then(function(saveInfo){if(!saveInfo){return null;}
if(saveInfo.created){return self.start_edition();}
if(!options){options={};}
options.wraparound=!self.is_action_enabled('create');var record=self.records[next_record](saveInfo.record,options);if(record===undefined){return self.start_edition();}
return self.start_edition(record,options);});},keyup_ENTER:function(){return this._next();},keydown_ESCAPE:function(e){return false;},keyup_ESCAPE:function(e){return this.cancel_edition();},_text_selection_range:function(el){var selectionStart;try{selectionStart=el.selectionStart;}catch(e){return null;}
if(selectionStart!==undefined){return{start:selectionStart,end:el.selectionEnd};}else if(document.body.createTextRange){throw new Error("Implement text range handling for MSIE");}
return null;},_text_cursor:function(el){var selection=this._text_selection_range(el);if(!selection){return null;}
if(selection.start!==selection.end){return{position:null,collapsed:false};}
return{position:selection.start,collapsed:true};},_at_start:function(cursor,el){return cursor.collapsed&&(cursor.position===0);},_at_end:function(cursor,el){return cursor.collapsed&&(cursor.position===el.value.length);},_key_move_record:function(event,record_direction,is_valid_move){if(!this.editor.is_editing()||this.editor.is_creating()){return $.when();}
var cursor=this._text_cursor(event.target);if(cursor&&!is_valid_move(event.target,cursor)){return $.when();}
event.preventDefault();var source_field=$(event.target).closest('[data-fieldname]').attr('data-fieldname');return this._next(record_direction,{focus_field:source_field});},keyup_UP:function(e){var self=this;return this._key_move_record(e,'pred',function(el,cursor){return self._at_start(cursor,el)&&!$(el).is('select,.ui-autocomplete-input');});},keyup_DOWN:function(e){var self=this;return this._key_move_record(e,'succ',function(el,cursor){return self._at_end(cursor,el)&&!$(el).is('select,.ui-autocomplete-input');});},keydown_LEFT:function(e){var source_field=$(e.target).closest('[data-fieldname]').attr('data-fieldname');var cursor=this._text_cursor(e.target);if(cursor&&!this._at_start(cursor,e.target)){return $.when();}
var fields_order=this.editor.form.fields_order;var field_index=_(fields_order).indexOf(source_field);var fields=this.editor.form.fields;var field;do{if(--field_index<0){return $.when();}
field=fields[fields_order[field_index]];}while(!field.$el.is(':visible'));field.focus();return $.when();},keydown_RIGHT:function(e){var source_field=$(e.target).closest('[data-fieldname]').attr('data-fieldname');var cursor=this._text_cursor(e.target);if(cursor&&!this._at_end(cursor,e.target)){return $.when();}
var fields_order=this.editor.form.fields_order;var field_index=_(fields_order).indexOf(source_field);var fields=this.editor.form.fields;var field;do{if(++field_index>=fields_order.length){return $.when();}
field=fields[fields_order[field_index]];}while(!field.$el.is(':visible'));field.focus();return $.when();},keydown_TAB:function(e){var form=this.editor.form;var last_field=_(form.fields_order).chain().map(function(name){return form.fields[name];}).filter(function(field){return field.$el.is(':visible')&&!field.get('effective_readonly');}).last().value();if(last_field&&$(e.target).closest(last_field.el).length){e.preventDefault();return this._next();}
this.editor.form.__clicked_inside=true;return $.when();},});ListView.Groups.include({passthrough_events:ListView.Groups.prototype.passthrough_events+" edit saved",get_row_for:function(record){return _(this.children).chain().invoke('get_row_for',record).compact().first().value();}});ListView.List.include({row_clicked:function(event){if(!this.view.editable()||!this.view.is_action_enabled('edit')){return this._super.apply(this,arguments);}
var self=this;var args=arguments;var _super=self._super;var record_id=$(event.currentTarget).data('id');return this.view.start_edition(((record_id)?this.records.get(record_id):null),{focus_field:$(event.target).not(".o_readonly").data('field'),}).fail(function(){return _super.apply(self,args);});},get_row_for:function(record){var $row=this.$current.children('[data-id='+record.get('id')+']');return(($row.length)?$row:null);},});return Editor;});;

/* /web/static/src/js/views/pivot_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.PivotView',function(require){"use strict";var core=require('web.core');var crash_manager=require('web.crash_manager');var data_manager=require('web.data_manager');var formats=require('web.formats');var framework=require('web.framework');var Model=require('web.DataModel');var session=require('web.session');var Sidebar=require('web.Sidebar');var utils=require('web.utils');var View=require('web.View');var _lt=core._lt;var _t=core._t;var QWeb=core.qweb;var PivotView=View.extend({events:{'click .o_pivot_header_cell_opened':'on_open_header_click','click .o_pivot_header_cell_closed':'on_closed_header_click','click .o_pivot_field_menu a':'on_field_menu_selection','click td':'on_cell_click','click .o_pivot_measure_row':'on_measure_row_click',},display_name:_lt('Pivot'),icon:'fa-table',require_fields:true,template:'PivotView',init:function(){this._super.apply(this,arguments);this._model=new Model(this.model,{group_by_no_leaf:true});this.measures={};this.groupable_fields={};this.ready=false;this.data_loaded=$.Deferred();this.title=this.options.title||this.fields_view.arch.attrs.string;this.main_row={root:undefined,groupbys:[],};this.main_col={root:undefined,groupbys:[],};this.initial_col_groupby=[];this.initial_row_groupby=[];this.active_measures=[];this.headers={};this.cells={};this.has_data=false;this.$buttons=$();this.last_header_selected=null;this.sorted_column={};this.numbering={};this.widgets=[];this.enable_linking=!this.fields_view.arch.attrs.disable_linking;},willStart:function(){var self=this;var fields_def=data_manager.load_fields(this.dataset);var xlwt_def=session.rpc('/web/pivot/check_xlwt').then(function(result){self.xlwt_installed=result;});this.fields_view.arch.children.forEach(function(field){var name=field.attrs.name;if(field.attrs.interval){name+=':'+field.attrs.interval;}
switch(field.attrs.type){case'measure':self.widgets.push(field.attrs.widget||"");self.active_measures.push(name);break;case'col':self.initial_col_groupby.push(name);break;default:if('operator'in field.attrs){self.active_measures.push(name);break;}
case'row':self.initial_row_groupby.push(name);}});if((!this.active_measures.length)||this.fields_view.arch.attrs.display_quantity){this.active_measures.push('__count__');}
return $.when(fields_def,xlwt_def,this._super()).then(function(fields){self.prepare_fields(fields);_.each(self.active_measures,function(m){if(!(m in self.measures)){self.measures[m]=self.fields[m];}});});},start:function(){this.$el.toggleClass('o_enable_linking',this.enable_linking);var context={fields:_.chain(this.groupable_fields).pairs().sortBy(function(f){return f[1].string;}).value(),};this.$field_selection=this.$('.o_field_selection');this.$field_selection.html(QWeb.render('PivotView.FieldSelection',context));core.bus.on('click',this,function(){this.$field_selection.find('ul').first().hide();});return this._super();},render_buttons:function($node){if($node){var self=this;var context={measures:_.pairs(_.omit(this.measures,'__count__'))};this.$buttons=$(QWeb.render('PivotView.buttons',context));this.$buttons.click(this.on_button_click.bind(this));this.active_measures.forEach(function(measure){self.$buttons.find('li[data-field="'+measure+'"]').addClass('selected');});this.$buttons.find('button').tooltip();this.$buttons.appendTo($node);}},render_sidebar:function($node){if(this.xlwt_installed&&$node&&this.options.sidebar){this.sidebar=new Sidebar(this,{editable:this.is_action_enabled('edit')});this.sidebar.appendTo($node);}},prepare_fields:function(fields){var self=this,groupable_types=['many2one','char','boolean','selection','date','datetime'];this.fields=fields;_.each(fields,function(field,name){if((name!=='id')&&(field.store===true)){if(field.type==='integer'||field.type==='float'||field.type==='monetary'){self.measures[name]=field;}
if(_.contains(groupable_types,field.type)){self.groupable_fields[name]=field;}}});this.measures.__count__={string:_t("Count"),type:"integer"};},do_search:function(domain,context,group_by){if(!this.ready){this.initial_row_groupby=context.pivot_row_groupby||this.initial_row_groupby;this.initial_col_groupby=context.pivot_col_groupby||this.initial_col_groupby;}
this.main_row.groupbys=group_by.length?group_by:(context.pivot_row_groupby||this.initial_row_groupby.slice(0));this.main_col.groupbys=context.pivot_column_groupby||this.initial_col_groupby.slice(0);this.active_measures=context.pivot_measures||this.active_measures;this.domain=domain;this.context=context;if(!this.ready){this.data_loaded=this.load_data(true);this.ready=true;return;}
this.data_loaded=this.load_data(false);return this.do_show();},do_show:function(){var self=this;var _super=this._super.bind(this);this.do_push_state({});return this.data_loaded.done(function(){self.display_table();self.$buttons.find('.o_pivot_measures_list li').removeClass('selected');self.active_measures.forEach(function(measure){self.$buttons.find('li[data-field="'+measure+'"]').addClass('selected');});_super();});},get_context:function(){return!this.ready?{}:{pivot_measures:this.active_measures,pivot_column_groupby:this.main_col.groupbys,pivot_row_groupby:this.main_row.groupbys,};},on_button_click:function(event){var $target=$(event.target);if($target.hasClass('o_pivot_flip_button')){return this.flip();}
if($target.hasClass('o_pivot_expand_button')){return this.expand_all();}
if($target.parents('.o_pivot_measures_list').length){var parent=$target.parent();var field=parent.data('field');parent.toggleClass('selected');event.preventDefault();event.stopPropagation();return this.toggle_measure(field);}
if($target.hasClass('o_pivot_download')){return this.download_table();}},on_open_header_click:function(event){var id=$(event.target).data('id'),header=this.headers[id];header.expanded=false;header.children=[];var new_groupby_length=this.get_header_depth(header.root)-1;header.root.groupbys.splice(new_groupby_length);this.display_table();},on_closed_header_click:function(event){var id=$(event.target).data('id'),header=this.headers[id],groupbys=header.root.groupbys;if(header.path.length-1<groupbys.length){this.expand_header(header,groupbys[header.path.length-1]).then(this.proxy('display_table'));}else{this.last_header_selected=id;var $test=$(event.target);var $menu=this.$field_selection.find('ul').first();var position=$test.position();$menu.css({top:position.top+$test.height(),left:position.left+event.offsetX,});$menu.show();event.stopPropagation();}},on_cell_click:function(event){var $target=$(event.target);if($target.hasClass('o_pivot_header_cell_closed')||$target.hasClass('o_pivot_header_cell_opened')||$target.hasClass('o_empty')||!this.enable_linking){return;}
var row_id=$target.data('id'),col_id=$target.data('col_id'),row_domain=this.headers[row_id].domain,col_domain=this.headers[col_id].domain,context=_.omit(_.clone(this.context),'group_by');var views=[_find_view_info.call(this,"list"),_find_view_info.call(this,"form"),];return this.do_action({type:'ir.actions.act_window',name:this.title,res_model:this.model,views:views,view_type:"list",view_mode:"list",target:'current',context:context,domain:this.domain.concat(row_domain,col_domain),});function _find_view_info(view_type){return _.find(this.options.action.views,function(view){return view[1]===view_type;})||[false,view_type];}},on_measure_row_click:function(event){var $target=$(event.target),col_id=$target.data('id'),measure=$target.data('measure');this.sort_rows(col_id,measure,$target.hasClass('o_pivot_measure_row_sorted_asc'));this.display_table();},sort_rows:function(col_id,measure,descending){var self=this;traverse_tree(this.main_row.root,function(header){header.children.sort(compare);});this.sorted_column={id:col_id,measure:measure,order:descending?'desc':'asc',};function compare(row1,row2){var values1=self.get_value(row1.id,col_id),values2=self.get_value(row2.id,col_id),value1=values1?values1[measure]:0,value2=values2?values2[measure]:0;return descending?value1-value2:value2-value1;}},on_field_menu_selection:function(event){event.preventDefault();var field=$(event.target).parent().data('field'),interval=$(event.target).data('interval'),header=this.headers[this.last_header_selected];if(interval)field=field+':'+interval;this.expand_header(header,field).then(function(){header.root.groupbys.push(field);}).then(this.proxy('display_table'));},expand_header:function(header,field){var self=this;var other_root=header.root.other_root,other_groupbys=header.root.other_root.groupbys,fields=[].concat(field,other_groupbys,this.active_measures),groupbys=[];for(var i=0;i<=other_groupbys.length;i++){groupbys.push([field].concat(other_groupbys.slice(0,i)));}
return $.when.apply(null,groupbys.map(function(groupby){return self._model.query(fields).filter(header.domain.length?header.domain:self.domain).context(self.context).lazy(false).group_by(groupby);})).then(function(){var data=Array.prototype.slice.call(arguments),datapt,attrs,j,k,l,row,col,cell_value,field_name;for(i=0;i<data.length;i++){for(j=0;j<data[i].length;j++){datapt=data[i][j];attrs=datapt.attributes;if(i===0)attrs.value=[attrs.value];for(k=0;k<attrs.value.length;k++){if(k<1)field_name=field;else field_name=other_groupbys[k-1];attrs.value[k]=self.sanitize_value(attrs.value[k],field_name);}
if(i===0){row=self.make_header(datapt,header.root,0,1,header);}else{row=self.get_header(datapt,header.root,0,1,header);}
col=self.get_header(datapt,other_root,1,i+1);if(!col)continue;for(cell_value={},l=0;l<self.active_measures.length;l++){cell_value[self.active_measures[l]]=attrs.aggregates[self.active_measures[l]];}
cell_value.__count__=attrs.length;if(!self.cells[row.id])self.cells[row.id]=[];self.cells[row.id][col.id]=cell_value;}}});},expand_all:function(){this.load_data(false).then(this.proxy('display_table'));},load_data:function(update){var should_update=(update&&this.main_row.root&&this.main_col.root);var self=this,i,j,groupbys=[],row_gbs=this.main_row.groupbys,col_gbs=this.main_col.groupbys,fields=[].concat(row_gbs,col_gbs,this.active_measures);for(i=0;i<row_gbs.length+1;i++){for(j=0;j<col_gbs.length+1;j++){groupbys.push(row_gbs.slice(0,i).concat(col_gbs.slice(0,j)));}}
return $.when.apply(null,groupbys.map(function(groupby){return self._model.query(fields).filter(self.domain).context(self.context).lazy(false).group_by(groupby);})).then(function(){var data=Array.prototype.slice.call(arguments);self.prepare_data(data,should_update);});},prepare_data:function(data,should_update){var i,j,k,l,m,index=0,row_gbs=this.main_row.groupbys,col_gbs=this.main_col.groupbys,main_row_header,main_col_header,row,col,attrs,datapt,cell_value,field;for(i=0;i<row_gbs.length+1;i++){for(j=0;j<col_gbs.length+1;j++){for(k=0;k<data[index].length;k++){datapt=data[index][k];attrs=datapt.attributes;if(i+j===1){attrs.value=[attrs.value];}
for(l=0;l<attrs.value.length;l++){if(l<i)field=row_gbs[l];else field=col_gbs[l-i];attrs.value[l]=this.sanitize_value(attrs.value[l],field);}
if(j===0){row=this.make_header(datapt,main_row_header,0,i);}else{row=this.get_header(datapt,main_row_header,0,i);}
if(i===0){col=this.make_header(datapt,main_col_header,i,i+j);}else{col=this.get_header(datapt,main_col_header,i,i+j);}
if(i+j===0){this.has_data=attrs.length>0;main_row_header=row;main_col_header=col;}
if(!this.cells[row.id])this.cells[row.id]=[];for(cell_value={},m=0;m<this.active_measures.length;m++){cell_value[this.active_measures[m]]=attrs.aggregates[this.active_measures[m]];}
cell_value.__count__=attrs.length;this.cells[row.id][col.id]=cell_value;}
index++;}}
if(should_update){this.update_tree(this.main_row.root,main_row_header);var new_groupby_length=this.get_header_depth(main_row_header)-1;main_row_header.groupbys=this.main_row.root.groupbys.slice(0,new_groupby_length);this.update_tree(this.main_col.root,main_col_header);new_groupby_length=this.get_header_depth(main_col_header)-1;main_col_header.groupbys=this.main_col.root.groupbys.slice(0,new_groupby_length);}else{main_row_header.groupbys=this.main_row.groupbys;main_col_header.groupbys=this.main_col.groupbys;}
main_row_header.other_root=main_col_header;main_col_header.other_root=main_row_header;this.main_row.root=main_row_header;this.main_col.root=main_col_header;},update_tree:function(old_tree,new_tree){if(!old_tree.expanded){new_tree.expanded=false;new_tree.children=[];return;}
var tree,j,old_title,new_title;for(var i=0;i<new_tree.children.length;i++){tree=undefined;new_title=new_tree.children[i].path[new_tree.children[i].path.length-1];for(j=0;j<old_tree.children.length;j++){old_title=old_tree.children[j].path[old_tree.children[j].path.length-1];if(old_title===new_title){tree=old_tree.children[j];break;}}
if(tree)this.update_tree(tree,new_tree.children[i]);else{new_tree.children[i].expanded=false;new_tree.children[i].children=[];}}},sanitize_value:function(value,field){if(value===false)return _t("Undefined");if(value instanceof Array)return this.get_numbered_value(value,field);if(field&&this.fields[field]&&(this.fields[field].type==='selection')){var selected=_.where(this.fields[field].selection,{0:value})[0];return selected?selected[1]:value;}
return value;},get_numbered_value:function(value,field){var id=value[0];var name=value[1]
this.numbering[field]=this.numbering[field]||{};this.numbering[field][name]=this.numbering[field][name]||{};var numbers=this.numbering[field][name];numbers[id]=numbers[id]||_.size(numbers)+1;return name+(numbers[id]>1?"  ("+numbers[id]+")":"");},make_header:function(data_pt,root,i,j,parent_header){var total=_t("Total");var attrs=data_pt.attributes,value=attrs.value,title=value.length?value[value.length-1]:total;var path,parent;if(parent_header){path=parent_header.path.concat(title);parent=parent_header;}else{path=[total].concat(value.slice(i,j-1));parent=value.length?find_path_in_tree(root,path):null;}
var header={id:utils.generate_id(),expanded:false,domain:data_pt.model._domain,children:[],path:value.length?parent.path.concat(title):[title]};this.headers[header.id]=header;header.root=root||header;if(parent){parent.children.push(header);parent.expanded=true;}
return header;},get_header:function(data_pt,root,i,j,parent){var path;var total=_t("Total");if(parent){path=parent.path.concat(data_pt.attributes.value.slice(i,j));}else{path=[total].concat(data_pt.attributes.value.slice(i,j));}
return find_path_in_tree(root,path);},_clean_table:function(){return this.$el.find('table').remove().end().find('.oe_view_nocontent').remove().end();},display_table:function(){if(!this.active_measures.length||!this.has_data){return this._clean_table().append(QWeb.render('PivotView.nodata'));}
var $fragment=$(document.createDocumentFragment()),$table=$('<table>').addClass('table table-hover table-condensed table-bordered').appendTo($fragment),$thead=$('<thead>').appendTo($table),$tbody=$('<tbody>').appendTo($table),headers=this.compute_headers(),rows=this.compute_rows(),nbr_measures=this.active_measures.length,nbr_cols=(this.main_col.width===1)?nbr_measures:(this.main_col.width+1)*nbr_measures;for(var i=0;i<nbr_cols+1;i++){$table.prepend($('<col>'));}
this.draw_headers($thead,headers);this.draw_rows($tbody,rows);$table.on('hover','td',function(){$table.find('col:eq('+$(this).index()+')').toggleClass('hover');});this._clean_table().append($fragment);this.$('.o_pivot_header_cell_opened,.o_pivot_header_cell_closed').tooltip();},draw_headers:function($thead,headers){var self=this,i,j,cell,$row,$cell;var groupby_labels=_.map(this.main_col.groupbys,function(gb){return self.fields[gb.split(':')[0]].string;});for(i=0;i<headers.length;i++){$row=$('<tr>');for(j=0;j<headers[i].length;j++){cell=headers[i][j];$cell=$('<th>').text(cell.title).attr('rowspan',cell.height).attr('colspan',cell.width);if(i>0){$cell.attr('title',groupby_labels[i-1]);}
if(cell.expanded!==undefined){$cell.addClass(cell.expanded?'o_pivot_header_cell_opened':'o_pivot_header_cell_closed');$cell.data('id',cell.id);}
if(cell.measure){$cell.addClass('o_pivot_measure_row text-muted').text(this.measures[cell.measure].string);$cell.data('id',cell.id).data('measure',cell.measure);if(cell.id===this.sorted_column.id&&cell.measure===this.sorted_column.measure){$cell.addClass('o_pivot_measure_row_sorted_'+this.sorted_column.order);}}
$row.append($cell);$cell.toggleClass('hidden-xs',(cell.expanded!==undefined)||(cell.measure!==undefined&&j<headers[i].length-this.active_measures.length));if(cell.height>1){$cell.css('padding',0);}}
$thead.append($row);}},draw_rows:function($tbody,rows){var self=this,i,j,value,$row,$cell,$header,nbr_measures=this.active_measures.length,length=rows[0].values.length,display_total=this.main_col.width>1;var groupby_labels=_.map(this.main_row.groupbys,function(gb){return self.fields[gb.split(':')[0]].string;});var measure_types=this.active_measures.map(function(name){return self.measures[name].type;});var widgets=this.widgets;for(i=0;i<rows.length;i++){$row=$('<tr>');$header=$('<td>').text(rows[i].title).data('id',rows[i].id).css('padding-left',(5+rows[i].indent*30)+'px').addClass(rows[i].expanded?'o_pivot_header_cell_opened':'o_pivot_header_cell_closed');if(rows[i].indent>0)$header.attr('title',groupby_labels[rows[i].indent-1]);$header.appendTo($row);for(j=0;j<length;j++){value=formats.format_value(rows[i].values[j],{type:measure_types[j%nbr_measures],widget:widgets[j%nbr_measures]});$cell=$('<td>').data('id',rows[i].id).data('col_id',rows[i].col_ids[Math.floor(j/nbr_measures)]).toggleClass('o_empty',!value).text(value).addClass('o_pivot_cell_value text-right');if(((j>=length-this.active_measures.length)&&display_total)||i===0){$cell.css('font-weight','bold');}
$row.append($cell);$cell.toggleClass('hidden-xs',j<length-this.active_measures.length);}
$tbody.append($row);}},compute_headers:function(){var self=this,main_col_dims=this.get_header_width_depth(this.main_col.root),depth=main_col_dims.depth,width=main_col_dims.width,nbr_measures=this.active_measures.length,result=[[{width:1,height:depth+1}]],col_ids=[];this.main_col.width=width;traverse_tree(this.main_col.root,function(header){var index=header.path.length-1,cell={width:self.get_header_width(header)*nbr_measures,height:header.expanded?1:depth-index,title:header.path[header.path.length-1],id:header.id,expanded:header.expanded,};if(!header.expanded)col_ids.push(header.id);if(result[index])result[index].push(cell);else result[index]=[cell];});col_ids.push(this.main_col.root.id);this.main_col.width=width;if(width>1){var total_cell={width:nbr_measures,height:depth,title:""};if(nbr_measures===1){total_cell.total=true;}
result[0].push(total_cell);}
var nbr_cols=width===1?nbr_measures:(width+1)*nbr_measures;for(var i=0,measure_row=[],measure;i<nbr_cols;i++){measure=this.active_measures[i%nbr_measures];measure_row.push({measure:measure,is_bold:(width>1)&&(i>=nbr_measures*width),id:col_ids[Math.floor(i/nbr_measures)],});}
result.push(measure_row);return result;},get_header_width:function(header){var self=this;if(!header.children.length)return 1;if(!header.expanded)return 1;return header.children.reduce(function(s,c){return s+self.get_header_width(c);},0);},get_header_width_depth:function(header){var depth=1,width=0;traverse_tree(header,function(hdr){depth=Math.max(depth,hdr.path.length);if(!hdr.expanded)width++;});return{width:width,depth:depth};},get_header_depth:function(header){var depth=1;traverse_tree(header,function(hdr){depth=Math.max(depth,hdr.path.length);});return depth;},compute_rows:function(){var self=this,aggregates,i,result=[];traverse_tree(this.main_row.root,function(header){var values=[],col_ids=[];result.push({id:header.id,col_ids:col_ids,indent:header.path.length-1,title:header.path[header.path.length-1],expanded:header.expanded,values:values,});traverse_tree(self.main_col.root,add_cells,header.id,values,col_ids);if(self.main_col.width>1){aggregates=self.get_value(header.id,self.main_col.root.id);for(i=0;i<self.active_measures.length;i++){values.push(aggregates&&aggregates[self.active_measures[i]]);}
col_ids.push(self.main_col.root.id);}});return result;function add_cells(col_hdr,row_id,values,col_ids){if(col_hdr.expanded)return;col_ids.push(col_hdr.id);aggregates=self.get_value(row_id,col_hdr.id);for(i=0;i<self.active_measures.length;i++){values.push(aggregates&&aggregates[self.active_measures[i]]);}}},get_value:function(id1,id2){if((id1 in this.cells)&&(id2 in this.cells[id1])){return this.cells[id1][id2];}
if(id2 in this.cells)return this.cells[id2][id1];},flip:function(){var temp=this.main_col;this.main_col=this.main_row;this.main_row=temp;this.display_table();},toggle_measure:function(field){if(_.contains(this.active_measures,field)){this.active_measures=_.without(this.active_measures,field);this.display_table();}else{this.active_measures.push(field);this.load_data().then(this.display_table.bind(this));}},download_table:function(){framework.blockUI();var nbr_measures=this.active_measures.length,headers=this.compute_headers(),measure_row=nbr_measures>1?_.last(headers):[],rows=this.compute_rows(),i,j,value;headers[0].splice(0,1);for(i=0;i<measure_row.length;i++){measure_row[i].measure=this.measures[measure_row[i].measure].string;}
for(i=0,j,value;i<rows.length;i++){for(j=0;j<rows[i].values.length;j++){value=rows[i].values[j];rows[i].values[j]={is_bold:(i===0)||((this.main_col.width>1)&&(j>=rows[i].values.length-nbr_measures)),value:(value===undefined)?"":value,};}}
var table={headers:_.initial(headers),measure_row:measure_row,rows:rows,nbr_measures:nbr_measures,title:this.title,};if(table.measure_row.length+1>256){c.show_message(_t("For Excel compatibility, data cannot be exported if there are more than 256 columns.\n\nTip: try to flip axis, filter further or reduce the number of measures."));return;}
session.get_file({url:'/web/pivot/export_xls',data:{data:JSON.stringify(table)},complete:framework.unblockUI,error:crash_manager.rpc_error.bind(crash_manager)});},destroy:function(){if(this.$buttons){this.$buttons.find('button').off();}
return this._super.apply(this,arguments);},});function traverse_tree(root,f,arg1,arg2,arg3){f(root,arg1,arg2,arg3);if(!root.expanded)return;for(var i=0;i<root.children.length;i++){traverse_tree(root.children[i],f,arg1,arg2,arg3);}}
function find_path_in_tree(root,path){var i,l=root.path.length;if(l===path.length){return(root.path[l-1]===path[l-1])?root:null;}
for(i=0;i<root.children.length;i++){if(root.children[i].path[l]===path[l]){return find_path_in_tree(root.children[i],path);}}
return null;}
core.view_registry.add('pivot',PivotView);return PivotView;});;

/* /web/static/src/js/views/graph_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.GraphView',function(require){"use strict";var core=require('web.core');var data_manager=require('web.data_manager');var GraphWidget=require('web.GraphWidget');var View=require('web.View');var _lt=core._lt;var _t=core._t;var QWeb=core.qweb;var GraphView=View.extend({className:'o_graph',display_name:_lt('Graph'),icon:'fa-bar-chart',require_fields:true,init:function(){this._super.apply(this,arguments);this.measures=[];this.active_measure='__count__';this.initial_groupbys=[];this.widget=undefined;},willStart:function(){var self=this;var fields_def=data_manager.load_fields(this.dataset).then(this.prepare_fields.bind(this));this.fields_view.arch.children.forEach(function(field){var name=field.attrs.name;if(field.attrs.interval){name+=':'+field.attrs.interval;}
if(field.attrs.type==='measure'){self.active_measure=name;}else{self.initial_groupbys.push(name);}});return $.when(this._super(),fields_def);},render_buttons:function($node){if($node){var context={measures:_.pairs(_.omit(this.measures,'__count__'))};this.$buttons=$(QWeb.render('GraphView.buttons',context));this.$measure_list=this.$buttons.find('.o_graph_measures_list');this.update_measure();this.$buttons.find('button').tooltip();this.$buttons.click(this.on_button_click.bind(this));this.$buttons.find('.o_graph_button[data-mode="'+this.widget.mode+'"]').addClass('active');this.$buttons.appendTo($node);}},update_measure:function(){var self=this;this.$measure_list.find('li').each(function(index,li){$(li).toggleClass('selected',$(li).data('field')===self.active_measure);});},do_show:function(){this.do_push_state({});return this._super();},prepare_fields:function(fields){var self=this;this.fields=fields;_.each(fields,function(field,name){if((name!=='id')&&(field.store===true)){if(field.type==='integer'||field.type==='float'||field.type==='monetary'){self.measures[name]=field;}}});this.measures.__count__={string:_t("Count"),type:"integer"};},do_search:function(domain,context,group_by){if(!this.widget){this.initial_groupbys=context.graph_groupbys||(group_by.length?group_by:this.initial_groupbys);this.widget=new GraphWidget(this,this.model,{measure:context.graph_measure||this.active_measure,mode:context.graph_mode||this.active_mode,domain:domain,groupbys:this.initial_groupbys,context:context,fields:this.fields,stacked:this.fields_view.arch.attrs.stacked!=="False"});this.widget.appendTo(this.$el);}else{var groupbys=group_by.length?group_by:this.initial_groupbys.slice(0);this.widget.update_data(domain,groupbys);}},get_context:function(){return!this.widget?{}:{graph_mode:this.widget.mode,graph_measure:this.widget.measure,graph_groupbys:this.widget.groupbys};},on_button_click:function(event){var $target=$(event.target);if($target.hasClass('o_graph_button')){this.widget.set_mode($target.data('mode'));this.$buttons.find('.o_graph_button.active').removeClass('active');$target.addClass('active');}
else if($target.parents('.o_graph_measures_list').length){var parent=$target.parent();var field=parent.data('field');this.active_measure=field;event.preventDefault();event.stopPropagation();this.update_measure();this.widget.set_measure(this.active_measure);}},destroy:function(){if(this.$buttons){this.$buttons.find('button').off();}
return this._super.apply(this,arguments);},});core.view_registry.add('graph',GraphView);return GraphView;});;

/* /web/static/src/js/views/graph_widget.js defined in bundle 'web.assets_backend' */
odoo.define('web.GraphWidget',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Model=require('web.DataModel');var formats=require('web.formats');var Widget=require('web.Widget');var _t=core._t;var QWeb=core.qweb;var MAX_LEGEND_LENGTH=25*(1+config.device.size_class);return Widget.extend({className:"o_graph_svg_container",init:function(parent,model,options){this._super(parent);this.context=options.context;this.fields=options.fields;this.fields.__count__={string:_t("Count"),type:"integer"};this.model=new Model(model,{group_by_no_leaf:true});this.domain=options.domain||[];this.groupbys=options.groupbys||[];this.mode=options.mode||"bar";this.measure=options.measure||"__count__";this.stacked=options.stacked;},start:function(){return this.load_data().then(this.proxy('display_graph'));},update_data:function(domain,groupbys){this.domain=domain;this.groupbys=groupbys;return this.load_data().then(this.proxy('display_graph'));},set_mode:function(mode){this.mode=mode;this.display_graph();},set_measure:function(measure){this.measure=measure;return this.load_data().then(this.proxy('display_graph'));},load_data:function(){var fields=this.groupbys.slice(0);if(this.measure!=='__count__'.slice(0))
fields=fields.concat(this.measure);return this.model.query(fields).filter(this.domain).context(this.context).lazy(false).group_by(this.groupbys.slice(0,2)).then(this.proxy('prepare_data'));},prepare_data:function(){var raw_data=arguments[0],is_count=this.measure==='__count__';var data_pt,j,values,value;this.data=[];for(var i=0;i<raw_data.length;i++){data_pt=raw_data[i].attributes;values=[];if(this.groupbys.length===1)data_pt.value=[data_pt.value];for(j=0;j<data_pt.value.length;j++){values[j]=this.sanitize_value(data_pt.value[j],data_pt.grouped_on[j]);}
value=is_count?data_pt.length:data_pt.aggregates[this.measure];this.data.push({labels:values,value:value});}},sanitize_value:function(value,field){if(value===false)return _t("Undefined");if(value instanceof Array)return value[1];if(field&&this.fields[field]&&(this.fields[field].type==='selection')){var selected=_.where(this.fields[field].selection,{0:value})[0];return selected?selected[1]:value;}
return value;},display_graph:function(){if(this.to_remove){nv.utils.offWindowResize(this.to_remove);}
this.$el.empty();if(!this.data.length){this.$el.append(QWeb.render('GraphView.error',{title:_t("No data to display"),description:_t("No data available for this chart. "+"Try to add some records, or make sure that "+"there is no active filter in the search bar."),}));}else{var chart=this['display_'+this.mode]();if(chart){chart.tooltip.chartContainer(this.$el[0]);}}},display_bar:function(){var data,values,measure=this.fields[this.measure].string,self=this;if(this.groupbys.length===0){data=[{values:[{x:measure,y:this.data[0].value}],key:measure}];}
if(this.groupbys.length===1){values=this.data.map(function(datapt){return{x:datapt.labels,y:datapt.value};});data=[{values:values,key:measure,}];}
if(this.groupbys.length>1){var xlabels=[],series=[],label,serie,value;values={};for(var i=0;i<this.data.length;i++){label=this.data[i].labels[0];serie=this.data[i].labels[1];value=this.data[i].value;if((!xlabels.length)||(xlabels[xlabels.length-1]!==label)){xlabels.push(label);}
series.push(this.data[i].labels[1]);if(!(serie in values)){values[serie]={};}
values[serie][label]=this.data[i].value;}
series=_.uniq(series);data=[];var current_serie,j;for(i=0;i<series.length;i++){current_serie={values:[],key:series[i]};for(j=0;j<xlabels.length;j++){current_serie.values.push({x:xlabels[j],y:values[series[i]][xlabels[j]]||0,});}
data.push(current_serie);}}
var svg=d3.select(this.$el[0]).append('svg');svg.datum(data);svg.transition().duration(0);var chart=nv.models.multiBarChart();chart.options({margin:{left:120,bottom:60},delay:250,transition:10,showLegend:_.size(data)<=MAX_LEGEND_LENGTH,showXAxis:true,showYAxis:true,rightAlignYAxis:false,stacked:this.stacked,reduceXTicks:false,rotateLabels:-20,showControls:(this.groupbys.length>1)});chart.yAxis.tickFormat(function(d){return formats.format_value(d,{type:'float',digits:self.fields[self.measure]&&self.fields[self.measure].digits||[69,2],});});chart(svg);this.to_remove=chart.update;nv.utils.onWindowResize(chart.update);return chart;},display_pie:function(){var data=[],all_negative=true,some_negative=false,all_zero=true;this.data.forEach(function(datapt){all_negative=all_negative&&(datapt.value<0);some_negative=some_negative||(datapt.value<0);all_zero=all_zero&&(datapt.value===0);});if(some_negative&&!all_negative){this.$el.append(QWeb.render('GraphView.error',{title:_t("Invalid data"),description:_t("Pie chart cannot mix positive and negative numbers. "+"Try to change your domain to only display positive results"),}));return;}
if(all_zero){this.$el.append(QWeb.render('GraphView.error',{title:_t("Invalid data"),description:_t("Pie chart cannot display all zero numbers.. "+"Try to change your domain to display positive results"),}));return;}
if(this.groupbys.length){data=this.data.map(function(datapt){return{x:datapt.labels.join("/"),y:datapt.value};});}
var svg=d3.select(this.$el[0]).append('svg');svg.datum(data);svg.transition().duration(100);var legend_right=config.device.size_class>config.device.SIZES.XS;var chart=nv.models.pieChart();chart.options({delay:250,showLegend:legend_right||_.size(data)<=MAX_LEGEND_LENGTH,legendPosition:legend_right?'right':'top',transition:100,color:d3.scale.category10().range(),});chart(svg);this.to_remove=chart.update;nv.utils.onWindowResize(chart.update);return chart;},display_line:function(){if(this.data.length<2){this.$el.append(QWeb.render('GraphView.error',{title:_t("Not enough data points"),description:"You need at least two data points to display a line chart."}));return;}
var self=this,data=[],tickValues,tickFormat,measure=this.fields[this.measure].string;if(this.groupbys.length===1){var values=this.data.map(function(datapt,index){return{x:index,y:datapt.value};});data=[{values:values,key:measure,}];tickValues=this.data.map(function(d,i){return i;});tickFormat=function(d){return self.data[d].labels;};}
if(this.groupbys.length>1){data=[];var data_dict={},tick=0,tickLabels=[],serie,tickLabel,identity=function(p){return p;};tickValues=[];for(var i=0;i<this.data.length;i++){if(this.data[i].labels[0]!==tickLabel){tickLabel=this.data[i].labels[0];tickValues.push(tick);tickLabels.push(tickLabel);tick++;}
serie=this.data[i].labels[1];if(!data_dict[serie]){data_dict[serie]={values:[],key:serie,};}
data_dict[serie].values.push({x:tick,y:this.data[i].value,});data=_.map(data_dict,identity);}
tickFormat=function(d){return tickLabels[d];};}
var svg=d3.select(this.$el[0]).append('svg');svg.datum(data);svg.transition().duration(0);var chart=nv.models.lineChart();chart.options({margin:{left:120,bottom:60},useInteractiveGuideline:true,showLegend:_.size(data)<=MAX_LEGEND_LENGTH,showXAxis:true,showYAxis:true,});chart.xAxis.tickValues(tickValues).tickFormat(tickFormat);chart.yAxis.tickFormat(function(d){return formats.format_value(d,{type:'float',digits:self.fields[self.measure]&&self.fields[self.measure].digits||[69,2],});});chart(svg);this.to_remove=chart.update;nv.utils.onWindowResize(chart.update);return chart;},destroy:function(){nv.utils.offWindowResize(this.to_remove);return this._super();}});});;

/* /web/static/src/js/views/search_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.SearchView',function(require){"use strict";var AutoComplete=require('web.AutoComplete');var config=require('web.config');var core=require('web.core');var data_manager=require('web.data_manager');var FavoriteMenu=require('web.FavoriteMenu');var FilterMenu=require('web.FilterMenu');var GroupByMenu=require('web.GroupByMenu');var pyeval=require('web.pyeval');var search_inputs=require('web.search_inputs');var View=require('web.View');var Widget=require('web.Widget');var local_storage=require('web.local_storage');var _t=core._t;var Backbone=window.Backbone;var FacetValue=Backbone.Model.extend({});var FacetValues=Backbone.Collection.extend({model:FacetValue});var Facet=Backbone.Model.extend({initialize:function(attrs){var values=attrs.values;delete attrs.values;Backbone.Model.prototype.initialize.apply(this,arguments);this.values=new FacetValues(values||[]);this.values.on('add remove change reset',function(_,options){this.trigger('change',this,options);},this);},get:function(key){if(key!=='values'){return Backbone.Model.prototype.get.call(this,key);}
return this.values.toJSON();},set:function(key,value){if(key!=='values'){return Backbone.Model.prototype.set.call(this,key,value);}
this.values.reset(value);},toJSON:function(){var out={};var attrs=this.attributes;for(var att in attrs){if(!attrs.hasOwnProperty(att)||att==='field'){continue;}
out[att]=attrs[att];}
out.values=this.values.toJSON();return out;}});var SearchQuery=Backbone.Collection.extend({model:Facet,initialize:function(){Backbone.Collection.prototype.initialize.apply(this,arguments);this.on('change',function(facet){if(!facet.values.isEmpty()){return;}
this.remove(facet,{silent:true});},this);},add:function(values,options){options=options||{};if(!values){values=[];}else if(!(values instanceof Array)){values=[values];}
_(values).each(function(value){var model=this._prepareModel(value,options);var previous=this.detect(function(facet){return facet.get('category')===model.get('category')&&facet.get('field')===model.get('field');});if(previous){previous.values.add(model.get('values'),_.omit(options,'at','merge'));return;}
Backbone.Collection.prototype.add.call(this,model,options);},this);return this;},toggle:function(value,options){options=options||{};var facet=this.detect(function(facet){return facet.get('category')===value.category&&facet.get('field')===value.field;});if(!facet){return this.add(value,options);}
var changed=false;_(value.values).each(function(val){var already_value=facet.values.detect(function(v){return v.get('value')===val.value&&v.get('label')===val.label;});if(already_value){facet.values.remove(already_value,{silent:true});}else{facet.values.add(val,{silent:true});}
changed=true;});facet.trigger('change',facet);return this;}});var InputView=Widget.extend({template:'SearchView.InputView',events:{focus:function(){this.trigger('focused',this);},blur:function(){this.$el.val('');this.trigger('blurred',this);},keydown:'onKeydown',},onKeydown:function(e){switch(e.which){case $.ui.keyCode.BACKSPACE:if(this.$el.val()===''){var preceding=this.getParent().siblingSubview(this,-1);if(preceding&&(preceding instanceof FacetView)){preceding.model.destroy();}}
break;case $.ui.keyCode.LEFT:if(this.el.selectionStart>0){e.stopPropagation();}
break;case $.ui.keyCode.RIGHT:if(this.el.selectionStart<this.$el.val().length){e.stopPropagation();}
break;}}});var FacetView=Widget.extend({template:'SearchView.FacetView',events:{'focus':function(){this.trigger('focused',this);},'blur':function(){this.trigger('blurred',this);},'click':function(e){if($(e.target).hasClass('o_facet_remove')){this.model.destroy();return false;}
this.$el.focus();e.stopPropagation();},'keydown':function(e){var keys=$.ui.keyCode;switch(e.which){case keys.BACKSPACE:case keys.DELETE:this.model.destroy();return false;}}},init:function(parent,model){this._super(parent);this.model=model;this.model.on('change',this.model_changed,this);},destroy:function(){this.model.off('change',this.model_changed,this);this._super();},start:function(){var self=this;var $e=this.$('.o_facet_values').last();return $.when(this._super()).then(function(){return $.when.apply(null,self.model.values.map(function(value,index){if(index>0){$('<span/>',{html:self.model.get('separator')||_t(" or ")}).addClass('o_facet_values_sep').appendTo($e);}
return new FacetValueView(self,value).appendTo($e);}));});},model_changed:function(){this.$el.text(this.$el.text()+'*');}});var FacetValueView=Widget.extend({template:'SearchView.FacetView.Value',init:function(parent,model){this._super(parent);this.model=model;this.model.on('change',this.model_changed,this);},destroy:function(){this.model.off('change',this.model_changed,this);this._super();},model_changed:function(){this.$el.text(this.$el.text()+'*');}});var SearchView=View.extend({events:{'click .o_searchview_more':function(e){$(e.target).toggleClass('fa-search-plus fa-search-minus');var visible_search_menu=(local_storage.getItem('visible_search_menu')!=='true');local_storage.setItem('visible_search_menu',visible_search_menu);this.toggle_buttons();},'keydown .o_searchview_input, .o_searchview_facet':function(e){switch(e.which){case $.ui.keyCode.LEFT:this.focusPreceding(e.target);e.preventDefault();break;case $.ui.keyCode.RIGHT:if(!this.autocomplete.is_expandable()){this.focusFollowing(e.target);}
e.preventDefault();break;}},},defaults:_.extend({},View.prototype.defaults,{hidden:false,disable_filters:false,disable_groupby:false,disable_favorites:false,disable_custom_filters:false,}),template:"SearchView",init:function(){this._super.apply(this,arguments);this.query=undefined;this.title=this.options.action&&this.options.action.name;this.action_id=this.options.action&&this.options.action.id;this.search_fields=[];this.filters=[];this.groupbys=[];this.visible_filters=(local_storage.getItem('visible_search_menu')==='true');this.input_subviews=[];this.search_defaults=this.options.search_defaults||{};this.headless=this.options.hidden&&_.isEmpty(this.search_defaults);this.$buttons=this.options.$buttons;this.filter_menu=undefined;this.groupby_menu=undefined;this.favorite_menu=undefined;},willStart:function(){var self=this;var def;if(!this.options.disable_favorites){def=data_manager.load_filters(this.dataset,this.action_id).then(function(filters){self.favorite_filters=filters;});}
return $.when(this._super(),def);},start:function(){if(this.headless){this.do_hide();}
this.toggle_visibility(false);this.setup_global_completion();this.query=new SearchQuery().on('add change reset remove',this.proxy('do_search')).on('change',this.proxy('renderChangedFacets')).on('add reset remove',this.proxy('renderFacets'));this.$('.o_searchview_more').toggleClass('fa-search-minus',this.visible_filters).toggleClass('fa-search-plus',!this.visible_filters);var menu_defs=[];this.prepare_search_inputs();if(this.$buttons){if(!this.options.disable_filters){this.filter_menu=new FilterMenu(this,this.filters);menu_defs.push(this.filter_menu.appendTo(this.$buttons));}
if(!this.options.disable_groupby){this.groupby_menu=new GroupByMenu(this,this.groupbys);menu_defs.push(this.groupby_menu.appendTo(this.$buttons));}
if(!this.options.disable_favorites){this.favorite_menu=new FavoriteMenu(this,this.query,this.dataset.model,this.action_id,this.favorite_filters);menu_defs.push(this.favorite_menu.appendTo(this.$buttons));}}
return $.when.apply($,menu_defs).then(this.set_default_filters.bind(this));},get_title:function(){return this.title;},set_default_filters:function(){var self=this,default_custom_filter=this.$buttons&&this.favorite_menu.get_default_filter();if(!self.options.disable_custom_filters&&default_custom_filter){return this.favorite_menu.toggle_filter(default_custom_filter,true);}
if(!_.isEmpty(this.search_defaults)){var inputs=this.search_fields.concat(this.filters,this.groupbys),search_defaults=_.invoke(inputs,'facet_for_defaults',this.search_defaults);return $.when.apply(null,search_defaults).then(function(){self.query.reset(_(arguments).compact(),{preventSearch:true});});}
this.query.reset([],{preventSearch:true});return $.when();},do_search:function(_query,options){if(options&&options.preventSearch){return;}
var search=this.build_search_data();this.trigger('search_data',search.domains,search.contexts,search.groupbys);},build_search_data:function(){var domains=[],contexts=[],groupbys=[];this.query.each(function(facet){var field=facet.get('field');var domain=field.get_domain(facet);if(domain){domains.push(domain);}
var context=field.get_context(facet);if(context){contexts.push(context);}
var group_by=field.get_groupby(facet);if(group_by){groupbys.push.apply(groupbys,group_by);}});return{domains:domains,contexts:contexts,groupbys:groupbys,};},toggle_visibility:function(is_visible){this.do_toggle(!this.headless&&is_visible);if(this.$buttons){this.$buttons.toggle(!this.headless&&is_visible&&this.visible_filters);}
if(!config.device.touch&&config.device.size_class>=config.device.SIZES.SM){this.$('input').focus();}},toggle_buttons:function(is_visible){this.visible_filters=is_visible||!this.visible_filters;if(this.$buttons){this.$buttons.toggle(this.visible_filters);}},setup_global_completion:function(){var self=this;this.autocomplete=new AutoComplete(this,{source:this.proxy('complete_global_search'),select:this.proxy('select_completion'),get_search_string:function(){return self.$('.o_searchview_input').val().trim();},});this.autocomplete.appendTo(this.$el);},complete_global_search:function(req,resp){var inputs=this.search_fields.concat(this.filters,this.groupbys);$.when.apply(null,_(inputs).chain().filter(function(input){return input.visible();}).invoke('complete',req.term).value()).then(function(){resp(_(arguments).chain().compact().flatten(true).value());});},select_completion:function(e,ui){e.preventDefault();if(ui.item.facet&&ui.item.facet.values&&ui.item.facet.values.length&&String(ui.item.facet.values[0].value).trim()!==""){this.query.add(ui.item.facet);}else{this.query.trigger('add');}},subviewForRoot:function(subview_root){return _(this.input_subviews).detect(function(subview){return subview.$el[0]===subview_root;});},siblingSubview:function(subview,direction,wrap_around){var index=_(this.input_subviews).indexOf(subview)+direction;if(wrap_around&&index<0){index=this.input_subviews.length-1;}else if(wrap_around&&index>=this.input_subviews.length){index=0;}
return this.input_subviews[index];},focusPreceding:function(subview_root){return this.siblingSubview(this.subviewForRoot(subview_root),-1,true).$el.focus();},focusFollowing:function(subview_root){return this.siblingSubview(this.subviewForRoot(subview_root),+1,true).$el.focus();},renderFacets:function(collection,model,options){var self=this;var started=[];_.invoke(this.input_subviews,'destroy');this.input_subviews=[];this.query.each(function(facet){var f=new FacetView(this,facet);started.push(f.appendTo(self.$el));self.input_subviews.push(f);},this);var i=new InputView(this);started.push(i.appendTo(self.$el));self.input_subviews.push(i);_.each(this.input_subviews,function(childView){childView.on('focused',self,self.proxy('childFocused'));childView.on('blurred',self,self.proxy('childBlurred'));});$.when.apply(null,started).then(function(){_.last(self.input_subviews).$el.focus();});},childFocused:function(){this.$el.addClass('active');},childBlurred:function(){this.$el.val('').removeClass('active').trigger('blur');this.autocomplete.close();},renderChangedFacets:function(model,options){this.renderFacets(undefined,model,options);},prepare_search_inputs:function(){var self=this,arch=this.fields_view.arch;var filters=[].concat.apply([],_.map(arch.children,function(item){return item.tag!=='group'?eval_item(item):item.children.map(eval_item);}));function eval_item(item){var category='filters';if(item.attrs.context){try{var context=pyeval.eval('context',item.attrs.context);if(context.group_by){category='group_by';}}catch(e){}}
return{item:item,category:category,};}
var current_group=[],current_category='filters',categories={filters:this.filters,group_by:this.groupbys};_.each(filters.concat({category:'filters',item:'separator'}),function(filter){if(filter.item.tag==='filter'&&filter.category===current_category){return current_group.push(new search_inputs.Filter(filter.item,self));}
if(current_group.length){var group=new search_inputs.FilterGroup(current_group,self);categories[current_category].push(group);current_group=[];}
if(filter.item.tag==='field'){var attrs=filter.item.attrs;var field=self.fields_view.fields[attrs.name];if(field.type==="many2one"&&attrs.widget==="selection"){attrs.widget=undefined;}
var Obj=core.search_widgets_registry.get_any([attrs.widget,field.type]);if(Obj){self.search_fields.push(new(Obj)(filter.item,field,self));}}
if(filter.item.tag==='filter'){current_group.push(new search_inputs.Filter(filter.item,self));}
current_category=filter.category;});},});_.extend(SearchView,{SearchQuery:SearchQuery,Facet:Facet,});return SearchView;});;

/* /web/static/src/js/views/search_filters.js defined in bundle 'web.assets_backend' */
odoo.define('web.search_filters',function(require){"use strict";var core=require('web.core');var datepicker=require('web.datepicker');var formats=require('web.formats');var Widget=require('web.Widget');var _t=core._t;var _lt=core._lt;var ExtendedSearchProposition=Widget.extend({template:'SearchView.extended_search.proposition',events:{'change .o_searchview_extended_prop_field':'changed','change .o_searchview_extended_prop_op':'operator_changed','click .o_searchview_extended_delete_prop':function(e){e.stopPropagation();this.getParent().remove_proposition(this);},},init:function(parent,fields){this._super(parent);this.fields=_(fields).chain().map(function(val,key){return _.extend({},val,{'name':key});}).filter(function(field){return!field.deprecated&&field.searchable;}).sortBy(function(field){return field.string;}).value();this.attrs={_:_,fields:this.fields,selected:null};this.value=null;},start:function(){return this._super().done(this.proxy('changed'));},changed:function(){var nval=this.$(".o_searchview_extended_prop_field").val();if(this.attrs.selected===null||this.attrs.selected===undefined||nval!=this.attrs.selected.name){this.select_field(_.detect(this.fields,function(x){return x.name==nval;}));}},operator_changed:function(e){this.value.show_inputs($(e.target));},select_field:function(field){var self=this;if(this.attrs.selected!==null&&this.attrs.selected!==undefined){this.value.destroy();this.value=null;this.$('.o_searchview_extended_prop_op').html('');}
this.attrs.selected=field;if(field===null||field===undefined){return;}
var type=field.type;var Field=core.search_filters_registry.get_any([type,"char"]);this.value=new Field(this,field);_.each(this.value.operators,function(operator){$('<option>',{value:operator.value}).text(String(operator.text)).appendTo(self.$('.o_searchview_extended_prop_op'));});var $value_loc=this.$('.o_searchview_extended_prop_value').show().empty();this.value.appendTo($value_loc);},get_filter:function(){if(this.attrs.selected===null||this.attrs.selected===undefined)
return null;var field=this.attrs.selected,op_select=this.$('.o_searchview_extended_prop_op')[0],operator=op_select.options[op_select.selectedIndex];return{attrs:{domain:this.value.get_domain(field,operator),string:this.value.get_label(field,operator),},children:[],tag:'filter',};},});ExtendedSearchProposition.Field=Widget.extend({init:function(parent,field){this._super(parent);this.field=field;},get_label:function(field,operator){var format;switch(operator.value){case'∃':case'∄':format=_t('%(field)s %(operator)s');break;default:format=_t('%(field)s %(operator)s "%(value)s"');break;}
return this.format_label(format,field,operator);},format_label:function(format,field,operator){return _.str.sprintf(format,{field:field.string,operator:operator.label||operator.text,value:this});},get_domain:function(field,operator){switch(operator.value){case'∃':return[[field.name,'!=',false]];case'∄':return[[field.name,'=',false]];default:return[[field.name,operator.value,this.get_value()]];}},show_inputs:function($operator){var $value=this.$el.parent();switch($operator.val()){case'∃':case'∄':$value.hide();break;default:$value.show();}},toString:function(){return this.get_value();}});ExtendedSearchProposition.Char=ExtendedSearchProposition.Field.extend({tagName:'input',attributes:{type:'text'},operators:[{value:"ilike",text:_lt("contains")},{value:"not ilike",text:_lt("doesn't contain")},{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],get_value:function(){return this.$el.val();}});ExtendedSearchProposition.DateTime=ExtendedSearchProposition.Field.extend({tagName:'span',attributes:{type:'datetime'},operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("greater than")},{value:"<",text:_lt("less than")},{value:">=",text:_lt("greater than or equal to")},{value:"<=",text:_lt("less than or equal to")},{value:"between",text:_lt("is between")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],widget:function(){return datepicker.DateTimeWidget;},get_value:function(){return this.datewidget_1.get_value();},get_domain:function(field,operator){switch(operator.value){case'∃':return[[field.name,'!=',false]];case'∄':return[[field.name,'=',false]];case'between':return[[field.name,'>=',this.datewidget_1.get_value()],[field.name,'<=',this.datewidget_2.get_value()]];default:return[[field.name,operator.value,this.get_value()]];}},show_inputs:function($operator){this._super($operator);if($operator.val()==='between'){if(!this.datewidget_2){this.datewidget_2=new(this.widget())(this);this.datewidget_2.appendTo(this.$el);}
else{this.datewidget_2.$el.show();}}
else{if(this.datewidget_2){this.datewidget_2.$el.hide();}}},toString:function(){var str=formats.format_value(this.get_value(),{type:this.attributes['type']});if(this.datewidget_2&&this.datewidget_2.get_value()){str+=' and '+formats.format_value(this.datewidget_2.get_value(),{type:this.attributes['type']});}
return str;},start:function(){var ready=this._super();this.datewidget_1=new(this.widget())(this);this.datewidget_1.appendTo(this.$el);return ready;}});ExtendedSearchProposition.Date=ExtendedSearchProposition.DateTime.extend({attributes:{type:'date'},widget:function(){return datepicker.DateWidget;},});ExtendedSearchProposition.Integer=ExtendedSearchProposition.Field.extend({tagName:'input',attributes:{type:'number',value:'0',},operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("greater than")},{value:"<",text:_lt("less than")},{value:">=",text:_lt("greater than or equal to")},{value:"<=",text:_lt("less than or equal to")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],toString:function(){return this.$el.val();},get_value:function(){try{var val=this.$el.val();return formats.parse_value(val===""?0:val,{'widget':'integer'});}catch(e){return"";}}});ExtendedSearchProposition.Id=ExtendedSearchProposition.Integer.extend({operators:[{value:"=",text:_lt("is")}]});ExtendedSearchProposition.Float=ExtendedSearchProposition.Field.extend({template:'SearchView.extended_search.proposition.float',operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("greater than")},{value:"<",text:_lt("less than")},{value:">=",text:_lt("greater than or equal to")},{value:"<=",text:_lt("less than or equal to")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],init:function(parent){this._super(parent);this.decimal_point=_t.database.parameters.decimal_point;},toString:function(){return this.$el.val();},get_value:function(){try{var val=this.$el.val();return formats.parse_value(val===""?0.0:val,{'widget':'float'});}catch(e){return"";}}});ExtendedSearchProposition.Selection=ExtendedSearchProposition.Field.extend({template:'SearchView.extended_search.proposition.selection',operators:[{value:"=",text:_lt("is")},{value:"!=",text:_lt("is not")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],toString:function(){var select=this.$el[0];var option=select.options[select.selectedIndex];return option.label||option.text;},get_value:function(){return this.$el.val();}});ExtendedSearchProposition.Boolean=ExtendedSearchProposition.Field.extend({tagName:'span',operators:[{value:"=",text:_lt("is true")},{value:"!=",text:_lt("is false")}],get_label:function(field,operator){return this.format_label(_t('%(field)s %(operator)s'),field,operator);},get_value:function(){return true;}});core.search_filters_registry.add('char',ExtendedSearchProposition.Char).add('text',ExtendedSearchProposition.Char).add('one2many',ExtendedSearchProposition.Char).add('many2one',ExtendedSearchProposition.Char).add('many2many',ExtendedSearchProposition.Char).add('datetime',ExtendedSearchProposition.DateTime).add('date',ExtendedSearchProposition.Date).add('integer',ExtendedSearchProposition.Integer).add('float',ExtendedSearchProposition.Float).add('monetary',ExtendedSearchProposition.Float).add('boolean',ExtendedSearchProposition.Boolean).add('selection',ExtendedSearchProposition.Selection).add('id',ExtendedSearchProposition.Id);return{ExtendedSearchProposition:ExtendedSearchProposition};});;

/* /web/static/src/js/views/search_inputs.js defined in bundle 'web.assets_backend' */
odoo.define('web.search_inputs',function(require){"use strict";var core=require('web.core');var data=require('web.data');var formats=require('web.formats');var Model=require('web.DataModel');var pyeval=require('web.pyeval');var time=require('web.time');var utils=require('web.utils');var Widget=require('web.Widget');var _t=core._t;var _lt=core._lt;var Input=Widget.extend({init:function(parent){this._super(parent);this.searchview=parent;this.load_attrs({});},complete:function(value){return $.when(null);},facet_for_defaults:function(defaults){if(!this.attrs||!(this.attrs.name in defaults&&defaults[this.attrs.name])){return $.when(null);}
return this.facet_for(defaults[this.attrs.name]);},get_context:function(){throw new Error("get_context not implemented for widget "+this.attrs.type);},get_groupby:function(){throw new Error("get_groupby not implemented for widget "+this.attrs.type);},get_domain:function(){throw new Error("get_domain not implemented for widget "+this.attrs.type);},load_attrs:function(attrs){if(!_.isObject(attrs.modifiers)){attrs.modifiers=attrs.modifiers?JSON.parse(attrs.modifiers):{};}
this.attrs=attrs;},visible:function(){return!this.attrs.modifiers.invisible;},});var Field=Input.extend({template:'SearchView.field',default_operator:'=',init:function(view_section,field,parent){this._super(parent);this.load_attrs(_.extend({},field,view_section.attrs));},facet_for:function(value){return $.when({field:this,category:this.attrs.string||this.attrs.name,values:[{label:String(value),value:value}]});},value_from:function(facetValue){return facetValue.get('value');},get_context:function(facet){var self=this;var context=this.attrs.context;if(_.isEmpty(context)||!facet.values.length){return;}
var contexts=facet.values.map(function(facetValue){return new data.CompoundContext(context).set_eval_context({self:self.value_from(facetValue)});});if(contexts.length===1){return contexts[0];}
return _.extend(new data.CompoundContext(),{__contexts:contexts});},get_groupby:function(){},make_domain:function(name,operator,facet){return[[name,operator,this.value_from(facet)]];},get_domain:function(facet){if(!facet.values.length){return;}
var value_to_domain;var self=this;var domain=this.attrs.filter_domain;if(domain){value_to_domain=function(facetValue){return new data.CompoundDomain(domain).set_eval_context({self:self.value_from(facetValue)});};}else{value_to_domain=function(facetValue){return self.make_domain(self.attrs.name,self.attrs.operator||self.default_operator,facetValue);};}
var domains=facet.values.map(value_to_domain);if(domains.length===1){return domains[0];}
for(var i=domains.length;--i;){domains.unshift(['|']);}
return _.extend(new data.CompoundDomain(),{__domains:domains});}});var CharField=Field.extend({default_operator:'ilike',complete:function(value){if(_.isEmpty(value)){return $.when(null);}
var label=_.str.sprintf(_.str.escapeHTML(_t("Search %(field)s for: %(value)s")),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+_.escape(value)+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:value,value:value}]}}]);}});var NumberField=Field.extend({complete:function(value){var val=this.parse(value);if(isNaN(val)){return $.when();}
var label=_.str.sprintf(_t("Search %(field)s for: %(value)s"),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+_.escape(value)+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:value,value:val}]}}]);},});var IntegerField=NumberField.extend({error_message:_t("not a valid integer"),parse:function(value){try{return formats.parse_value(value,{'widget':'integer'});}catch(e){return NaN;}}});var FloatField=NumberField.extend({error_message:_t("not a valid number"),parse:function(value){try{return formats.parse_value(value,{'widget':'float'});}catch(e){return NaN;}}});function facet_from(field,pair){return{field:field,category:field.attrs.string,values:[{label:pair[1],value:pair[0]}]};}
var SelectionField=Field.extend({template:'SearchView.field.selection',init:function(){this._super.apply(this,arguments);this.prepend_empty=!_(this.attrs.selection).detect(function(item){return!item[1];});},complete:function(needle){var self=this;var results=_(this.attrs.selection).chain().filter(function(sel){var value=sel[0],label=sel[1];if(value===undefined||!label){return false;}
return label.toLowerCase().indexOf(needle.toLowerCase())!==-1;}).map(function(sel){return{label:_.escape(sel[1]),indent:true,facet:facet_from(self,sel)};}).value();if(_.isEmpty(results)){return $.when(null);}
return $.when.call(null,[{label:_.escape(this.attrs.string)}].concat(results));},facet_for:function(value){var match=_(this.attrs.selection).detect(function(sel){return sel[0]===value;});if(!match){return $.when(null);}
return $.when(facet_from(this,match));}});var BooleanField=SelectionField.extend({init:function(){this._super.apply(this,arguments);this.attrs.selection=[[true,_t("Yes")],[false,_t("No")]];}});var DateField=Field.extend({value_from:function(facetValue){return time.date_to_str(facetValue.get('value'));},complete:function(needle){var t,v;try{t=(this.attrs&&this.attrs.type==='datetime')?'datetime':'date';v=formats.parse_value(needle,{'widget':t});}catch(e){return $.when(null);}
var m=moment(v,t==='datetime'?'YYYY-MM-DD HH:mm:ss':'YYYY-MM-DD');if(!m.isValid()){return $.when(null);}
var d=m.toDate();var date_string=formats.format_value(d,this.attrs);var label=_.str.sprintf(_.str.escapeHTML(_t("Search %(field)s at: %(value)s")),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+date_string+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:date_string,value:d}]}}]);}});var DateTimeField=DateField.extend({value_from:function(facetValue){return time.datetime_to_str(facetValue.get('value'));}});var ManyToOneField=CharField.extend({default_operator:{},init:function(view_section,field,parent){this._super(view_section,field,parent);this.model=new Model(this.attrs.relation);this.searchview=parent;},complete:function(value){if(_.isEmpty(value)){return $.when(null);}
var label=_.str.sprintf(_.str.escapeHTML(_t("Search %(field)s for: %(value)s")),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+_.escape(value)+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:value,value:value,operator:'ilike'}]},expand:this.expand.bind(this),}]);},expand:function(needle){var self=this;var context=pyeval.eval('contexts',[this.searchview.dataset.get_context()]);var args=this.attrs.domain;if(typeof args==='string'){try{args=pyeval.eval('domain',args);}catch(e){args=[];}}
return this.model.call('name_search',[],{name:needle,args:args,limit:8,context:context}).then(function(results){if(_.isEmpty(results)){return null;}
return _(results).map(function(result){return{label:_.escape(result[1]),facet:facet_from(self,result)};});});},facet_for:function(value){var self=this;if(value instanceof Array){if(value.length===2&&_.isString(value[1])){return $.when(facet_from(this,value));}
utils.assert(value.length<=1,_t("M2O search fields do not currently handle multiple default values"));value=value[0];}
var context=pyeval.eval('contexts',[this.searchview.dataset.get_context()]);return this.model.call('name_get',[value],{context:context}).then(function(names){if(_(names).isEmpty()){return null;}
return facet_from(self,names[0]);});},value_from:function(facetValue){return facetValue.get('label');},make_domain:function(name,operator,facetValue){operator=facetValue.get('operator')||operator;switch(operator){case this.default_operator:return[[name,'=',facetValue.get('value')]];case'ilike':return[[name,'ilike',facetValue.get('value')]];case'child_of':return[[name,'child_of',facetValue.get('value')]];}
return this._super(name,operator,facetValue);},get_context:function(facet){var values=facet.values;if(_.isEmpty(this.attrs.context)&&values.length===1){var c={};var v=values.at(0);if(v.get('operator')!=='ilike'){c['default_'+this.attrs.name]=v.get('value');}
return c;}
return this._super(facet);}});var FilterGroup=Input.extend({template:'SearchView.filters',icon:"fa-filter",completion_label:_lt("Filter on: %s"),init:function(filters,parent){if(!(this instanceof GroupbyGroup)&&_(filters).all(function(f){if(!f.attrs.context){return false;}
var c=pyeval.eval('context',f.attrs.context);return!_.isEmpty(c.group_by);})){return new GroupbyGroup(filters,parent);}
this._super(parent);this.filters=filters;this.searchview=parent;this.searchview.query.on('add remove change reset',this.proxy('search_change'));},start:function(){this.$el.on('click','a',this.proxy('toggle_filter'));return $.when(null);},search_change:function(){var self=this;var $filters=this.$el.removeClass('selected');var facet=this.searchview.query.find(_.bind(this.match_facet,this));if(!facet){return;}
facet.values.each(function(v){var i=_(self.filters).indexOf(v.get('value'));if(i===-1){return;}
$filters.filter(function(){return Number($(this).data('index'))===i;}).addClass('selected');});},match_facet:function(facet){return facet.get('field')===this;},make_facet:function(values){return{category:_t("Filter"),icon:this.icon,separator:_t(" or "),values:values,field:this};},make_value:function(filter){return{label:filter.attrs.string||filter.attrs.help||filter.attrs.name,value:filter};},facet_for_defaults:function(defaults){var self=this;var fs=_(this.filters).chain().filter(function(f){return f.attrs&&f.attrs.name&&!!defaults[f.attrs.name];}).map(function(f){return self.make_value(f);}).value();if(_.isEmpty(fs)){return $.when(null);}
return $.when(this.make_facet(fs));},get_context:function(facet){var contexts=facet.values.chain().map(function(f){return f.get('value').attrs.context;}).without('{}').reject(_.isEmpty).value();if(!contexts.length){return;}
if(contexts.length===1){return contexts[0];}
return _.extend(new data.CompoundContext(),{__contexts:contexts});},get_groupby:function(facet){return facet.values.chain().map(function(f){return f.get('value').attrs.context;}).without('{}').reject(_.isEmpty).value();},get_domain:function(facet){var domains=facet.values.chain().map(function(f){return f.get('value').attrs.domain;}).without('[]').reject(_.isEmpty).value();if(!domains.length){return;}
if(domains.length===1){return domains[0];}
for(var i=domains.length;--i;){domains.unshift(['|']);}
return _.extend(new data.CompoundDomain(),{__domains:domains});},toggle_filter:function(e){e.preventDefault();e.stopPropagation();this.toggle(this.filters[Number($(e.target).parent().data('index'))]);},toggle:function(filter,options){this.searchview.query.toggle(this.make_facet([this.make_value(filter)]),options);},is_visible:function(){return _.some(this.filters,function(filter){return!filter.attrs.invisible;});},complete:function(item){var self=this;item=item.toLowerCase();var facet_values=_(this.filters).chain().filter(function(filter){return filter.visible();}).filter(function(filter){var at={string:filter.attrs.string||'',help:filter.attrs.help||'',name:filter.attrs.name||''};var include=_.str.include;return include(at.string.toLowerCase(),item)||include(at.help.toLowerCase(),item)||include(at.name.toLowerCase(),item);}).map(this.make_value).value();if(_(facet_values).isEmpty()){return $.when(null);}
return $.when(_.map(facet_values,function(facet_value){return{label:_.str.sprintf(self.completion_label.toString(),_.escape(facet_value.label)),facet:self.make_facet([facet_value])};}));}});var GroupbyGroup=FilterGroup.extend({icon:'fa-bars',completion_label:_lt("Group by: %s"),init:function(filters,parent){this._super(filters,parent);this.searchview=parent;if(!this.searchview._s_groupby){this.searchview._s_groupby={help:"See GroupbyGroup#init",get_context:this.proxy('get_context'),get_domain:this.proxy('get_domain'),get_groupby:this.proxy('get_groupby')};}},match_facet:function(facet){return facet.get('field')===this.searchview._s_groupby;},make_facet:function(values){return{category:_t("Group By"),icon:this.icon,separator:" > ",values:values,field:this.searchview._s_groupby};}});var Filter=Input.extend({template:'SearchView.filter',init:function(node,parent){this._super(parent);this.load_attrs(node.attrs);},facet_for:function(){return $.when(null);},get_context:function(){},get_domain:function(){},});core.search_widgets_registry.add('char',CharField).add('text',CharField).add('html',CharField).add('boolean',BooleanField).add('integer',IntegerField).add('id',IntegerField).add('float',FloatField).add('monetary',FloatField).add('selection',SelectionField).add('datetime',DateTimeField).add('date',DateField).add('many2one',ManyToOneField).add('many2many',CharField).add('one2many',CharField);return{FilterGroup:FilterGroup,Filter:Filter,Field:Field,GroupbyGroup:GroupbyGroup,};});;

/* /web/static/src/js/views/search_menus.js defined in bundle 'web.assets_backend' */
odoo.define('web.FavoriteMenu',function(require){"use strict";var core=require('web.core');var data_manager=require('web.data_manager');var pyeval=require('web.pyeval');var session=require('web.session');var Widget=require('web.Widget');var _t=core._t;return Widget.extend({template:'SearchView.FavoriteMenu',events:{'click li':function(event){event.stopImmediatePropagation();},'click li a':function(event){event.preventDefault();},'click .o_save_search a':function(event){event.preventDefault();this.toggle_save_menu();},'click .o_save_name button':'save_favorite','hidden.bs.dropdown':'close_menus','keyup .o_save_name input':function(ev){if(ev.which===$.ui.keyCode.ENTER){this.save_favorite();}},},init:function(parent,query,target_model,action_id,filters){this._super.apply(this,arguments);this.searchview=parent;this.query=query;this.target_model=target_model;this.action_id=action_id;this.filters={};_.each(filters,this.add_filter.bind(this));},start:function(){var self=this;this.$filters={};this.$save_search=this.$('.o_save_search');this.$save_name=this.$('.o_save_name');this.$inputs=this.$save_name.find('input');this.$divider=this.$('.divider');this.$inputs.eq(0).val(this.searchview.get_title());var $shared_filter=this.$inputs.eq(1),$default_filter=this.$inputs.eq(2);$shared_filter.click(function(){$default_filter.prop('checked',false);});$default_filter.click(function(){$shared_filter.prop('checked',false);});this.query.on('remove',function(facet){if(facet.get('is_custom_filter')){self.clear_selection();}}).on('reset',this.proxy('clear_selection'));_.each(this.filters,this.append_filter.bind(this));return this._super();},toggle_save_menu:function(is_open){this.$save_search.toggleClass('o_closed_menu',!(_.isUndefined(is_open))?!is_open:undefined).toggleClass('o_open_menu',is_open);this.$save_name.toggle(is_open);if(this.$save_search.hasClass('o_open_menu')){this.$save_name.find('input').first().focus();}},close_menus:function(){this.toggle_save_menu(false);},save_favorite:function(){var self=this,filter_name=this.$inputs[0].value,default_filter=this.$inputs[1].checked,shared_filter=this.$inputs[2].checked;if(!filter_name.length){this.do_warn(_t("Error"),_t("Filter name is required."));this.$inputs.first().focus();return;}
if(_.chain(this.filters).pluck('name').contains(filter_name).value()){this.do_warn(_t("Error"),_t("Filter with same name already exists."));this.$inputs.first().focus();return;}
var search=this.searchview.build_search_data(),view_manager=this.findAncestor(function(a){return'active_view'in a;}),view_context=view_manager?view_manager.active_view.controller.get_context():{},results=pyeval.sync_eval_domains_and_contexts({domains:search.domains,contexts:search.contexts.concat(view_context||[]),group_by_seq:search.groupbys||[],});if(!_.isEmpty(results.group_by)){results.context.group_by=results.group_by;}
var ctx=results.context;_(_.keys(session.user_context)).each(function(key){delete ctx[key];});var filter={name:filter_name,user_id:shared_filter?false:session.uid,model_id:this.target_model,context:results.context,domain:results.domain,is_default:default_filter,action_id:this.action_id,};return data_manager.create_filter(filter).done(function(id){filter.id=id;self.toggle_save_menu(false);self.$save_name.find('input').val('').prop('checked',false);self.add_filter(filter);self.append_filter(filter);self.toggle_filter(filter,true);});},get_default_filter:function(){var personal_filter=_.find(this.filters,function(filter){return filter.user_id&&filter.is_default;});if(personal_filter){return personal_filter;}
return _.find(this.filters,function(filter){return!filter.user_id&&filter.is_default;});},key_for:function(filter){var user_id=filter.user_id,action_id=filter.action_id,uid=(user_id instanceof Array)?user_id[0]:user_id,act_id=(action_id instanceof Array)?action_id[0]:action_id;return _.str.sprintf('(%s)(%s)%s',uid,act_id,filter.name);},facet_for:function(filter){return{category:_t("Custom Filter"),icon:'fa-star',field:{get_context:function(){return filter.context;},get_groupby:function(){return[filter.context];},get_domain:function(){return filter.domain;}},_id:filter.id,is_custom_filter:true,values:[{label:filter.name,value:null}]};},clear_selection:function(){this.$('li.selected').removeClass('selected');},add_filter:function(filter){this.filters[this.key_for(filter)]=filter;},append_filter:function(filter){var self=this;var key=this.key_for(filter);this.$divider.show();if(!(key in this.$filters)){var $filter=$('<li>').addClass(filter.user_id?'o-searchview-custom-private':'o-searchview-custom-public').append($('<a>',{'href':'#'}).text(filter.name)).append($('<span>',{class:'fa fa-trash-o o-remove-filter',on:{click:function(event){event.stopImmediatePropagation();self.remove_filter(filter,$filter,key);},},})).insertBefore(this.$divider);this.$filters[key]=$filter;}
this.$filters[key].unbind('click').click(function(){self.toggle_filter(filter);});},toggle_filter:function(filter,preventSearch){var current=this.query.find(function(facet){return facet.get('_id')===filter.id;});if(current){this.query.remove(current);this.$filters[this.key_for(filter)].removeClass('selected');return;}
this.query.reset([this.facet_for(filter)],{preventSearch:preventSearch||false});this.$filters[this.key_for(filter)].addClass('selected');},remove_filter:function(filter,$filter,key){var self=this;var global_warning=_t("This filter is global and will be removed for everybody if you continue."),warning=_t("Are you sure that you want to remove this filter?");if(!confirm(filter.user_id?warning:global_warning)){return;}
return data_manager.delete_filter(filter).done(function(){$filter.remove();delete self.$filters[key];delete self.filters[key];if(_.isEmpty(self.filters)){self.$divider.hide();}});},});});odoo.define('web.FilterMenu',function(require){"use strict";var data_manager=require('web.data_manager');var search_filters=require('web.search_filters');var search_inputs=require('web.search_inputs');var Widget=require('web.Widget');return Widget.extend({template:'SearchView.FilterMenu',events:{'click .o_add_filter':function(event){event.preventDefault();this.toggle_custom_filter_menu();},'click li':function(event){event.preventDefault();event.stopImmediatePropagation();},'hidden.bs.dropdown':function(){this.toggle_custom_filter_menu(false);},'click .o_add_condition':'append_proposition','click .o_apply_filter':'commit_search','keyup .o_searchview_extended_prop_value':function(ev){if(ev.which===$.ui.keyCode.ENTER){this.commit_search();}},},init:function(parent,filters){this._super(parent);this.filters=filters||[];this.searchview=parent;this.propositions=[];this.custom_filters_open=false;},start:function(){var self=this;this.$menu=this.$('.o_filters_menu');this.$add_filter=this.$('.o_add_filter');this.$apply_filter=this.$('.o_apply_filter');this.$add_filter_menu=this.$('.o_add_filter_menu');_.each(this.filters,function(group){if(group.is_visible()){group.insertBefore(self.$add_filter);$('<li class="divider">').insertBefore(self.$add_filter);}});},get_fields:function(){if(!this._fields_def){this._fields_def=data_manager.load_fields(this.searchview.dataset).then(function(data){var fields={id:{string:'ID',type:'id',searchable:true}};_.each(data,function(field_def,field_name){if(field_def.selectable!==false&&field_name!=='id'){fields[field_name]=field_def;}});return fields;});}
return this._fields_def;},toggle_custom_filter_menu:function(is_open){var self=this;this.custom_filters_open=!_.isUndefined(is_open)?is_open:!this.custom_filters_open;var def;if(this.custom_filters_open&&!this.propositions.length){def=this.append_proposition();}
$.when(def).then(function(){self.$add_filter.toggleClass('o_closed_menu',!self.custom_filters_open).toggleClass('o_open_menu',self.custom_filters_open);self.$add_filter_menu.toggle(self.custom_filters_open);self.$('.o_filter_condition').toggle(self.custom_filters_open);});},append_proposition:function(){var self=this;return this.get_fields().then(function(fields){var prop=new search_filters.ExtendedSearchProposition(self,fields);self.propositions.push(prop);prop.insertBefore(self.$add_filter_menu);self.$apply_filter.prop('disabled',false);return prop;});},remove_proposition:function(prop){this.propositions=_.without(this.propositions,prop);if(!this.propositions.length){this.$apply_filter.prop('disabled',true);}
prop.destroy();},commit_search:function(){var filters=_.invoke(this.propositions,'get_filter'),filters_widgets=_.map(filters,function(filter){return new search_inputs.Filter(filter,this);}),filter_group=new search_inputs.FilterGroup(filters_widgets,this.searchview),facets=filters_widgets.map(function(filter){return filter_group.make_facet([filter_group.make_value(filter)]);});filter_group.insertBefore(this.$add_filter);$('<li class="divider">').insertBefore(this.$add_filter);this.searchview.query.add(facets,{silent:true});this.searchview.query.trigger('reset');_.invoke(this.propositions,'destroy');this.propositions=[];this.append_proposition();this.toggle_custom_filter_menu(false);},});});odoo.define('web.GroupByMenu',function(require){"use strict";var core=require('web.core');var data_manager=require('web.data_manager');var search_inputs=require('web.search_inputs');var Widget=require('web.Widget');var QWeb=core.qweb;return Widget.extend({template:'SearchView.GroupByMenu',events:{'click li':function(event){event.stopImmediatePropagation();},'hidden.bs.dropdown':function(){this.toggle_add_menu(false);},'click .o_add_custom_group a':function(event){event.preventDefault();this.toggle_add_menu();},},init:function(parent,groups){this._super(parent);this.groups=groups||[];this.groupable_fields=[];this.searchview=parent;},start:function(){this.$menu=this.$('.o_group_by_menu');var divider=this.$menu.find('.divider');_.invoke(this.groups,'insertBefore',divider);if(this.groups.length){divider.show();}
this.$add_group=this.$menu.find('.o_add_custom_group');},get_fields:function(){var self=this;if(!this._fields_def){this._fields_def=data_manager.load_fields(this.searchview.dataset).then(function(fields){var groupable_types=['many2one','char','boolean','selection','date','datetime'];var filter_group_field=_.filter(fields,function(field,name){if(field.store&&_.contains(groupable_types,field.type)){field.name=name;return field;}});self.groupable_fields=_.sortBy(filter_group_field,'string');self.$menu.append(QWeb.render('GroupByMenuSelector',self));self.$add_group_menu=self.$('.o_add_group');self.$group_selector=self.$('.o_group_selector');self.$('.o_select_group').click(function(){self.toggle_add_menu(false);var field=self.$group_selector.find(':selected').data('name');self.add_groupby_to_menu(field);});});}
return this._fields_def;},toggle_add_menu:function(is_open){var self=this;this.get_fields().then(function(){self.$add_group.toggleClass('o_closed_menu',!(_.isUndefined(is_open))?!is_open:undefined).toggleClass('o_open_menu',is_open);self.$add_group_menu.toggle(is_open);if(self.$add_group.hasClass('o_open_menu')){self.$group_selector.focus();}});},add_groupby_to_menu:function(field_name){var filter=new search_inputs.Filter({attrs:{context:"{'group_by':'"+field_name+"''}",name:_.find(this.groupable_fields,{name:field_name}).string,}},this.searchview);var group=new search_inputs.FilterGroup([filter],this.searchview),divider=this.$('.divider').show();group.insertBefore(divider);group.toggle(filter);},});});;

/* /web/static/src/js/views/tree_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.TreeView',function(require){"use strict";var core=require('web.core');var data=require('web.data');var formats=require('web.formats');var pyeval=require('web.pyeval');var session=require('web.session');var View=require('web.View');var _lt=core._lt;var QWeb=core.qweb;var TreeView=View.extend({display_name:_lt('Tree'),icon:'fa-align-left',searchable:false,init:function(){this._super.apply(this,arguments);this.records={};_.bindAll(this,'color_for');this.fields=this.fields_view.fields;this.children_field=this.fields_view.field_parent;},fields_list:function(){var fields=_.keys(this.fields);if(!_(fields).contains(this.children_field)){fields.push(this.children_field);}
return fields;},willStart:function(){_(this.fields_view.arch.children).each(function(field){if(field.attrs.modifiers&&typeof field.attrs.modifiers==="string"){field.attrs.modifiers=JSON.parse(field.attrs.modifiers);}});if(this.fields_view.arch.attrs.colors){this.colors=_(this.fields_view.arch.attrs.colors.split(';')).chain().compact().map(function(color_pair){var pair=color_pair.split(':'),color=pair[0],expr=pair[1];return[color,py.parse(py.tokenize(expr)),expr];}).value();}
return this._super();},start:function(){var self=this;var has_toolbar=!!this.fields_view.arch.attrs.toolbar;this.hook_row_click();this.$el.html(QWeb.render('TreeView',{'title':this.fields_view.arch.attrs.string,'fields_view':this.fields_view.arch.children,'fields':this.fields,'toolbar':has_toolbar}));this.$el.addClass(this.fields_view.arch.attrs['class']);this.dataset.read_slice(this.fields_list()).done(function(records){if(!has_toolbar){self.getdata(null,_(records).pluck('id'));return;}
var $select=self.$('select').change(function(){var $option=$(this).find(':selected');self.getdata($option.val(),$option.data('children'));});_(records).each(function(record){self.records[record.id]=record;$('<option>').val(record.id).text(record.name).data('children',record[self.children_field]).appendTo($select);});if(!_.isEmpty(records)){$select.change();}});this.do_push_state({});return this._super();},color_for:function(record){if(!this.colors){return'';}
var context=_.extend({},record,{uid:session.uid,current_date:moment().format('YYYY-MM-DD')});for(var i=0,len=this.colors.length;i<len;++i){var pair=this.colors[i],color=pair[0],expression=pair[1];if(py.PY_isTrue(py.evaluate(expression,context))){return'color: '+color+';';}}
return'';},hook_row_click:function(){var self=this;this.$el.delegate('.treeview-td span, .treeview-tr span','click',function(e){e.stopImmediatePropagation();self.activate($(this).closest('tr').data('id'));});this.$el.delegate('.treeview-tr','click',function(){var is_loaded=0,$this=$(this),record_id=$this.data('id'),row_parent_id=$this.data('row-parent-id'),record=self.records[record_id],children_ids=record[self.children_field];_(children_ids).each(function(childid){if(self.$('[id=treerow_'+childid+'][data-row-parent-id='+record_id+']').length){if(self.$('[id=treerow_'+childid+'][data-row-parent-id='+record_id+']').is(':hidden')){is_loaded=-1;}else{is_loaded++;}}});if(is_loaded===0){if(!$this.parent().hasClass('o_open')){self.getdata(record_id,children_ids);}}else{self.showcontent($this,record_id,is_loaded<0);}});},getdata:function(id,children_ids){var self=this;self.dataset.read_ids(children_ids,this.fields_list()).done(function(records){_(records).each(function(record){self.records[record.id]=record;});var $curr_node=self.$('#treerow_'+id);var children_rows=QWeb.render('TreeView.rows',{'records':records,'children_field':self.children_field,'fields_view':self.fields_view.arch.children,'fields':self.fields,'level':$curr_node.data('level')||0,'render':formats.format_value,'color_for':self.color_for,'row_parent_id':id});if($curr_node.length){$curr_node.addClass('o_open');$curr_node.after(children_rows);}else{self.$('tbody').html(children_rows);}});},activate:function(id){var self=this;var local_context={active_model:self.model,active_id:id,active_ids:[id]};var ctx=pyeval.eval('context',new data.CompoundContext(this.dataset.get_context(),local_context));return this.rpc('/web/treeview/action',{id:id,model:this.model,context:ctx}).then(function(actions){if(!actions.length){return;}
var action=actions[0][2];var c=new data.CompoundContext(local_context).set_eval_context(ctx);if(action.context){c.add(action.context);}
action.context=c;return self.do_action(action);});},showcontent:function(curnode,record_id,show){curnode.parent('tr').toggleClass('o_open',show);_(this.records[record_id][this.children_field]).each(function(child_id){var $child_row=this.$('[id=treerow_'+child_id+'][data-row-parent-id='+curnode.data('id')+']');if($child_row.hasClass('o_open')){$child_row.toggleClass('o_open',show);this.showcontent($child_row,child_id,false);}
$child_row.toggle(show);},this);},});core.view_registry.add('tree',TreeView);return TreeView;});;

/* /web/static/src/js/apps.js defined in bundle 'web.assets_backend' */
odoo.define('web.Apps',function(require){"use strict";var core=require('web.core');var framework=require('web.framework');var Model=require('web.DataModel');var session=require('web.session');var web_client=require('web.web_client');var Widget=require('web.Widget');var _t=core._t;var apps_client=null;var qweb=core.qweb;var Apps=Widget.extend({template:'EmptyComponent',remote_action_tag:'loempia.embed',failback_action_id:'base.open_module_tree',init:function(parent,action){this._super(parent,action);var options=action.params||{};this.params=options;},get_client:function(){var check_client_available=function(client){var d=$.Deferred();var i=new Image();i.onerror=function(){d.reject(client);};i.onload=function(){d.resolve(client);};var ts=new Date().getTime();i.src=_.str.sprintf('%s/web/static/src/img/sep-a.gif?%s',client.origin,ts);return d.promise();};if(apps_client){return check_client_available(apps_client);}else{var Mod=new Model('ir.module.module');return Mod.call('get_apps_server').then(function(u){var link=$(_.str.sprintf('<a href="%s"></a>',u))[0];var host=_.str.sprintf('%s//%s',link.protocol,link.host);var dbname=link.pathname;if(dbname[0]==='/'){dbname=dbname.substr(1);}
var client={origin:host,dbname:dbname};apps_client=client;return check_client_available(client);});}},destroy:function(){$(window).off("message.apps");if(this.$ifr){this.$ifr.remove();this.$ifr=null;}
return this._super();},_on_message:function($e){var self=this,client=this.client,e=$e.originalEvent;if(e.origin!==client.origin){return;}
var dispatcher={'event':function(m){self.trigger('message:'+m.event,m);},'action':function(m){self.do_action(m.action).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},'rpc':function(m){self.session.rpc.apply(self.session,m.args).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},'Model':function(m){var M=new Model(m.model);M[m.method].apply(M,m.args).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},};if(!_.isObject(e.data)){return;}
if(dispatcher[e.data.type]){dispatcher[e.data.type](e.data);}},_on_update_count:function(m){var self=this;var count=m.count;var get_upd_menu_id=function(){if(_.isUndefined(self._upd_menu_id)){var IMD=new Model('ir.model.data');return IMD.call('get_object_reference',['base','menu_module_updates']).then(function(r){var mid=r[1];if(r[0]!=='ir.ui.menu'){mid=null;}
self._upd_menu_id=mid;return mid;});}else{return $.Deferred().resolve(self._upd_menu_id).promise();}};$.when(get_upd_menu_id()).done(function(menu_id){if(_.isNull(menu_id)){return;}
var $menu=web_client.menu.$secondary_menus.find(_.str.sprintf('a[data-menu=%s]',menu_id));if($menu.length===0){return;}
if(_.isUndefined(count)){count=0;}
var needupdate=$menu.find('#menu_counter');if(needupdate&&needupdate.length!==0){if(count>0){needupdate.text(count);}else{needupdate.remove();}}else if(count>0){$menu.append(qweb.render("Menu.needaction_counter",{widget:{needaction_counter:count}}));}});},start:function(){var self=this;var def=$.Deferred();self.get_client().then(function(client){self.client=client;var qs={db:client.dbname};if(session.debug){qs.debug=session.debug;}
var u=$.param.querystring(client.origin+"/apps/embed/client",qs);var css={width:'100%',height:'400px'};self.$ifr=$('<iframe>').attr('src',u);$(window).on("message.apps",self.proxy('_on_message'));self.on('message:ready',self,function(m){var w=this.$ifr[0].contentWindow;var act={type:'ir.actions.client',tag:this.remote_action_tag,params:_.extend({},this.params,{db:this.session.db,origin:this.session.origin,})};w.postMessage({type:'action',action:act},client.origin);});self.on('message:set_height',self,function(m){this.$ifr.height(m.height);});self.on('message:update_count',self,self._on_update_count);self.on('message:blockUI',self,function(){framework.blockUI();});self.on('message:unblockUI',self,function(){framework.unblockUI();});self.on('message:warn',self,function(m){self.do_warn(m.title,m.message,m.sticky);});self.$ifr.appendTo(self.$el).css(css).addClass('apps-client');def.resolve();},function(){self.do_warn(_t('Odoo Apps will be available soon'),_t('Showing locally available modules'),true);return session.rpc('/web/action/load',{action_id:self.failback_action_id}).then(function(action){return self.do_action(action);}).always(function(){def.reject();});});return def;},});var AppsUpdates=Apps.extend({remote_action_tag:'loempia.embed.updates',});core.action_registry.add("apps",Apps);core.action_registry.add("apps.updates",AppsUpdates);return Apps;});;

/* /website/static/src/js/website.backend.js defined in bundle 'web.assets_backend' */
odoo.define('website.backend',function(require){"use strict";var core=require('web.core');var form_common=require('web.form_common');var form_widgets=require('web.form_widgets');var _t=core._t;var WidgetWebsiteButton=form_common.AbstractField.extend({template:'WidgetWebsiteButton',render_value:function(){this._super.apply(this,arguments);var $value=this.$('.o_value');if(this.get_value()===true){$value.html(_t('Published')).removeClass('text-danger').addClass('text-success');}else{$value.html(_t('Unpublished')).removeClass('text-success').addClass('text-danger');}
if(this.node.attrs.class){this.$el.addClass(this.node.attrs.class);}},is_false:function(){return false;},});core.form_widget_registry.add('website_button',WidgetWebsiteButton);});;

/* /website/static/src/js/website.tour.rte.js defined in bundle 'web.assets_backend' */
odoo.define('website.tour.rte',function(require){'use strict';var tour=require("web_tour.tour");var base=require("web_editor.base");tour.register('rte_translator',{test:true,wait_for:base.ready()},[{content:"click on Add a language",trigger:'.js_language_selector a:has(i.fa)',},{content:"select french",trigger:'select[name="lang"]',run:'text "fr_BE"',},{content:"load french",trigger:'.modal-footer button:first',extra_trigger:'.modal select[name="lang"]:propValueContains(fr_BE)',},{content:"go to english version",trigger:'.js_language_selector a[data-lang="en_US"]',extra_trigger:'html[lang*="fr"]',},{content:"Open new page menu",trigger:'#oe_main_menu_navbar a[data-action=new_page]',extra_trigger:'a[data-action="edit"]',},{content:"click on new page",trigger:'a[data-action="new_page"]',},{content:"insert page name",trigger:'#editor_new_page input[type="text"]',run:'text rte_translator',},{content:"create page",trigger:'button.btn-continue',extra_trigger:'input[type="text"]:propValue(rte_translator)',},{content:"drop a snippet",trigger:"#snippet_structure .oe_snippet:eq(1) .oe_snippet_thumbnail",run:'drag_and_drop',},{content:"change content",trigger:'.oe_overlay_options .oe_options:visible',run:function(){$("#wrap p:first").replaceWith('<p>Write one or <font style="background-color: yellow;">two paragraphs <b>describing</b></font> your product or\
                        <font style="color: rgb(255, 0, 0);">services</font>. To be successful your content needs to be\
                        useful to your <a href="/999">readers</a>.</p> <input placeholder="test translate placeholder"/>\
                        <p>&lt;b&gt;&lt;/b&gt; is an HTML&nbsp;tag &amp; is empty</p>');$("#wrap img").attr("title","test translate image title");}},{content:"save",trigger:'button[data-action=save]',extra_trigger:'#wrap p:first b',},{content:"click on french version",trigger:'.js_language_selector a[data-lang="fr_BE"]',extra_trigger:'html[lang*="en"]:not(:has(button[data-action=save]))',},{content:"translate",trigger:'html:not(:has(#wrap p span)) .o_menu_systray a[data-action="translate"]',},{content:"close modal",trigger:'button[data-action="activate"]',},{content:"check if translation is activate",trigger:'[data-oe-translation-id]',},{content:"translate text",trigger:'#wrap p font:first',run:function(action_helper){action_helper.text('translated french text');this.$anchor.trigger('keydown');},},{content:"translate text with special char",trigger:'#wrap input + p span:first',run:function(action_helper){action_helper.click();this.$anchor.prepend('&lt;{translated}&gt;').trigger('keydown');},},{content:"click on input",trigger:'input:first',extra_trigger:'#wrap .o_dirty font:first:contains(translated french text)',run:'click',},{content:"translate placeholder",trigger:'input:first',run:'text test french placeholder',},{content:"close modal",trigger:'button.o_save_button',extra_trigger:'.modal input:propValue(test french placeholder)',},{content:"save translation",trigger:'button[data-action=save]',},{content:"check: content is translated",trigger:'#wrap p font:first:contains(translated french text)',run:function(){},},{content:"check: content with special char is translated",trigger:"#wrap input + p:contains(<{translated}><b></b> is an HTML\xa0tag & )",run:function(){},},{content:"check: placeholder translation",trigger:'input[placeholder="test french placeholder"]',run:function(){},},{content:"return to english version",trigger:'.js_language_selector a[data-lang="en_US"]',extra_trigger:'html[lang*="fr"]:not(:has(#wrap p span))',},{content:"edit english version",trigger:'a[data-action=edit]',extra_trigger:'body:not(:has(#wrap p font:first:containsExact(paragraphs <b>describing</b>)))',},{content:"select text",extra_trigger:'button[data-action=save]',trigger:'#wrap p',run:function(action_helper){action_helper.click();var el=this.$anchor[0];var evt=document.createEvent("MouseEvents");$.summernote.core.range.create(el.childNodes[2],6,el.childNodes[2],13).select();evt.initMouseEvent('mouseup',true,true,window,0,0,0,0,0,false,false,false,false,0,el);el.dispatchEvent(evt);},},{content:"underline",trigger:'.note-air-popover button[data-event="underline"]',},{content:"save new change",trigger:'button[data-action=save]',extra_trigger:'#wrap p u',},{content:"return in french",trigger:'html[lang="en-US"] .js_language_selector a[data-lang="fr_BE"]',extra_trigger:'html[lang*="en"]:not(:has(button[data-action=save]))',},{content:"check bis: content is translated",trigger:'#wrap p font:first:contains(translated french text)',extra_trigger:'body:not(:has(button[data-action=save]))',},{content:"check bis: placeholder translation",trigger:'input[placeholder="test french placeholder"]',},]);});;

/* /website/static/src/js/website.backendDashboard.js defined in bundle 'web.assets_backend' */
odoo.define('website.backendDashboard',function(require){"use strict";var ajax=require('web.ajax');var ControlPanelMixin=require('web.ControlPanelMixin');var core=require('web.core');var Dialog=require('web.Dialog');var Model=require('web.Model');var session=require('web.session');var utils=require('web.utils');var web_client=require('web.web_client');var Widget=require('web.Widget');var _t=core._t;var QWeb=core.qweb;var Dashboard=Widget.extend(ControlPanelMixin,{template:"website.WebsiteDashboardMain",events:{'click .js_link_analytics_settings':'on_link_analytics_settings',},init:function(parent,context){this._super(parent,context);this.date_range='week';this.date_from=moment().subtract(1,'week');this.date_to=moment();this.dashboards_templates=['website.dashboard_visits'];this.graphs=[];},willStart:function(){var self=this;return this._super().then(function(){return $.when(self.fetch_data());});},start:function(){var self=this;return this._super().then(function(){self.update_cp();self.render_dashboards();self.render_graphs();self.$el.parent().addClass('oe_background_grey');});},fetch_data:function(){var self=this;return ajax.jsonRpc('/website/fetch_dashboard_data','call',{'date_from':this.date_from.format('YYYY-MM-DD'),'date_to':this.date_to.format('YYYY-MM-DD'),}).done(function(result){self.data=result;self.dashboards_data=result.dashboards;self.currency_id=result.currency_id;self.groups=result.groups;});},on_link_analytics_settings:function(ev){ev.preventDefault();var self=this;var dialog=new Dialog(this,{size:'medium',title:_t('Google Analytics'),$content:QWeb.render('website.ga_dialog_content',{ga_key:this.dashboards_data.visits.ga_client_id}),buttons:[{text:_t("Save"),classes:'btn-primary',close:true,click:function(){var ga_client_id=dialog.$el.find('input[name="ga_client_id"]').val();self.on_save_ga_client_id(ga_client_id);},},{text:_t("Cancel"),close:true,},],}).open();},on_save_ga_client_id:function(ga_client_id){if(!ga_client_id.endsWith(".apps.googleusercontent.com")||ga_client_id.startsWith(" ")){this.do_warn(_t('Incorrect Client ID'),_t('The Google Analytics Client ID you have entered seems incorrect.'));return;}
var self=this;new Model('ir.config_parameter').call('set_param',['google_management_client_id',ga_client_id]).then(function(){self.on_date_range_button('week');});},render_dashboards:function(){var self=this;_.each(this.dashboards_templates,function(template){self.$('.o_website_dashboard').append(QWeb.render(template,{widget:self}));});},render_graph:function(div_to_display,chart_values){this.$(div_to_display).empty();var self=this;nv.addGraph(function(){var chart=nv.models.lineChart().x(function(d){return self.getDate(d);}).y(function(d){return self.getValue(d);}).forceY([0]);chart.useInteractiveGuideline(true).showLegend(false).showYAxis(true).showXAxis(true);var tick_values=self.getPrunedTickValues(chart_values[0].values,5);chart.xAxis.tickFormat(function(d){return d3.time.format("%m/%d/%y")(new Date(d));}).tickValues(_.map(tick_values,function(d){return self.getDate(d);})).rotateLabels(-45);chart.yAxis.tickFormat(d3.format('.02f'));var svg=d3.select(div_to_display).append("svg");svg.attr("height",'20em').datum(chart_values).call(chart);nv.utils.windowResize(chart.update);return chart;});},render_graphs:function(){var self=this;_.each(this.graphs,function(e){if(self.groups[e.group]){self.render_graph('#o_graph_'+e.name,self.dashboards_data[e.name].graph);}});this.render_graph_analytics(this.dashboards_data.visits.ga_client_id);},render_graph_analytics:function(client_id){if(!this.dashboards_data.visits||!this.dashboards_data.visits.ga_client_id){return;}
this.load_analytics_api();var $analytics_components=this.$('.js_analytics_components');this.addLoader($analytics_components);var self=this;gapi.analytics.ready(function(){$analytics_components.empty();var $analytics_auth=$('<div>').addClass('col-md-12');gapi.analytics.auth.authorize({container:$analytics_auth[0],clientid:client_id});$analytics_auth.appendTo($analytics_components);self.handle_analytics_auth($analytics_components);gapi.analytics.auth.on('signIn',function(){self.handle_analytics_auth($analytics_components);});});},on_date_range_button:function(date_range){if(date_range==='week'){this.date_range='week';this.date_from=moment().subtract(1,'weeks');}else if(date_range==='month'){this.date_range='month';this.date_from=moment().subtract(1,'months');}else if(date_range==='year'){this.date_range='year';this.date_from=moment().subtract(1,'years');}else{console.log('Unknown date range. Choose between [week, month, year]');return;}
var self=this;$.when(this.fetch_data()).then(function(){self.$('.o_website_dashboard').empty();self.render_dashboards();self.render_graphs();});},on_reverse_breadcrumb:function(){web_client.do_push_state({});this.update_cp();},update_cp:function(){var self=this;if(!this.$searchview){this.$searchview=$(QWeb.render("website.DateRangeButtons",{widget:this,}));this.$searchview.click('button.js_date_range',function(ev){self.on_date_range_button($(ev.target).data('date'));$(this).find('button.js_date_range.active').removeClass('active');$(ev.target).addClass('active');});}
this.update_control_panel({cp_content:{$searchview:this.$searchview,},breadcrumbs:this.getParent().get_breadcrumbs(),});},load_analytics_api:function(){var self=this;if(!("gapi"in window)){(function(w,d,s,g,js,fjs){g=w.gapi||(w.gapi={});g.analytics={q:[],ready:function(cb){this.q.push(cb);}};js=d.createElement(s);fjs=d.getElementsByTagName(s)[0];js.src='https://apis.google.com/js/platform.js';fjs.parentNode.insertBefore(js,fjs);js.onload=function(){g.load('analytics');};}(window,document,'script'));gapi.analytics.ready(function(){self.analytics_create_components();});}},handle_analytics_auth:function($analytics_components){$analytics_components.find('.js_unauthorized_message').remove();if(!gapi.analytics.auth.getAuthResponse()){this.display_unauthorized_message($analytics_components,'not_connected');}else if(gapi.analytics.auth.getAuthResponse()&&gapi.analytics.auth.getAuthResponse().scope.indexOf('https://www.googleapis.com/auth/analytics')===-1){this.display_unauthorized_message($analytics_components,'no_right');}else{this.make_analytics_calls($analytics_components);}},display_unauthorized_message:function($analytics_components,reason){$analytics_components.prepend($(QWeb.render('website.unauthorized_analytics',{reason:reason})));},make_analytics_calls:function($analytics_components){var $analytics_users=$('<div>');var activeUsers=new gapi.analytics.ext.ActiveUsers({container:$analytics_users[0],pollingInterval:10,});$analytics_users.appendTo($analytics_components);var $analytics_view_selector=$('<div>').addClass('col-md-12 o_properties_selection');var viewSelector=new gapi.analytics.ViewSelector({container:$analytics_view_selector[0],});viewSelector.execute();$analytics_view_selector.appendTo($analytics_components);var start_date='7daysAgo';if(this.date_range==='month'){start_date='30daysAgo';}else if(this.date_range==='year'){start_date='365daysAgo';}
var $analytics_chart_2=$('<div>').addClass('col-md-6 col-xs-12');var breakdownChart=new gapi.analytics.googleCharts.DataChart({query:{'dimensions':'ga:date','metrics':'ga:sessions','start-date':start_date,'end-date':'yesterday'},chart:{type:'LINE',container:$analytics_chart_2[0],options:{title:'All',width:'100%'}}});$analytics_chart_2.appendTo($analytics_components);var $analytics_chart_1=$('<div>').addClass('col-md-6 col-xs-12');var mainChart=new gapi.analytics.googleCharts.DataChart({query:{'dimensions':'ga:medium','metrics':'ga:sessions','sort':'-ga:sessions','max-results':'6'},chart:{type:'TABLE',container:$analytics_chart_1[0],options:{width:'100%'}}});$analytics_chart_1.appendTo($analytics_components);var table_row_listener;viewSelector.on('change',function(ids){var options={query:{ids:ids}};activeUsers.set({ids:ids}).execute();mainChart.set(options).execute();breakdownChart.set(options).execute();if(table_row_listener){google.visualization.events.removeListener(table_row_listener);}});mainChart.on('success',function(response){var chart=response.chart;var dataTable=response.dataTable;table_row_listener=google.visualization.events.addListener(chart,'select',function(){var options;if(chart.getSelection().length){var row=chart.getSelection()[0].row;var medium=dataTable.getValue(row,0);options={query:{filters:'ga:medium=='+medium,},chart:{options:{title:medium,}}};}else{options={chart:{options:{title:'All',}}};delete breakdownChart.get().query.filters;}
breakdownChart.set(options).execute();});});activeUsers.once('success',function(){var element=this.container.firstChild;var timeout;this.on('change',function(data){element=this.container.firstChild;var animationClass=data.delta>0?'is-increasing':'is-decreasing';element.className+=(' '+animationClass);clearTimeout(timeout);timeout=setTimeout(function(){element.className=element.className.replace(/ is-(increasing|decreasing)/g,'');},3000);});});},analytics_create_components:function(){gapi.analytics.createComponent('ActiveUsers',{initialize:function(){this.activeUsers=0;gapi.analytics.auth.once('signOut',this.handleSignOut_.bind(this));},execute:function(){if(this.polling_){this.stop();}
this.render_();if(gapi.analytics.auth.isAuthorized()){this.pollActiveUsers_();}else{gapi.analytics.auth.once('signIn',this.pollActiveUsers_.bind(this));}},stop:function(){clearTimeout(this.timeout_);this.polling_=false;this.emit('stop',{activeUsers:this.activeUsers});},render_:function(){var opts=this.get();this.container=typeof opts.container==='string'?document.getElementById(opts.container):opts.container;this.container.innerHTML=opts.template||this.template;this.container.querySelector('b').innerHTML=this.activeUsers;},pollActiveUsers_:function(){var options=this.get();var pollingInterval=(options.pollingInterval||5)*1000;if(isNaN(pollingInterval)||pollingInterval<5000){throw new Error('Frequency must be 5 seconds or more.');}
this.polling_=true;gapi.client.analytics.data.realtime.get({ids:options.ids,metrics:'rt:activeUsers'}).then(function(response){var result=response.result;var newValue=result.totalResults?+result.rows[0][0]:0;var oldValue=this.activeUsers;this.emit('success',{activeUsers:this.activeUsers});if(newValue!==oldValue){this.activeUsers=newValue;this.onChange_(newValue-oldValue);}
if(this.polling_){this.timeout_=setTimeout(this.pollActiveUsers_.bind(this),pollingInterval);}}.bind(this));},onChange_:function(delta){var valueContainer=this.container.querySelector('b');if(valueContainer){valueContainer.innerHTML=this.activeUsers;}
this.emit('change',{activeUsers:this.activeUsers,delta:delta});if(delta>0){this.emit('increase',{activeUsers:this.activeUsers,delta:delta});}else{this.emit('decrease',{activeUsers:this.activeUsers,delta:delta});}},handleSignOut_:function(){this.stop();gapi.analytics.auth.once('signIn',this.handleSignIn_.bind(this));},handleSignIn_:function(){this.pollActiveUsers_();gapi.analytics.auth.once('signOut',this.handleSignOut_.bind(this));},template:'<div class="ActiveUsers">'+'Active Users: <b class="ActiveUsers-value"></b>'+'</div>'});},addLoader:function(selector){var loader='<span class="fa fa-3x fa-spin fa-spinner fa-pulse"/>';selector.html("<div class='o_loader'>"+loader+"</div>");},getDate:function(d){return new Date(d[0]);},getValue:function(d){return d[1];},getPrunedTickValues:function(ticks,nb_desired_ticks){var nb_values=ticks.length;var keep_one_of=Math.max(1,Math.floor(nb_values/nb_desired_ticks));return _.filter(ticks,function(d,i){return i%keep_one_of===0;});},format_number:function(value,symbol){value=utils.human_number(value);if(symbol==='currency'){return this.render_monetary_field(value,this.currency_id);}else{return value+(symbol||'');}},render_monetary_field:function(value,currency_id){var currency=session.get_currency(currency_id);if(currency){if(currency.position==="after"){value+=currency.symbol;}else{value=currency.symbol+value;}}
return value;},});core.action_registry.add('backend_dashboard',Dashboard);return Dashboard;});;

/* /account/static/src/js/account_reconciliation_widgets.js defined in bundle 'web.assets_backend' */
odoo.define('account.reconciliation',function(require){"use strict";var ActionManager=require('web.ActionManager');var ControlPanelMixin=require('web.ControlPanelMixin');var core=require('web.core');var utils=require('web.utils');var CrashManager=require('web.CrashManager');var data=require('web.data');var Dialog=require('web.Dialog');var formats=require('web.formats');var FormView=require('web.FormView');var ListView=require('web.ListView');var Model=require('web.Model');var pyeval=require('web.pyeval');var web_client=require('web.web_client');var parse_value=require('web.web_client');var Widget=require('web.Widget');var session=require('web.session');var FieldMany2One=core.form_widget_registry.get('many2one');var FieldChar=core.form_widget_registry.get('char');var FieldFloat=core.form_widget_registry.get('float');var _t=core._t;var QWeb=core.qweb;var bus=core.bus;function defaultIfUndef(variable,defaultValue){return variable===undefined?defaultValue:variable;}
var abstractReconciliation=Widget.extend(ControlPanelMixin,{className:'o_reconciliation',events:{"click *[rel='do_action']":"doActionClickHandler","click .presets_config_create":"presetConfigCreateClickHandler","click .presets_config_edit":"presetConfigEditClickHandler",},init:function(parent,context){this._super(parent);this.lines_reconciled_with_ctrl_enter=0;this.time_widget_loaded=Date.now();this.action_manager=this.findAncestor(function(ancestor){return ancestor instanceof ActionManager});this.crash_manager=new CrashManager();this.formatCurrencies;this.model_res_users=new Model("res.users");this.model_tax=new Model("account.tax");this.model_presets=new Model("account.reconcile.model");this.max_move_lines_displayed=5;this.num_reconciliations_fetched_in_batch=10;this.animation_speed=100;this.aestetic_animation_speed=300;this.map_account_id_code={};this.presets={};var domain_account_id=[['deprecated','=',false]];if(context&&context.context&&context.context.company_ids){domain_account_id.push(['company_id','in',context.context.company_ids]);}
this.create_form_fields={account_id:{id:"account_id",index:0,corresponding_property:"account_id",label:_t("Account"),required:true,constructor:FieldMany2One,field_properties:{relation:"account.account",string:_t("Account"),type:"many2one",domain:domain_account_id,},},label:{id:"label",index:5,corresponding_property:"label",label:_t("Label"),required:true,constructor:FieldChar,field_properties:{string:_t("Label"),type:"char",},},tax_id:{id:"tax_id",index:10,corresponding_property:"tax_id",label:_t("Tax"),required:false,constructor:FieldMany2One,field_properties:{relation:"account.tax",string:_t("Tax"),type:"many2one",domain:[['type_tax_use','!=','none']],},},amount:{id:"amount",index:15,corresponding_property:"amount",label:_t("Amount"),required:true,constructor:FieldFloat,field_properties:{string:_t("Amount"),type:"float",},},analytic_account_id:{id:"analytic_account_id",index:20,corresponding_property:"analytic_account_id",label:_t("Analytic Acc."),required:false,group:"analytic.group_analytic_accounting",constructor:FieldMany2One,field_properties:{relation:"account.analytic.account",string:_t("Analytic Acc."),type:"many2one",},},};},start:function(){var self=this;return $.when(this._super()).then(function(){var deferred_promises=[];deferred_promises.push(new Model("account.account").query(['id','code']).all().then(function(data){_.each(data,function(o){self.map_account_id_code[o.id]=o.code});}));deferred_promises.push(self.fetchPresets());deferred_promises.push(new Model("res.currency").call("get_format_currencies_js_function").then(function(data){self.formatCurrencies=new Function("amount, currency_id",data);}));bus.on("keypress","body",function(e){self.keyboardShortcutsHandler(e);});self.update_cp();return $.when.apply($,deferred_promises);});},fetchPresets:function(){var self=this;var deferred_last_update=self.model_presets.query(['write_date']).order_by('-write_date').first().then(function(data){self.presets_last_write_date=(data?data.write_date:undefined);});var deferred_presets=self.model_presets.query().order_by('-sequence','-id').all().then(function(data){self.presets={};_(data).each(function(datum){var preset={id:datum.id,name:datum.name,sequence:datum.sequence,lines:[{account_id:datum.account_id,journal_id:datum.journal_id,label:datum.label,amount_type:datum.amount_type,amount:datum.amount,tax_id:datum.tax_id,analytic_account_id:datum.analytic_account_id}]};if(datum.has_second_line){preset.lines.push({account_id:datum.second_account_id,journal_id:datum.second_journal_id,label:datum.second_label,amount_type:datum.second_amount_type,amount:datum.second_amount,tax_id:datum.second_tax_id,analytic_account_id:datum.second_analytic_account_id});}
self.presets[datum.id]=preset;});});return $.when(deferred_last_update,deferred_presets);},do_show:function(){var self=this;var super_call=_.bind(this._super,this);self.model_presets.query(['write_date']).order_by('-write_date').first().then(function(data){if(!data||data.write_date!=self.presets_last_write_date){self.fetchPresets().then(function(){_.each(self.getChildren(),function(child){child.set("presets",self.presets);});});}
super_call();});self.update_cp();},update_cp:function(){var self=this;self.update_control_panel({breadcrumbs:self.action_manager.get_breadcrumbs(),});},doActionClickHandler:function(e){e.preventDefault();var name=e.currentTarget.dataset.action_nam;var model=e.currentTarget.dataset.model;var ids=e.currentTarget.dataset.ids.split(",").map(Number);this.action_manager.do_action({name:name,res_model:model,domain:[['id','in',ids]],views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',view_type:"list",view_mode:"list"});},presetConfigCreateClickHandler:function(e){e.preventDefault();var self=this;return self.rpc("/web/action/load",{action_id:"account.action_account_reconcile_model"}).then(function(result){result.views=[[false,"form"],[false,"list"]];return self.do_action(result);});},presetConfigEditClickHandler:function(e){e.preventDefault();var self=this;return self.rpc("/web/action/load",{action_id:"account.action_account_reconcile_model"}).then(function(result){result.views=[[false,"list"],[false,"form"]];return self.do_action(result);});},displayNotifications:function(notifications,speed){speed=defaultIfUndef(speed,this.aestetic_animation_speed)
for(var i=0;i<notifications.length;i++){var $notification=$(QWeb.render("reconciliation_notification",{type:notifications[i].type,message:notifications[i].message,details:notifications[i].details,})).hide();$notification.appendTo(this.$(".notification_area")).slideDown(speed);}},renderPresetsButtons:function(presets){var presets_array=[];for(var id in presets)
if(presets.hasOwnProperty(id))
presets_array.push(presets[id]);presets_array=_.sortBy(presets_array,function(o){return o.sequence});var temp=$("<div class='quick_add'><div class='btn-group btn-group-sm sandbox_lillibullero'></div></div>").appendTo(this.$el);var sandbox_dom=this.$(".sandbox_lillibullero");var dropdown_width=$(QWeb.render("presets_dropdown",{presets:[]})).appendTo(sandbox_dom).outerWidth();var max_width=540;var total_width=0;var html="";while(presets_array.length>0){var preset=presets_array[0];var preset_html=QWeb.render("preset_button",{id:preset.id,name:preset.name});var actual_max_width=(presets_array.length===1?max_width:max_width-dropdown_width);total_width+=$(preset_html).appendTo(sandbox_dom).outerWidth();if(total_width<actual_max_width){html+=preset_html;presets_array.shift();}else{break;}}
if(presets_array.length>0){html+=QWeb.render("presets_dropdown",{presets:presets_array});}
temp.remove();return html;},keyboardShortcutsHandler:function(e){var self=this;if((e.which===13||e.which===10)&&(e.ctrlKey||e.metaKey)){self.processReconciliations(_.filter(self.getChildren(),function(o){return self.monetaryIsZero(o.get("balance"));}));}},processReconciliations:function(reconciliations){},displayReconciliation:function(){},childValidated:function(child){},displayDoneMessage:function(){},updateProgressbar:function(){},decorateMoveLine:function(line){line.partial_reconcile=false;line.propose_partial_reconcile=false;line.q_due_date=(line.date_maturity===false?line.date:line.date_maturity);line.q_amount=(line.debit!==0?line.q_debit:"")+(line.credit!==0?line.q_credit:"");line.q_label=line.name;var template_name=(QWeb.has_template(this.template_prefix+"reconciliation_move_line_details")?this.template_prefix:"")+"reconciliation_move_line_details";line.q_popover=QWeb.render(template_name,{line:line});if(line.ref&&line.ref!==line.name)
line.q_label=line.q_label+" : "+line.ref;},monetaryIsZero:function(amount,digits){return utils.float_is_zero(amount,digits===undefined?4:digits);},});var abstractReconciliationLine=Widget.extend({className:'o_reconciliation_line',events:{"click .mv_line":"moveLineClickHandler","click .created_line":"createdLineClickHandler","click .pager_control_left:not(.disabled)":"pagerControlLeftHandler","click .pager_control_right:not(.disabled)":"pagerControlRightHandler","keyup .filter":"filterHandler","click .add_line":"addLineBeingEdited","click .preset":"presetClickHandler","click .line_info_button":function(e){e.stopPropagation()},"mousedown *[tabindex='0']":function(e){e.preventDefault()},},init:function(parent,context){this._super(parent);var self=this;this.decorateMoveLine=this.getParent().decorateMoveLine;this.formatCurrencies=this.getParent().formatCurrencies;this.monetaryIsZero=this.getParent().monetaryIsZero;this.renderPresetsButtons=this.getParent().renderPresetsButtons;if(context.initial_data_provided===true&&(context.reconciliation_proposition===undefined||context.line===undefined))
console.error("[Warning] bankStatementReconciliationLine instanciated with incorrect context.");if(context.initial_data_provided){this.partner_id=context.line.partner_id;_.each(context.reconciliation_proposition,function(line){self.decorateMoveLine(line);},this);this.set("mv_lines_selected",context.reconciliation_proposition);}else{this.set("mv_lines_selected",[]);}
this.context=context;this.max_move_lines_displayed=this.getParent().max_move_lines_displayed;this.animation_speed=this.getParent().animation_speed;this.aestetic_animation_speed=this.getParent().aestetic_animation_speed;this.model_res_users=this.getParent().model_res_users;this.model_tax=this.getParent().model_tax;this.map_account_id_code=this.getParent().map_account_id_code;this.is_valid=true;this.is_consistent=true;this.can_fetch_more_move_lines;this.filter="";this.finishedLoadingMoveLines;this.set("presets",this.getParent().presets);this.on("change:presets",this,this.presetsChanged);this.set("mode",undefined);this.on("change:mode",this,this.modeChanged);this.set("balance",undefined);this.on("change:balance",this,this.balanceChanged);this.set("pager_index",0);this.on("change:pager_index",this,this.pagerChanged);this.set("mv_lines",[]);this.on("change:mv_lines",this,this.mvLinesChanged);this.mv_lines_deselected=[];this.on("change:mv_lines_selected",this,this.mvLinesSelectedChanged);this.set("lines_created",[]);this.set("line_created_being_edited",[{'id':0}]);this.on("change:lines_created",this,this.createdLinesChanged);this.on("change:line_created_being_edited",this,this.createdLinesChanged);},start:function(){var self=this;return self._super().then(function(){self.animation_speed=0;self.aestetic_animation_speed=0;self.is_consistent=false;if(self.context.animate_entrance){self.$el.fadeOut(0);self.$el.slideUp(0);}
return $.when(self.loadData()).then(function(){return $.when(self.render()).then(function(){self.is_consistent=true;self.animation_speed=self.getParent().animation_speed;self.aestetic_animation_speed=self.getParent().aestetic_animation_speed;if(self.context.animate_entrance){return self.$el.stop(true,true).fadeIn({duration:self.aestetic_animation_speed,queue:false}).css('display','none').slideDown(self.aestetic_animation_speed);}});});});},loadData:function(){},render:function(){},createFormWidgets:function(){var self=this;var create_form_fields=self.getParent().create_form_fields;var create_form_fields_arr=[];for(var key in create_form_fields)
if(create_form_fields.hasOwnProperty(key))
create_form_fields_arr.push(create_form_fields[key]);create_form_fields_arr.sort(function(a,b){return a.index-b.index});var dataset=new data.DataSet(this,"account.account",self.context);dataset.ids=[];var fields_view={};fields_view.arch={attrs:{string:"Stéphanie de Monaco",version:"7.0",class:"oe_form_container o_form_container"},children:[],tag:"form"};self.field_manager=new FormView(this,dataset,fields_view,{initial_mode:'edit',disable_autofocus:false,$buttons:$(),$pager:$()});self.field_manager.appendTo(document.createDocumentFragment());var Default_field=function(){this.context={};this.domain=[];this.help="";this.readonly=false;this.required=true;this.selectable=true;this.states={};this.views={};};var Default_node=function(field_name){this.tag="field";this.children=[];this.required=true;this.attrs={invisible:"False",modifiers:'{"required":true}',name:field_name,nolabel:"True",};};self.field_manager.fields_view.fields={};for(var i=0;i<create_form_fields_arr.length;i++){self.field_manager.fields_view.fields[create_form_fields_arr[i].id]=_.extend(new Default_field(),create_form_fields_arr[i].field_properties);}
var hideGroupResponseClosureFactory=function(field_widget,$container,obj_key){return function(has_group){if(has_group)$container[0].style.removeProperty('display');else{field_widget.destroy();$container.remove();delete self[obj_key];}};};self.create_form=[];for(var i=0;i<create_form_fields_arr.length;i++){var field_data=create_form_fields_arr[i];var node=new Default_node(field_data.id);if(!field_data.required)node.attrs.modifiers="";var field=new field_data.constructor(self.field_manager,node);self[field_data.id+"_field"]=field;self.create_form.push(field);field.corresponding_property=field_data.corresponding_property;field.on("change:value",self,self.formCreateInputChanged);var $field_container=$(QWeb.render("form_create_field",{id:field_data.id,label:field_data.label}));field.appendTo($field_container.find(".o_td_field"));self.$(".create_group_"+(i%2===0?"left":"right")).append($field_container);if(field_data.field_properties.type!=="many2one"){field.$el.find('input').andSelf().filter('input').keyup(function(){this.store_dom_value();}.bind(field));}
if(field_data.group!==undefined){var target=$field_container;target.hide();self.model_res_users.call("has_group",[field_data.group]).then(hideGroupResponseClosureFactory(field,target,(field_data.id+"_field")));}}
self.field_manager.do_show();},bindPopoverTo:function(el){var self=this;$(el).addClass("bootstrap_popover");el.popover({'placement':'left','container':self.el,'html':true,'trigger':'hover','animation':false,'toggle':'popover'});},islineCreatedBeingEditedValid:function(){var line=this.get("line_created_being_edited")[0];return line.amount&&line.account_id&&line.label;},getCreatedLines:function(){var self=this;var created_lines=self.get("lines_created").slice();if(self.islineCreatedBeingEditedValid())
return created_lines.concat(self.get("line_created_being_edited"));else
return created_lines;},moveLineClickHandler:function(e){var self=this;if(e.currentTarget.dataset.selected==="true")self.deselectMoveLine(e.currentTarget);else self.selectMoveLine(e.currentTarget);},selectMoveLine:function(mv_line){var self=this;var line_id=mv_line.dataset.lineid;var line=_.find(self.get("mv_lines"),function(o){return o.id==line_id});if(!line){line=_.find(self.mv_lines_deselected,function(o){return o.id==line_id});self.mv_lines_deselected=_.filter(self.mv_lines_deselected,function(o){return o.id!=line_id});}
if(!line)return;return line;},deselectMoveLine:function(mv_line){var self=this;var line_id=mv_line.dataset.lineid;var line=_.find(self.get("mv_lines_selected"),function(o){return o.id==line_id});if(!line)return;$(mv_line).attr('data-selected','false');self.mv_lines_deselected.unshift(line);self.set("mv_lines_selected",_.filter(self.get("mv_lines_selected"),function(o){return o.id!=line_id}));self.$el.removeClass("no_match");self.set("mode","match");return line;},pagerControlLeftHandler:function(){var self=this;if(self.$(".pager_control_left").hasClass("disabled")){return;}
if(self.get("pager_index")===0){return;}
self.set("pager_index",self.get("pager_index")-1);},pagerControlRightHandler:function(){var self=this;var new_index=self.get("pager_index")+1;if(self.$(".pager_control_right").hasClass("disabled")){return;}
if(!self.can_fetch_more_move_lines){return;}
self.set("pager_index",new_index);},filterHandler:function(){var self=this;self.set("pager_index",0);self.filter=self.$(".filter").val();window.clearTimeout(self.apply_filter_timeout);self.apply_filter_timeout=window.setTimeout(self.proxy('updateMatches'),200);},initializeCreateForm:function(){var self=this;_.each(self.create_form,function(field){field.set("value",false);});self.amount_field.set("value",-1*self.get("balance"));self.account_id_field.focus();},addLineBeingEdited:function(){var self=this;if(!self.islineCreatedBeingEditedValid())return;self.set("lines_created",self.get("lines_created").concat(self.get("line_created_being_edited")));var new_id=self.get("line_created_being_edited")[0].id+1;self.set("line_created_being_edited",[{'id':new_id}]);self.initializeCreateForm();},createdLineClickHandler:function(e){this.removeLine($(e.currentTarget));},removeLine:function($line){var self=this;var line_id=$line.data("lineid");if(line_id===self.get("line_created_being_edited")[0].id){self.addLineBeingEdited();}
self.set("lines_created",_.filter(self.get("lines_created"),function(o){return o.id!=line_id}));self.amount_field.set("value",-1*self.get("balance"));},presetClickHandler:function(e){var self=this;var preset=this.get("presets")[e.currentTarget.dataset.presetid];for(var i=0;i<preset.lines.length;i++){self.addLineBeingEdited();self.applyPresetLine(preset.lines[i]);}},applyPresetLine:function(preset_line){var self=this;self.initializeCreateForm();if(preset_line.tax&&self.tax_field)self.tax_field.set_value(false);if(preset_line.amount&&self.amount_field)self.amount_field.set_value(false);for(var key in preset_line){if(!preset_line.hasOwnProperty(key)||key==="amount")continue;if(preset_line[key]&&self.hasOwnProperty(key+"_field"))
self[key+"_field"].set_value(preset_line[key]);}
if(preset_line.amount&&self.amount_field){if(preset_line.amount_type==="fixed")
self.amount_field.set_value(preset_line.amount);else if(preset_line.amount_type==="percentage"){self.amount_field.set_value(0);self.updateBalance();self.amount_field.set_value(-1*self.get("balance")*preset_line.amount/100);}}},updateAccountingViewMatchedLines:function(){var self=this;$.each(self.$(".tbody_matched_lines .bootstrap_popover"),function(){$(this).popover('destroy')});self.$(".tbody_matched_lines").empty();var template_name=(QWeb.has_template(this.template_prefix+"reconciliation_move_line")?this.template_prefix:"")+"reconciliation_move_line";_(self.get("mv_lines_selected")).each(function(line){line.amount_str=self.formatCurrencies(Math.abs(line.debit+line.credit),self.get("currency_id"));var $line=$(QWeb.render(template_name,{line:line,selected:true}));self.bindPopoverTo($line.find(".line_info_button"));if(line.propose_partial_reconcile)self.bindPopoverTo($line.find(".do_partial_reconcile_button"));if(line.partial_reconcile)self.bindPopoverTo($line.find(".undo_partial_reconcile_button"));self.$(".tbody_matched_lines").append($line);});},updateAccountingViewCreatedLines:function(){var self=this;$.each(self.$(".tbody_created_lines .bootstrap_popover"),function(){$(this).popover('destroy')});self.$(".tbody_created_lines").empty();var template_name=(QWeb.has_template(this.template_prefix+"reconciliation_created_line")?this.template_prefix:"")+"reconciliation_created_line";var previous_line=undefined;_(self.getCreatedLines()).each(function(line){line.amount_str=self.formatCurrencies(Math.abs(line.amount),self.get("currency_id"));if(previous_line!==undefined&&self.monetaryIsZero(line.amount)&&previous_line.id===line.id)
line.amount=0.000001*(previous_line.amount<0?-1:1);var $line=$(QWeb.render(template_name,{line:line}));self.$(".tbody_created_lines").append($line);if(line.no_remove_action){var $first_line=self.$(".tbody_created_lines .created_line[data-lineid='"+line.id+"']").first();$line.hover(function(){this.addClass("active")}.bind($first_line),function(){this.removeClass("active")}.bind($first_line));}
previous_line=line;});},updateMatchView:function(){var self=this;var table=self.$(".match table");var nothing_displayed=true;var template_name=(QWeb.has_template(this.template_prefix+"reconciliation_move_line")?this.template_prefix:"")+"reconciliation_move_line";$.each(self.$(".match table .bootstrap_popover"),function(){$(this).popover('destroy')});table.empty();var slice_start=self.get("pager_index")*self.max_move_lines_displayed;var slice_end=(self.get("pager_index")+1)*self.max_move_lines_displayed;_(_.filter(self.mv_lines_deselected,function(o){var floatFromFilter=false;try{floatFromFilter=parse_value(self.filter,{type:'float'});}catch(e){}
return o.name.indexOf(self.filter)!==-1||(o.ref&&o.ref.indexOf(self.filter)!==-1)||(isFinite(floatFromFilter)&&(o.debit===floatFromFilter||o.credit===floatFromFilter||o.debit_currency===floatFromFilter||o.credit_currency===floatFromFilter))}).slice(slice_start,slice_end)).each(function(line){var $line=$(QWeb.render(template_name,{line:line,selected:false}));self.bindPopoverTo($line.find(".line_info_button"));table.append($line);nothing_displayed=false;});_(self.get("mv_lines")).each(function(line){var $line=$(QWeb.render(template_name,{line:line,selected:false}));self.bindPopoverTo($line.find(".line_info_button"));table.append($line);nothing_displayed=false;});if(nothing_displayed&&this.filter!=="")
table.append(QWeb.render("filter_no_match",{filter_str:self.filter}));},updatePagerControls:function(){var self=this;if(self.get("pager_index")===0)
self.$(".pager_control_left").addClass("disabled");else
self.$(".pager_control_left").removeClass("disabled");if(!self.can_fetch_more_move_lines)
self.$(".pager_control_right").addClass("disabled");else
self.$(".pager_control_right").removeClass("disabled");},lineOpenBalanceClickHandler:function(){var self=this;if(self.get("mode")==="create"){self.set("mode","match");}else{self.set("mode","create");}},balanceChanged:function(){},presetsChanged:function(){if($.isEmptyObject(this.get("presets"))){this.$(".quick_add").hide();}else{this.$(".presets_container").html(this.renderPresetsButtons(this.get("presets")));this.$(".quick_add").show();}},modeChanged:function(o,val){var self=this;self.$(".action_pane.active").removeClass("active");if(val.oldValue==="create")
self.addLineBeingEdited();if(self.get("mode")==="inactive"){self.$(".match").slideUp(self.animation_speed);self.$(".create").slideUp(self.animation_speed);self.el.dataset.mode="inactive";if(self.finishedLoadingMoveLines)self.finishedLoadingMoveLines.resolve();}else if(self.get("mode")==="match"){self.updateMatches().then(function(){if(self.$el.hasClass("no_match")){self.$(".create").stop(true,false);self.set("mode","create");return;}
self.$(".match").slideDown(self.animation_speed);self.$(".create").slideUp(self.animation_speed);self.el.dataset.mode="match";if(self.finishedLoadingMoveLines)self.finishedLoadingMoveLines.resolve();});}else if(self.get("mode")==="create"){self.initializeCreateForm();self.$(".match").slideUp(self.animation_speed);self.$(".create").slideDown(self.animation_speed);self.el.dataset.mode="create";if(self.finishedLoadingMoveLines)self.finishedLoadingMoveLines.resolve();}},pagerChanged:function(){this.updateMatches();},mvLinesChanged:function(){var self=this;if(self.get("pager_index")!==0&&self.get("mv_lines").length===0&&!self.can_fetch_more_move_lines){self.set("pager_index",0);}
if(self.get("mv_lines").length+self.mv_lines_deselected.length===0&&!self.can_fetch_more_move_lines&&self.filter===""){self.$el.addClass("no_match");if(self.get("mode")==="match"){self.set("mode","inactive");}}else{self.$el.removeClass("no_match");}
self.updateMatchView();self.updatePagerControls();},mvLinesSelectedChanged:function(elt,val){var self=this;$.when(self.updateMatches()).then(function(){self.updateAccountingViewMatchedLines();self.updateBalance();});},updateMatches:function(){var self=this;var deselected_lines_num=self.mv_lines_deselected.length;var offset=self.get("pager_index")*self.max_move_lines_displayed-deselected_lines_num;if(offset<0)offset=0;var limit=(self.get("pager_index")+1)*self.max_move_lines_displayed-deselected_lines_num;if(limit>self.max_move_lines_displayed)limit=self.max_move_lines_displayed;var excluded_ids=_.collect(self.get("mv_lines_selected").concat(self.mv_lines_deselected),function(o){return o.id;});limit+=1;if(limit>0)
return self.updateMatchesGetMvLines(excluded_ids,offset,limit,function(move_lines){self.can_fetch_more_move_lines=(move_lines.length===limit);self.set("mv_lines",move_lines.slice(0,limit-1));});else
self.set("mv_lines",[]);},updateMatchesGetMvLines:function(excluded_ids,offset,limit,callback){},formCreateInputChanged:function(elt,val){var self=this;var line_created_being_edited=self.get("line_created_being_edited");line_created_being_edited[0][elt.corresponding_property]=val.newValue;if(elt===self.account_id_field)
line_created_being_edited[0].account_num=self.map_account_id_code[elt.get("value")];var deferred_tax=new $.Deferred();if(elt===self.tax_id_field||elt===self.amount_field){var amount=self.amount_field.get("value");var tax_id=self.tax_id_field.get("value");if(amount&&tax_id){deferred_tax=self.model_tax.call("json_friendly_compute_all",[[tax_id],amount,self.get("currency_id")]).then(function(data){line_created_being_edited.length=1;line_created_being_edited[0].amount_before_tax=amount;line_created_being_edited[0].amount=data.total_excluded;$.each(data.taxes,function(index,tax){var tax_account_id=(amount>0?tax.account_id:tax.refund_account_id);tax_account_id=tax_account_id!==false?tax_account_id:line_created_being_edited[0].account_id;line_created_being_edited.push({id:line_created_being_edited[0].id,account_id:tax_account_id,account_num:self.map_account_id_code[tax_account_id],label:tax.name,amount:tax.amount,no_remove_action:true,is_tax_line:true});});});}else{line_created_being_edited.length=1;deferred_tax.resolve();}}else{deferred_tax.resolve();}
return deferred_tax.then(function(){self.set("line_created_being_edited",line_created_being_edited);self.createdLinesChanged();});},createdLinesChanged:function(){var self=this;self.updateAccountingViewCreatedLines();self.updateBalance();if(self.islineCreatedBeingEditedValid())self.$(".add_line").show();else self.$(".add_line").hide();},updateBalance:function(){var self=this;var balance=0;var mv_lines_selected=self.get("mv_lines_selected");_.each(mv_lines_selected,function(o){balance=balance-o.debit+o.credit;});_.each(self.getCreatedLines(),function(o){balance+=o.amount;});balance=Math.round(balance*1000)/1000;self.set("balance",balance);},prepareCreatedMoveLinesForPersisting:function(lines){lines=_.filter(lines,function(line){return!line.is_tax_line});return _.collect(lines,function(line){var dict={account_id:line.account_id,name:line.label};var amount=line.tax_id?line.amount_before_tax:line.amount;dict['credit']=(amount>0?amount:0);dict['debit']=(amount<0?-1*amount:0);if(line.tax_id)dict['tax_ids']=[[4,line.tax_id,null]];if(line.analytic_account_id)dict['analytic_account_id']=line.analytic_account_id;return dict;});},bowOut:function(speed,doPostMortemProcess){speed=defaultIfUndef(speed,this.animation_speed);if(doPostMortemProcess)
var postMortemProcess=this.getPostMortemProcess();var self=this;var height=self.$el.outerHeight();var container=$("<div />");container.css("height",height).css("marginTop",self.$el.css("marginTop")).css("marginBottom",self.$el.css("marginBottom"));self.$el.wrap(container);return $.when(self.$el.parent().animate({height:0,marginBottom:0},speed*height/150)).then(function(){$.each(self.$(".bootstrap_popover"),function(){$(this).popover('destroy')});_.each(self.getChildren(),function(o){o.destroy()});self.$el.parent().remove();return $.when(self.destroy()).then(function(){if(doPostMortemProcess)
postMortemProcess.call(self);});});},getPostMortemProcess:function(){},});var bankStatementReconciliation=abstractReconciliation.extend({className:abstractReconciliation.prototype.className+' o_bank_statement_reconciliation',events:_.defaults({"click .statement_name span":"statementNameClickHandler","keyup .change_statement_name_field":"changeStatementNameFieldHandler","click .change_statement_name_button":"changeStatementButtonClickHandler","click .show_more":"showMoreButtonClickHandler",},abstractReconciliation.prototype.events),init:function(parent,context){this.children_widget=bankStatementReconciliationLine;this.template_prefix="bank_statement_";this._super(parent,context);if(context.context.statement_id)this.statement_ids=[context.context.statement_id];if(context.context.statement_ids)this.statement_ids=context.context.statement_ids;this.single_statement=this.statement_ids!==undefined&&this.statement_ids.length===1;this.multiple_statements=this.statement_ids!==undefined&&this.statement_ids.length>1;this.title=context.context.title||_t("Bank Reconciliation");context.display_name=this.title;this.notifications=context.context.notifications||[];this.lines=[];this.last_displayed_reconciliation_index=undefined;this.reconciled_lines=0;this.num_already_reconciled_lines=0;this.model_bank_statement=new Model("account.bank.statement");this.model_bank_statement_line=new Model("account.bank.statement.line");this.reconciliation_menu_id=false;this.excluded_move_lines_ids={};this.widget_childrens=[];},serverPreprocessResultHandler:function(data){this.num_already_reconciled_lines=data.num_already_reconciled_lines;this.notifications=this.notifications.concat(data.notifications);this.lines=data.st_lines_ids;if(this.single_statement&&data.statement_name)
this.title=data.statement_name;},start:function(){var self=this;return $.when(this._super()).then(function(){var deferred_promises=[];deferred_promises.push(self.model_bank_statement.call("reconciliation_widget_preprocess",[self.statement_ids||undefined]).then(function(data){self.serverPreprocessResultHandler(data)}));deferred_promises.push(new Model("ir.model.data").call("xmlid_to_res_id",["account.menu_bank_reconcile_bank_statements"]).then(function(data){self.reconciliation_menu_id=data;self.doReloadMenuReconciliation();}));return $.when.apply($,deferred_promises).then(function(){if(self.lines.length===0&&!self.statement_ids){self.$el.prepend(QWeb.render("bank_statement_nothing_to_reconcile"));if(self.notifications)
self.displayNotifications(self.notifications);return;}
self.$el.prepend(QWeb.render("bank_statement_reconciliation",{title:self.title,single_statement:self.single_statement,total_lines:self.num_already_reconciled_lines+self.lines.length}));self.$el.find('.js_automatic_reconciliation').click(function(){self.model_bank_statement_line.call("reconciliation_widget_auto_reconcile",[self.lines||undefined,self.num_already_reconciled_lines]).then(function(data){self.serverPreprocessResultHandler(data);}).then(function(){self.$('.js_automatic_reconciliation').hide();return self.display_reconciliation_propositions();});});return self.display_reconciliation_propositions();});});},display_reconciliation_propositions:function(){var self=this;self.updateProgressbar();var reconciliations_to_show=self.lines.slice(0,self.num_reconciliations_fetched_in_batch);self.last_displayed_reconciliation_index=reconciliations_to_show.length;self.$(".reconciliation_lines_container").css("opacity",0);$.each(self.widget_childrens,function(index,child){child.destroy();});if(self.lines.length===0){self.$(".reconciliation_lines_container").hide();if(self.notifications)
self.displayNotifications(self.notifications,0);self.displayDoneMessage(true);return;}
return self.model_bank_statement_line.call("get_data_for_reconciliation_widget",[reconciliations_to_show]).then(function(data){var child_promises=[];var datum=data.shift();if(datum!==undefined)
child_promises.push(self.displayReconciliation(datum.st_line.id,'match',false,true,datum.st_line,datum.reconciliation_proposition));while((datum=data.shift())!==undefined)
child_promises.push(self.displayReconciliation(datum.st_line.id,'inactive',false,true,datum.st_line,datum.reconciliation_proposition));$.when.apply($,child_promises).then(function(){self.$(".reconciliation_lines_container").animate({opacity:1},self.aestetic_animation_speed,function(){if(self.notifications){self.displayNotifications(self.notifications);self.updateShowMoreButton();}});});});},statementNameClickHandler:function(){if(!this.single_statement)return;this.$(".statement_name span").hide();this.$(".change_statement_name_field").attr("value",this.title);this.$(".change_statement_name_container").show();this.$(".change_statement_name_field").focus();},changeStatementNameFieldHandler:function(e){var name=this.$(".change_statement_name_field").val();if(name==="")this.$(".change_statement_name_button").attr("disabled","disabled");else this.$(".change_statement_name_button").removeAttr("disabled");if(name!==""&&e.which===13)
this.$(".change_statement_name_button").trigger("click");if(e.which===27){this.$(".statement_name span").show();this.$(".change_statement_name_container").hide();}},changeStatementButtonClickHandler:function(){var self=this;if(!self.single_statement)return;var name=self.$(".change_statement_name_field").val();if(name==="")return;self.$(".change_statement_name_button").attr("disabled","disabled");return self.model_bank_statement.call("write",[[self.statement_ids[0]],{'name':name}]).done(function(){self.title=name;self.$(".statement_name span").text(name).show();self.$(".change_statement_name_container").hide();}).always(function(){self.$(".change_statement_name_button").removeAttr("disabled");});},updateProgressbar:function(){var self=this;var done=self.num_already_reconciled_lines+self.reconciled_lines;var total=self.num_already_reconciled_lines+self.lines.length;var prog_bar=self.$(".progress .progress-bar");prog_bar.attr("aria-valuenow",done);prog_bar.css("width",(done/total*100)+"%");self.$(".progress .progress-text .valuenow").text(done);},processReconciliations:function(reconciliations){if(reconciliations.length===0)return;var self=this;var ids=_.collect(reconciliations,function(o){return o.line_id});var data=_.collect(reconciliations,function(o){return o.prepareDataForPersisting()});var deferred_animation=self.$(".reconciliation_lines_container, .show_more_container").fadeOut(self.aestetic_animation_speed);var deferred_rpc=self.model_bank_statement_line.call("process_reconciliations",[ids,data]);return $.when(deferred_animation,deferred_rpc).done(function(){for(var i=0;i<reconciliations.length;i++)
reconciliations[i].bowOut(0,false);self.lines_reconciled_with_ctrl_enter+=reconciliations.length;self.reconciled_lines+=reconciliations.length;self.updateProgressbar();self.doReloadMenuReconciliation();if(self.last_displayed_reconciliation_index<self.lines.length){return self.displayReconciliations(self.num_reconciliations_fetched_in_batch).then(function(){if(self.reconciled_lines!==self.lines.length){var first_child=self.getChildren()[0];if(first_child.get("mode")==="inactive"){first_child.set("mode","match");}}
self.$(".reconciliation_lines_container, .show_more_container").fadeIn(self.aestetic_animation_speed);});}else if(self.reconciled_lines===self.lines.length){self.displayDoneMessage(false);}else{self.$(".reconciliation_lines_container, .show_more_container").fadeIn(self.aestetic_animation_speed);}}).fail(function(){self.$(".reconciliation_lines_container, .show_more_container").fadeIn(self.aestetic_animation_speed);});},displayReconciliation:function(line_id,mode,animate_entrance,initial_data_provided,line,reconciliation_proposition){var self=this;animate_entrance=defaultIfUndef(animate_entrance,true);initial_data_provided=defaultIfUndef(initial_data_provided,false);var context={line_id:line_id,mode:mode,animate_entrance:animate_entrance,initial_data_provided:initial_data_provided,line:initial_data_provided?line:undefined,reconciliation_proposition:initial_data_provided?reconciliation_proposition:undefined,};var widget=new self.children_widget(self,context);this.widget_childrens.push(widget);return widget.appendTo(self.$(".reconciliation_lines_container"));},excludeMoveLines:function(source_child,partner_id,lines){var self=this;var line_ids=_.collect(lines,function(o){return o.id});var excluded_ids=this.excluded_move_lines_ids[partner_id];var excluded_move_lines_changed=false;_.each(line_ids,function(line_id){if(excluded_ids.indexOf(line_id)===-1){excluded_ids.push(line_id);excluded_move_lines_changed=true;}});if(!excluded_move_lines_changed)
return;var contains_lines=function(lines_array,line_ids){for(var i=0;i<lines_array.length;i++)
for(var j=0;j<line_ids.length;j++)
if(lines_array[i].id===line_ids[j])
return true;return false;};_.each(self.getChildren(),function(child){if(child===source_child||child.st_line===undefined)return;if(child.partner_id===partner_id||child.st_line.has_no_partner){if(contains_lines(child.get("mv_lines_selected"),line_ids)){child.set("mv_lines_selected",_.filter(child.get("mv_lines_selected"),function(o){return line_ids.indexOf(o.id)===-1}));}else if(contains_lines(child.mv_lines_deselected,line_ids)){child.mv_lines_deselected=_.filter(child.mv_lines_deselected,function(o){return line_ids.indexOf(o.id)===-1});child.updateMatches();}else if(contains_lines(child.get("mv_lines"),line_ids)||child.get("mode")==="match"){child.updateMatches();}}});},unexcludeMoveLines:function(source_child,partner_id,lines){var self=this;var line_ids=_.collect(lines,function(o){return o.id});var initial_excluded_lines_num=this.excluded_move_lines_ids[partner_id].length;this.excluded_move_lines_ids[partner_id]=_.difference(this.excluded_move_lines_ids[partner_id],line_ids);if(this.excluded_move_lines_ids[partner_id].length===initial_excluded_lines_num)
return;_.each(self.getChildren(),function(child){if(child.st_line===undefined)return;if(child.partner_id===partner_id&&child!==source_child&&(child.get("mode")==="match"||child.$el.hasClass("no_match")))
child.updateMatches();if(child.st_line.has_no_partner&&child.get("mode")==="match"||child.$el.hasClass("no_match"))
child.updateMatches();});},displayReconciliations:function(number){var self=this;var begin=self.last_displayed_reconciliation_index;var end=Math.min((begin+number),self.lines.length);var reconciliations_to_show=self.lines.slice(begin,end);var excluded_move_lines_ids=[];_.each(self.excluded_move_lines_ids,function(o){excluded_move_lines_ids=excluded_move_lines_ids.concat(o);});return self.model_bank_statement_line.call("get_data_for_reconciliation_widget",[reconciliations_to_show,excluded_move_lines_ids]).then(function(data){var child_promises=[];var datum;while((datum=data.shift())!==undefined){var context={line_id:datum.st_line.id,mode:'inactive',animate_entrance:false,initial_data_provided:true,line:datum.st_line,reconciliation_proposition:datum.reconciliation_proposition,};var widget=new bankStatementReconciliationLine(self,context);child_promises.push(widget.appendTo(self.$(".reconciliation_lines_container")));}
self.last_displayed_reconciliation_index+=reconciliations_to_show.length;return $.when.apply($,child_promises).then(function(){self.updateShowMoreButton();});});},childValidated:function(child){var self=this;self.reconciled_lines++;self.updateProgressbar();self.doReloadMenuReconciliation();if(self.last_displayed_reconciliation_index<self.lines.length&&self.getChildren().length<self.num_reconciliations_fetched_in_batch){self.displayReconciliation(self.lines[self.last_displayed_reconciliation_index++],'inactive');}
if(self.reconciled_lines===self.lines.length){self.displayDoneMessage(false);}
if(self.reconciled_lines!==self.lines.length){var first_child=self.getChildren()[0];if(first_child.get("mode")==="inactive"){first_child.set("mode","match");}}
self.updateShowMoreButton();},decorateMoveLine:function(line){line['credit']=[line['debit'],line['debit']=line['credit']][0];this._super(line);if(!this.partner_id&&line.partner_name)
line.q_label=line.partner_name+" : "+line.q_label;},doReloadMenuReconciliation:function(){var menu=web_client.menu;if(!menu||!this.reconciliation_menu_id){return $.when();}
return menu.rpc("/web/menu/load_needaction",{'menu_ids':[this.reconciliation_menu_id]}).done(function(r){menu.on_needaction_loaded(r);}).then(function(){menu.trigger("need_action_reloaded");});},goBackToStatementsTreeView:function(){var self=this;new Model("ir.model.data").call("get_object_reference",['account','action_bank_statement_tree']).then(function(result){var action_id=result[1];var action_stack=self.action_manager.get_action_stack();var action=_.find(action_stack,function(action){return action.get_action_descr()&&action.get_action_descr().id===action_id;});if(action){self.action_manager.select_action(action,0);}else{self.action_manager.do_action(action_id,{clear_breadcrumbs:true});}});},displayDoneMessage:function(all_was_auto_reconciled){var self=this;if(all_was_auto_reconciled){var title=_t("There you go, it's all done !");}else{var sec_taken=Math.round((Date.now()-self.time_widget_loaded)/1000);var sec_per_item=Math.round(sec_taken/self.reconciled_lines);var achievements=[];var time_taken;if(sec_taken/60>=1)time_taken=Math.floor(sec_taken/60)+"' "+sec_taken%60+"''";else time_taken=sec_taken%60+_t(" seconds");var title;if(sec_per_item<5)title=_t("Whew, that was fast !")+" <i class='fa fa-trophy congrats_icon'></i>";else title=_t("Congrats, you're all done !")+" <i class='fa fa-thumbs-o-up congrats_icon'></i>";if(self.lines_reconciled_with_ctrl_enter===self.reconciled_lines)
achievements.push({title:_t("Efficiency at its finest"),desc:_t("Only use the ctrl-enter shortcut to validate reconciliations."),icon:"fa-keyboard-o"});if(sec_per_item<5)
achievements.push({title:_t("Fast reconciler"),desc:_t("Take on average less than 5 seconds to reconcile a transaction."),icon:"fa-bolt"});}
self.$(".o_protip").hide();self.updateShowMoreButton();self.$(".oe_form_sheet, o_form_sheet").append(QWeb.render("bank_statement_reconciliation_done_message",{title:title,all_was_auto_reconciled:all_was_auto_reconciled,time_taken:time_taken,sec_per_item:sec_per_item,transactions_done:self.reconciled_lines,done_with_ctrl_enter:self.lines_reconciled_with_ctrl_enter,achievements:achievements,single_statement:self.single_statement,multiple_statements:self.multiple_statements,}));var container=$("<div style='overflow: hidden;' />");self.$(".done_message").wrap(container).css("opacity",0).css("position","relative").css("left","-50%");self.$(".done_message").animate({opacity:1,left:0},self.aestetic_animation_speed*2,"easeOutCubic");self.$(".done_message").animate({opacity:1},self.aestetic_animation_speed*3,"easeOutCubic");if(self.$(".achievement").length!==0)
self.$(".achievement").popover({'placement':'top','container':self.el,'trigger':'hover'});if(self.$(".button_back_to_statement").length!==0)
self.$(".button_back_to_statement").click(function(){self.goBackToStatementsTreeView();});if(self.$(".button_close_statement").length!==0){self.$(".button_close_statement").hide();self.model_bank_statement.query(["balance_end_real","balance_end"]).filter([['id','in',self.statement_ids]]).all().then(function(data){if(_.all(data,function(o){return self.monetaryIsZero(o.balance_end_real-o.balance_end)})){self.$(".button_close_statement").show();self.$(".button_close_statement").click(function(){self.$(".button_close_statement").attr("disabled","disabled");self.model_bank_statement.call("button_confirm_bank",[self.statement_ids]).then(function(){self.goBackToStatementsTreeView();},function(){self.$(".button_close_statement").removeAttr("disabled");});});}});}},showMoreButtonClickHandler:function(){this.displayReconciliations(this.num_reconciliations_fetched_in_batch);},updateShowMoreButton:function(){var items_remaining=this.lines.length-this.last_displayed_reconciliation_index;if(items_remaining>0)
this.$(".show_more").show().find(".num_items_remaining").text(items_remaining);else
this.$(".show_more").hide();},});var bankStatementReconciliationLine=abstractReconciliationLine.extend({className:abstractReconciliationLine.prototype.className+' o_bank_statement_reconciliation_line',events:_.defaults({"click .change_partner":"changePartnerClickHandler","click .button_ok":"persistAndBowOut","click .initial_line":"initialLineClickHandler","click .line_open_balance":"lineOpenBalanceClickHandler","click .do_partial_reconcile_button":"doPartialReconcileButtonClickHandler","click .undo_partial_reconcile_button":"undoPartialReconcileButtonClickHandler",},abstractReconciliationLine.prototype.events),init:function(parent,context){this.template_prefix="bank_statement_";this._super(parent,context);if(context.line_id===undefined||context.initial_data_provided===true&&(context.reconciliation_proposition===undefined||context.line===undefined))
console.error("[Warning] bankStatementReconciliationLine instanciated with incorrect context.");this.line_id=context.line_id;this.model_bank_statement_line=this.getParent().model_bank_statement_line;this.formatCurrencies=this.getParent().formatCurrencies;this.monetaryIsZero=this.getParent().monetaryIsZero;if(context.initial_data_provided){this.st_line=context.line;this.decorateStatementLine(this.st_line);this.set("currency_id",this.st_line.currency_id);if(this.getParent().excluded_move_lines_ids[this.partner_id]===undefined)
this.getParent().excluded_move_lines_ids[this.partner_id]=[];this.getParent().excludeMoveLines(this,this.partner_id,context.reconciliation_proposition);}else{this.st_line=undefined;this.partner_id=undefined;}},loadData:function(){var self=this;if(self.context.initial_data_provided)
return;var excluded_move_lines_ids=[];_.each(self.getParent().excluded_move_lines_ids,function(o){excluded_move_lines_ids=excluded_move_lines_ids.concat(o);});return self.model_bank_statement_line.call("get_data_for_reconciliation_widget",[[self.line_id],excluded_move_lines_ids]).then(function(data){self.st_line=data[0].st_line;self.decorateStatementLine(self.st_line);self.set("currency_id",self.st_line.currency_id);self.partner_id=data[0].st_line.partner_id;if(self.getParent().excluded_move_lines_ids[self.partner_id]===undefined)
self.getParent().excluded_move_lines_ids[self.partner_id]=[];var mv_lines=[];_.each(data[0].reconciliation_proposition,function(line){self.decorateMoveLine(line);mv_lines.push(line);},self);self.set("mv_lines_selected",self.get("mv_lines_selected").concat(mv_lines));});},render:function(){var self=this;self.$el.prepend(QWeb.render("bank_statement_reconciliation_line",{line:self.st_line,presets:self.renderPresetsButtons(self.get("presets")),}));self.$(".match").slideUp(0);self.$(".create").slideUp(0);if(self.st_line.no_match)self.$el.addClass("no_match");self.bindPopoverTo(self.$(".line_info_button"));self.createFormWidgets();if(self.st_line.has_no_partner){self.updateBalance();self.$(".change_partner_container").show(0);self.$el.addClass("no_partner");}
self.finishedLoadingMoveLines=$.Deferred();self.set("mode",self.context.mode);return $.when(self.finishedLoadingMoveLines).then(function(){self.balanceChanged();self.createdLinesChanged();self.updateAccountingViewMatchedLines();});},restart:function(mode){var self=this;mode=defaultIfUndef(mode,'inactive');self.context.animate_entrance=false;self.$el.css("height",self.$el.outerHeight());_.each(self.getChildren(),function(o){o.destroy()});self.is_consistent=false;return $.when(self.$el.animate({opacity:0},self.animation_speed)).then(function(){self.getParent().unexcludeMoveLines(self,self.partner_id,self.get("mv_lines_selected"));$.each(self.$(".bootstrap_popover"),function(){$(this).popover('destroy')});self.$el.empty();self.$el.removeClass("no_partner");self.context.mode=mode;self.context.initial_data_provided=false;self.is_valid=true;self.is_consistent=true;self.filter="";self.set("balance",undefined,{silent:true});self.set("mode",undefined,{silent:true});self.set("pager_index",0,{silent:true});self.set("mv_lines",[],{silent:true});self.set("mv_lines_selected",[],{silent:true});self.mv_lines_deselected=[];self.set("lines_created",[],{silent:true});self.set("line_created_being_edited",[{'id':0}],{silent:true});return $.when(self.start()).then(function(){self.$el.css("height","auto");self.is_consistent=true;self.$el.animate({opacity:1},self.animation_speed);});});},createFormWidgets:function(){var self=this;this._super();var change_partner_field={relation:"res.partner",string:_t("Partner"),type:"many2one",domain:[['parent_id','=',false],'|',['customer','=',true],['supplier','=',true]],help:"",readonly:false,required:true,selectable:true,states:{},views:{},context:{},};var change_partner_node={tag:"field",children:[],required:true,attrs:{invisible:"False",modifiers:'',name:"change_partner",nolabel:"True",}};self.field_manager.fields_view.fields["change_partner"]=change_partner_field;self.change_partner_field=new FieldMany2One(self.field_manager,change_partner_node);self.change_partner_field.appendTo(self.$(".change_partner_container"));self.change_partner_field.on("change:value",self.change_partner_field,function(){self.changePartner(this.get_value());});self.change_partner_field.$el.find("input").attr("placeholder",self.st_line.communication_partner_name||_t("Select Partner"));},decorateStatementLine:function(line){line.q_popover=QWeb.render("bank_statement_reconciliation_statement_line_details",{line:line});},initializeCreateForm:function(){this._super();this.label_field.set("value",this.st_line.name);},selectMoveLine:function(mv_line){var self=this;var line=self._super(mv_line);if(!line)return;var last_selected_line=_.last(self.get("mv_lines_selected"));var selected_lines_account_types=_.collect(self.get("mv_lines_selected").concat(line),function(l){return l.account_type});if(selected_lines_account_types.indexOf("payable")!=-1&&selected_lines_account_types.indexOf("receivable")!=-1){new CrashManager().show_warning({data:{exception_type:_t("Incorrect Operation"),message:_t("You cannot mix items from receivable and payable accounts.")}});return;}
$(mv_line).attr('data-selected','true');self.set("mv_lines_selected",self.get("mv_lines_selected").concat(line));},deselectMoveLine:function(mv_line){var self=this;var line=self._super(mv_line);if(!line)return;var need_redraw=false;if(line.partial_reconcile===true){self.unpartialReconcileLine(line);need_redraw=true;}
if(line.propose_partial_reconcile===true){line.propose_partial_reconcile=false;need_redraw=true;}
if(need_redraw)self.deselectMoveLine(mv_line);},initialLineClickHandler:function(){var self=this;if(self.get("mode")!=="inactive"){self.set("mode","inactive");}else{self.set("mode","match");}},changePartnerClickHandler:function(){var self=this;var partner_name=self.st_line.partner_name;$.when(self.changePartner(false)).then(function(){self.$(".change_partner_container").show();self.$(".partner_name").hide();self.$(".change_partner_container").find("input").attr("placeholder",partner_name);self.change_partner_field.$dropdown.trigger("click");});},balanceChanged:function(){var self=this;self.is_valid=false;self.$(".tip_reconciliation_not_balanced").show();self.$(".tbody_open_balance").empty();self.$(".button_ok").text(_t("Reconcile")).removeClass("btn-primary").hide();var balance_type=undefined;var digits=4;if(this.get("currency_id")&&session.get_currency(this.get("currency_id"))){digits=session.get_currency(this.get("currency_id")).digits[1];}
if(self.monetaryIsZero(self.get("balance"),digits))balance_type="equal";else if(self.get("balance")*self.st_line.amount>0)balance_type="greater";else if(self.get("balance")*self.st_line.amount<0)balance_type="lower";if(balance_type==="equal"){displayValidState(true);}else if(balance_type==="greater"){createOpenBalance(_t("Create Write-off"));}else if(balance_type==="lower"){if(self.st_line.has_no_partner){createOpenBalance(_t("Choose counterpart"));}else{displayValidState(false,_t("Validate"));createOpenBalance(_t("Open balance"));}}
if(self.get("mv_lines_selected").length>0){var last_line=_.last(self.get("mv_lines_selected"));var propose_partial=self.getCreatedLines().length===0&&balance_type==="greater"&&Math.abs(self.get("balance"))<Math.abs(last_line.debit-last_line.credit)&&self.get("balance")*(last_line.debit-last_line.credit)<0&&!last_line.partial_reconcile&&!last_line.already_paid;last_line.propose_partial_reconcile=propose_partial;self.updateAccountingViewMatchedLines();}
function displayValidState(higlight_ok_button,ok_button_text){self.is_valid=true;self.$(".tip_reconciliation_not_balanced").hide();self.$(".button_ok").show();if(higlight_ok_button)self.$(".button_ok").addClass("btn-primary");if(ok_button_text!==undefined)self.$(".button_ok").text(ok_button_text)}
function createOpenBalance(name){var balance=self.get("balance");var amount=self.formatCurrencies(Math.abs(balance),self.get("currency_id"));var $line=$(QWeb.render("reconciliation_line_open_balance",{debit:balance>0?amount:"",credit:balance<0?amount:"",account_code:self.map_account_id_code[self.st_line.open_balance_account_id],label:name||_t("Open balance")}));self.$(".tbody_open_balance").empty().append($line);}},mvLinesSelectedChanged:function(elt,val){var self=this;_.each(self.get("mv_lines_selected"),function(line){if(line.partial_reconcile===true)self.unpartialReconcileLine(line);if(line.propose_partial_reconcile===true)line.propose_partial_reconcile=false;});var added_lines=_.difference(val.newValue,val.oldValue);var removed_lines=_.difference(val.oldValue,val.newValue);self.getParent().excludeMoveLines(self,self.partner_id,added_lines);self.getParent().unexcludeMoveLines(self,self.partner_id,removed_lines);self._super(elt,val);},doPartialReconcileButtonClickHandler:function(e){var line_id=$(e.currentTarget).closest("tr").data("lineid");var line=_.find(this.get("mv_lines_selected"),function(o){return o.id==line_id});this.partialReconcileLine(line);$(e.currentTarget).popover('destroy');this.updateAccountingViewMatchedLines();this.updateBalance();e.stopPropagation();},partialReconcileLine:function(line){var balance=this.get("balance");line.initial_amount=line.debit!==0?line.debit:-1*line.credit;if(balance<0)
line.debit+=balance;else
line.credit-=balance;line.propose_partial_reconcile=false;line.partial_reconcile=true;},undoPartialReconcileButtonClickHandler:function(e){var line_id=$(e.currentTarget).closest("tr").data("lineid");var line=_.find(this.get("mv_lines_selected"),function(o){return o.id==line_id});this.unpartialReconcileLine(line);$(e.currentTarget).popover('destroy');this.updateAccountingViewMatchedLines();this.updateBalance();e.stopPropagation();},unpartialReconcileLine:function(line){if(line.initial_amount>0)
line.debit=line.initial_amount;else
line.credit=-1*line.initial_amount;line.propose_partial_reconcile=true;line.partial_reconcile=false;line.amount_str=this.formatCurrencies(Math.abs(line.debit+line.credit),this.get("currency_id"));},updateBalance:function(){var self=this;var mv_lines_selected=self.get("mv_lines_selected");var balance=0;balance-=self.st_line.amount;_.each(mv_lines_selected,function(o){balance=balance-o.debit+o.credit;});_.each(self.getCreatedLines(),function(o){balance+=o.amount;});balance=Math.round(balance*10000)/10000;self.set("balance",balance);},updateMatchesGetMvLines:function(excluded_ids,offset,limit,callback){var self=this;var globally_excluded_ids=[];if(self.st_line.has_no_partner)
_.each(self.getParent().excluded_move_lines_ids,function(o){globally_excluded_ids=globally_excluded_ids.concat(o)});else
globally_excluded_ids=self.getParent().excluded_move_lines_ids[self.partner_id];for(var i=0;i<globally_excluded_ids.length;i++)
if(excluded_ids.indexOf(globally_excluded_ids[i])===-1)
excluded_ids.push(globally_excluded_ids[i]);return self.model_bank_statement_line.call("get_move_lines_for_reconciliation_widget",[self.st_line.id,excluded_ids,self.filter,offset,limit]).then(function(lines){_.each(lines,function(line){self.decorateMoveLine(line)},self);return callback.call(self,lines);});},changePartner:function(partner_id){var self=this;self.is_consistent=false;return self.model_bank_statement_line.call("write",[[self.line_id],{'partner_id':partner_id}]).then(function(){return $.when(self.restart("match")).then(function(){self.is_consistent=true;});});},prepareCounterpartAMLDict:function(line){return{name:line.name,debit:line.debit,credit:line.credit,counterpart_aml_id:line.id,};},prepareOpenBalanceForPersisting:function(){var balance=this.get("balance");var dict={};dict['account_id']=this.st_line.open_balance_account_id;dict['name']=this.st_line.name+' : '+_t("Open balance");dict['debit']=balance>0?balance:0;dict['credit']=balance<0?-1*balance:0;return dict;},prepareDataForPersisting:function(){var self=this;var counterpart_aml=_.filter(this.get("mv_lines_selected"),function(line){return!line.already_paid});var counterpart_aml_dicts=_.collect(counterpart_aml,function(line){return self.prepareCounterpartAMLDict(line)});var payment_aml=_.filter(this.get("mv_lines_selected"),function(line){return line.already_paid});var payment_aml_ids=_.collect(payment_aml,function(line){return line.id});var new_aml_dicts=this.prepareCreatedMoveLinesForPersisting(this.getCreatedLines());var digits=4;if(this.get("currency_id")&&session.get_currency(this.get("currency_id"))){digits=session.get_currency(this.get("currency_id")).digits[1];}
if(!self.monetaryIsZero(this.get("balance"),digits))new_aml_dicts.push(this.prepareOpenBalanceForPersisting());return{'counterpart_aml_dicts':counterpart_aml_dicts,'payment_aml_ids':payment_aml_ids,'new_aml_dicts':new_aml_dicts,};},persistAndBowOut:function(){var self=this;if(!this.is_consistent)return;self.$(".button_ok").attr("disabled","disabled");this.model_bank_statement_line.call("process_reconciliations",[[this.line_id],[this.prepareDataForPersisting()]]).done(function(){self.bowOut(self.animation_speed,true);}).always(function(){self.$(".button_ok").removeAttr("disabled");});},getPostMortemProcess:function(){var clone=_.clone(this);var parent=this.getParent();var partner_id=this.partner_id;var mv_lines_selected=this.get("mv_lines_selected");return function(){parent.unexcludeMoveLines(undefined,partner_id,mv_lines_selected);parent.childValidated(clone);};},});var manualReconciliation=abstractReconciliation.extend({className:abstractReconciliation.prototype.className+' o_manual_reconciliation',events:_.defaults({"change input[name='modeselektor']":"modeSelektorHandler",},abstractReconciliation.prototype.events),init:function(parent,context){this.children_widget=manualReconciliationLine;this.template_prefix="manual_";this._super(parent,context);this.model_aml=new Model("account.move.line");this.model_partner=new Model("res.partner");this.model_account=new Model("account.account");this.title=_t("Journal Items to Reconcile");context.display_name=_t("Invoices & Payments Matching");this.max_move_lines_displayed=20;this.mode=defaultIfUndef(context.context.mode,'all');this.partner_ids=context.context.partner_ids;this.account_ids=context.context.account_ids;this.show_mode_selector=defaultIfUndef(context.context.show_mode_selector,true);if(this.partner_ids&&!this.account_ids)this.account_ids=[];if(this.account_ids&&!this.partner_ids)this.partner_ids=[];this.working_on_a_given_item=utils.xor((this.partner_ids&&this.partner_ids.length===1),(this.account_ids&&this.account_ids.length===1));this.customers_data={show:true,items:[],num_total:0,num_done:0,};this.suppliers_data={show:true,items:[],num_total:0,num_done:0,};this.accounts_data={show:true,items:[],num_total:0,num_done:0,};this.create_form_fields=_.defaults({journal_id:{id:"journal_id",index:2,corresponding_property:"journal_id",label:_t("Journal"),required:true,constructor:FieldMany2One,field_properties:{relation:"account.journal",string:_t("Journal"),type:"many2one",},}},this.create_form_fields);},start:function(){var self=this;return $.when(this._super()).then(function(){return self.model_aml.call("get_data_for_manual_reconciliation_widget",[self.partner_ids,self.account_ids]).then(function(data){var data_customers_len=data.customers?data.customers.length:0;var data_suppliers_len=data.suppliers?data.suppliers.length:0;var data_accounts_len=data.accounts?data.accounts.length:0;if(data_customers_len+data_suppliers_len+data_accounts_len===0){self.$el.prepend(QWeb.render("manual_reconciliation_nothing_to_reconcile"));return;}
if(self.working_on_a_given_item){self.title=_t("Reconciling ");if(data_customers_len===1){self.title+=data.customers[0].partner_name}
else if(data_suppliers_len===1){self.title+=data.suppliers[0].partner_name}
else if(data_accounts_len===1){self.title+=data.accounts[0].account_code}}
var display_mode_customers=data_customers_len!==0;var display_mode_suppliers=data_suppliers_len!==0;var display_mode_others=data_accounts_len!==0;var mode_selector_relevant=(display_mode_customers+display_mode_suppliers+display_mode_others)>1;self.$el.prepend(QWeb.render("manual_reconciliation",{title:self.title,total_lines:0,hide_progress:self.working_on_a_given_item,mode:self.mode,show_mode_selector:self.show_mode_selector&&!self.working_on_a_given_item&&mode_selector_relevant,display_mode_customers:display_mode_customers,display_mode_suppliers:display_mode_suppliers,display_mode_others:display_mode_others,}));if(data_customers_len!==0){self.customers_data.num_total=data_customers_len;self.customers_data.items=_.each(data.customers,function(item){self.prepareReconciliationData(item,'customer')});}
if(data_suppliers_len!==0){self.suppliers_data.num_total=data_suppliers_len;self.suppliers_data.items=_.each(data.suppliers,function(item){self.prepareReconciliationData(item,'supplier')});}
if(data_accounts_len!==0){self.accounts_data.num_total=data_accounts_len;self.accounts_data.items=_.each(data.accounts,function(item){self.prepareReconciliationData(item,'account')});}
self.$(".reconciliation_lines_container").css("opacity",0);return $.when(self.updateProgress(false)).then(function(){return self.$(".reconciliation_lines_container").animate({opacity:1},self.aestetic_animation_speed);});}).always(function(){self.$(".button_ok").removeAttr("disabled");});});},processReconciliations:function(reconciliations){if(reconciliations.length===0)return;var self=this;var reconciliations_type_count=_.countBy(reconciliations,function(rec){return rec.data.reconciliation_type;});var data=_.collect(reconciliations,function(rec){return{id:rec.data.reconciliation_type==='account'?rec.data.account_id:rec.data.partner_id,type:rec.data.reconciliation_type==='account'?'account':'partner',mv_line_ids:_.collect(rec.get("mv_lines_selected"),function(o){return o.id}),new_mv_line_dicts:rec.prepareCreatedMoveLinesForPersisting(rec.getCreatedLines()),};});var deferred_animation=self.$(".reconciliation_lines_container, .show_more_container").fadeOut(self.aestetic_animation_speed);var deferred_rpc=self.model_aml.call("process_reconciliations",[data]);return $.when(deferred_animation,deferred_rpc).done(function(){for(var i=0;i<reconciliations.length;i++)
reconciliations[i].bowOut(0,false);self.lines_reconciled_with_ctrl_enter+=reconciliations.length;self.customers_data.num_done+=reconciliations_type_count.customer||0;self.suppliers_data.num_done+=reconciliations_type_count.supplier||0;self.accounts_data.num_done+=reconciliations_type_count.account||0;self.updateProgress();}).always(function(){self.$(".reconciliation_lines_container").fadeIn(self.aestetic_animation_speed);});},displayReconciliation:function(data,animate_entrance){var widget=new this.children_widget(this,{data:data,animate_entrance:animate_entrance});data.displayed=true;return widget.appendTo(this.$(".reconciliation_lines_container"));},modeSelektorHandler:function(e){this.mode=$(e.target).attr("val");this.updateProgress();},getDisplayedCollections:function(){var collections=[];if(this.mode==='customers'||this.mode==='all'){collections.push(this.customers_data)}
if(this.mode==='suppliers'||this.mode==='all'){collections.push(this.suppliers_data)}
if(this.mode==='others'||this.mode==='all'){collections.push(this.accounts_data)}
return collections;},updateProgress:function(animate_entrance){animate_entrance=defaultIfUndef(animate_entrance,true);var self=this;var displayed_collections=self.getDisplayedCollections();self.updateProgressbar();if(self.mode!=='all'){_.each(self.getChildren(),function(child){if(child.data.reconciliation_type!==self.mode){child.$el.slideUp(self.aestetic_animation_speed,function(){child.destroy()});child.data.displayed=false;}});}
var children_promises=[];var items_to_display=_.foldl(displayed_collections,function(prev,current){return prev.concat(current.items)},[]);items_to_display=_.filter(items_to_display,function(item){return item.displayed===false;}).slice(0,self.num_reconciliations_fetched_in_batch-self.getChildren().length);_.each(items_to_display,function(item){children_promises.push(self.displayReconciliation(item,animate_entrance));});var reconciliations_left=_.foldl(displayed_collections,function(prev,current){return prev+current.num_total-current.num_done},0);if(reconciliations_left===0&&self.$(".done_message").length===0)
self.showDoneMessage();if(reconciliations_left!==0&&self.$(".done_message").length!==0)
self.hideDoneMessage();return $.when.apply($,children_promises);},updateProgressbar:function(){var displayed_collections=this.getDisplayedCollections();var done=_.foldl(displayed_collections,function(prev,current){return prev+current.num_done},0);var total=_.foldl(displayed_collections,function(prev,current){return prev+current.num_total},0);var prog_bar=this.$(".progress .progress-bar");prog_bar.attr("aria-valuenow",done);prog_bar.css("width",(done/total*100)+"%");this.$(".progress .progress-text .valuenow").text(done);this.$(".progress .progress-text .valuemax").text(total);},showDoneMessage:function(){this.$(".oe_form_sheet, .o_form_sheet").append(QWeb.render("manual_reconciliation_done_message"));var container=$("<div style='overflow: hidden;' />");this.$(".done_message").wrap(container).css("opacity",0).css("position","relative").css("left","-50%");this.$(".done_message").animate({opacity:1,left:0},this.aestetic_animation_speed*2,"easeOutCubic");this.$(".done_message").animate({opacity:1},this.aestetic_animation_speed*3,"easeOutCubic");},hideDoneMessage:function(){this.$(".done_message").remove();},prepareReconciliationData:function(item,type){item.displayed=false;item.reconciliation_type=type;},childValidated:function(reconciliation_type){if(reconciliation_type==="customer")
this.customers_data.num_done++;else if(reconciliation_type==="supplier")
this.suppliers_data.num_done++;else if(reconciliation_type==="account")
this.accounts_data.num_done++;this.updateProgress();},});var manualReconciliationLine=abstractReconciliationLine.extend({className:abstractReconciliationLine.prototype.className+' o_manual_reconciliation_line',events:_.defaults({"click .accounting_view thead":"headerClickHandler","click .line_open_balance":"lineOpenBalanceClickHandler","click .button_reconcile":"buttonReconcileClickHandler",},abstractReconciliationLine.prototype.events),init:function(parent,context){this.template_prefix="manual_";this._super(parent,context);this.working_on_a_given_item=this.getParent().working_on_a_given_item;this.model_aml=this.getParent().model_aml;this.data=context.data;this.initial_currency=context.data.currency_id;this.set("currency_id",context.data.currency_id);this.on("change:currency_id",this,this.currencyChanged);_.each(context.data.reconciliation_proposition,function(line){this.decorateMoveLine(line);},this);this.set("mv_lines_selected",context.data.reconciliation_proposition);},render:function(){var self=this;self.$el.prepend(QWeb.render("manual_reconciliation_line",{data:self.data,presets:self.renderPresetsButtons(self.get("presets")),}));self.$(".match").slideUp(0);self.$(".create").slideUp(0);self.createFormWidgets();self.$el.append($('ul.ui-autocomplete'));self.updateBalance();self.updateAccountingViewMatchedLines();self.finishedLoadingMoveLines=$.Deferred();self.set("mode","match");return self.finishedLoadingMoveLines;},islineCreatedBeingEditedValid:function(){return this._super()&&this.get("line_created_being_edited")[0].journal_id;},selectMoveLine:function(mv_line){var self=this;var line=self._super(mv_line);if(!line)return;$(mv_line).attr('data-selected','true');self.set("mv_lines_selected",self.get("mv_lines_selected").concat(line));},mvLinesChanged:function(){var self=this;self._super();if(!self.working_on_a_given_item&&self.get("pager_index")===0&&!self.can_fetch_more_move_lines&&self.get("mv_lines_selected").length===0&&self.filter===''){var mkay,mmkay=false;var lines=self.get("mv_lines").concat(self.mv_lines_deselected);for(var i=0;i<lines.length;i++){if(lines[i].credit!==0)mkay=true;if(lines[i].debit!==0)mmkay=true;if(mkay&&mmkay)break;}
if(!(mkay&&mmkay)){self.markAsReconciled();}}},headerClickHandler:function(){if(this.get("mode")!=="match")
this.set("mode","match");},buttonReconcileClickHandler:function(){if(this.persist_action==="reconcile")
this.processReconciliation();else if(this.persist_action==="mark_as_reconciled")
this.markAsReconciled();},preventAccountingViewCollapse:function(){if(this.$(".tbody_matched_lines > *").length+this.$(".tbody_created_lines > *").length===0)
this.$(".tbody_matched_lines").append('<tr class="filler_line"><td class="cell_action"></td><td class="cell_due_date"></td>\
                <td class="cell_label"></td><td class="cell_debit"></td><td class="cell_credit"></td><td class="cell_info_popover"></td></tr>');},updateAccountingViewMatchedLines:function(){this._super();this.preventAccountingViewCollapse();},updateAccountingViewCreatedLines:function(){this._super();this.preventAccountingViewCollapse();},balanceChanged:function(){var self=this;var balance=self.get("balance");self.$(".button_reconcile").removeClass("btn-primary");self.$(".button_reconcile").text(_t("Reconcile"));self.persist_action="reconcile";if(self.get("mv_lines_selected").length<2){self.$(".button_reconcile").text(_t("Skip"));self.persist_action="mark_as_reconciled";}else if(self.monetaryIsZero(balance)){self.$(".button_reconcile").addClass("btn-primary");}
self.$(".tbody_open_balance").empty();if((!self.monetaryIsZero(balance))&&self.get("mv_lines_selected").length>1){var debit=(balance>0?self.formatCurrencies(balance,self.get("currency_id")):"");var credit=(balance<0?self.formatCurrencies(-1*balance,self.get("currency_id")):"");var $line=$(QWeb.render("manual_reconciliation_line_open_balance",{debit:debit,credit:credit,label:_t("Create writeoff")}));self.$(".tbody_open_balance").append($line);}},mvLinesSelectedChanged:function(elt,val){var lines=this.get("mv_lines_selected");var new_currency=this.initial_currency;if(lines.length>0){var first_line_currency=lines[0].currency_id;var same_currency=_.every(lines,function(line){return line.currency_id===first_line_currency});if(same_currency)
new_currency=first_line_currency;}
if(new_currency!=this.get("currency_id"))
this.set("currency_id",new_currency);else
this._super(elt,val);},currencyChanged:function(){var self=this;this.mv_lines_deselected=[];this.updateMatches();var line_ids=_.collect(self.get("mv_lines_selected"),function(o){return o.id});self.model_aml.call("prepare_move_lines_for_reconciliation_widget",[line_ids,self.get("currency_id")]).then(function(lines){_.each(lines,function(line){self.decorateMoveLine(line)},self);self.set("mv_lines_selected",lines);});},loadReconciliationProposition:function(){var self=this;return self.model_aml.call("get_reconciliation_proposition",[self.data.account_id,self.data.partner_id||undefined]).then(function(lines){_.each(lines,function(line){self.decorateMoveLine(line)},self);self.set("mv_lines_selected",lines);});},updateMatchesGetMvLines:function(excluded_ids,offset,limit,callback){var self=this;return self.model_aml.call("get_move_lines_for_manual_reconciliation",[self.data.account_id,self.data.partner_id||undefined,excluded_ids,self.filter,offset,limit,self.get("currency_id")]).then(function(lines){_.each(lines,function(line){self.decorateMoveLine(line)},self);callback.call(self,lines);});},prepareCreatedMoveLinesForPersisting:function(lines){var dicts=this._super(lines);for(var i=0;i<dicts.length;i++)
dicts[i]['journal_id']=lines[i].journal_id;return dicts;},processReconciliation:function(){var self=this;if(!self.is_consistent)return $.Deferred().rejectWith({reason:"Reconciliation widget is not in a consistent state."});var mv_line_ids=_.collect(self.get("mv_lines_selected"),function(o){return o.id});var new_mv_line_dicts=self.prepareCreatedMoveLinesForPersisting(self.getCreatedLines());self.$(".button_reconcile").attr("disabled","disabled");return self.model_aml.call("process_reconciliation",[mv_line_ids,new_mv_line_dicts]).done(function(){self.initializeCreateForm();self.loadReconciliationProposition();self.set("lines_created",[]);if(self.get("mode")!="match"&&self.get("mv_lines").length>=1)
self.set("mode","match");self.balanceChanged();}).always(function(){self.$(".button_reconcile").removeAttr("disabled");});},markAsReconciled:_.throttle(function(){var self=this;var type=this.data.reconciliation_type;var id=(type==="partner"?this.data.partner_id:this.data.account_id);var model=(type==="partner"?this.getParent().model_partner:this.getParent().model_account);model.call("mark_as_reconciled",[[id]]).then(function(){self.bowOut(self.animation_speed,true);});},100,{trailing:false}),getPostMortemProcess:function(){var reconciliation_type=this.data.reconciliation_type;var parent=this.getParent();return function(){if(parent)
parent.childValidated(reconciliation_type);};},});core.action_registry.add('bank_statement_reconciliation_view',bankStatementReconciliation);core.action_registry.add('manual_reconciliation_view',manualReconciliation);return{abstractReconciliation:abstractReconciliation,abstractReconciliationLine:abstractReconciliationLine,bankStatementReconciliation:bankStatementReconciliation,manualReconciliation:manualReconciliation,bankStatementReconciliationLine:bankStatementReconciliationLine,};});;

/* /account/static/src/js/move_line_quickadd.js defined in bundle 'web.assets_backend' */
odoo.define('account.move_line_quickadd',function(require){"use strict";var core=require('web.core');var data=require('web.data');var ListView=require('web.ListView');var Model=require('web.DataModel');var QWeb=core.qweb;var QuickAddListView=ListView.extend({init:function(){this._super.apply(this,arguments);this.journals=[];this.periods=[];this.current_journal=null;this.current_period=null;this.default_period=null;this.default_journal=null;this.current_journal_type=null;this.current_journal_currency=null;this.current_journal_analytic=null;},start:function(){var tmp=this._super.apply(this,arguments);var self=this;var defs=[];this.$el.parent().prepend(QWeb.render("AccountMoveLineQuickAdd",{widget:this}));this.$el.parent().find('.oe_account_select_journal').change(function(){self.current_journal=this.value===''?null:parseInt(this.value);self.do_search(self.last_domain,self.last_context,self.last_group_by);});this.$el.parent().find('.oe_account_select_period').change(function(){self.current_period=this.value===''?null:parseInt(this.value);self.do_search(self.last_domain,self.last_context,self.last_group_by);});this.on('edit:after',this,function(){self.$el.parent().find('.oe_account_select_journal').attr('disabled','disabled');self.$el.parent().find('.oe_account_select_period').attr('disabled','disabled');});this.on('save:after cancel:after',this,function(){self.$el.parent().find('.oe_account_select_journal').removeAttr('disabled');self.$el.parent().find('.oe_account_select_period').removeAttr('disabled');});var mod=new Model("account.move.line",self.dataset.context,self.dataset.domain);defs.push(mod.call("default_get",[['journal_id','period_id'],self.dataset.context]).then(function(result){self.current_period=result['period_id'];self.current_journal=result['journal_id'];}));defs.push(mod.call("list_journals",[]).then(function(result){self.journals=result;}));defs.push(mod.call("list_periods",[]).then(function(result){self.periods=result;}));return $.when(tmp,defs);},do_search:function(domain,context,group_by){var self=this;this.last_domain=domain;this.last_context=context;this.last_group_by=group_by;this.old_search=_.bind(this._super,this);var o;self.$el.parent().find('.oe_account_select_journal').children().remove().end();self.$el.parent().find('.oe_account_select_journal').append(new Option('',''));for(var i=0;i<self.journals.length;i++){o=new Option(self.journals[i][1],self.journals[i][0]);if(self.journals[i][0]===self.current_journal){self.current_journal_type=self.journals[i][2];self.current_journal_currency=self.journals[i][3];self.current_journal_analytic=self.journals[i][4];$(o).attr('selected',true);}
self.$el.parent().find('.oe_account_select_journal').append(o);}
self.$el.parent().find('.oe_account_select_period').children().remove().end();self.$el.parent().find('.oe_account_select_period').append(new Option('',''));for(var i=0;i<self.periods.length;i++){o=new Option(self.periods[i][1],self.periods[i][0]);self.$el.parent().find('.oe_account_select_period').append(o);}
self.$el.parent().find('.oe_account_select_period').val(self.current_period).attr('selected',true);return self.search_by_journal_period();},search_by_journal_period:function(){var self=this;var domain=[];if(self.current_journal!==null)domain.push(["journal_id","=",self.current_journal]);if(self.current_period!==null)domain.push(["period_id","=",self.current_period]);self.last_context["journal_id"]=self.current_journal===null?false:self.current_journal;if(self.current_period===null)delete self.last_context["period_id"];else self.last_context["period_id"]=self.current_period;self.last_context["journal_type"]=self.current_journal_type;self.last_context["currency"]=self.current_journal_currency;var compound_domain=new data.CompoundDomain(self.last_domain,domain);self.dataset.domain=compound_domain.eval();return self.old_search(compound_domain,self.last_context,self.last_group_by);},});core.view_registry.add('tree_account_move_line_quickadd',QuickAddListView);});;

/* /account/static/src/js/account_payment_widget.js defined in bundle 'web.assets_backend' */
odoo.define('account.payment',function(require){"use strict";var core=require('web.core');var form_common=require('web.form_common');var formats=require('web.formats');var Model=require('web.Model');var QWeb=core.qweb;var ShowPaymentLineWidget=form_common.AbstractField.extend({render_value:function(){var self=this;var info=JSON.parse(this.get('value'));var invoice_id=info.invoice_id;if(info!==false){_.each(info.content,function(k,v){k.index=v;k.amount=formats.format_value(k.amount,{type:"float",digits:k.digits});if(k.date){k.date=formats.format_value(k.date,{type:"date"});}});this.$el.html(QWeb.render('ShowPaymentInfo',{'lines':info.content,'outstanding':info.outstanding,'title':info.title}));this.$('.outstanding_credit_assign').click(function(){var id=$(this).data('id')||false;new Model("account.invoice").call("assign_outstanding_credit",[invoice_id,id]).then(function(result){self.view.reload();});});_.each(this.$('.js_payment_info'),function(k,v){var options={'content':QWeb.render('PaymentPopOver',{'name':info.content[v].name,'journal_name':info.content[v].journal_name,'date':info.content[v].date,'amount':info.content[v].amount,'currency':info.content[v].currency,'position':info.content[v].position,'payment_id':info.content[v].payment_id,'move_id':info.content[v].move_id,'ref':info.content[v].ref,}),'html':true,'placement':'left','title':'Payment Information','trigger':'focus','delay':{"show":0,"hide":100},};$(k).popover(options);$(k).on('shown.bs.popover',function(event){$(this).parent().find('.js_unreconcile_payment').click(function(){var payment_id=parseInt($(this).attr('payment-id'))
if(payment_id!==undefined&&payment_id!==NaN){new Model("account.move.line").call("remove_move_reconcile",[payment_id,{'invoice_id':self.view.datarecord.id}]).then(function(result){self.view.reload();});}});$(this).parent().find('.js_open_payment').click(function(){var move_id=parseInt($(this).attr('move-id'))
if(move_id!==undefined&&move_id!==NaN){self.do_action({type:'ir.actions.act_window',res_model:'account.move',res_id:move_id,views:[[false,'form']],target:'current'});}});});});}
else{this.$el.html('');}},});core.form_widget_registry.add('payment',ShowPaymentLineWidget);});;

/* /account/static/src/js/account_journal_dashboard_widget.js defined in bundle 'web.assets_backend' */
odoo.define('journal_dashboard',function(require){'use strict';var kanban_widgets=require('web_kanban.widgets');var JournalDashboardGraph=kanban_widgets.AbstractField.extend({start:function(){this.graph_type=this.$node.attr('graph_type');this.data=JSON.parse(this.field.raw_value);this.display_graph();return this._super();},display_graph:function(){var self=this;nv.addGraph(function(){self.$svg=self.$el.append('<svg>');switch(self.graph_type){case"line":self.$svg.addClass('o_graph_linechart');self.chart=nv.models.lineChart();self.chart.forceY([0]);self.chart.options({x:function(d,u){return u},margin:{'left':0,'right':0,'top':0,'bottom':0},showYAxis:false,showLegend:false,});self.chart.xAxis.tickFormat(function(d){var label='';_.each(self.data,function(v,k){if(v.values[d]&&v.values[d].x){label=v.values[d].x;}});return label;});self.chart.yAxis.tickFormat(d3.format(',.2f'));break;case"bar":self.$svg.addClass('o_graph_barchart');self.chart=nv.models.discreteBarChart().x(function(d){return d.label}).y(function(d){return d.value}).showValues(false).showYAxis(false).margin({'left':0,'right':0,'top':0,'bottom':40});self.chart.xAxis.axisLabel(self.data[0].title);self.chart.yAxis.tickFormat(d3.format(',.2f'));break;}
d3.select(self.$el.find('svg')[0]).datum(self.data).transition().duration(1200).call(self.chart);self.customize_chart();nv.utils.windowResize(self.on_resize);});},on_resize:function(){this.chart.update();this.customize_chart();},customize_chart:function(){if(this.graph_type==='bar'){var bar_classes=_.map(this.data[0].values,function(v,k){return v.type});_.each(this.$('.nv-bar'),function(v,k){$(v).attr('class',$(v).attr('class')+' '+bar_classes[k]);});}},destroy:function(){nv.utils.offWindowResize(this.on_resize);this._super();},});kanban_widgets.registry.add('dashboard_graph',JournalDashboardGraph);});;

/* /account_accountant/static/src/js/tour.js defined in bundle 'web.assets_backend' */
odoo.define('account_accountant.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('account_accountant_tour',{'skip_enabled':true,},[{trigger:'.o_app[data-menu-xmlid="account.menu_finance"], .oe_menu_toggler[data-menu-xmlid="account.menu_finance"]',content:_t('Ready to discover your new favorite <b>accounting app</b>? Get started by clicking here.'),position:'bottom',},{trigger:".o_invoice_new",extra_trigger:'.o_account_kanban',content:_t("Let\'s start with a new customer invoice."),position:"bottom"},{trigger:".breadcrumb li:not(.active):last",extra_trigger:"[data-id='open'].btn-primary, [data-id='open'].oe_active",content:_t("Use the path to quickly click back to <b>previous screens</b>, without reloading the page."),position:"bottom"},{trigger:'li a[data-menu-xmlid="account.menu_finance_reports"], div[data-menu-xmlid="account.menu_finance_reports"]',content:_t("Your reports are available in real time. <i>No need to close a fiscal year to get a Profit &amp; Loss statement or view the Balance Sheet.</i>"),position:"bottom"}]);});;

/* /sale_stock/static/src/js/tour.js defined in bundle 'web.assets_backend' */
odoo.define("sale_stock.tour",function(require){"use strict";var tour=require('web_tour.tour');require('sale.tour');var quotation_product_selected_step_index=_.findIndex(tour.tours.sale_tour.steps,function(step){return(step.id==="quotation_product_selected");});tour.tours.sale_tour.steps[quotation_product_selected_step_index].run=function(actions){actions.auto();};tour.tours.sale_tour.steps.splice(quotation_product_selected_step_index+1,0,{trigger:".o_dialog_warning + .modal-footer .btn-primary",auto:true,},{trigger:"body:not(:has(.o_dialog_warning))",auto:true,in_modal:false,run:function(actions){actions.auto(".modal-footer .btn-primary");},});});;

/* /website_crm/static/src/js/website_crm_backend.js defined in bundle 'web.assets_backend' */
odoo.define('website_crm.backend',function(require){"use strict";var core=require('web.core');var WebsiteBackend=require('website.backendDashboard');var QWeb=core.qweb;WebsiteBackend.include({events:_.defaults({'change .js_field_selection':'on_field_selection',},WebsiteBackend.prototype.events),init:function(parent,context){this._super(parent,context);this.dashboards_templates.push('website_crm.dashboard_leads');this.graphs.push({'name':'leads','group':'sale_salesman'});this.leads_table=[];this.lead_fields=[];this.lead_field='';},compute_percentages:function(){if(!this.dashboards_data.leads.leads||!this.dashboards_data.leads.leads.length){return;}
var leads=this.dashboards_data.leads.leads;var lead_field_keys=_.pluck(leads,this.lead_field);var leads_counter=_.groupBy(lead_field_keys);this.leads_table=$.map(leads_counter,function(e,key){return{'value':e.length,'key':key,'perc':Math.round(e.length*100/leads.length)};});this.leads_table.sort(function(a,b){return b.value-a.value;});},fetch_data:function(){var self=this;return this._super().then(function(){if(self.dashboards_data.leads){var leads=self.dashboards_data.leads.leads;if(leads&&leads.length){self.lead_fields=self.dashboards_data.leads.lead_fields;self.lead_field=Object.keys(self.lead_fields)[0];self.compute_percentages();}}});},on_field_selection:function(ev){this.lead_field=ev.currentTarget.value;this.compute_percentages();this.$('.js_leads_table').replaceWith(QWeb.render("website_crm.LeadsTable",{'widget':this}));},});});;

/* /website_sale/static/src/js/website_sale_backend.js defined in bundle 'web.assets_backend' */
odoo.define('website_sale.backend',function(require){"use strict";var WebsiteBackend=require('website.backendDashboard');WebsiteBackend.include({events:_.defaults({'click tr.o_product_template':'on_product_template',},WebsiteBackend.prototype.events),init:function(parent,context){this._super(parent,context);this.dashboards_templates.push('website_sale.dashboard_sales');this.graphs.push({'name':'sales','group':'sale_salesman'});},on_product_template:function(ev){ev.preventDefault();var product_id=$(ev.currentTarget).data('productId');this.do_action({type:'ir.actions.act_window',res_model:'product.product',res_id:product_id,views:[[false,'form']],target:'current',},{on_reverse_breadcrumb:this.on_reverse_breadcrumb,});},});});;

/* /barcodes/static/src/js/barcode_parser.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes.BarcodeParser',function(require){"use strict";var Class=require('web.Class');var Model=require('web.DataModel');var BarcodeParser=Class.extend({init:function(attributes){this.nomenclature_id=attributes.nomenclature_id;this.loaded=this.load();},load:function(){var self=this;return new Model('barcode.nomenclature').query(['name','rule_ids','upc_ean_conv']).filter([['id','=',this.nomenclature_id[0]]]).first().then(function(nomenclature){self.nomenclature=nomenclature;return new Model('barcode.rule').query(['name','sequence','type','encoding','pattern','alias']).filter([['barcode_nomenclature_id','=',self.nomenclature.id]]).all();}).then(function(rules){rules=rules.sort(function(a,b){return a.sequence-b.sequence;});self.nomenclature.rules=rules;});},is_loaded:function(){return this.loaded;},ean_checksum:function(ean){var code=ean.split('');if(code.length!==13){return-1;}
var oddsum=0,evensum=0,total=0;code=code.reverse().splice(1);for(var i=0;i<code.length;i++){if(i%2===0){oddsum+=Number(code[i]);}else{evensum+=Number(code[i]);}}
total=oddsum*3+evensum;return Number((10-total%10)%10);},ean8_checksum:function(ean){var code=ean.split('');if(code.length!==8){return-1;}
var sum1=Number(code[1])+Number(code[3])+Number(code[5]);var sum2=Number(code[0])+Number(code[2])+Number(code[4])+Number(code[6]);var total=sum1+3*sum2;return Number((10-total%10)%10);},check_ean:function(ean){return/^\d+$/.test(ean)&&this.ean_checksum(ean)===Number(ean[ean.length-1]);},check_encoding:function(barcode,encoding){var len=barcode.length;var allnum=/^\d+$/.test(barcode);var check=Number(barcode[len-1]);if(encoding==='ean13'){return len===13&&allnum&&this.ean_checksum(barcode)===check;}else if(encoding==='ean8'){return len===8&&allnum&&this.ean8_checksum(barcode)===check;}else if(encoding==='upca'){return len===12&&allnum&&this.ean_checksum('0'+barcode)===check;}else if(encoding==='any'){return true;}else{return false;}},sanitize_ean:function(ean){ean=ean.substr(0,13);for(var n=0,count=(13-ean.length);n<count;n++){ean=ean+'0';}
return ean.substr(0,12)+this.ean_checksum(ean);},sanitize_upc:function(upc){return this.sanitize_ean('0'+upc).substr(1,12);},match_pattern:function(barcode,pattern,encoding){var match={value:0,base_code:barcode,match:false,};barcode=barcode.replace("\\","\\\\").replace("{",'\{').replace("}","\}").replace(".","\.");var numerical_content=pattern.match(/[{][N]*[D]*[}]/);var base_pattern=pattern;if(numerical_content){var num_start=numerical_content.index;var num_length=numerical_content[0].length;var value_string=barcode.substr(num_start,num_length-2);var whole_part_match=numerical_content[0].match("[{][N]*[D}]");var decimal_part_match=numerical_content[0].match("[{N][D]*[}]");var whole_part=value_string.substr(0,whole_part_match.index+whole_part_match[0].length-2);var decimal_part="0."+value_string.substr(decimal_part_match.index,decimal_part_match[0].length-1);if(whole_part===''){whole_part='0';}
match['value']=parseInt(whole_part)+parseFloat(decimal_part);match['base_code']=barcode.substr(0,num_start);var base_pattern=pattern.substr(0,num_start);for(var i=0;i<(num_length-2);i++){match['base_code']+="0";base_pattern+="0";}
match['base_code']+=barcode.substr(num_start+num_length-2,barcode.length-1);base_pattern+=pattern.substr(num_start+num_length,pattern.length-1);match['base_code']=match['base_code'].replace("\\\\","\\").replace("\{","{").replace("\}","}").replace("\.",".");var base_code=match.base_code.split('')
if(encoding==='ean13'){base_code[12]=''+this.ean_checksum(match.base_code);}else if(encoding==='ean8'){base_code[7]=''+this.ean8_checksum(match.base_code);}else if(encoding==='upca'){base_code[11]=''+this.ean_checksum('0'+match.base_code);}
match.base_code=base_code.join('')}
if(base_pattern[0]!=='^'){base_pattern="^"+base_pattern;}
match.match=match.base_code.match(base_pattern);return match;},parse_barcode:function(barcode){var parsed_result={encoding:'',type:'error',code:barcode,base_code:barcode,value:0,};if(!this.nomenclature){return parsed_result;}
var rules=this.nomenclature.rules;for(var i=0;i<rules.length;i++){var rule=rules[i];var cur_barcode=barcode;if(rule.encoding==='ean13'&&this.check_encoding(barcode,'upca')&&this.nomenclature.upc_ean_conv in{'upc2ean':'','always':''}){cur_barcode='0'+cur_barcode;}else if(rule.encoding==='upca'&&this.check_encoding(barcode,'ean13')&&barcode[0]==='0'&&this.upc_ean_conv in{'ean2upc':'','always':''}){cur_barcode=cur_barcode.substr(1,12);}
if(!this.check_encoding(cur_barcode,rule.encoding)){continue;}
var match=this.match_pattern(cur_barcode,rules[i].pattern,rule.encoding);if(match.match){if(rules[i].type==='alias'){barcode=rules[i].alias;parsed_result.code=barcode;parsed_result.type='alias';}
else{parsed_result.encoding=rules[i].encoding;parsed_result.type=rules[i].type;parsed_result.value=match.value;parsed_result.code=cur_barcode;if(rules[i].encoding==="ean13"){parsed_result.base_code=this.sanitize_ean(match.base_code);}
else{parsed_result.base_code=match.base_code;}
return parsed_result;}}}
return parsed_result;},});return BarcodeParser;});;

/* /barcodes/static/src/js/barcode_events.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes.BarcodeEvents',function(require){"use strict";var core=require('web.core');var mixins=core.mixins;function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:undefined};var evt=document.createEvent('CustomEvent');evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt;}
CustomEvent.prototype=window.Event.prototype;var BarcodeEvents=core.Class.extend(mixins.PropertiesMixin,{timeout:null,key_pressed:{},buffered_key_events:[],regexp:/(.{3,})[\n\r\t]*/,suffix:/[\n\r\t]+/,max_time_between_keys_in_ms:55,init:function(){mixins.PropertiesMixin.init.call(this);this.__keydown_handler=_.bind(this.keydown_handler,this);this.__keyup_handler=_.bind(this.keyup_handler,this);this.__handler=_.bind(this.handler,this);$(_.bind(this.start,this,false));},handle_buffered_keys:function(){var str=this.buffered_key_events.reduce(function(memo,e){return memo+String.fromCharCode(e.which)},'');var match=str.match(this.regexp);if(match){var barcode=match[1];core.bus.trigger('barcode_scanned',barcode,this.buffered_key_events[0].target);if(this.buffered_key_events[0].target.getAttribute("barcode_events")==="true")
$(this.buffered_key_events[0].target).trigger('barcode_scanned',barcode);}else{this.resend_buffered_keys();}
this.buffered_key_events=[];},resend_buffered_keys:function(){var old_event,new_event;for(var i=0;i<this.buffered_key_events.length;i++){old_event=this.buffered_key_events[i];if(old_event.which!==13){var params={'bubbles':old_event.bubbles,'cancelable':old_event.cancelable,};try{new_event=new Event("keypress",params);}catch(error){new_event=new CustomEvent("keypress",params);}
new_event.viewArg=old_event.viewArg;new_event.ctrl=old_event.ctrl;new_event.alt=old_event.alt;new_event.shift=old_event.shift;new_event.meta=old_event.meta;new_event.char=old_event.char;new_event.key=old_event.key;new_event.charCode=old_event.charCode;new_event.keyCode=old_event.keyCode||old_event.which;new_event.which=old_event.which;new_event.dispatched_by_barcode_reader=true;old_event.target.dispatchEvent(new_event);}}},element_is_editable:function(element){return $(element).is('input,textarea,[contenteditable="true"]');},is_special_key:function(e){if(e.key==="ArrowLeft"||e.key==="ArrowRight"||e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="Escape"||e.key==="Tab"||/F\d\d?/.test(e.key)){return true;}else{return false;}},keydown_handler:function(e){if(this.key_pressed[e.which]){e.preventDefault();}else{this.key_pressed[e.which]=true;}},keyup_handler:function(e){this.key_pressed[e.which]=false;},handler:function(e){if(e.dispatched_by_barcode_reader)
return;if(this.is_special_key(e))
return;if(e.ctrlKey||e.metaKey||e.altKey)
return;if(e.which===13&&this.buffered_key_events.length===0)
return;if(this.element_is_editable(e.target)&&e.target.getAttribute("barcode_events")!=="true")
return;this.buffered_key_events.push(e);e.preventDefault();e.stopImmediatePropagation();clearTimeout(this.timeout);if(String.fromCharCode(e.which).match(this.suffix)){this.handle_buffered_keys();}else{this.timeout=setTimeout(_.bind(this.handle_buffered_keys,this),this.max_time_between_keys_in_ms);}},start:function(prevent_key_repeat){document.body.addEventListener('keypress',this.__handler,true);if(prevent_key_repeat===true){document.body.addEventListener('keydown',this.__keydown_handler,true);document.body.addEventListener('keyup',this.__keyup_handler,true);}},stop:function(){document.body.removeEventListener('keypress',this.__handler,true);document.body.removeEventListener('keydown',this.__keydown_handler,true);document.body.removeEventListener('keyup',this.__keyup_handler,true);},});return{BarcodeEvents:new BarcodeEvents(),ReservedBarcodePrefixes:['O-CMD'],};});;

/* /barcodes/static/src/js/barcode_handler_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes.BarcodeHandlerMixin',function(require){"use strict";var core=require('web.core');var View=require('web.View');return{init:function(){var self=this;this._super.apply(this,arguments);this.__on_barcode_scanned=function(barcode,target){if($.contains(target,self.el)){self.on_barcode_scanned.call(self,barcode);}};this.start_listening();var view=this.findAncestor(function(ancestor){return ancestor instanceof View});if(view){view.on('attached',this,this.start_listening);view.on('detached',this,this.stop_listening);}},start_listening:function(){if(!this.is_listening){core.bus.on('barcode_scanned',this,this.__on_barcode_scanned);this.is_listening=true;}},stop_listening:function(){if(this.is_listening){core.bus.off('barcode_scanned',this,this.__on_barcode_scanned);this.is_listening=false;}},on_barcode_scanned:function(barcode){console.error('A class implementing BarcodeHandlerMixin must redefine method on_barcode_scanned.');},};});;

/* /barcodes/static/src/js/form_view_barcode_handler.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes.FormViewBarcodeHandler',function(require){"use strict";var core=require('web.core');var utils=require('web.utils');var common=require('web.form_common');var BarcodeEvents=require('barcodes.BarcodeEvents');var BarcodeHandlerMixin=require('barcodes.BarcodeHandlerMixin');var KanbanRecord=require('web_kanban.Record');var Dialog=require('web.Dialog');var _t=core._t;KanbanRecord.include({get:function(key){return this.values[key]&&this.values[key].value;},});var FormViewBarcodeHandler=common.AbstractField.extend(BarcodeHandlerMixin,{init:function(parent,context){this.__quantity_listener=_.bind(this._set_quantity_listener,this);BarcodeHandlerMixin.init.apply(this,arguments);this.process_barcode_mutex=new utils.Mutex();return this._super.apply(this,arguments);},start:function(){this._super();this.form_view=this.field_manager;this.map_barcode_method={'O-CMD.NEW':_.bind(this.form_view.on_button_new,this.form_view),'O-CMD.EDIT':_.bind(this.form_view.on_button_edit,this.form_view),'O-CMD.CANCEL':_.bind(this.form_view.on_button_cancel,this.form_view),'O-CMD.SAVE':_.bind(this.form_view.on_button_save,this.form_view,{target:$('.o_cp_buttons .o_form_button_save')}),};if(this.form_view.execute_pager_action){this.map_barcode_method['O-CMD.PAGER-PREV']=_.bind(this.form_view.execute_pager_action,this.form_view,'previous');this.map_barcode_method['O-CMD.PAGER-NEXT']=_.bind(this.form_view.execute_pager_action,this.form_view,'next');}else if(this.form_view.pager){this.map_barcode_method['O-CMD.PAGER-PREV']=_.bind(this.form_view.pager.previous,this.form_view.pager);this.map_barcode_method['O-CMD.PAGER-NEXT']=_.bind(this.form_view.pager.next,this.form_view.pager);}},destroy:function(){this.stop_listening();this._super.apply(this,arguments);},_display_no_edit_mode_warning:function(){this.do_warn(_t('Error : Document not editable'),_t('To modify this document, please first start edition.'));},_display_no_last_scanned_warning:function(){this.do_warn(_t('Error : No last scanned barcode'),_t('To set the quantity please scan a barcode first.'));},_set_quantity_listener:function(event){var self=this;var character=String.fromCharCode(event.which);if($(event.target).is('body')&&/[0-9]/.test(character)){if(this.form_view.get('actual_mode')==='view'){this._display_no_edit_mode_warning();}else{var field=this.form_view.fields[this.m2x_field];var view=field.viewmanager.active_view;var $content=$('<div>').append($('<input>',{type:'text',class:'o_set_qty_input'}));if(this.last_scanned_barcode){this.dialog=new Dialog(this,{title:_t('Set quantity'),buttons:[{text:_t('Select'),classes:'btn-primary',close:true,click:function(){var new_qty=this.$content.find('.o_set_qty_input').val();var record=_.find(self._get_records(field),function(record){return record.get('product_barcode')===self.last_scanned_barcode;});if(record){var values={};values[self.quantity_field]=parseFloat(new_qty);field.data_update(record.get('id'),values).then(function(){view.controller.reload_record(record);});}else{self._display_no_last_scanned_warning();}}},{text:_t('Discard'),close:true}],$content:$content,}).open();this.dialog.$content.find('.o_set_qty_input').focus().val(character);var $selectBtn=this.dialog.$footer.find('.btn-primary');core.bus.on('keypress',this.dialog,function(event){if(event.which===13){event.preventDefault();$selectBtn.click();}});}else{this._display_no_last_scanned_warning();}}}},start_listening:function(){if(this.quantity_field&&!this.is_listening){core.bus.on('keypress',this,this.__quantity_listener);}
BarcodeHandlerMixin.start_listening.call(this);},stop_listening:function(){if(this.quantity_field&&this.is_listening){core.bus.off('keypress',this,this.__quantity_listener);delete this.last_scanned_barcode;}
BarcodeHandlerMixin.stop_listening.call(this);},pre_onchange_hook:function(barcode){return $.Deferred().resolve(true);},on_barcode_scanned:function(barcode){var self=this;self.last_scanned_barcode=barcode;var action=this.map_barcode_method[barcode];if(typeof action==="function")
return $.when(action());if(_.any(BarcodeEvents.ReservedBarcodePrefixes,function(prefix){return barcode.indexOf(prefix)===0}))
return;else if(this.form_view.get('actual_mode')==='view')
this._display_no_edit_mode_warning();else{var process_barcode=function(){var form_onchanges_mutex=function(){return self.form_view.onchanges_mutex.def;}
var commit_mutex=new utils.Mutex();_.each(self.form_view.fields,function(field){commit_mutex.exec(function(){return field.commit_value();});commit_mutex.exec(form_onchanges_mutex);});return commit_mutex.def.then(function(){return self.pre_onchange_hook(barcode).then(function(proceed){if(proceed){self.set_value(barcode);return form_onchanges_mutex();}});});};this.process_barcode_mutex.exec(process_barcode);}},_get_records:function(field){var active_view=field.viewmanager.active_view;if(active_view.type==="kanban"){return active_view.controller.widgets;}else{return active_view.controller.records.records;}},});core.form_widget_registry.add('barcode_handler',FormViewBarcodeHandler);return FormViewBarcodeHandler;});;

/* /barcodes/static/src/js/inherited_form_widget_button.js defined in bundle 'web.assets_backend' */
odoo.define('barcode.InheritedFormWidgetButton',function(require){"use strict";var widgets=require('web.form_widgets');var BarcodeEvents=require('barcodes.BarcodeEvents');var BarcodeHandlerMixin=require('barcodes.BarcodeHandlerMixin');var ButtonBarcodeHandlerMixin=_.extend({},BarcodeHandlerMixin,{init:function(field_manager,node){if(node.attrs.barcode_trigger){BarcodeHandlerMixin.init.call(this,field_manager,node);var self=this;this.on_barcode_scanned=function(barcode){var match=barcode.match(/O-BTN\.(.+)/);if(match&&match[1]===self.node.attrs.barcode_trigger&&(self.$el.is(':visible')||self.$el.parent('.dropdown-menu').length)){self.on_click();}};}else{this._super(field_manager,node);}},});BarcodeEvents.ReservedBarcodePrefixes.push('O-BTN');widgets.WidgetButton.include(ButtonBarcodeHandlerMixin);});;

/* /barcodes/static/src/js/field_float_scannable.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes.FieldFloatScannable',function(require){"use strict";var core=require('web.core');var formats=require('web.formats');var form_widgets=require('web.form_widgets');var FieldFloatScannable=form_widgets.FieldFloat.extend({events:{'keypress':'simulateKeypress',},parse_value:function(val,def){return formats.parse_value(val,{type:"float"},def);},simulateKeypress:function(e){var character=String.fromCharCode(e.which);var current_str=e.target.value;var str_before_carret=current_str.substring(0,e.target.selectionStart);var str_after_carret=current_str.substring(e.target.selectionEnd);e.target.value=str_before_carret+character+str_after_carret;var new_carret_index=str_before_carret.length+character.length;e.target.setSelectionRange(new_carret_index,new_carret_index);this.store_dom_value();},});core.form_widget_registry.add('field_float_scannable',FieldFloatScannable);return{FieldFloatScannable:FieldFloatScannable,};});;

/* /base_import/static/lib/javascript-state-machine/state-machine.js defined in bundle 'web.assets_backend' */
(function(window){StateMachine={VERSION:"2.1.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,ASYNC:4,},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300,},WILDCARD:'*',ASYNC:'async',create:function(cfg,target){var initial=(typeof cfg.initial=='string')?{state:cfg.initial}:cfg.initial;var fsm=target||cfg.target||{};var events=cfg.events||[];var callbacks=cfg.callbacks||{};var map={};var add=function(e){var from=(e.from instanceof Array)?e.from:(e.from?[e.from]:[StateMachine.WILDCARD]);map[e.name]=map[e.name]||{};for(var n=0;n<from.length;n++)
map[e.name][from[n]]=e.to||from[n];};if(initial){initial.event=initial.event||'startup';add({name:initial.event,from:'none',to:initial.state});}
for(var n=0;n<events.length;n++)
add(events[n]);for(var name in map){if(map.hasOwnProperty(name))
fsm[name]=StateMachine.buildEvent(name,map[name]);}
for(var name in callbacks){if(callbacks.hasOwnProperty(name))
fsm[name]=callbacks[name]}
fsm.current='none';fsm.is=function(state){return this.current==state;};fsm.can=function(event){return!this.transition&&(map[event].hasOwnProperty(this.current)||map[event].hasOwnProperty(StateMachine.WILDCARD));}
fsm.cannot=function(event){return!this.can(event);};fsm.error=cfg.error||function(name,from,to,args,error,msg){throw msg;};if(initial&&!initial.defer)
fsm[initial.event]();return fsm;},doCallback:function(fsm,func,name,from,to,args){if(func){try{return func.apply(fsm,[name,from,to].concat(args));}
catch(e){return fsm.error(name,from,to,args,StateMachine.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function");}}},beforeEvent:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onbefore'+name],name,from,to,args);},afterEvent:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onafter'+name]||fsm['on'+name],name,from,to,args);},leaveState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onleave'+from],name,from,to,args);},enterState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onenter'+to]||fsm['on'+to],name,from,to,args);},changeState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onchangestate'],name,from,to,args);},buildEvent:function(name,map){return function(){var from=this.current;var to=map[from]||map[StateMachine.WILDCARD]||from;var args=Array.prototype.slice.call(arguments);if(this.transition)
return this.error(name,from,to,args,StateMachine.Error.PENDING_TRANSITION,"event "+name+" inappropriate because previous transition did not complete");if(this.cannot(name))
return this.error(name,from,to,args,StateMachine.Error.INVALID_TRANSITION,"event "+name+" inappropriate in current state "+this.current);if(false===StateMachine.beforeEvent(this,name,from,to,args))
return StateMachine.CANCELLED;if(from===to){StateMachine.afterEvent(this,name,from,to,args);return StateMachine.NOTRANSITION;}
var fsm=this;this.transition=function(){fsm.transition=null;fsm.current=to;StateMachine.enterState(fsm,name,from,to,args);StateMachine.changeState(fsm,name,from,to,args);StateMachine.afterEvent(fsm,name,from,to,args);};var leave=StateMachine.leaveState(this,name,from,to,args);if(false===leave){this.transition=null;return StateMachine.CANCELLED;}
else if("async"===leave){return StateMachine.ASYNC;}
else{if(this.transition)
this.transition();return StateMachine.SUCCEEDED;}};}};if("function"===typeof define){define("statemachine",[],function(){return StateMachine;});}
else{window.StateMachine=StateMachine;}}(this));;

/* /base_import/static/src/js/base_import.js defined in bundle 'web.assets_backend' */
odoo.define('base_import.import',function(require){"use strict";var ControlPanelMixin=require('web.ControlPanelMixin');var core=require('web.core');var time=require('web.time');var ListView=require('web.ListView');var KanbanView=require('web_kanban.KanbanView');var Model=require('web.DataModel');var session=require('web.session');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var _lt=core._lt;var StateMachine=window.StateMachine;function jsonp(form,attributes,callback){attributes=attributes||{};var options={jsonp:_.uniqueId('import_callback_')};window[options.jsonp]=function(){delete window[options.jsonp];callback.apply(null,arguments);};if('data'in attributes){_.extend(attributes.data,options);}else{_.extend(attributes,{data:options});}
_.extend(attributes,{dataType:'script',});$(form).ajaxSubmit(attributes);}
function execute_import_action(){var self=this;this.do_action({type:'ir.actions.client',tag:'import',params:{model:this.dataset.model,context:this.getParent().action.context,}},{on_reverse_breadcrumb:function(){return self.reload();},});return false;}
ListView.prototype.defaults.import_enabled=true;ListView.include({render_buttons:function(){var self=this;var add_button=false;if(!this.$buttons){add_button=true;}
this._super.apply(this,arguments);if(add_button){this.$buttons.on('click','.o_button_import',execute_import_action.bind(this));}}});KanbanView.include({render_buttons:function(){var self=this;var add_button=false;if(!this.$buttons){add_button=true;}
this._super.apply(this,arguments);if(add_button&&this.$buttons){this.$buttons.on('click','.o_button_import',execute_import_action.bind(this));}},set_default_options:function(options){this._super(_.defaults(options||{},{import_enabled:true,}));},});var DataImport=Widget.extend(ControlPanelMixin,{template:'ImportView',opts:[{name:'encoding',label:_lt("Encoding:"),value:'utf-8'},{name:'separator',label:_lt("Separator:"),value:','},{name:'quoting',label:_lt("Text Delimiter:"),value:'"'}],parse_opts:[{name:'date_format',label:_lt("Date Format:"),value:''},{name:'datetime_format',label:_lt("Datetime Format:"),value:''},{name:'float_thousand_separator',label:_lt("Thousands Separator:"),value:','},{name:'float_decimal_separator',label:_lt("Decimal Separator:"),value:'.'}],events:{'change .oe_import_file':'loaded_file','click .oe_import_file_reload':'loaded_file','change input.oe_import_has_header, .js_import_options input':'settings_changed','change input.oe_import_advanced_mode':function(e){this.do_not_change_match=true;this['settings_changed']();},'click a.oe_import_toggle':function(e){e.preventDefault();this.$('.oe_import_options').toggle();},'click .oe_import_report a.oe_import_report_count':function(e){e.preventDefault();$(e.target).parent().toggleClass('oe_import_report_showmore');},'click .oe_import_moreinfo_action a':function(e){e.preventDefault();var action=JSON.parse($(e.target).attr('data-action'));action.views=_(action.views).map(function(view){var id=view[0],type=view[1];return[id,type!=='tree'?type:action.view_type==='form'?'list':'tree'];});this.do_action(_.extend(action,{target:'new',flags:{search_view:true,display_title:true,pager:true,list:{selectable:false}}}));},},init:function(parent,action){this._super.apply(this,arguments);this.action_manager=parent;this.res_model=action.params.model;this.parent_context=action.params.context||{};this.id=null;this.Import=new Model('base_import.import');this.session=session;action.display_name=_t('Import a File');this.do_not_change_match=false;},start:function(){var self=this;this.setup_encoding_picker();this.setup_separator_picker();this.setup_float_format_picker();return $.when(this._super(),self.create_model().done(function(id){self.id=id;self.$('input[name=import_id]').val(id);self.render_buttons();var status={breadcrumbs:self.action_manager.get_breadcrumbs(),cp_content:{$buttons:self.$buttons},};self.update_control_panel(status);}));},create_model:function(){return this.Import.call('create',[{'res_model':this.res_model}]);},render_buttons:function(){var self=this;this.$buttons=$(QWeb.render("ImportView.buttons",this));this.$buttons.filter('.o_import_validate').on('click',this.validate.bind(this));this.$buttons.filter('.o_import_import').on('click',this.import.bind(this));this.$buttons.filter('.o_import_cancel').on('click',function(e){e.preventDefault();self.exit();});},setup_encoding_picker:function(){this.$('input.oe_import_encoding').select2({width:'160px',query:function(q){var make=function(term){return{id:term,text:term};};var suggestions=_.map(('utf-8 utf-16 windows-1252 latin1 latin2 big5 '+'gb18030 shift_jis windows-1251 koir8_r').split(/\s+/),make);if(q.term){suggestions.unshift(make(q.term));}
q.callback({results:suggestions});},initSelection:function(e,c){return c({id:'utf-8',text:'utf-8'});}}).select2('val','utf-8');},setup_separator_picker:function(){this.$('input.oe_import_separator').select2({width:'160px',query:function(q){var suggestions=[{id:',',text:_t("Comma")},{id:';',text:_t("Semicolon")},{id:'\t',text:_t("Tab")},{id:' ',text:_t("Space")}];if(q.term){suggestions.unshift({id:q.term,text:q.term});}
q.callback({results:suggestions});},initSelection:function(e,c){return c({id:',',text:_t("Comma")});},});},setup_float_format_picker:function(){var sug_query=function(q){var suggestions=[{id:',',text:_t("Comma")},{id:'.',text:_t("Dot")},];if(q.term){suggestions.unshift({id:q.term,text:q.term});}
q.callback({results:suggestions});};this.$('input.oe_import_float_thousand_separator').select2({width:'160px',query:sug_query,initSelection:function(e,c){return c({id:',',text:_t("Comma")});},});this.$('input.oe_import_float_decimal_separator').select2({width:'160px',query:sug_query,initSelection:function(e,c){return c({id:',',text:_t("Dot")});},});},import_options:function(){var self=this;var options={headers:this.$('input.oe_import_has_header').prop('checked'),advanced:this.$('input.oe_import_advanced_mode').prop('checked'),keep_matches:this.do_not_change_match};_(this.opts).each(function(opt){options[opt.name]=self.$('input.oe_import_'+opt.name).val();});_(this.parse_opts).each(function(opt){if(opt.name==='date_format'||opt.name==='datetime_format'){options[opt.name]=time.moment_to_strftime_format(self.$('input.oe_import_'+opt.name).val());}
else{options[opt.name]=self.$('input.oe_import_'+opt.name).val();}});options['fields']=[];if(this.do_not_change_match){options['fields']=this.$('.oe_import_fields input.oe_import_match_field').map(function(index,el){return $(el).select2('val')||false;}).get();}
this.do_not_change_match=false;return options;},onfile_loaded:function(){var file=this.$('.oe_import_file')[0].files[0];this.$('.oe_import_file_show').val(file!==undefined&&file.name||'');this.$buttons.filter('.o_import_button').add(this.$('.oe_import_file_reload')).prop('disabled',true);if(!this.$('input.oe_import_file').val()){return this['settings_changed']();}
this.$('.oe_import_date_format').val('');this.$('.oe_import_datetime_format').val('');this.$el.removeClass('oe_import_preview oe_import_error');var import_toggle=false;var file=this.$('input.oe_import_file')[0].files[0];if((file.type&&_.last(file.type.split('/'))==="csv")||(_.last(file.name.split('.'))==="csv")){import_toggle=true;}
this.$el.find('.oe_import_toggle').toggle(import_toggle);jsonp(this.$el,{url:'/base_import/set_file'},this.proxy('settings_changed'));},onpreviewing:function(){var self=this;this.$buttons.filter('.o_import_button').add(this.$('.oe_import_file_reload')).prop('disabled',true);this.$el.addClass('oe_import_with_file');this.$el.removeClass('oe_import_preview_error oe_import_error');this.$el.toggleClass('oe_import_noheaders',!this.$('input.oe_import_has_header').prop('checked'));this.Import.call('parse_preview',[this.id,this.import_options()]).done(function(result){var signal=result.error?'preview_failed':'preview_succeeded';self[signal](result);});},onpreview_error:function(event,from,to,result){this.$('.oe_import_options').show();this.$('.oe_import_file_reload').prop('disabled',false);this.$el.addClass('oe_import_preview_error oe_import_error');this.$('.oe_import_error_report').html(QWeb.render('ImportView.preview.error',result));},onpreview_success:function(event,from,to,result){var self=this;this.$buttons.filter('.o_import_import').removeClass('btn-primary');this.$buttons.filter('.o_import_validate').addClass('btn-primary');this.$buttons.filter('.o_import_button').add(this.$('.oe_import_file_reload')).prop('disabled',false);this.$el.addClass('oe_import_preview');this.$('input.oe_import_advanced_mode').prop('checked',result.advanced_mode);this.$('.oe_import_grid').html(QWeb.render('ImportView.preview',result));if(result.headers.length===1){this.$('.oe_import_options').show();this.onresults(null,null,null,[{type:'warning',message:_t("A single column was found in the file, this often means the file separator is incorrect")}]);}
this.$('.oe_import_date_format').val(time.strftime_to_moment_format(result.options.date_format));this.$('.oe_import_datetime_format').val(time.strftime_to_moment_format(result.options.datetime_format));this.$('.oe_import_float_thousand_separator').val(result.options.float_thousand_separator).change();this.$('.oe_import_float_decimal_separator').val(result.options.float_decimal_separator).change();if(result.debug===false){this.$('.oe_import_tracking').hide();}
var $fields=this.$('.oe_import_fields input');this.render_fields_matches(result,$fields);var data=this.generate_fields_completion(result);var item_finder=function(id,items){items=items||data;for(var i=0;i<items.length;++i){var item=items[i];if(item.id===id){return item;}
var val;if(item.children&&(val=item_finder(id,item.children))){return val;}}
return'';};$fields.each(function(k,v){var filtered_data=self.generate_fields_completion(result,k);$(v).select2({allowClear:true,minimumInputLength:0,data:filtered_data,initSelection:function(element,callback){var default_value=element.val();if(!default_value){callback('');return;}
callback(item_finder(default_value));},placeholder:_t('Don\'t import'),width:'resolve',dropdownCssClass:'oe_import_selector'});});},generate_fields_completion:function(root,index){var basic=[];var regulars=[];var o2m=[];var headers_type=root.headers_type;function traverse(field,ancestors,collection,type){var subfields=field.fields;var advanced_mode=self.$('input.oe_import_advanced_mode').prop('checked');var field_path=ancestors.concat(field);var label=_(field_path).pluck('string').join(' / ');var id=_(field_path).pluck('name').join('/');if(type===undefined||(type!==undefined&&(type.indexOf('all')!==-1||type.indexOf(field['type'])!==-1))){if(!collection){if(field.name==='id'){collection=basic;}else if(_.isEmpty(subfields)||_.isEqual(_.pluck(subfields,'name'),['id','.id'])){collection=regulars;}else{collection=o2m;}}
collection.push({id:id,text:label,required:field.required});}
if(advanced_mode){for(var i=0,end=subfields.length;i<end;++i){traverse(subfields[i],field_path,collection,type);}}}
_(root.fields).each(function(field){if(index===undefined){traverse(field,[]);}
else{if(self.$('input.oe_import_advanced_mode').prop('checked')){traverse(field,[],undefined,['all']);}
else{traverse(field,[],undefined,headers_type[index]);}}});var cmp=function(field1,field2){return field1.text.localeCompare(field2.text);};regulars.sort(cmp);o2m.sort(cmp);if(!_.isEmpty(regulars)&&!_.isEmpty(o2m)){basic=basic.concat([{text:_t("Normal Fields"),children:regulars},{text:_t("Relation Fields"),children:o2m},]);}
else if(!_.isEmpty(regulars)){basic=basic.concat(regulars);}
else if(!_.isEmpty(o2m)){basic=basic.concat(o2m);}
return basic;},render_fields_matches:function(result,$fields){if(_(result.matches).isEmpty()){return;}
$fields.each(function(index,input){var match=result.matches[index];if(!match){return;}
var current_field=result;input.value=_(match).chain().map(function(name){return current_field=_(current_field.fields).find(function(subfield){return subfield.name===name;});}).pluck('name').value().join('/');});},call_import:function(kwargs){var fields=this.$('.oe_import_fields input.oe_import_match_field').map(function(index,el){return $(el).select2('val')||false;}).get();var tracking_disable='tracking_disable'in kwargs?kwargs.tracking_disable:!this.$('#oe_import_tracking').prop('checked')
delete kwargs.tracking_disable
kwargs.context=_.extend({},this.parent_context,{tracking_disable:tracking_disable});return this.Import.call('do',[this.id,fields,this.import_options()],kwargs).then(undefined,function(error,event){if(event){event.preventDefault();}
return $.when([{type:'error',record:false,message:error.data.arguments&&error.data.arguments[1]||error.message,}]);});},onvalidate:function(){return this.call_import({dryrun:true,tracking_disable:true}).done(this.proxy('validated'));},onimport:function(){var self=this;return this.call_import({dryrun:false}).done(function(message){if(!_.any(message,function(message){return message.type==='error';})){self['import_succeeded']();return;}
self['import_failed'](message);});},onimported:function(){this.exit();},exit:function(){this.do_action({type:'ir.actions.client',tag:'history_back'});},onresults:function(event,from,to,message){var no_messages=_.isEmpty(message);this.$buttons.filter('.o_import_import').toggleClass('btn-primary',no_messages);this.$buttons.filter('.o_import_import').toggleClass('btn-default',!no_messages);this.$buttons.filter('.o_import_validate').toggleClass('btn-primary',!no_messages);this.$buttons.filter('.o_import_validate').toggleClass('btn-default',no_messages);if(no_messages){message.push({type:'info',message:_t("Everything seems valid.")});}
var offset=1;if(this.import_options().headers){offset+=1;}
this.$el.addClass('oe_import_error');this.$('.oe_import_error_report').html(QWeb.render('ImportView.error',{errors:_(message).groupBy('message'),at:function(rows){var from=rows.from+offset;var to=rows.to+offset;if(from===to){return _.str.sprintf(_t("at row %d"),from);}
return _.str.sprintf(_t("between rows %d and %d"),from,to);},more:function(n){return _.str.sprintf(_t("(%d more)"),n);},info:function(msg){if(typeof msg==='string'){return _.str.sprintf('<div class="oe_import_moreinfo oe_import_moreinfo_message">%s</div>',_.str.escapeHTML(msg));}
if(msg instanceof Array){return _.str.sprintf('<div class="oe_import_moreinfo oe_import_moreinfo_choices">%s <ul>%s</ul></div>',_.str.escapeHTML(_t("Here are the possible values:")),_(msg).map(function(msg){return'<li>'
+_.str.escapeHTML(msg)
+'</li>';}).join(''));}
return['<div class="oe_import_moreinfo oe_import_moreinfo_action">',_.str.sprintf('<a href="#" data-action="%s">',_.str.escapeHTML(JSON.stringify(msg))),_.str.escapeHTML(_t("Get all possible values")),'</a>','</div>'].join('');},}));},});core.action_registry.add('import',DataImport);StateMachine.create({target:DataImport.prototype,events:[{name:'loaded_file',from:['none','file_loaded','preview_error','preview_success','results'],to:'file_loaded'},{name:'settings_changed',from:['file_loaded','preview_error','preview_success','results'],to:'previewing'},{name:'preview_failed',from:'previewing',to:'preview_error'},{name:'preview_succeeded',from:'previewing',to:'preview_success'},{name:'validate',from:'preview_success',to:'validating'},{name:'validate',from:'results',to:'validating'},{name:'validated',from:'validating',to:'results'},{name:'import',from:['preview_success','results'],to:'importing'},{name:'import_succeeded',from:'importing',to:'imported'},{name:'import_failed',from:'importing',to:'results'}]});return{DataImport:DataImport,}});;

/* /board/static/src/js/dashboard.js defined in bundle 'web.assets_backend' */
odoo.define('board.dashboard',function(require){"use strict";var ActionManager=require('web.ActionManager');var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var FavoriteMenu=require('web.FavoriteMenu');var form_common=require('web.form_common');var Model=require('web.DataModel');var pyeval=require('web.pyeval');var ViewManager=require('web.ViewManager');var _t=core._t;var QWeb=core.qweb;var DashBoard=form_common.FormWidget.extend({events:{'click .oe_dashboard_link_change_layout':'on_change_layout','click h2.oe_header span.oe_header_txt':function(ev){if(ev.target===ev.currentTarget)
this.on_header_string($(ev.target).parent());},'click .oe_dashboard_column .oe_fold':'on_fold_action','click .oe_dashboard_column .oe_close':'on_close_action',},init:function(view,node){this._super(view,node);this.form_template='DashBoard';this.actions_attrs={};this.action_managers=[];this.set_title=_t('My Dashboard');},start:function(){var self=this;this._super.apply(this,arguments);this.$el.addClass('o_dashboard');this.$('.oe_dashboard_column').sortable({connectWith:'.oe_dashboard_column',handle:'.oe_header',scroll:false}).bind('sortstop',self.do_save_dashboard);var old_title=this.__parentedParent.get('title');self.__parentedParent.set({'title':this.set_title});this.__parentedParent.on('load_record',self,function(){self.__parentedParent.set({'title':old_title});});_.each(this.node.children,function(column,column_index){_.each(column.children,function(action,action_index){delete(action.attrs.width);delete(action.attrs.height);delete(action.attrs.colspan);var action_id=_.str.toNumber(action.attrs.name);if(!_.isNaN(action_id)){self.rpc('/web/action/load',{action_id:action_id}).done(function(result){self.on_load_action(result,column_index+'_'+action_index,action.attrs);});}});});},on_header_string:function(h2){var self=this;var span=h2.find('span:first').hide();var input=h2.find('.oe_header_text').css('visibility','visible');var attr=h2.closest(".oe_action").data('action_attrs');var change_string=function(new_name){attr['string']=new_name;span.text(new_name).show();input.css('visibility','hidden');self.do_save_dashboard();};input.unbind().val(span.text()).change(function(event){change_string($(this).val());}).keyup(function(event){if(event.keyCode==27){input.css('visibility','hidden');span.show();}});},on_change_layout:function(){var self=this;var qdict={current_layout:this.$el.find('.oe_dashboard').attr('data-layout')};var dialog=new Dialog(this,{title:_t("Edit Layout"),$content:QWeb.render('DashBoard.layouts',qdict)}).open();dialog.$el.find('li').click(function(){var layout=$(this).attr('data-layout');self.do_change_layout(layout);dialog.close();});},do_change_layout:function(new_layout){var $dashboard=this.$el.find('.oe_dashboard');var current_layout=$dashboard.attr('data-layout');if(current_layout!=new_layout){var clayout=current_layout.split('-').length,nlayout=new_layout.split('-').length,column_diff=clayout-nlayout;if(column_diff>0){var $last_column=$();$dashboard.find('.oe_dashboard_column').each(function(k,v){if(k>=nlayout){$(v).find('.oe_action').appendTo($last_column);}else{$last_column=$(v);}});}
$dashboard.toggleClass('oe_dashboard_layout_'+current_layout+' oe_dashboard_layout_'+new_layout);$dashboard.attr('data-layout',new_layout);this.do_save_dashboard();}},on_fold_action:function(e){var $e=$(e.currentTarget),$action=$e.parents('.oe_action:first'),id=parseInt($action.attr('data-id'),10);if($e.is('.oe_minimize')){$action.data('action_attrs').fold='1';}else{delete($action.data('action_attrs').fold);}
$e.toggleClass('oe_minimize oe_maximize');$action.find('.oe_content').toggle();this.do_save_dashboard();},on_close_action:function(e){if(confirm(_t("Are you sure you want to remove this item ?"))){var $container=$(e.currentTarget).parents('.oe_action:first');var am=_.findWhere(this.action_managers,{am_id:$container.data('am_id')});am.destroy();this.action_managers.splice(_.indexOf(this.action_managers,am),1);$container.remove();this.do_save_dashboard();}},do_save_dashboard:function(){var board={form_title:this.view.fields_view.arch.attrs.string,style:this.$el.find('.oe_dashboard').attr('data-layout'),columns:[]};this.$el.find('.oe_dashboard_column').each(function(){var actions=[];$(this).find('.oe_action').each(function(){var action_id=$(this).attr('data-id'),new_attrs=_.clone($(this).data('action_attrs'));if(new_attrs.domain){new_attrs.domain=new_attrs.domain_string;delete(new_attrs.domain_string);}
if(new_attrs.context){new_attrs.context=new_attrs.context_string;delete(new_attrs.context_string);}
actions.push(new_attrs);});board.columns.push(actions);});var arch=QWeb.render('DashBoard.xml',board);this.rpc('/web/view/add_custom',{view_id:this.view.fields_view.view_id,arch:arch});},on_load_action:function(result,index,action_attrs){var self=this,action=result,view_mode=action_attrs.view_mode;if(!action){return;}
action_attrs.context_string=action_attrs.context;action_attrs.context=pyeval.eval('context',action_attrs.context||{});action_attrs.domain_string=action_attrs.domain;action_attrs.domain=pyeval.eval('domain',action_attrs.domain||[],action_attrs.context);if(action_attrs.context['dashboard_merge_domains_contexts']===false){action.context=action_attrs.context||{};action.domain=action_attrs.domain||[];}else{action.context=pyeval.eval('contexts',[action.context||{},action_attrs.context]);action.domain=pyeval.eval('domains',[action_attrs.domain,action.domain||[]],action.context);}
var action_orig=_.extend({flags:{}},action);if(view_mode&&view_mode!=action.view_mode){action.views=_.map(view_mode.split(','),function(mode){mode=mode==='tree'?'list':mode;return _(action.views).find(function(view){return view[1]==mode;})||[false,mode];});}
action.flags={search_view:true,sidebar:false,views_switcher:false,action_buttons:false,pager:false,headless:true,low_profile:true,display_title:false,search_disable_custom_filters:true,list:{selectable:false}};var am=new ActionManager(this),$action=$('#'+this.view.element_id+'_action_'+index);var $action_container=$action.closest('.oe_action');var am_id=_.uniqueId('action_manager_');am.am_id=am_id;$action_container.data({action_attrs:action_attrs,am_id:am_id,});this.action_managers.push(am);am.appendTo($action).then(function(){am.do_action(action).then(function(){if(am.inner_widget){var new_form_action=function(id,editable){var new_views=[];_.each(action_orig.views,function(view){new_views[view[1]==='form'?'unshift':'push'](view);});if(!new_views.length||new_views[0][1]!=='form'){new_views.unshift([false,'form']);}
action_orig.views=new_views;action_orig.res_id=id;action_orig.flags={form:{"initial_mode":editable?"edit":"view",}};self.do_action(action_orig);};var list=am.inner_widget.views.list;if(list){list.loaded.done(function(){$(list.controller.groups).off('row_link').on('row_link',function(e,id){new_form_action(id);});});}
var kanban=am.inner_widget.views.kanban;if(kanban){kanban.loaded.done(function(){kanban.controller.open_record=function(event,editable){new_form_action(event.data.id,editable);};});}}});am.do_action=self.do_action.bind(self);am.current_action_updated=function(){};});},renderElement:function(){this._super();var check=_.detect(this.node.children,function(column,column_index){return _.detect(column.children,function(element){return element.tag==="action"?element:false;});});if(!check){return this.no_result();}
for(var i=this.node.children.length;i<3;i++){this.node.children.push({tag:'column',attrs:{},children:[]});}
var rendered=QWeb.render(this.form_template,this);this.$el.html(rendered);},no_result:function(){if(this.view.options.action.help){this.$el.append($('<div class="oe_view_nocontent">').append($('<div>').html(this.view.options.action.help||" ")));}},do_reload:function(){var view_manager=this.view.getParent(),action_manager=view_manager.getParent();this.view.destroy();action_manager.do_action(view_manager.action);}});var DashBoardLegacy=DashBoard.extend({renderElement:function(){if(this.node.tag=='hpaned'){this.node.attrs.layout='2-1';}else if(this.node.tag=='vpaned'){this.node.attrs.layout='1';}
this.node.tag='board';_.each(this.node.children,function(child){if(child.tag.indexOf('child')===0){child.tag='column';var actions=[],first_child=child.children[0];if(first_child&&first_child.tag=='vpaned'){_.each(first_child.children,function(subchild){actions.push.apply(actions,subchild.children);});child.children=actions;}}});this._super(this);}});core.form_tag_registry.add('hpaned',DashBoardLegacy).add('vpaned',DashBoardLegacy).add('board',DashBoard);FavoriteMenu.include({start:function(){var self=this;if(this.action_id===undefined){return this._super();}
var am=this.findAncestor(function(a){return a instanceof ActionManager;});if(am&&am.get_inner_widget()instanceof ViewManager){this.view_manager=am.get_inner_widget();this.add_to_dashboard_available=true;this.$('.o_favorites_menu').append(QWeb.render('SearchView.addtodashboard'));this.$add_to_dashboard=this.$('.o_add_to_dashboard');this.$add_dashboard_btn=this.$add_to_dashboard.eq(1).find('button');this.$add_dashboard_input=this.$add_to_dashboard.eq(0).find('input');this.$add_dashboard_link=this.$('.o_add_to_dashboard_link');var title=this.searchview.get_title();this.$add_dashboard_input.val(title);this.$add_dashboard_link.click(function(e){e.preventDefault();self.toggle_dashboard_menu();});this.$add_dashboard_btn.click(this.proxy('add_dashboard'));}
return this._super();},toggle_dashboard_menu:function(is_open){this.$add_dashboard_link.toggleClass('o_closed_menu',!(_.isUndefined(is_open))?!is_open:undefined).toggleClass('o_open_menu',is_open);this.$add_to_dashboard.toggle(is_open);if(this.$add_dashboard_link.hasClass('o_open_menu')){this.$add_dashboard_input.focus();}},close_menus:function(){if(this.add_to_dashboard_available){this.toggle_dashboard_menu(false);}
this._super();},add_dashboard:function(){var self=this;var search_data=this.searchview.build_search_data(),context=new data.CompoundContext(this.searchview.dataset.get_context()||[]),domain=new data.CompoundDomain(this.searchview.dataset.get_domain()||[]);_.each(search_data.contexts,context.add,context);_.each(search_data.domains,domain.add,domain);context.add({group_by:pyeval.eval('groupbys',search_data.groupbys||[])});context.add(this.view_manager.active_view.controller.get_context());var c=pyeval.eval('context',context);for(var k in c){if(c.hasOwnProperty(k)&&/^search_default_/.test(k)){delete c[k];}}
this.toggle_dashboard_menu(false);c.dashboard_merge_domains_contexts=false;var d=pyeval.eval('domain',domain),board=new Model('board.board'),name=self.$add_dashboard_input.val();return self.rpc('/board/add_to_dashboard',{action_id:self.action_id||false,context_to_save:c,domain:d,view_mode:self.view_manager.active_view.type,name:name,}).then(function(r){if(r){self.do_notify(_.str.sprintf(_t("'%s' added to dashboard"),name),'');}else{self.do_warn(_t("Could not add filter to dashboard"));}});},});});;

/* /calendar/static/src/js/base_calendar.js defined in bundle 'web.assets_backend' */
odoo.define('base_calendar.base_calendar',function(require){"use strict";var bus=require('bus.bus').bus;var core=require('web.core');var CalendarView=require('web_calendar.CalendarView');var data=require('web.data');var Dialog=require('web.Dialog');var form_common=require('web.form_common');var Model=require('web.DataModel');var Notification=require('web.notification').Notification;var session=require('web.session');var WebClient=require('web.WebClient');var widgets=require('web_calendar.widgets');var FieldMany2ManyTags=core.form_widget_registry.get('many2many_tags');var _t=core._t;var _lt=core._lt;var QWeb=core.qweb;CalendarView.include({extraSideBar:function(){var result=this._super();if(this.useContacts){return result.then(this.sidebar.filter.initialize_favorites.bind(this.sidebar.filter));}
return result;},get_all_filters_ordered:function(){var filters=this._super();if(this.useContacts){var filter_me=_.first(_.values(this.all_filters));var filter_all=this.all_filters[-1];filters=[].concat(filter_me,_.difference(filters,[filter_me,filter_all]),filter_all);}
return filters;}});var FieldMany2One=core.form_widget_registry.get('many2one');var SidebarFilterM2O=FieldMany2One.extend({get_search_blacklist:function(){return this._super.apply(this,arguments).concat(this.filter_ids);},set_filter_ids:function(filter_ids){this.filter_ids=filter_ids;},});widgets.SidebarFilter.include({events:_.extend(widgets.SidebarFilter.prototype.events,{'click .o_remove_contact':'on_remove_filter',}),init:function(){this._super.apply(this,arguments);this.ds_contacts=new data.DataSet(this,'calendar.contacts',session.context);},initialize_favorites:function(){return this.load_favorite_list().then(this.initialize_m2o.bind(this));},initialize_m2o:function(){this.dfm=new form_common.DefaultFieldManager(this);this.dfm.extend_field_desc({partner_id:{relation:"res.partner",},});this.m2o=new SidebarFilterM2O(this.dfm,{attrs:{class:'o_add_favorite_calendar',name:"partner_id",type:"many2one",options:'{"no_open": True}',placeholder:_t("Add Favorite Calendar"),},});this.m2o.set_filter_ids(_.pluck(this.view.all_filters,'value'));this.m2o.appendTo(this.$el);var self=this;this.m2o.on('change:value',this,function(){if(self.m2o.get_value()){self.on_add_filter();}});},load_favorite_list:function(){var self=this;var active_partner=(this.view.dataset.context.active_model==='res.partner');return session.is_bound.then(function(){self.view.all_filters={};self.view.now_filter_ids=[];self._add_filter(session.partner_id,session.name+_lt(" [Me]"),!active_partner);self._add_filter(-1,_lt("Everybody's calendars"),false,false);return new Model("calendar.contacts").query(["partner_id"]).filter([["user_id","=",session.uid]]).all().then(function(result){_.each(result,function(item){self._add_filter(item.partner_id[0],item.partner_id[1],!active_partner,true);});self.view.now_filter_ids=_.pluck(self.view.all_filters,'value');self.render();});});},reload:function(){this.trigger_up('reload_events');this.render();this.m2o.set_filter_ids(_.pluck(this.view.all_filters,'value'));this.m2o.set_value(false);},_add_filter:function(value,label,is_checked,can_be_removed){this.view.all_filters[value]={value:value,label:label,color:this.view.get_color(value),avatar_model:this.view.avatar_model,is_checked:is_checked||false,can_be_removed:can_be_removed||false,};if(is_checked){this.view.now_filter_ids.push(value);}},_remove_filter:function(value){delete this.view.all_filters[value];var index=this.view.now_filter_ids.indexOf(value);if(index>=0){this.view.now_filter_ids.splice(index,1);}},on_add_filter:function(){var self=this;var defs=[];_.each(this.m2o.display_value,function(element,index){if(session.partner_id!==index){defs.push(self.ds_contacts.call("create",[{'partner_id':index}]).then(function(){self._add_filter(parseInt(index),element,true,true);self.reload();}));}});return $.when.apply(null,defs).then(this.reload.bind(this));},on_remove_filter:function(e){var self=this;var id=$(e.currentTarget).data('id');Dialog.confirm(this,_t("Do you really want to delete this filter from favorites ?"),{confirm_callback:function(){self.ds_contacts.call('unlink_from_partner_id',[id]).then(function(){self._remove_filter(id);self.reload();});},});},});var CalendarNotification=Notification.extend({template:"CalendarNotification",init:function(parent,title,text,eid){this._super(parent,title,text,true);this.eid=eid;this.events=_.extend(this.events||{},{'click .link2event':function(){var self=this;this.rpc("/web/action/load",{action_id:"calendar.action_calendar_event_notify",}).then(function(r){r.res_id=self.eid;return self.do_action(r);});},'click .link2recall':function(){this.destroy(true);},'click .link2showed':function(){this.destroy(true);this.rpc("/calendar/notify_ack");},});},});WebClient.include({display_calendar_notif:function(notifications){var self=this;var last_notif_timer=0;clearTimeout(this.get_next_calendar_notif_timeout);_.each(this.calendar_notif_timeouts,clearTimeout);_.each(this.calendar_notif,function(notif){if(!notif.isDestroyed()){notif.destroy();}});this.calendar_notif_timeouts={};this.calendar_notif={};_.each(notifications,function(notif){self.calendar_notif_timeouts[notif.event_id]=setTimeout(function(){var notification=new CalendarNotification(self.notification_manager,notif.title,notif.message,notif.event_id);self.notification_manager.display(notification);self.calendar_notif[notif.event_id]=notification;},notif.timer*1000);last_notif_timer=Math.max(last_notif_timer,notif.timer);});if(last_notif_timer>0){this.get_next_calendar_notif_timeout=setTimeout(this.get_next_calendar_notif.bind(this),last_notif_timer*1000);}},get_next_calendar_notif:function(){this.rpc("/calendar/notify",{},{shadow:true}).done(this.display_calendar_notif.bind(this)).fail(function(err,ev){if(err.code===-32098){ev.preventDefault();}});},show_application:function(){this.calendar_notif_timeouts={};this.calendar_notif={};bus.on('notification',this,function(notifications){_.each(notifications,(function(notification){if(notification[0][1]==='calendar.alarm'){this.display_calendar_notif(notification[1]);}}).bind(this));});return this._super.apply(this,arguments).then(this.get_next_calendar_notif.bind(this));},});var Many2ManyAttendee=FieldMany2ManyTags.extend({tag_template:"Many2ManyAttendeeTag",get_render_data:function(ids){return this.dataset.call('get_attendee_detail',[ids,this.getParent().datarecord.id||false]).then(process_data);function process_data(data){return _.map(data,function(d){return _.object(['id','display_name','status','color'],d);});}},});core.form_widget_registry.add('many2manyattendee',Many2ManyAttendee);});;

/* /crm/static/src/js/web_planner_crm.js defined in bundle 'web.assets_backend' */
odoo.define('planner_crm.planner',function(require){"use strict";var planner=require('web.planner.common');var core=require('web.core');var _t=core._t;planner.PlannerDialog.include({prepare_planner_event:function(){var self=this;this._super.apply(this,arguments);if(self.planner['planner_application']=='planner_crm'){var stages={'solution_selling':[_t('Territory'),_t('Qualified'),_t('Qualified Sponsor'),_t('Proposal'),_t('Negotiation'),_t('Won'),'',_t('New propspect assigned to the right salesperson'),_t('Set fields: Expected Revenue, Expected Closing Date, Next Action'),_t('You are in discussion with the decision maker and HE agreed on his pain points'),_t('Quotation sent to customer'),_t('The customer came back to you to discuss your quotation'),_t('Quotation signed by the customer'),''],'b2c':[_t('New'),_t('Initial Contact'),_t('Product Demonstration'),_t('Proposal'),_t('Won'),'','','',_t('Phone call with following questions: ...'),_t('Meeting with a demo. Set Fields: expected revenue, closing date'),_t('Quotation sent'),'','',''],'b2b':[_t('New'),_t('Qualified'),_t('Needs assessment'),_t('POC Sold'),_t('Demonstration'),_t('Proposal'),_t('Won'),_t('Set fields: Expected Revenue, Expected Closing Date, Next Action'),_t('Close opportunity if: "pre-sales days * $500" < "expected revenue" * probability'),_t('GAP analysis with customer'),_t('Create a Proof of Concept with consultants'),_t('POC demonstration to the customer'),_t('Final Proposal sent'),''],'odoo_default':[_t('New'),_t('Qualified'),_t('Proposition'),_t('Negotiation'),_t('Won'),_t('Lost'),'','','','','','','','']}
self.$el.on('change','#input_element_pipeline',function(ev){var option=$(ev.target).find(":selected").val();if(_.has(stages,option)){var values=stages[option];for(var i=0;i<values.length;i++){$('#input_element_stage_'+i).val(values[i]);}}});}}});});;

/* /crm/static/src/js/sales_team_dashboard.js defined in bundle 'web.assets_backend' */
odoo.define('crm.sales_team_dashboard',function(require){"use strict";var SalesTeamDashboardView=require('sales_team.dashboard');var Model=require('web.Model');SalesTeamDashboardView.include({fetch_data:function(){return new Model('crm.lead').call('retrieve_sales_dashboard',[]);}});});;

/* /crm/static/src/js/tour.js defined in bundle 'web.assets_backend' */
odoo.define('crm.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('crm_tour',{url:"/web",},[tour.STEPS.MENU_MORE,{trigger:'.o_app[data-menu-xmlid="sales_team.menu_base_partner"], .oe_menu_toggler[data-menu-xmlid="sales_team.menu_base_partner"]',content:_t("Ready to boost you sales? Your <b>sales pipeline</b> can be found here, under this app."),position:'bottom',},{trigger:".o_sales_dashboard .o_dashboard_action[name=\"crm.action_your_pipeline\"]:last",extra_trigger:'.o_sales_dashboard',content:_t("Let\'s have a look at your opportunities pipeline."),position:"bottom"},{trigger:".o-kanban-button-new",extra_trigger:'.o_opportunity_kanban',content:_t("Click here to <b>create your first opportunity</b> and add it to your pipeline."),position:"right"},{trigger:".modal-body input:first",auto:true,run:function(actions){actions.auto();actions.auto(".modal-footer .btn-primary");},},{trigger:".o_opportunity_kanban .o_kanban_group:first-child .o_kanban_record:last-child",content:_t("<b>Drag &amp; drop opportunities</b> between columns as you progress in your sales cycle."),position:"right",run:"drag_and_drop .o_opportunity_kanban .o_kanban_group:eq(2) ",},{trigger:".o_kanban_record:not(.o_updating) .oe_kanban_status_grey",extra_trigger:".o_opportunity_kanban",content:_t("This opportunity has <b>no next activity scheduled</b>. <i>Click to set one.</i>"),position:"bottom"},{trigger:".o_recommended_activity .o_radio_item",extra_trigger:".o_opportunity_kanban",content:_t("<p>You will be able to customize your followup activities. Examples:</p><ol><li>introductory email</li><li>call 10 days after</li><li>second call 3 days after, ...</li></ol><p class='mb0'><i>Select a standard activity for now on.</i></p>"),position:"left",run:function(actions){actions.auto(this.$anchor.children("input").first());actions.auto(".modal-footer .btn-primary");},},{trigger:".o_kanban_record",extra_trigger:".o_opportunity_kanban",content:_t("Click on an opportunity to zoom to it."),position:"bottom",run:function(actions){actions.auto(".o_kanban_record .oe_kanban_action[data-type=edit]");},},{trigger:".o_opportunity_form .o_chatter_button_new_message",content:_t('<p><b>Send messages</b> to your prospect and get replies automatically attached to this opportunity.</p><p class="mb0">Type <i>\'@\'</i> to mention people - it\'s like cc-ing on emails.</p>'),position:"top"},{trigger:".breadcrumb li:not(.active):last",extra_trigger:'.o_opportunity_form',content:_t("Use the breadcrumbs to <b>go back to your sales pipeline</b>."),position:"bottom"},tour.STEPS.TOGGLE_APPSWITCHER,tour.STEPS.MENU_MORE,{trigger:'.o_app[data-menu-xmlid="base.menu_administration"], .oe_menu_toggler[data-menu-xmlid="base.menu_administration"]',content:_t("Configuration options are available in the Settings app."),position:"bottom"},{trigger:".o_web_settings_dashboard textarea#user_emails",content:_t("<b>Invite coworkers</b> via email.<br/><i>Enter one email per line.</i>"),position:"right"},tour.STEPS.TOGGLE_APPSWITCHER,tour.STEPS.MENU_MORE,{trigger:'.o_app[data-menu-xmlid="sales_team.menu_base_partner"], .oe_menu_toggler[data-menu-xmlid="sales_team.menu_base_partner"]',content:_t("Good job! Your completed the tour of the CRM. You can continue with the <b>implementation guide</b> to help you setup the CRM in your company."),position:'bottom',},{trigger:'.o_planner_systray div.progress',content:_t("Use the <b>implementation guide</b> to setup the CRM in your company."),position:'bottom',}]);});;

/* /document/static/src/js/document.js defined in bundle 'web.assets_backend' */
odoo.define('document.document',function(require){"use strict";var core=require('web.core');var Sidebar=require('web.Sidebar');var _t=core._t;Sidebar.include({init:function(){this._super.apply(this,arguments);var view=this.getParent();if(view.fields_view&&view.fields_view.type==="form"){this.sections.splice(1,0,{'name':'files','label':_t('Attachment(s)'),});this.items.files=[];}},on_attachments_loaded:function(attachments){var self=this;_.chain(attachments).groupBy(function(attachment){return attachment.name;}).each(function(attachment){if(attachment.length>1)
_.map(attachment,function(attachment,i){attachment.name=_.str.sprintf(_t("%s (%s)"),attachment.name,i+1);});});self._super(attachments);},});});;

/* /point_of_sale/static/src/js/tour.js defined in bundle 'web.assets_backend' */
odoo.define('point_of_sale.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('point_of_sale_tour',{url:"/web",},[{trigger:'.o_app[data-menu-xmlid="point_of_sale.menu_point_root"], .oe_menu_toggler[data-menu-xmlid="point_of_sale.menu_point_root"]',content:_t("Ready to launch your <b>point of sale</b>? <i>Click here</i>."),position:'bottom',},{trigger:".o_pos_kanban button.oe_kanban_action_button",content:_t("<p>Click to start the point of sale interface. It <b>runs on tablets</b>, laptops, or industrial hardware.</p><p>Once the session launched, the system continues to run without an internet connection.</p>"),position:"bottom"}]);});;

/* /hr_attendance/static/src/js/employee_kanban_view_handler.js defined in bundle 'web.assets_backend' */
odoo.define('hr_attendance.employee_kanban_view_handler',function(require){"use strict";var KanbanRecord=require('web_kanban.Record');KanbanRecord.include({on_card_clicked:function(){if(this.model==='hr.employee'&&this.$el.parents('.o_hr_employee_attendance_kanban').length){var action={type:'ir.actions.client',name:'Confirm',tag:'hr_attendance_kiosk_confirm',employee_id:this.record.id.raw_value,employee_name:this.record.name.raw_value,employee_state:this.record.attendance_state.raw_value,};this.do_action(action);}else{this._super.apply(this,arguments);}}});});;

/* /hr_attendance/static/src/js/presence_widgets.js defined in bundle 'web.assets_backend' */
odoo.define('hr_attendance.presence_widgets',function(require){"use strict";var core=require('web.core');var form_common=require('web.form_common');var kanban_widgets=require('web_kanban.widgets');var QWeb=core.qweb;var _t=core._t;var FormPresenceIndicator=form_common.AbstractField.extend({init:function(){this._super.apply(this,arguments);},start:function(){this.display_field();this.$el.tooltip({title:_t("employee presence<br/>green: checked in<br/>red: checked out"),trigger:'hover'});return this._super();},render_value:function(){this.$('.oe_hr_attendance_status').toggleClass("oe_hr_attendance_status_green",this.get_value()=='checked_in');this.$('.oe_hr_attendance_status').toggleClass("oe_hr_attendance_status_red",this.get_value()=='checked_out');},display_field:function(){this.$el.html(QWeb.render("PresenceIndicator"));},});var KanbanPresenceIndicator=kanban_widgets.AbstractField.extend({init:function(){this._super.apply(this,arguments);},start:function(){this.display_field();this.render_value();this.$el.tooltip({title:_t("employee presence<br/>green: checked in<br/>red: checked out"),trigger:'hover'});return this._super();},render_value:function(){this.$('.oe_hr_attendance_status').toggleClass("oe_hr_attendance_status_green",this.field.raw_value=='checked_in');this.$('.oe_hr_attendance_status').toggleClass("oe_hr_attendance_status_red",this.field.raw_value=='checked_out');},display_field:function(){this.$el.html(QWeb.render("PresenceIndicator"));},});core.form_widget_registry.add('hr_attendance_form_presence_indicator',FormPresenceIndicator);kanban_widgets.registry.add('hr_attendance_kanban_presence_indicator',KanbanPresenceIndicator);});;

/* /hr_attendance/static/src/js/greeting_message.js defined in bundle 'web.assets_backend' */
odoo.define('hr_attendance.greeting_message',function(require){"use strict";var BarcodeHandlerMixin=require('barcodes.BarcodeHandlerMixin');var core=require('web.core');var Model=require('web.Model');var Widget=require('web.Widget');var _t=core._t;var GreetingMessage=Widget.extend(BarcodeHandlerMixin,{template:'HrAttendanceGreetingMessage',events:{"click .o_hr_attendance_button_dismiss":function(){this.do_action(this.next_action,{clear_breadcrumbs:true});},},init:function(parent,action){var self=this;this._super.apply(this,arguments);BarcodeHandlerMixin.init.apply(this,arguments);if(!action.attendance){this.stop_listening();this.session.user_has_group('hr_attendance.group_hr_attendance_user').then(function(has_group){if(has_group){self.next_action='hr_attendance.hr_attendance_action_kiosk_mode';}else{self.next_action='hr_attendance.hr_attendance_action_my_attendances';}});return;}
this.next_action=action.next_action||'hr_attendance.hr_attendance_action_my_attendances';if(this.next_action!='hr_attendance.hr_attendance_action_kiosk_mode'&&this.next_action.tag!='hr_attendance_kiosk_mode'){this.stop_listening();}
this.attendance=action.attendance;this.attendance.check_in_time=(new Date((new Date(this.attendance.check_in)).valueOf()-(new Date()).getTimezoneOffset()*60*1000)).toTimeString().slice(0,8);this.attendance.check_out_time=this.attendance.check_out&&(new Date((new Date(this.attendance.check_out)).valueOf()-(new Date()).getTimezoneOffset()*60*1000)).toTimeString().slice(0,8);this.previous_attendance_change_date=action.previous_attendance_change_date;this.employee_name=action.employee_name;},start:function(){if(this.attendance){this.attendance.check_out?this.farewell_message():this.welcome_message();}},welcome_message:function(){var self=this;var now=new Date((new Date(this.attendance.check_in)).valueOf()-(new Date()).getTimezoneOffset()*60*1000);this.return_to_main_menu=setTimeout(function(){self.do_action(self.next_action,{clear_breadcrumbs:true});},5000);if(now.getHours()<5){this.$('.o_hr_attendance_message_message').append(_t("Good night"));}else if(now.getHours()<12){if(now.getHours()<8&&Math.random()<0.3){if(Math.random()<0.75){this.$('.o_hr_attendance_message_message').append(_t("The early bird catches the worm"));}else{this.$('.o_hr_attendance_message_message').append(_t("First come, first served"));}}else{this.$('.o_hr_attendance_message_message').append(_t("Good morning"));}}else if(now.getHours()<17){this.$('.o_hr_attendance_message_message').append(_t("Good afternoon"));}else if(now.getHours()<23){this.$('.o_hr_attendance_message_message').append(_t("Good evening"));}else{this.$('.o_hr_attendance_message_message').append(_t("Good night"));}
if(this.previous_attendance_change_date){var last_check_out_date=new Date((new Date(this.previous_attendance_change_date)).valueOf()-(new Date()).getTimezoneOffset()*60*1000);if(now.valueOf()-last_check_out_date.valueOf()>1000*60*60*24*7){this.$('.o_hr_attendance_random_message').html(_t("Glad to have you back, it's been a while!"));}else{if(Math.random()<0.02){this.$('.o_hr_attendance_random_message').html(_t("If a job is worth doing, it is worth doing well!"));}}}},farewell_message:function(){var self=this;var now=new Date((new Date(this.attendance.check_out)).valueOf()-(new Date()).getTimezoneOffset()*60*1000);this.return_to_main_menu=setTimeout(function(){self.do_action(self.next_action,{clear_breadcrumbs:true});},5000);if(this.previous_attendance_change_date){var last_check_in_date=new Date((new Date(this.previous_attendance_change_date)).valueOf()-(new Date()).getTimezoneOffset()*60*1000);if(now.valueOf()-last_check_in_date.valueOf()>1000*60*60*12){this.$('.o_hr_attendance_warning_message').append(_t("Warning! Last check in was over 12 hours ago.<br/>If this isn't right, please contact Human Resources."));clearTimeout(this.return_to_main_menu);this.stop_listening();}else if(now.valueOf()-last_check_in_date.valueOf()>1000*60*60*8){this.$('.o_hr_attendance_random_message').html(_t("Another good day's work! See you soon!"));}}
if(now.getHours()<12){this.$('.o_hr_attendance_message_message').append(_t("Have a good day!"));}else if(now.getHours()<14){this.$('.o_hr_attendance_message_message').append(_t("Have a nice lunch!"));if(Math.random()<0.05){this.$('.o_hr_attendance_random_message').html(_t("Eat breakfast as a king, lunch as a merchant and supper as a beggar"));}else if(Math.random()<0.06){this.$('.o_hr_attendance_random_message').html(_t("An apple a day keeps the doctor away"));}}else if(now.getHours()<17){this.$('.o_hr_attendance_message_message').append(_t("Have a good afternoon"));}else{if(now.getHours()<18&&Math.random()<0.2){this.$('.o_hr_attendance_message_message').append(_t("Early to bed and early to rise, makes a man healthy, wealthy and wise"));}else{this.$('.o_hr_attendance_message_message').append(_t("Have a good evening"));}}},on_barcode_scanned:function(barcode){var self=this;if(this.return_to_main_menu){clearTimeout(this.return_to_main_menu);}
var hr_employee=new Model('hr.employee');hr_employee.call('attendance_scan',[barcode,]).then(function(result){if(result.action){self.do_action(result.action);}else if(result.warning){self.do_warn(result.warning);}});},destroy:function(){clearTimeout(this.return_to_main_menu);this._super.apply(this,arguments);},});core.action_registry.add('hr_attendance_greeting_message',GreetingMessage);return GreetingMessage;});;

/* /hr_attendance/static/src/js/kiosk_mode.js defined in bundle 'web.assets_backend' */
odoo.define('hr_attendance.kiosk_mode',function(require){"use strict";var core=require('web.core');var Model=require('web.Model');var Widget=require('web.Widget');var Session=require('web.session');var BarcodeHandlerMixin=require('barcodes.BarcodeHandlerMixin');var QWeb=core.qweb;var _t=core._t;var KioskMode=Widget.extend(BarcodeHandlerMixin,{events:{"click .o_hr_attendance_button_employees":function(){this.do_action('hr_attendance.hr_employee_attendance_action_kanban');},},init:function(parent,action){this._super;BarcodeHandlerMixin.init.apply(this,arguments);},start:function(){var self=this;self.session=Session;var res_company=new Model('res.company');res_company.query(['name']).filter([['id','=',self.session.company_id]]).all().then(function(companies){self.company_name=companies[0].name;self.company_image_url=self.session.url('/web/image',{model:'res.company',id:self.session.company_id,field:'logo',})
self.$el.html(QWeb.render("HrAttendanceKioskMode",{widget:self}));self.start_clock();});return self._super.apply(this,arguments);},on_barcode_scanned:function(barcode){var self=this;var hr_employee=new Model('hr.employee');hr_employee.call('attendance_scan',[barcode,]).then(function(result){if(result.action){self.do_action(result.action);}else if(result.warning){self.do_warn(result.warning);}});},start_clock:function(){this.clock_start=setInterval(function(){this.$(".o_hr_attendance_clock").text(new Date().toLocaleTimeString(navigator.language,{hour:'2-digit',minute:'2-digit'}));},500);this.$(".o_hr_attendance_clock").text(new Date().toLocaleTimeString(navigator.language,{hour:'2-digit',minute:'2-digit'}));},destroy:function(){clearInterval(this.clock_start);this._super.apply(this,arguments);},});core.action_registry.add('hr_attendance_kiosk_mode',KioskMode);return KioskMode;});;

/* /hr_attendance/static/src/js/kiosk_confirm.js defined in bundle 'web.assets_backend' */
odoo.define('hr_attendance.kiosk_confirm',function(require){"use strict";var core=require('web.core');var Model=require('web.Model');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var KioskConfirm=Widget.extend({events:{"click .o_hr_attendance_back_button":function(){this.do_action(this.next_action,{clear_breadcrumbs:true});},"click .o_hr_attendance_sign_in_out_icon":function(){var self=this;this.$('.o_hr_attendance_sign_in_out_icon').attr("disabled","disabled");var hr_employee=new Model('hr.employee');hr_employee.call('attendance_manual',[[this.employee_id],this.next_action]).then(function(result){if(result.action){self.do_action(result.action);}else if(result.warning){self.do_warn(result.warning);self.$('.o_hr_attendance_sign_in_out_icon').removeAttr("disabled");}});},'click .o_hr_attendance_pin_pad_button_0':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+0);},'click .o_hr_attendance_pin_pad_button_1':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+1);},'click .o_hr_attendance_pin_pad_button_2':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+2);},'click .o_hr_attendance_pin_pad_button_3':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+3);},'click .o_hr_attendance_pin_pad_button_4':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+4);},'click .o_hr_attendance_pin_pad_button_5':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+5);},'click .o_hr_attendance_pin_pad_button_6':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+6);},'click .o_hr_attendance_pin_pad_button_7':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+7);},'click .o_hr_attendance_pin_pad_button_8':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+8);},'click .o_hr_attendance_pin_pad_button_9':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+9);},'click .o_hr_attendance_pin_pad_button_C':function(){this.$('.o_hr_attendance_PINbox').val('');},'click .o_hr_attendance_pin_pad_button_ok':function(){var self=this;this.$('.o_hr_attendance_pin_pad_button_ok').attr("disabled","disabled");var hr_employee=new Model('hr.employee');hr_employee.call('attendance_manual',[[this.employee_id],this.next_action,this.$('.o_hr_attendance_PINbox').val()]).then(function(result){if(result.action){self.do_action(result.action);}else if(result.warning){self.do_warn(result.warning);setTimeout(function(){self.$('.o_hr_attendance_pin_pad_button_ok').removeAttr("disabled");},500);}});},},init:function(parent,action){this._super.apply(this,arguments);this.next_action='hr_attendance.hr_attendance_action_kiosk_mode';this.employee_id=action.employee_id;this.employee_name=action.employee_name;this.employee_state=action.employee_state;var self=this;},start:function(){var self=this;self.session.user_has_group('hr_attendance.group_hr_attendance_use_pin').then(function(has_group){self.use_pin=has_group;self.$el.html(QWeb.render("HrAttendanceKioskConfirm",{widget:self}));self.start_clock();});return self._super.apply(this,arguments);},start_clock:function(){this.clock_start=setInterval(function(){this.$(".o_hr_attendance_clock").text(new Date().toLocaleTimeString(navigator.language,{hour:'2-digit',minute:'2-digit'}));},500);this.$(".o_hr_attendance_clock").text(new Date().toLocaleTimeString(navigator.language,{hour:'2-digit',minute:'2-digit'}));},destroy:function(){clearInterval(this.clock_start);this._super.apply(this,arguments);},});core.action_registry.add('hr_attendance_kiosk_confirm',KioskConfirm);return KioskConfirm;});;

/* /hr_attendance/static/src/js/my_attendances.js defined in bundle 'web.assets_backend' */
odoo.define('hr_attendance.my_attendances',function(require){"use strict";var core=require('web.core');var Model=require('web.Model');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var MyAttendances=Widget.extend({events:{"click .o_hr_attendance_sign_in_out_icon":function(){this.$('.o_hr_attendance_sign_in_out_icon').attr("disabled","disabled");this.update_attendance();},},start:function(){var self=this;var hr_employee=new Model('hr.employee');hr_employee.query(['attendance_state','name']).filter([['user_id','=',self.session.uid]]).all().then(function(res){if(_.isEmpty(res)){self.$('.o_hr_attendance_employee').append(_t("Error : Could not find employee linked to user"));return;}
self.employee=res[0];self.$el.html(QWeb.render("HrAttendanceMyMainMenu",{widget:self}));});return this._super.apply(this,arguments);},update_attendance:function(){var self=this;var hr_employee=new Model('hr.employee');hr_employee.call('attendance_manual',[[self.employee.id],'hr_attendance.hr_attendance_action_my_attendances']).then(function(result){if(result.action){self.do_action(result.action);}else if(result.warning){self.do_warn(result.warning);}});},});core.action_registry.add('hr_attendance_my_attendances',MyAttendances);return MyAttendances;});;

/* /hr_expense/static/src/js/tour.js defined in bundle 'web.assets_backend' */
odoo.define('hr_expense.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('hr_expense_tour',[{trigger:'.o_app[data-menu-xmlid="hr_expense.menu_hr_expense_root"], .oe_menu_toggler[data-menu-xmlid="hr_expense.menu_hr_expense_root"]',content:_t("Want to manage your employee expenses and receipts? <i>Start here</i>."),position:'bottom',},{trigger:'a#o_mail_test',content:_t("Click to try <b>submitting an expense by email</b>. You can attach a photo of the receipt to the mail."),position:'right',},{trigger:'.o_expense_submit:visible',content:_t("<p>Once completed, you can <b>submit the expense</b> for approval.</p><p><i>Tip: from the list view, select all expenses to submit them all at once, in a single report.</i></p>"),extra_trigger:'.o_form_readonly',position:'bottom',},{trigger:'.o_form_button_save:visible',extra_trigger:'.o_expense_sheet',content:_t("Save the report, your manager will receive a notification by email to approve it."),position:'right',},{trigger:'.o_expense_sheet_approve:visible',content:_t("<p>Managers can validate or refuse expense reports.</p><p>If you refuse a report, explain the reason using the <i>New Message</i> button in the bottom.</p>"),position:'bottom',},{trigger:'.o_expense_sheet_post:visible',content:_t("<p>The accountant receive approved expense reports.</p><p>He can post journal entries in one click if taxes and accounts are right.</p>"),position:'bottom',},{trigger:'.o_expense_sheet_pay:visible',content:_t("The accountant can register a payment to reimburse the employee directly."),position:'bottom',},{trigger:'li a[data-menu-xmlid="hr_expense.menu_hr_expense_sheet_my_all"], div[data-menu-xmlid="hr_expense.menu_hr_expense_sheet_my_all"]',content:_t("Managers can get all reports to approve from this menu."),position:'bottom',}]);});;

/* /hr_expense/static/src/js/web_planner_hr_expense.js defined in bundle 'web.assets_backend' */
odoo.define('planner_hr_expense.planner',function(require){"use strict";var planner=require('web.planner.common');});;

/* /hr_gamification/static/src/js/gamification.js defined in bundle 'web.assets_backend' */
odoo.define('hr_gamification.hr_gamification',function(require){"use strict";var KanbanRecord=require('web_kanban.Record');KanbanRecord.include({on_card_clicked:function(){if(this.model==='gamification.badge.user'){var action={type:'ir.actions.act_window',res_model:'gamification.badge',view_mode:'form',view_type:'form,kanban,tree',views:[[false,'form']],res_id:this.record.badge_id.raw_value[0]};this.do_action(action);}else{this._super.apply(this,arguments);}}});});;

/* /hr_recruitment/static/src/js/job_position.js defined in bundle 'web.assets_backend' */
odoo.define('hr_recruitment.hr_recruitment',function(require){"use strict";var KanbanRecord=require('web_kanban.Record');KanbanRecord.include({on_card_clicked:function(){if(this.model==='hr.job'){this.$('.oe_applications a').first().click();}else{this._super.apply(this,arguments);}},});});;

/* /hr_recruitment/static/src/js/tour.js defined in bundle 'web.assets_backend' */
odoo.define('hr_recruitment.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('hr_recruitment_tour',[{trigger:'.o_app[data-menu-xmlid="hr_recruitment.menu_hr_recruitment_root"], .oe_menu_toggler[data-menu-xmlid="hr_recruitment.menu_hr_recruitment_root"]',content:_t('Want to <b>start recruiting</b> like a pro? <i>Start here.</i>'),position:'bottom',},{trigger:".oe_kanban_action_button",extra_trigger:'.o_hr_recruitment_kanban',content:_t("Let\'s have a look at the <b>applications pipeline</b> for this job position."),position:"bottom"},{trigger:".o_kanban_applicant .o_column_quick_create",content:_t("Add columns to define the <b>interview stages</b>.<br/><i>e.g. New &gt; Qualified &gt; First Interview &gt; Recruited</i>"),position:"right"},{trigger:".breadcrumb li:not(.active):last",extra_trigger:'.o_kanban_applicant',content:_t("Use the breadcrumbs to <b>go back to the dashboard</b>."),position:"bottom"},{trigger:".o_job_alias",extra_trigger:'.o_hr_recruitment_kanban',content:_t("Try to send an email to this address, it will create an application automatically."),position:"bottom"}]);});;

/* /bus/static/src/js/bus.js defined in bundle 'web.assets_backend' */
odoo.define('bus.bus',function(require){"use strict";var local_storage=require('web.local_storage');var session=require('web.session');var Widget=require('web.Widget');var bus={};var PARTNERS_PRESENCE_CHECK_PERIOD=30000;var TAB_HEARTBEAT_PERIOD=10000;var MASTER_TAB_HEARTBEAT_PERIOD=1500;bus.ERROR_DELAY=10000;bus.Bus=Widget.extend({init:function(){var self=this;this._super();this.options={};this.activated=false;this.bus_id=_.uniqueId('bus');this.channels=[];this.last=0;this.stop=false;this.is_master=true;this.last_presence=new Date().getTime();this.last_partners_presence_check=this.last_presence;this.set("window_focus",true);this.on("change:window_focus",this,function(){if(this.get("window_focus")){this.trigger('window_focus',this.is_master);}});$(window).on("focus."+this.bus_id,_.bind(this.focus_change,this,true));$(window).on("blur."+this.bus_id,_.bind(this.focus_change,this,false));$(window).on("unload."+this.bus_id,_.bind(this.focus_change,this,false));_.each('click,keydown,keyup'.split(','),function(evtype){$(window).on(evtype+"."+self.bus_id,function(){self.last_presence=new Date().getTime();});});},destroy:function(){var self=this;$(window).off("focus."+this.bus_id);$(window).off("blur."+this.bus_id);$(window).off("unload."+this.bus_id);_.each('click,keydown,keyup'.split(','),function(evtype){$(window).off(evtype+"."+self.bus_id);});},start_polling:function(){if(!this.activated){this.poll();this.stop=false;}},stop_polling:function(){this.activated=false;this.stop=true;this.channels=[];},poll:function(){var self=this;self.activated=true;var now=new Date().getTime();var options=_.extend({},this.options,{bus_inactivity:now-this.get_last_presence(),});if(this.last_partners_presence_check+PARTNERS_PRESENCE_CHECK_PERIOD>now){options=_.omit(options,'bus_presence_partner_ids');}else{this.last_partners_presence_check=now;}
var data={channels:self.channels,last:self.last,options:options};session.rpc('/longpolling/poll',data,{shadow:true}).then(function(result){self.on_notification(result);if(!self.stop){self.poll();}},function(unused,e){e.preventDefault();setTimeout(_.bind(self.poll,self),bus.ERROR_DELAY+(Math.floor((Math.random()*20)+1)*1000));});},on_notification:function(notifications){var self=this;var notifs=_.map(notifications,function(notif){if(notif.id>self.last){self.last=notif.id;}
return[notif.channel,notif.message];});this.trigger("notification",notifs);},add_channel:function(channel){this.channels.push(channel);this.channels=_.uniq(this.channels);},delete_channel:function(channel){this.channels=_.without(this.channels,channel);},focus_change:function(focus){this.set("window_focus",focus);},is_odoo_focused:function(){return this.get("window_focus");},get_last_presence:function(){return this.last_presence;},update_option:function(key,value){this.options[key]=value;},delete_option:function(key){if(_.contains(_.keys(this.options),key)){delete this.options[key];}},});var CrossTabBus=bus.Bus.extend({init:function(){this._super.apply(this,arguments);this.is_master=false;this.is_registered=false;if(parseInt(getItem('bus.last_ts',0))+50000<new Date().getTime()){setItem('bus.last',-1);}
on("storage",this.on_storage.bind(this));},start_polling:function(){var self=this;if(!this.is_registered){this.is_registered=true;tab_manager.register_tab(function(){self.is_master=true;self.start_polling();},function(){self.is_master=false;self.stop_polling();},function(){var hb_period=this.is_master?MASTER_TAB_HEARTBEAT_PERIOD:TAB_HEARTBEAT_PERIOD;if(self.last_presence+hb_period>new Date().getTime()){setItem('bus.last_presence',self.last_presence);}});if(this.is_master){setItem('bus.channels',this.channels);setItem('bus.options',this.options);}else{this.channels=getItem('bus.channels',this.channels);this.options=getItem('bus.options',this.options);}
return;}
if(this.is_master){this._super.apply(this,arguments);}},on_notification:function(notifications){if(this.is_master){var last=getItem('bus.last',-1);var max_id=Math.max(last,0);var new_notifications=_.filter(notifications,function(notif){max_id=Math.max(max_id,notif.id);return notif.id<0||notif.id>last;});this.last=max_id;if(new_notifications.length){setItem('bus.last',max_id);setItem('bus.last_ts',new Date().getTime());setItem('bus.notification',new_notifications);this._super(new_notifications);}}else{this._super.apply(this,arguments);}},on_storage:function(e){var value=e.newValue;if(e.key==='bus.notification'){var notifs=JSON.parse(value);this.on_notification(notifs);}
if(e.key==='bus.channels'){this.channels=JSON.parse(value);}
if(e.key==='bus.options'){this.options=JSON.parse(value);}
if(e.key==='bus.focus'){this.set('window_focus',JSON.parse(value));}},add_channel:function(){this._super.apply(this,arguments);setItem('bus.channels',this.channels);},delete_channel:function(){this._super.apply(this,arguments);setItem('bus.channels',this.channels);},get_last_presence:function(){return getItem('bus.last_presence')||new Date().getTime();},update_option:function(){this._super.apply(this,arguments);setItem('bus.options',this.options);},delete_option:function(){this._super.apply(this,arguments);setItem('bus.options',this.options);},focus_change:function(focus){this._super.apply(this,arguments);setItem('bus.focus',focus);},});function on(type,listener){if(window.addEventListener){window.addEventListener(type,listener);}else{window.attachEvent('on'+type,listener);}}
function getItem(key,defaultValue){var val=local_storage.getItem(key);return val?JSON.parse(val):defaultValue;}
function setItem(key,value){local_storage.setItem(key,JSON.stringify(value));}
var tab_manager={peersKey:'bus.peers',masterKey:'bus.master',heartbeatKey:'bus.heartbeat',isMaster:false,id:new Date().getTime()+':'+(Math.random()*1000000000|0),register_tab:function(is_master_callback,is_no_longer_master,on_heartbeat_callback){this.is_master_callback=is_master_callback;this.is_no_longer_master=is_no_longer_master||function(){};this.on_heartbeat_callback=on_heartbeat_callback||function(){};var peers=getItem(tab_manager.peersKey,{});peers[tab_manager.id]=new Date().getTime();setItem(tab_manager.peersKey,peers);on('unload',function(){var peers=getItem(tab_manager.peersKey,{});delete peers[tab_manager.id];setItem(tab_manager.peersKey,peers);if(tab_manager.isMaster){local_storage.removeItem(tab_manager.masterKey);}});if(!local_storage.getItem(tab_manager.masterKey)){tab_manager.start_election();}
on('storage',function(e){if(!e){e=window.event;}
if(e.key!==tab_manager.masterKey){return;}
if(e.newValue===null){tab_manager.start_election();}});tab_manager.heartbeat();},heartbeat:function(){var current=new Date().getTime();var heartbeatValue=local_storage.getItem(tab_manager.heartbeatKey)||0;var peers=getItem(tab_manager.peersKey,{});if((parseInt(heartbeatValue)+5000)<current){tab_manager.start_election();}
if(tab_manager.isMaster){var cleanedPeers={};for(var peerName in peers){if(peers[peerName]+15000>current){cleanedPeers[peerName]=peers[peerName];}}
if(!tab_manager.is_last_heartbeat_mine()){tab_manager.isMaster=false;tab_manager.last_heartbeat=0;peers[tab_manager.id]=current;setItem(tab_manager.peersKey,peers);tab_manager.is_no_longer_master();}else{tab_manager.last_heartbeat=current;local_storage.setItem(tab_manager.heartbeatKey,current);setItem(tab_manager.peersKey,cleanedPeers);}}else{peers[tab_manager.id]=current;setItem(tab_manager.peersKey,peers);}
this.on_heartbeat_callback();setTimeout(function(){tab_manager.heartbeat();},tab_manager.isMaster?MASTER_TAB_HEARTBEAT_PERIOD:TAB_HEARTBEAT_PERIOD);},is_last_heartbeat_mine:function(){var heartbeatValue=local_storage.getItem(tab_manager.heartbeatKey)||0;return(parseInt(heartbeatValue)===tab_manager.last_heartbeat);},start_election:function(){if(tab_manager.isMaster){return;}
var peers=getItem(tab_manager.peersKey,{});var now=new Date().getTime();var newMaster;for(var peerName in peers){if(peers[peerName]+15000<now){continue;}
newMaster=peerName;break;}
if(newMaster===tab_manager.id){setItem(tab_manager.masterKey,tab_manager.id);tab_manager.last_heartbeat=new Date().getTime();setItem(tab_manager.heartbeatKey,tab_manager.last_heartbeat);tab_manager.isMaster=true;tab_manager.is_master_callback();delete peers[newMaster];setItem(tab_manager.peersKey,peers);}},};if(typeof Storage!=="undefined"){bus.bus=new CrossTabBus();}else{bus.bus=new bus.Bus();}
return bus;});;

/* /im_livechat/static/src/js/im_livechat_backend.js defined in bundle 'web.assets_backend' */
odoo.define('im_livechat.chat_client_action',function(require){"use strict";require('mail.chat_client_action');var chat_manager=require('mail.chat_manager');var core=require('web.core');core.action_registry.get('mail.chat.instant_messaging').include({_render_sidebar:function(options){var channel_partition=_.partition(options.channels,function(channel){return channel.type==='livechat';});channel_partition[0].sort(function(c1,c2){return c2.last_message_date.diff(c1.last_message_date);});options.channels=channel_partition[0].concat(channel_partition[1]);return this._super(options);},});chat_manager.bus.on('new_message',null,function(msg){_.each(msg.channel_ids,function(channel_id){var channel=chat_manager.get_channel(channel_id);if(channel){channel.last_message_date=msg.date;}});});});;

/* /lunch/static/src/js/lunch.js defined in bundle 'web.assets_backend' */
odoo.define('lunch.form_widgets',function(require){"use strict";var core=require('web.core');var form_common=require('web.form_common');var form_widgets=require('web.form_widgets');var form_relational=require('web.form_relational');var _t=core._t;var QWeb=core.qweb;var LunchPreviousOrdersWidget=form_relational.AbstractManyField.extend(form_common.ReinitializeWidgetMixin,{className:'row o_lunch_last_orders',events:{'click .o_add_button':'set_order_line',},init:function(field_manager,node){this._super.apply(this,arguments);this.lunch_data={};this.fields_to_read=['product_id','supplier','note','price','category_id','currency_id'];this.monetary=new form_widgets.FieldMonetary(field_manager,node);this.monetary.__edispatcherRegisteredEvents=[];},fetch_value:function(){var self=this;return this.dataset.read_ids(this.get('value'),this.fields_to_read).then(function(data){_.each(data,function(order){self.lunch_data[order['id']]=order;});return data;});},get_line_value:function(id){var data=_.clone(this.lunch_data[id]);if(typeof this.lunch_data[id]['product_id'][0]!='undefined'){data['product_id']=this.lunch_data[id]['product_id'][0];}
if(typeof this.lunch_data[id]['supplier'][0]!='undefined'){data['supplier']=this.lunch_data[id]['supplier'][0];}
if(typeof this.lunch_data[id]['category_id'][0]!='undefined'){data['category_id']=this.lunch_data[id]['category_id'][0];}
return data;},set_order_line:function(event){var data=this.get_line_value(parseInt($(event.currentTarget).data('id')));var order_line_ids=this.field_manager.fields.order_line_ids;order_line_ids.data_create(data);order_line_ids.reload_current_view();},render_value:function(){var self=this;return this.fetch_value().then(function(data){if(_.isEmpty(data)){return self.$el.html(QWeb.render("lunch_order_widget_no_previous_order"));}
var categories=_.groupBy(data,function(data1){return data1['supplier'][1];});return self.$el.html(QWeb.render("lunch_order_widget_previous_orders_list",{'widget':self,'categories':categories}));});},destroy:function(){this.monetary.destroy();this._super();},is_false:function(){return false;},});core.form_widget_registry.add('previous_order',LunchPreviousOrdersWidget);return LunchPreviousOrdersWidget;});;

/* /mail/static/src/js/many2many_tags_email.js defined in bundle 'web.assets_backend' */
odoo.define('mail.many2manytags',function(require){"use strict";var core=require('web.core');var form_common=require('web.form_common');var form_relational=require('web.form_relational');var Model=require('web.DataModel');var _t=core._t;var FieldMany2ManyTagsEmail=form_relational.FieldMany2ManyTags.extend({start:function(){this.values=[];this.values_checking=[];this.on("change:value",this,this.on_change_value_check);this.trigger("change:value");this._super.apply(this,arguments);},on_change_value_check:function(){this.values=_.uniq(this.values);var values_removed=_.difference(this.values,this.get('value'));if(values_removed.length){this.values=_.difference(this.values,values_removed);this.set({'value':this.values});return false;}
var not_checked=_.difference(this.get('value'),this.values,this.values_checking);if(not_checked.length){this.values_checking=this.values_checking.concat(not_checked);this._check_email_popup(not_checked);}},_check_email_popup:function(ids){var self=this;new Model('res.partner').call("search",[[["id","in",ids],["email","=",false],["notify_email","=",'always']]],{context:this.build_context()}).then(function(record_ids){var valid_partner=_.difference(ids,record_ids);self.values=self.values.concat(valid_partner);self.values_checking=_.difference(self.values_checking,valid_partner);_.each(record_ids,function(id){var pop=new form_common.FormViewDialog(self,{res_model:'res.partner',res_id:id,context:self.build_context(),title:_t("Please complete partner's informations and Email"),}).open();pop.on('write_completed',self,function(){this.values.push(id);this.values_checking=_.without(this.values_checking,id);this.set({'value':this.values});});pop.on('closed',self,function(){this.values_checking=_.without(this.values_checking,id);this.set({'value':this.values});});});});},});core.form_widget_registry.add('many2many_tags_email',FieldMany2ManyTagsEmail);});;

/* /mail/static/src/js/client_action.js defined in bundle 'web.assets_backend' */
odoo.define('mail.chat_client_action',function(require){"use strict";var chat_manager=require('mail.chat_manager');var composer=require('mail.composer');var ChatThread=require('mail.ChatThread');var utils=require('mail.utils');var config=require('web.config');var ControlPanelMixin=require('web.ControlPanelMixin');var core=require('web.core');var data=require('web.data');var data_manager=require('web.data_manager');var Dialog=require('web.Dialog');var framework=require('web.framework');var Model=require('web.Model');var pyeval=require('web.pyeval');var SearchView=require('web.SearchView');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var PartnerInviteDialog=Dialog.extend({dialog_title:_t('Invite people'),template:"mail.PartnerInviteDialog",init:function(parent,title,channel_id){this.channel_id=channel_id;this._super(parent,{title:title,size:"medium",buttons:[{text:_t("Invite"),close:true,classes:"btn-primary",click:_.bind(this.on_click_add,this),}],});},start:function(){this.$input=this.$('.o_mail_chat_partner_invite_input');this.$input.select2({width:'100%',allowClear:true,multiple:true,formatResult:function(item){var status=QWeb.render('mail.chat.UserStatus',{status:item.im_status});return $('<span>').text(item.text).prepend(status);},query:function(query){chat_manager.search_partner(query.term,20).then(function(partners){query.callback({results:_.map(partners,function(partner){return _.extend(partner,{text:partner.label});}),});});}});return this._super.apply(this,arguments);},on_click_add:function(){var self=this;var data=this.$input.select2('data');if(data.length>=1){var ChannelModel=new Model('mail.channel');return ChannelModel.call('channel_invite',[this.channel_id],{partner_ids:_.pluck(data,'id')}).then(function(){var names=_.escape(_.pluck(data,'text').join(', '));var notification=_.str.sprintf(_t('You added <b>%s</b> to the conversation.'),names);self.do_notify(_t('New people'),notification);});}},});var ChatAction=Widget.extend(ControlPanelMixin,{template:'mail.client_action',events:{"click .o_mail_chat_channel_item":function(event){event.preventDefault();var channel_id=this.$(event.currentTarget).data('channel-id');this.set_channel(chat_manager.get_channel(channel_id));},"click .o_mail_sidebar_title .o_add":function(event){event.preventDefault();var type=$(event.target).data("type");this.$('.o_mail_add_channel[data-type='+type+']').show().find("input").focus();},"blur .o_mail_add_channel input":function(){this.$('.o_mail_add_channel').hide();},"click .o_mail_partner_unpin":function(event){event.stopPropagation();var channel_id=$(event.target).data("channel-id");chat_manager.unsubscribe(chat_manager.get_channel(channel_id));},"click .o_snackbar_undo":function(event){event.preventDefault();var channel=this.channel;this.$snackbar.remove();this.clear_needactions_def.then(function(msgs_ids){chat_manager.undo_mark_as_read(msgs_ids,channel);});},"click .o_mail_annoying_notification_bar .fa-close":function(){this.$(".o_mail_annoying_notification_bar").slideUp();},"click .o_mail_request_permission":function(event){event.preventDefault();this.$(".o_mail_annoying_notification_bar").slideUp();var def=window.Notification.requestPermission();if(def){def.then(function(value){if(value==='denied'){utils.send_notification(_t('Permission denied'),_t('Odoo will not have the permission to send native notifications on this device.'));}else{utils.send_notification(_t('Permission granted'),_t('Odoo has now the permission to send you native notifications on this device.'));}});}},"keydown":function(event){if(event.which===$.ui.keyCode.ESCAPE&&this.selected_message){this.unselect_message();}},"click .o_mail_open_channels":function(){this.do_action({name:_t('Public Channels'),type:'ir.actions.act_window',res_model:"mail.channel",views:[[false,'kanban'],[false,'form']],domain:[['public','!=','private']],},{on_reverse_breadcrumb:this.on_reverse_breadcrumb,});},},on_attach_callback:function(){chat_manager.bus.trigger('client_action_open',true);if(this.channel){this.thread.scroll_to({offset:this.channels_scrolltop[this.channel.id]});}},on_detach_callback:function(){chat_manager.bus.trigger('client_action_open',false);this.channels_scrolltop[this.channel.id]=this.thread.get_scrolltop();},init:function(parent,action,options){this._super.apply(this,arguments);this.action_manager=parent;this.dataset=new data.DataSetSearch(this,'mail.message');this.domain=[];this.action=action;this.options=options||{};this.channels_scrolltop={};this.throttled_render_sidebar=_.throttle(this.render_sidebar.bind(this),100,{leading:false});this.notification_bar=(window.Notification&&window.Notification.permission==="default");this.selected_message=null;},willStart:function(){var self=this;var view_id=this.action&&this.action.search_view_id&&this.action.search_view_id[0];var def=data_manager.load_fields_view(this.dataset,view_id,'search',false).then(function(fields_view){self.fields_view=fields_view;});return $.when(this._super(),chat_manager.is_ready,def);},start:function(){var self=this;var options={$buttons:$("<div>"),action:this.action,disable_groupby:true,};var default_channel_id=this.options.active_id||this.action.context.active_id||this.action.params.default_active_id||'channel_inbox';var default_channel=chat_manager.get_channel(default_channel_id)||chat_manager.get_channel('channel_inbox');this.searchview=new SearchView(this,this.dataset,this.fields_view,options);this.searchview.on('search_data',this,this.on_search);this.basic_composer=new composer.BasicComposer(this,{mention_partners_restricted:true});this.extended_composer=new composer.ExtendedComposer(this,{mention_partners_restricted:true});this.thread=new ChatThread(this,{display_help:true,});this.$buttons=$(QWeb.render("mail.chat.ControlButtons",{}));this.$buttons.find('button').css({display:"inline-block"});this.$buttons.on('click','.o_mail_chat_button_invite',this.on_click_button_invite);this.$buttons.on('click','.o_mail_chat_button_unsubscribe',this.on_click_button_unsubscribe);this.$buttons.on('click','.o_mail_chat_button_settings',this.on_click_button_settings);this.$buttons.on('click','.o_mail_toggle_channels',function(){self.$('.o_mail_chat_sidebar').slideToggle(200);});this.$buttons.on('click','.o_mail_chat_button_mark_read',function(){chat_manager.mark_all_as_read(self.channel,self.domain);});this.$buttons.on('click','.o_mail_chat_button_unstar_all',chat_manager.unstar_all);this.thread.on('redirect',this,function(res_model,res_id){chat_manager.redirect(res_model,res_id,this.set_channel.bind(this));});this.thread.on('redirect_to_channel',this,function(channel_id){chat_manager.join_channel(channel_id).then(this.set_channel.bind(this));});this.thread.on('load_more_messages',this,this.load_more_messages);this.thread.on('mark_as_read',this,function(message_id){chat_manager.mark_as_read([message_id]);});this.thread.on('toggle_star_status',this,function(message_id){chat_manager.toggle_star_status(message_id);});this.thread.on('select_message',this,this.select_message);this.thread.on('unselect_message',this,this.unselect_message);this.basic_composer.on('post_message',this,this.on_post_message);this.basic_composer.on('input_focused',this,this.on_composer_input_focused);this.extended_composer.on('post_message',this,this.on_post_message);this.extended_composer.on('input_focused',this,this.on_composer_input_focused);var def1=this.thread.appendTo(this.$('.o_mail_chat_content'));var def2=this.basic_composer.appendTo(this.$('.o_mail_chat_content'));var def3=this.extended_composer.appendTo(this.$('.o_mail_chat_content'));var def4=this.searchview.appendTo($("<div>")).then(function(){self.$searchview_buttons=self.searchview.$buttons.contents();});this.render_sidebar();return $.when(def1,def2,def3,def4).then(this.set_channel.bind(this,default_channel)).then(function(){chat_manager.bus.on('open_channel',self,self.set_channel);chat_manager.bus.on('new_message',self,self.on_new_message);chat_manager.bus.on('update_message',self,self.on_update_message);chat_manager.bus.on('new_channel',self,self.on_new_channel);chat_manager.bus.on('anyone_listening',self,function(channel,query){query.is_displayed=query.is_displayed||(channel.id===self.channel.id&&self.thread.is_at_bottom());});chat_manager.bus.on('unsubscribe_from_channel',self,self.on_channel_unsubscribed);chat_manager.bus.on('update_needaction',self,self.throttled_render_sidebar);chat_manager.bus.on('update_starred',self,self.throttled_render_sidebar);chat_manager.bus.on('update_channel_unread_counter',self,self.throttled_render_sidebar);chat_manager.bus.on('update_dm_presence',self,self.throttled_render_sidebar);self.thread.$el.on("scroll",null,_.debounce(function(){if(self.thread.is_at_bottom()){chat_manager.mark_channel_as_seen(self.channel);}},100));});},select_message:function(message_id){this.$el.addClass('o_mail_selection_mode');var message=chat_manager.get_message(message_id);this.selected_message=message;var subject="Re: "+message.record_name;this.extended_composer.set_subject(subject);if(this.channel.type!=='static'){this.basic_composer.toggle(false);}
this.extended_composer.toggle(true);this.thread.scroll_to({id:message_id,duration:200,only_if_necessary:true});this.extended_composer.focus('body');},unselect_message:function(){this.basic_composer.toggle(this.channel.type!=='static'&&!this.channel.mass_mailing);this.extended_composer.toggle(this.channel.type!=='static'&&this.channel.mass_mailing);if(!config.device.touch){var composer=this.channel.mass_mailing?this.extended_composer:this.basic_composer;composer.focus();}
this.$el.removeClass('o_mail_selection_mode');this.thread.unselect();this.selected_message=null;},render_sidebar:function(){var self=this;var $sidebar=this._render_sidebar({active_channel_id:this.channel?this.channel.id:undefined,channels:chat_manager.get_channels(),needaction_counter:chat_manager.get_needaction_counter(),starred_counter:chat_manager.get_starred_counter(),});this.$(".o_mail_chat_sidebar").html($sidebar.contents());this.$('.o_mail_add_channel[data-type=public]').find("input").autocomplete({source:function(request,response){self.last_search_val=_.escape(request.term);self.do_search_channel(self.last_search_val).done(function(result){result.push({'label':_.str.sprintf('<strong>'+_t("Create %s")+'</strong>','<em>"#'+self.last_search_val+'"</em>'),'value':'_create',});response(result);});},select:function(event,ui){if(self.last_search_val){if(ui.item.value==='_create'){chat_manager.create_channel(self.last_search_val,"public");}else{chat_manager.join_channel(ui.item.id);}}},focus:function(event){event.preventDefault();},html:true,});this.$('.o_mail_add_channel[data-type=dm]').find("input").autocomplete({source:function(request,response){self.last_search_val=_.escape(request.term);chat_manager.search_partner(self.last_search_val,10).done(response);},select:function(event,ui){var partner_id=ui.item.id;var dm=chat_manager.get_dm_from_partner_id(partner_id);if(dm){self.set_channel(dm);}else{chat_manager.create_channel(partner_id,"dm");}
$(this).val('');return false;},focus:function(event){event.preventDefault();},});this.$('.o_mail_add_channel[data-type=private]').find("input").on('keyup',this,function(event){var name=_.escape($(event.target).val());if(event.which===$.ui.keyCode.ENTER&&name){chat_manager.create_channel(name,"private");}});},_render_sidebar:function(options){return $(QWeb.render("mail.chat.Sidebar",options));},render_snackbar:function(template,context,timeout){if(this.$snackbar){this.$snackbar.remove();}
timeout=timeout||20000;this.$snackbar=$(QWeb.render(template,context));this.$('.o_mail_chat_content').append(this.$snackbar);var $snackbar=this.$snackbar;setTimeout(function(){$snackbar.fadeOut();},timeout);},do_search_channel:function(search_val){var Channel=new Model("mail.channel");return Channel.call('channel_search_to_join',[search_val]).then(function(result){var values=[];_.each(result,function(channel){var escaped_name=_.escape(channel.name);values.push(_.extend(channel,{'value':escaped_name,'label':escaped_name,}));});return values;});},set_channel:function(channel){var self=this;if(this.channel){this.channels_scrolltop[this.channel.id]=this.thread.get_scrolltop();}
var new_channel_scrolltop=this.channels_scrolltop[channel.id];this.channel=channel;this.messages_separator_position=undefined;this.unread_counter=this.channel.unread_counter;this.last_seen_message_id=this.channel.last_seen_message_id;this.clear_needactions_def=$.Deferred();if(this.$snackbar){this.$snackbar.remove();}
this.action.context.active_id=channel.id;this.action.context.active_ids=[channel.id];return this.fetch_and_render_thread().then(function(){if(channel.type!=='static'){if(channel.needaction_counter>0){self.render_snackbar('mail.chat.UndoSnackbar',{nb_needactions:channel.needaction_counter,});}
chat_manager.mark_channel_as_seen(channel);self.clear_needactions_def=chat_manager.mark_all_as_read(channel);}
self.set("title",'#'+channel.name);self.$buttons.find('.o_mail_chat_button_invite, .o_mail_chat_button_unsubscribe, .o_mail_chat_button_settings').toggle(channel.type!=="dm"&&channel.type!=='static');self.$buttons.find('.o_mail_chat_button_mark_read').toggle(channel.id==="channel_inbox");self.$buttons.find('.o_mail_chat_button_unstar_all').toggle(channel.id==="channel_starred");self.$('.o_mail_chat_channel_item').removeClass('o_active').filter('[data-channel-id='+channel.id+']').removeClass('o_unread_message').addClass('o_active');var $new_messages_separator=self.$('.o_thread_new_messages_separator');if($new_messages_separator.length){self.thread.$el.scrollTo($new_messages_separator);}else{self.thread.scroll_to({offset:new_channel_scrolltop});}
self.update_cp();if(config.device.size_class===config.device.SIZES.XS){self.$('.o_mail_chat_sidebar').hide();}
self.unselect_message();self.action_manager.do_push_state({action:self.action.id,active_id:self.channel.id,});});},get_thread_rendering_options:function(messages){if(_.isUndefined(this.messages_separator_position)){if(!this.unread_counter){this.messages_separator_position=false;}else{var msg=chat_manager.get_last_seen_message(this.channel);this.messages_separator_position=msg?msg.id:'top';}}
return{channel_id:this.channel.id,display_load_more:!chat_manager.all_history_loaded(this.channel,this.domain),display_needactions:this.channel.display_needactions,messages_separator_position:this.messages_separator_position,squash_close_messages:this.channel.type!=='static'&&!this.channel.mass_mailing,display_empty_channel:!messages.length&&!this.domain.length,display_no_match:!messages.length&&this.domain.length,display_subject:this.channel.mass_mailing||this.channel.id==="channel_inbox",display_email_icon:false,display_reply_icon:true,};},fetch_and_render_thread:function(){var self=this;return chat_manager.get_messages({channel_id:this.channel.id,domain:this.domain}).then(function(result){self.thread.render(result,self.get_thread_rendering_options(result));self.update_button_status(result.length===0);});},update_button_status:function(disabled){if(this.channel.id==="channel_inbox"){this.$buttons.find('.o_mail_chat_button_mark_read').toggleClass('disabled',disabled);}
if(this.channel.id==="channel_starred"){this.$buttons.find('.o_mail_chat_button_unstar_all').toggleClass('disabled',disabled);}},load_more_messages:function(){var self=this;var oldest_msg_id=this.$('.o_thread_message').first().data('messageId');var oldest_msg_selector='.o_thread_message[data-message-id="'+oldest_msg_id+'"]';var offset=-framework.getPosition(document.querySelector(oldest_msg_selector)).top;return chat_manager.get_messages({channel_id:this.channel.id,domain:this.domain,load_more:true}).then(function(result){if(self.messages_separator_position==='top'){self.messages_separator_position=undefined;}
self.thread.render(result,self.get_thread_rendering_options(result));offset+=framework.getPosition(document.querySelector(oldest_msg_selector)).top;self.thread.scroll_to({offset:offset});});},update_cp:function(){this.update_control_panel({breadcrumbs:this.action_manager.get_breadcrumbs(),cp_content:{$buttons:this.$buttons,$searchview:this.searchview.$el,$searchview_buttons:this.$searchview_buttons,},searchview:this.searchview,});},do_show:function(){this._super.apply(this,arguments);this.update_cp();this.action_manager.do_push_state({action:this.action.id,active_id:this.channel.id,});},on_search:function(domains){var result=pyeval.sync_eval_domains_and_contexts({domains:domains});this.domain=result.domain;this.fetch_and_render_thread();},on_post_message:function(message){var self=this;var options=this.selected_message?{}:{channel_id:this.channel.id};if(this.selected_message){message.subtype='mail.mt_comment';message.subtype_id=false;message.message_type='comment';message.content_subtype='html';options.model=this.selected_message.model;options.res_id=this.selected_message.res_id;}
chat_manager.post_message(message,options).then(function(){if(self.selected_message){self.render_snackbar('mail.chat.MessageSentSnackbar',{record_name:self.selected_message.record_name},5000);self.unselect_message();}else{self.thread.scroll_to();}}).fail(function(){});},on_new_message:function(message){var self=this;if(_.contains(message.channel_ids,this.channel.id)){if(this.channel.type!=='static'&&this.thread.is_at_bottom()){chat_manager.mark_channel_as_seen(this.channel);}
var should_scroll=this.thread.is_at_bottom();this.fetch_and_render_thread().then(function(){if(should_scroll){self.thread.scroll_to({id:message.id});}});}
this.render_sidebar();this.channels_scrolltop=_.omit(this.channels_scrolltop,message.channel_ids);},on_update_message:function(message){var self=this;var current_channel_id=this.channel.id;if((current_channel_id==="channel_starred"&&!message.is_starred)||(current_channel_id==="channel_inbox"&&!message.is_needaction)){chat_manager.get_messages({channel_id:this.channel.id,domain:this.domain}).then(function(messages){var options=self.get_thread_rendering_options(messages);self.thread.remove_message_and_render(message.id,messages,options).then(function(){self.update_button_status(messages.length===0);});});}else if(_.contains(message.channel_ids,current_channel_id)){this.fetch_and_render_thread();}},on_new_channel:function(channel){this.render_sidebar();if(channel.autoswitch){this.set_channel(channel);}},on_channel_unsubscribed:function(channel_id){if(this.channel.id===channel_id){this.set_channel(chat_manager.get_channel("channel_inbox"));}
this.render_sidebar();delete this.channels_scrolltop[channel_id];},on_composer_input_focused:function(){var composer=this.channel.mass_mailing?this.extended_composer:this.basic_composer;var commands=chat_manager.get_commands(this.channel);var partners=chat_manager.get_mention_partner_suggestions(this.channel);composer.mention_set_enabled_commands(commands);composer.mention_set_prefetched_partners(partners);},on_click_button_invite:function(){var title=_.str.sprintf(_t('Invite people to #%s'),this.channel.name);new PartnerInviteDialog(this,title,this.channel.id).open();},on_click_button_unsubscribe:function(){chat_manager.unsubscribe(this.channel);},on_click_button_settings:function(){this.do_action({type:'ir.actions.act_window',res_model:"mail.channel",res_id:this.channel.id,views:[[false,'form']],target:'current'});},destroy:function(){this.$buttons.off().destroy();this._super.apply(this,arguments);},});core.action_registry.add('mail.chat.instant_messaging',ChatAction);});;

/* /mail/static/src/js/chat_window.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ChatWindow',function(require){"use strict";var ChatThread=require('mail.ChatThread');var config=require('web.config');var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var HEIGHT_OPEN='400px';var HEIGHT_FOLDED='28px';return Widget.extend({template:"mail.ChatWindow",events:{"click .o_chat_composer":"focus_input","keydown .o_chat_composer":"on_keydown","keypress .o_chat_composer":"on_keypress","click .o_chat_window_close":"on_click_close","click .o_chat_title":"on_click_fold",},init:function(parent,channel_id,title,is_folded,unread_msgs,options){this._super(parent);this.title=title;this.channel_id=channel_id;this.folded=is_folded;this.options=_.defaults(options||{},{autofocus:true,display_stars:true,display_reply_icon:false,display_email_icon:false,placeholder:_t("Say something"),input_less:false,});this.status=this.options.status;this.unread_msgs=unread_msgs||0;this.is_hidden=false;},start:function(){this.$input=this.$('.o_composer_text_field');this.$header=this.$('.o_chat_header');this.thread=new ChatThread(this,{channel_id:this.channel_id,display_needactions:false,display_stars:this.options.display_stars,});this.thread.on('toggle_star_status',null,this.trigger.bind(this,'toggle_star_status'));this.thread.on('redirect_to_channel',null,this.trigger.bind(this,'redirect_to_channel'));this.thread.on('redirect',null,this.trigger.bind(this,'redirect'));if(this.folded){this.$el.css('height',HEIGHT_FOLDED);}else if(this.options.autofocus){this.focus_input();}
var def=this.thread.replace(this.$('.o_chat_content'));return $.when(this._super(),def);},render:function(messages){this.update_unread(this.unread_msgs);this.thread.render(messages,{display_load_more:false});},update_unread:function(counter){this.unread_msgs=counter;this.render_header();},update_status:function(status){this.status=status;this.render_header();},render_header:function(){this.$header.html(QWeb.render('mail.ChatWindowHeaderContent',{status:this.status,title:this.title,unread_counter:this.unread_msgs,}));},fold:function(){this.$el.animate({height:this.folded?HEIGHT_FOLDED:HEIGHT_OPEN});},toggle_fold:function(fold){this.folded=_.isBoolean(fold)?fold:!this.folded;if(!this.folded){this.thread.scroll_to();this.focus_input();}
this.fold();},focus_input:function(){if(!config.device.touch){this.$input.focus();}},do_show:function(){this.is_hidden=false;this._super.apply(this,arguments);},do_hide:function(){this.is_hidden=true;this._super.apply(this,arguments);},do_toggle:function(display){this.is_hidden=_.isBoolean(display)?!display:!this.is_hidden;this._super.apply(this,arguments);},on_keypress:function(event){event.stopPropagation();},on_keydown:function(event){event.stopPropagation();if(event.which===13){var content=_.str.trim(this.$input.val());var message={content:content,attachment_ids:[],partner_ids:[],};this.$input.val('');if(content){this.trigger('post_message',message,this.channel_id);}}},on_click_close:function(event){event.stopPropagation();event.preventDefault();this.trigger("close_chat_session");},on_click_fold:function(){if(config.device.size_class!==config.device.SIZES.XS){this.toggle_fold();this.trigger("fold_channel",this.channel_id,this.folded);}},});});;

/* /mail/static/src/js/extended_chat_window.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ExtendedChatWindow',function(require){"use strict";var chat_manager=require('mail.chat_manager');var ChatWindow=require('mail.ChatWindow');var composer=require('mail.composer');return ChatWindow.extend({template:"mail.ExtendedChatWindow",start:function(){var self=this;var def;if(self.options.thread_less){this.$el.addClass('o_thread_less');this.$('.o_chat_search_input input').autocomplete({source:function(request,response){chat_manager.search_partner(request.term,10).done(response);},select:function(event,ui){self.trigger('open_dm_session',ui.item.id);},}).focus();}else if(!self.options.input_less){var basic_composer=new composer.BasicComposer(self,{mention_partners_restricted:true});basic_composer.on('post_message',self,function(message){this.trigger('post_message',message,this.channel_id);});basic_composer.once('input_focused',self,function(){var channel=chat_manager.get_channel(this.channel_id);var commands=chat_manager.get_commands(channel);var partners=chat_manager.get_mention_partner_suggestions(channel);basic_composer.mention_set_enabled_commands(commands);basic_composer.mention_set_prefetched_partners(partners);});def=basic_composer.replace(self.$('.o_chat_composer'));}
return $.when(this._super(),def);},on_keydown:function(event){event.stopPropagation();},});});;

/* /mail/static/src/js/composer.js defined in bundle 'web.assets_backend' */
odoo.define('mail.composer',function(require){"use strict";var chat_manager=require('mail.chat_manager');var utils=require('mail.utils');var core=require('web.core');var data=require('web.data');var dom_utils=require('web.dom_utils');var Model=require('web.Model');var session=require('web.session');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var NON_BREAKING_SPACE='\u00a0';var MENTION_PARTNER_DELIMITER='@';var MENTION_CHANNEL_DELIMITER='#';var MENTION_CANNED_RESPONSE_DELIMITER=':';var MENTION_COMMAND_DELIMITER='/';var MentionManager=Widget.extend({className:'dropup o_composer_mention_dropdown',events:{"mouseover .o_mention_proposition":"on_hover_mention_proposition","click .o_mention_proposition":"on_click_mention_item",},init:function(parent,options){this._super.apply(this,arguments);this.composer=parent;this.options=_.extend({},options,{min_length:0,});this.open=false;this.listeners=[];this.set('mention_suggestions',[]);this.on('change:mention_suggestions',this,this._render_suggestions);},on_hover_mention_proposition:function(event){var $elem=$(event.currentTarget);this.$('.o_mention_proposition').removeClass('active');$elem.addClass('active');},on_click_mention_item:function(event){event.preventDefault();var text_input=this.composer.$input.val();var id=$(event.currentTarget).data('id');var selected_suggestion=_.find(_.flatten(this.get('mention_suggestions')),function(s){return s.id===id;});var substitution=selected_suggestion.substitution;if(!substitution){selected_suggestion.name=selected_suggestion.name.replace(/ /g,NON_BREAKING_SPACE);substitution=this.active_listener.delimiter+selected_suggestion.name;}
var get_mention_index=function(matches,cursor_position){for(var i=0;i<matches.length;i++){if(cursor_position<=matches[i].index){return i;}}
return i;};if(this.active_listener.selection.length){var matches=this._get_match(text_input,this.active_listener);var index=get_mention_index(matches,this._get_selection_positions().start);this.active_listener.selection.splice(index,0,selected_suggestion);}else{this.active_listener.selection.push(selected_suggestion);}
var cursor_position=this._get_selection_positions().start;var text_left=text_input.substring(0,cursor_position-(this.mention_word.length+1));var text_right=text_input.substring(cursor_position,text_input.length);var text_input_new=text_left+substitution+' '+text_right;this.composer.$input.val(text_input_new);this._set_cursor_position(text_left.length+substitution.length+2);this.set('mention_suggestions',[]);this.composer.focus();},register:function(listener){this.listeners.push(_.defaults(listener,{model:'',redirect_classname:'',selection:[],}));},is_open:function(){return this.open;},get_listener_selection:function(delimiter){var listener=_.findWhere(this.listeners,{delimiter:delimiter});if(listener){var input_mentions=this.composer.$input.val().match(new RegExp(delimiter+'[^ ]+(?= |&nbsp;)','g'));return this._validate_selection(listener.selection,input_mentions);}
return[];},get_listener_selections:function(){var selections={};_.each(this.listeners,function(listener){selections[listener.delimiter]=listener.selection;});return selections;},proposition_navigation:function(keycode){var $active=this.$('.o_mention_proposition.active');if(keycode===$.ui.keyCode.ENTER){$active.click();}else{var $to;if(keycode===$.ui.keyCode.DOWN){$to=$active.nextAll('.o_mention_proposition').first();}else{$to=$active.prevAll('.o_mention_proposition').first();}
if($to.length){$active.removeClass('active');$to.addClass('active');}}},detect_delimiter:function(){var self=this;var text_val=this.composer.$input.val();var cursor_position=this._get_selection_positions().start;var left_string=text_val.substring(0,cursor_position);function validate_keyword(delimiter,beginning_only){var delimiter_position=left_string.lastIndexOf(delimiter)-1;if(beginning_only&&delimiter_position>0){return false;}
var search_str=text_val.substring(delimiter_position,cursor_position);var pattern="(^"+delimiter+"|(^\\s"+delimiter+"))";var regex_start=new RegExp(pattern,"g");search_str=search_str.replace(/^\s\s*|^[\n\r]/g,'');if(regex_start.test(search_str)&&search_str.length>self.options.min_length){search_str=search_str.replace(pattern,'');return search_str.indexOf(' ')<0&&!/[\r\n]/.test(search_str)?search_str.replace(delimiter,''):false;}
return false;}
this.active_listener=undefined;for(var i=0;i<this.listeners.length;i++){var listener=this.listeners[i];this.mention_word=validate_keyword(listener.delimiter,listener.beginning_only);if(this.mention_word!==false){this.active_listener=listener;break;}}
if(this.active_listener){var mention_word=this.mention_word;$.when(this.active_listener.fetch_callback(mention_word)).then(function(suggestions){if(mention_word===self.mention_word){self.set('mention_suggestions',suggestions);}});}else{this.set('mention_suggestions',[]);}},generate_links:function(s){var self=this;var base_href=session.url("/web");var mention_link="<a href='%s' class='%s' data-oe-id='%s' data-oe-model='%s' target='_blank'>%s%s</a>";_.each(this.listeners,function(listener){if(!listener.generate_links){return;}
var selection=listener.selection;if(selection.length){var matches=self._get_match(s,listener);var substrings=[];var start_index=0;for(var i=0;i<matches.length;i++){var match=matches[i];var end_index=match.index+match[0].length;var selection_id=self.get_selection_id(match,selection);var match_name=match[0].substring(1).replace(new RegExp(NON_BREAKING_SPACE,'g'),' ');var href=base_href+_.str.sprintf("#model=%s&id=%s",listener.model,selection_id);var processed_text=_.str.sprintf(mention_link,href,listener.redirect_classname,selection_id,listener.model,listener.delimiter,match_name);var subtext=s.substring(start_index,end_index).replace(match[0],processed_text);substrings.push(subtext);start_index=end_index;}
substrings.push(s.substring(start_index,s.length));s=substrings.join('');}});return s;},get_selection_id:function(match,selection){return _.findWhere(selection,{'name':match[0].slice(1)}).id;},reset_suggestions:function(){this.set('mention_suggestions',[]);},reset_selections:function(){_.each(this.listeners,function(listener){listener.selection=[];});},_get_match:function(input_text,listener){var names=_.pluck(listener.selection,'name');var escaped_names=_.map(names,function(str){return"("+_.str.escapeRegExp(listener.delimiter+str)+")(?= |&nbsp;)";});var regex_str=escaped_names.join('|');var result=[];if(regex_str.length){var myRegexp=new RegExp(regex_str,'g');var match=myRegexp.exec(input_text);while(match!==null){result.push(match);match=myRegexp.exec(input_text);}}
return result;},_render_suggestions:function(){var suggestions=[];if(_.find(this.get('mention_suggestions'),_.isArray)){var insert_divider=false;_.each(this.get('mention_suggestions'),function(suggestion_group){if(suggestion_group.length>0){if(insert_divider){suggestions.push({divider:true});}
suggestions=suggestions.concat(suggestion_group);insert_divider=true;}});}else{suggestions=this.get('mention_suggestions');}
if(suggestions.length){this.$el.html(QWeb.render(this.active_listener.suggestion_template,{suggestions:suggestions,}));this.$el.addClass('open').find('ul').css("max-width",this.composer.$input.width()).find('.o_mention_proposition').first().addClass('active');this.open=true;}else{this.$el.removeClass('open');this.$el.empty();this.open=false;}},_validate_selection:function(selection,input_mentions){var validated_selection=[];_.each(input_mentions,function(mention){var validated_mention=_.findWhere(selection,{name:mention.slice(1)});if(validated_mention){validated_selection.push(validated_mention);}});return validated_selection;},_get_selection_positions:function(){var el=this.composer.$input.get(0);return el?{start:el.selectionStart,end:el.selectionEnd}:{start:0,end:0};},_set_cursor_position:function(pos){this.composer.$input.each(function(index,elem){if(elem.setSelectionRange){elem.setSelectionRange(pos,pos);}
else if(elem.createTextRange){elem.createTextRange().collapse(true).moveEnd('character',pos).moveStart('character',pos).select();}});},});var BasicComposer=Widget.extend({template:"mail.ChatComposer",events:{"keydown .o_composer_input textarea":"on_keydown","keyup .o_composer_input":"on_keyup","change input.o_form_input_file":"on_attachment_change","click .o_composer_button_send":"send_message","click .o_composer_button_add_attachment":"on_click_add_attachment","click .o_attachment_delete":"on_attachment_delete",},init:function(parent,options){this._super.apply(this,arguments);this.options=_.defaults(options||{},{commands_enabled:true,context:{},input_baseline:18,input_max_height:150,input_min_height:28,mention_fetch_limit:8,mention_partners_restricted:false,send_text:_t('Send'),default_body:'',default_mention_selections:{},});this.context=this.options.context;this.AttachmentDataSet=new data.DataSetSearch(this,'ir.attachment',this.context);this.fileupload_id=_.uniqueId('o_chat_fileupload');this.set('attachment_ids',[]);this.mention_manager=new MentionManager(this);this.mention_manager.register({delimiter:MENTION_PARTNER_DELIMITER,fetch_callback:this.mention_fetch_partners.bind(this),generate_links:true,model:'res.partner',redirect_classname:'o_mail_redirect',selection:this.options.default_mention_selections[MENTION_PARTNER_DELIMITER],suggestion_template:'mail.MentionPartnerSuggestions',});this.mention_manager.register({delimiter:MENTION_CHANNEL_DELIMITER,fetch_callback:this.mention_fetch_channels.bind(this),generate_links:true,model:'mail.channel',redirect_classname:'o_channel_redirect',selection:this.options.default_mention_selections[MENTION_CHANNEL_DELIMITER],suggestion_template:'mail.MentionChannelSuggestions',});this.mention_manager.register({delimiter:MENTION_CANNED_RESPONSE_DELIMITER,fetch_callback:this.mention_get_canned_responses.bind(this),selection:this.options.default_mention_selections[MENTION_CANNED_RESPONSE_DELIMITER],suggestion_template:'mail.MentionCannedResponseSuggestions',});if(this.options.commands_enabled){this.mention_manager.register({beginning_only:true,delimiter:MENTION_COMMAND_DELIMITER,fetch_callback:this.mention_get_commands.bind(this),selection:this.options.default_mention_selections[MENTION_COMMAND_DELIMITER],suggestion_template:'mail.MentionCommandSuggestions',});}
this.emoji_container_classname='o_composer_emoji';this.PartnerModel=new Model('res.partner');this.ChannelModel=new Model('mail.channel');},start:function(){var self=this;this.$attachment_button=this.$(".o_composer_button_add_attachment");this.$attachments_list=this.$('.o_composer_attachments_list');this.$input=this.$('.o_composer_input textarea');this.$input.focus(function(){self.trigger('input_focused');});this.$input.val(this.options.default_body);dom_utils.autoresize(this.$input,{parent:this,min_height:this.options.input_min_height});$(window).on(this.fileupload_id,this.on_attachment_loaded);this.on("change:attachment_ids",this,this.render_attachments);this.$('.o_composer_button_emoji').popover({placement:'top',content:function(){if(!self.$emojis){self.$emojis=$(QWeb.render('mail.ChatComposer.emojis',{emojis:chat_manager.get_emojis(),}));self.$emojis.filter('.o_mail_emoji').on('click',self,self.on_click_emoji_img);}
return self.$emojis;},html:true,container:'.'+self.emoji_container_classname,trigger:'focus',});this.mention_manager.prependTo(this.$('.o_composer'));return this._super();},destroy:function(){$(window).off(this.fileupload_id);return this._super.apply(this,arguments);},toggle:function(state){this.$el.toggle(state);},preprocess_message:function(){var value=_.escape(this.$input.val()).replace(/\n|\r/g,'<br/>');value=value.replace(/ /g,'&nbsp;').replace(/([^>])&nbsp;([^<])/g,'$1 $2');var commands=this.options.commands_enabled?this.mention_manager.get_listener_selection('/'):[];return $.when({content:this.mention_manager.generate_links(value),attachment_ids:_.pluck(this.get('attachment_ids'),'id'),partner_ids:_.uniq(_.pluck(this.mention_manager.get_listener_selection('@'),'id')),command:commands.length>0?commands[0].name:undefined,});},send_message:function(){if(this.is_empty()||!this.do_check_attachment_upload()){return;}
var self=this;this.preprocess_message().then(function(message){self.trigger('post_message',message);self.$input.val('');self.mention_manager.reset_selections();self.set('attachment_ids',[]);self.$input.focus();});},on_click_add_attachment:function(){this.$('input.o_form_input_file').click();this.$input.focus();},on_click_emoji_img:function(event){this.$input.val(this.$input.val()+" "+$(event.currentTarget).data('emoji')+" ");this.$input.focus();},should_send:function(event){return!event.shiftKey;},on_keydown:function(event){switch(event.which){case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:if(this.mention_manager.is_open()){event.preventDefault();}
break;case $.ui.keyCode.ENTER:if(this.mention_manager.is_open()){event.preventDefault();}else{var send_message=event.ctrlKey||this.should_send(event);if(send_message){event.preventDefault();this.send_message();}}
break;}},on_keyup:function(event){switch(event.which){case $.ui.keyCode.END:case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.PAGE_DOWN:break;case $.ui.keyCode.ESCAPE:event.stopPropagation();this.mention_manager.reset_suggestions();break;case $.ui.keyCode.ENTER:case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:if(this.mention_manager.is_open()){this.mention_manager.proposition_navigation(event.which);}
break;default:this.mention_manager.detect_delimiter();}},on_attachment_change:function(event){var $target=$(event.target);if($target.val()!==''){var filename=$target.val().replace(/.*[\\\/]/,'');var attachments=[];for(var i in this.get('attachment_ids')){if((this.get('attachment_ids')[i].filename||this.get('attachment_ids')[i].name)===filename){if(this.get('attachment_ids')[i].upload){return false;}
this.AttachmentDataSet.unlink([this.get('attachment_ids')[i].id]);}else{attachments.push(this.get('attachment_ids')[i]);}}
this.$('form.o_form_binary_form').submit();this.$attachment_button.prop('disabled',true);attachments.push({'id':0,'name':filename,'filename':filename,'url':'','upload':true,'mimetype':'',});this.set('attachment_ids',attachments);}},on_attachment_loaded:function(event,result){var attachment_ids=[];if(result.error||!result.id){this.do_warn(result.error);attachment_ids=_.filter(this.get('attachment_ids'),function(val){return!val.upload;});}else{_.each(this.get('attachment_ids'),function(a){if(a.filename===result.filename&&a.upload){attachment_ids.push({'id':result.id,'name':result.name||result.filename,'filename':result.filename,'mimetype':result.mimetype,'url':session.url('/web/content',{'id':result.id,download:true}),});}else{attachment_ids.push(a);}});}
this.set('attachment_ids',attachment_ids);this.$attachment_button.prop('disabled',false);},on_attachment_delete:function(event){event.stopPropagation();var self=this;var attachment_id=$(event.target).data("id");if(attachment_id){var attachments=[];_.each(this.get('attachment_ids'),function(attachment){if(attachment_id!==attachment.id){attachments.push(attachment);}else{self.AttachmentDataSet.unlink([attachment_id]);}});this.set('attachment_ids',attachments);}},do_check_attachment_upload:function(){if(_.find(this.get('attachment_ids'),function(file){return file.upload;})){this.do_warn(_t("Uploading error"),_t("Please, wait while the file is uploading."));return false;}
return true;},render_attachments:function(){this.$attachments_list.html(QWeb.render('mail.ChatComposer.Attachments',{attachments:this.get('attachment_ids'),}));},mention_fetch_throttled:function(model,method,kwargs){var def=$.Deferred();clearTimeout(this.mention_fetch_timer);this.mention_fetch_timer=setTimeout(function(){return model.call(method,kwargs).then(function(results){def.resolve(results);});},200);return def;},mention_fetch_channels:function(search){return this.mention_fetch_throttled(this.ChannelModel,'get_mention_suggestions',{limit:this.options.mention_fetch_limit,search:search,}).then(function(suggestions){return _.partition(suggestions,function(suggestion){return _.contains(['public','groups'],suggestion.public);});});},mention_fetch_partners:function(search){var self=this;return $.when(this.mention_prefetched_partners).then(function(prefetched_partners){var suggestions=[];var limit=self.options.mention_fetch_limit;var search_regexp=new RegExp(_.str.escapeRegExp(utils.unaccent(search)),'i');_.each(prefetched_partners,function(partners){if(limit>0){var filtered_partners=_.filter(partners,function(partner){return partner.email&&search_regexp.test(partner.email)||partner.name&&search_regexp.test(utils.unaccent(partner.name));});if(filtered_partners.length){suggestions.push(filtered_partners.slice(0,limit));limit-=filtered_partners.length;}}});if(!suggestions.length&&!self.options.mention_partners_restricted){suggestions=self.mention_fetch_throttled(self.PartnerModel,'get_mention_suggestions',{limit:limit,search:search,});}
return suggestions;});},mention_get_canned_responses:function(search){var canned_responses=chat_manager.get_canned_responses();var matches=fuzzy.filter(utils.unaccent(search),_.pluck(canned_responses,'source'));var indexes=_.pluck(matches.slice(0,this.options.mention_fetch_limit),'index');return _.map(indexes,function(i){return canned_responses[i];});},mention_get_commands:function(search){var search_regexp=new RegExp(_.str.escapeRegExp(utils.unaccent(search)),'i');return _.filter(this.mention_commands,function(command){return search_regexp.test(command.name);}).slice(0,this.options.mention_fetch_limit);},mention_set_prefetched_partners:function(prefetched_partners){this.mention_prefetched_partners=prefetched_partners;},mention_set_enabled_commands:function(commands){this.mention_commands=commands;},mention_get_listener_selections:function(){return this.mention_manager.get_listener_selections();},is_empty:function(){return!this.$input.val().trim()&&!this.$('.o_attachments').children().length;},focus:function(){this.$input.focus();},});var ExtendedComposer=BasicComposer.extend({init:function(parent,options){options=_.defaults(options||{},{input_min_height:120,});this._super(parent,options);this.extended=true;this.emoji_container_classname='o_extended_composer_emoji';},start:function(){this.$subject_input=this.$(".o_composer_subject input");return this._super.apply(this,arguments);},preprocess_message:function(){var self=this;return this._super().then(function(message){var subject=self.$subject_input.val();self.$subject_input.val("");message.subject=subject;return message;});},should_send:function(){return false;},focus:function(target){if(target==='body'){this.$input.focus();}else{this.$subject_input.focus();}},set_subject:function(subject){this.$('.o_composer_subject input').val(subject);},});return{BasicComposer:BasicComposer,ExtendedComposer:ExtendedComposer,};});;

/* /mail/static/src/js/chat_manager.js defined in bundle 'web.assets_backend' */
odoo.define('mail.chat_manager',function(require){"use strict";var bus=require('bus.bus').bus;var utils=require('mail.utils');var config=require('web.config');var Bus=require('web.Bus');var core=require('web.core');var data=require('web.data');var Model=require('web.Model');var session=require('web.session');var time=require('web.time');var web_client=require('web.web_client');var _t=core._t;var _lt=core._lt;var LIMIT=25;var preview_msg_max_size=350;var ODOOBOT_ID="ODOOBOT";var MessageModel=new Model('mail.message',session.user_context);var ChannelModel=new Model('mail.channel',session.user_context);var UserModel=new Model('res.users',session.user_context);var PartnerModel=new Model('res.partner',session.user_context);var messages=[];var channels=[];var channels_preview_def;var channel_defs={};var chat_unread_counter=0;var unread_conversation_counter=0;var emojis=[];var emoji_substitutions={};var needaction_counter=0;var starred_counter=0;var mention_partner_suggestions=[];var canned_responses=[];var commands=[];var discuss_menu_id;var global_unread_counter=0;var pinned_dm_partners=[];var client_action_open=false;bus.on("window_focus",null,function(){global_unread_counter=0;web_client.set_title_part("_chat");});function notify_incoming_message(msg,options){if(bus.is_odoo_focused()&&options.is_displayed){return;}
var title=_t('New message');if(msg.author_id[1]){title=_.escape(msg.author_id[1]);}
var content=utils.parse_and_transform(msg.body,utils.strip_html).substr(0,preview_msg_max_size);if(!bus.is_odoo_focused()){global_unread_counter++;var tab_title=_.str.sprintf(_t("%d Messages"),global_unread_counter);web_client.set_title_part("_chat",tab_title);}
utils.send_notification(title,content);}
function add_message(data,options){options=options||{};var msg=_.findWhere(messages,{id:data.id});if(!msg){msg=chat_manager.make_message(data);messages.splice(_.sortedIndex(messages,msg,'id'),0,msg);_.each(msg.channel_ids,function(channel_id){var channel=chat_manager.get_channel(channel_id);if(channel){add_to_cache(msg,[]);if(options.domain&&options.domain!==[]){add_to_cache(msg,options.domain);}
if(channel.hidden){channel.hidden=false;chat_manager.bus.trigger('new_channel',channel);}
if(channel.type!=='static'&&!msg.is_author&&!msg.is_system_notification){if(options.increment_unread){update_channel_unread_counter(channel,channel.unread_counter+1);}
if(channel.is_chat&&options.show_notification){if(!client_action_open&&config.device.size_class!==config.device.SIZES.XS){chat_manager.bus.trigger('open_chat',channel,{passively:true});}
var query={is_displayed:false};chat_manager.bus.trigger('anyone_listening',channel,query);notify_incoming_message(msg,query);}}}});if(!options.silent){chat_manager.bus.trigger('new_message',msg);}}else if(options.domain&&options.domain!==[]){add_to_cache(msg,options.domain);}
return msg;}
function make_message(data){var msg={id:data.id,author_id:data.author_id,body:data.body||"",date:moment(time.str_to_datetime(data.date)),message_type:data.message_type,subtype_description:data.subtype_description,is_author:data.author_id&&data.author_id[0]===session.partner_id,is_note:data.is_note,is_system_notification:(data.message_type==='notification'&&data.model==='mail.channel')||data.info==='transient_message',attachment_ids:data.attachment_ids||[],subject:data.subject,email_from:data.email_from,customer_email_status:data.customer_email_status,customer_email_data:data.customer_email_data,record_name:data.record_name,tracking_value_ids:data.tracking_value_ids,channel_ids:data.channel_ids,model:data.model,res_id:data.res_id,url:session.url("/mail/view?message_id="+data.id),};_.each(_.keys(emoji_substitutions),function(key){var escaped_key=String(key).replace(/([.*+?=^!:${}()|[\]\/\\])/g,'\\$1');var regexp=new RegExp("(?:^|\\s|<[a-z]*>)("+escaped_key+")(?=\\s|$|</[a-z]*>)","g");msg.body=msg.body.replace(regexp,' <span class="o_mail_emoji">'+emoji_substitutions[key]+'</span> ');});function property_descr(channel){return{enumerable:true,get:function(){return _.contains(msg.channel_ids,channel);},set:function(bool){if(bool){add_channel_to_message(msg,channel);}else{msg.channel_ids=_.without(msg.channel_ids,channel);}}};}
Object.defineProperties(msg,{is_starred:property_descr("channel_starred"),is_needaction:property_descr("channel_inbox"),});if(_.contains(data.needaction_partner_ids,session.partner_id)){msg.is_needaction=true;}
if(_.contains(data.starred_partner_ids,session.partner_id)){msg.is_starred=true;}
if(msg.model==='mail.channel'){var real_channels=_.without(msg.channel_ids,'channel_inbox','channel_starred');var origin=real_channels.length===1?real_channels[0]:undefined;var channel=origin&&chat_manager.get_channel(origin);if(channel){msg.origin_id=origin;msg.origin_name=channel.name;}}
if((!msg.author_id||!msg.author_id[0])&&msg.email_from){msg.mailto=msg.email_from;}else{msg.displayed_author=(msg.author_id===ODOOBOT_ID)&&"OdooBot"||msg.author_id&&msg.author_id[1]||msg.email_from||_t('Anonymous');}
msg.author_redirect=!msg.is_author&&msg.author_id!==ODOOBOT_ID;if(msg.author_id===ODOOBOT_ID){msg.avatar_src="/mail/static/src/img/odoo_o.png";}else if(msg.author_id&&msg.author_id[0]){msg.avatar_src="/web/image/res.partner/"+msg.author_id[0]+"/image_small";}else if(msg.message_type==='email'){msg.avatar_src="/mail/static/src/img/email_icon.png";}else{msg.avatar_src="/mail/static/src/img/smiley/avatar.jpg";}
msg.body=utils.parse_and_transform(msg.body,utils.add_link);_.each(msg.attachment_ids,function(a){a.url='/web/content/'+a.id+'?download=true';});if(msg.tracking_value_ids&&msg.tracking_value_ids.length){_.each(msg.tracking_value_ids,function(f){if(_.contains(['date','datetime'],f.field_type)){var format=(f.field_type==='date')?'LL':'LLL';if(f.old_value){f.old_value=moment.utc(f.old_value).local().format(format);}
if(f.new_value){f.new_value=moment.utc(f.new_value).local().format(format);}}});}
return msg;}
function add_channel_to_message(message,channel_id){message.channel_ids.push(channel_id);message.channel_ids=_.uniq(message.channel_ids);}
function add_channel(data,options){options=typeof options==="object"?options:{};var channel=chat_manager.get_channel(data.id);if(channel){if(channel.is_folded!==(data.state==="folded")){channel.is_folded=(data.state==="folded");chat_manager.bus.trigger("channel_toggle_fold",channel);}}else{channel=chat_manager.make_channel(data,options);channels.push(channel);channels=_.sortBy(channels,function(channel){return _.isString(channel.name)?channel.name.toLowerCase():''});if(!options.silent){chat_manager.bus.trigger("new_channel",channel);}
if(channel.is_detached){chat_manager.bus.trigger("open_chat",channel);}}
return channel;}
function make_channel(data,options){var channel={id:data.id,name:data.name,server_type:data.channel_type,type:data.type||data.channel_type,all_history_loaded:false,uuid:data.uuid,is_detached:data.is_minimized,is_folded:data.state==="folded",autoswitch:'autoswitch'in options?options.autoswitch:true,hidden:options.hidden,display_needactions:options.display_needactions,mass_mailing:data.mass_mailing,needaction_counter:data.message_needaction_counter||0,unread_counter:0,last_seen_message_id:data.seen_message_id,cache:{'[]':{all_history_loaded:false,loaded:false,messages:[],}},};if(channel.type==="channel"){channel.type=data.public!=="private"?"public":"private";}
if(_.size(data.direct_partner)>0){channel.type="dm";channel.name=data.direct_partner[0].name;channel.direct_partner_id=data.direct_partner[0].id;channel.status=data.direct_partner[0].im_status;pinned_dm_partners.push(channel.direct_partner_id);bus.update_option('bus_presence_partner_ids',pinned_dm_partners);}else if('anonymous_name'in data){channel.name=data.anonymous_name;}
if(data.last_message_date){channel.last_message_date=moment(time.str_to_datetime(data.last_message_date));}
channel.is_chat=!channel.type.match(/^(public|private|static)$/);if(data.message_unread_counter){update_channel_unread_counter(channel,data.message_unread_counter);}
return channel;}
function remove_channel(channel){if(!channel){return;}
if(channel.type==='dm'){var index=pinned_dm_partners.indexOf(channel.direct_partner_id);if(index>-1){pinned_dm_partners.splice(index,1);bus.update_option('bus_presence_partner_ids',pinned_dm_partners);}}
channels=_.without(channels,channel);delete channel_defs[channel.id];}
function get_channel_cache(channel,domain){var stringified_domain=JSON.stringify(domain||[]);if(!channel.cache[stringified_domain]){channel.cache[stringified_domain]={all_history_loaded:false,loaded:false,messages:[],};}
return channel.cache[stringified_domain];}
function invalidate_caches(channel_ids){_.each(channel_ids,function(channel_id){var channel=chat_manager.get_channel(channel_id);if(channel){channel.cache={'[]':channel.cache['[]']};}});}
function add_to_cache(message,domain){_.each(message.channel_ids,function(channel_id){var channel=chat_manager.get_channel(channel_id);if(channel){var channel_cache=get_channel_cache(channel,domain);var index=_.sortedIndex(channel_cache.messages,message,'id');if(channel_cache.messages[index]!==message){channel_cache.messages.splice(index,0,message);}}});}
function remove_message_from_channel(channel_id,message){message.channel_ids=_.without(message.channel_ids,channel_id);var channel=_.findWhere(channels,{id:channel_id});_.each(channel.cache,function(cache){cache.messages=_.without(cache.messages,message);});}
function fetch_from_channel(channel,options){options=options||{};var domain=(channel.id==="channel_inbox")?[['needaction','=',true]]:(channel.id==="channel_starred")?[['starred','=',true]]:[['channel_ids','in',channel.id]];var cache=get_channel_cache(channel,options.domain);if(options.domain){domain=new data.CompoundDomain(domain,options.domain||[]);}
if(options.load_more){var min_message_id=cache.messages[0].id;domain=new data.CompoundDomain([['id','<',min_message_id]],domain);}
return MessageModel.call('message_fetch',[domain],{limit:LIMIT,context:session.user_context}).then(function(msgs){if(!cache.all_history_loaded){cache.all_history_loaded=msgs.length<LIMIT;}
cache.loaded=true;_.each(msgs,function(msg){add_message(msg,{channel_id:channel.id,silent:true,domain:options.domain});});var channel_cache=get_channel_cache(channel,options.domain||[]);return channel_cache.messages;});}
function fetch_document_messages(ids,options){var loaded_msgs=_.filter(messages,function(message){return _.contains(ids,message.id);});var loaded_msg_ids=_.pluck(loaded_msgs,'id');options=options||{};if(options.force_fetch||_.difference(ids.slice(0,LIMIT),loaded_msg_ids).length){var ids_to_load=_.difference(ids,loaded_msg_ids).slice(0,LIMIT);return MessageModel.call('message_format',[ids_to_load],{context:session.user_context}).then(function(msgs){var processed_msgs=[];_.each(msgs,function(msg){processed_msgs.push(add_message(msg,{silent:true}));});return _.sortBy(loaded_msgs.concat(processed_msgs),function(msg){return msg.id;});});}else{return $.when(loaded_msgs);}}
function update_channel_unread_counter(channel,counter){if(channel.unread_counter>0&&counter===0){unread_conversation_counter=Math.max(0,unread_conversation_counter-1);}else if(channel.unread_counter===0&&counter>0){unread_conversation_counter++;}
if(channel.is_chat){chat_unread_counter=Math.max(0,chat_unread_counter-channel.unread_counter+counter);}
channel.unread_counter=counter;chat_manager.bus.trigger("update_channel_unread_counter",channel);}
var channel_seen=_.throttle(function(channel){return ChannelModel.call('channel_seen',[[channel.id]],{},{shadow:true});},3000);function on_notification(notifications){var unsubscribed_notif=_.find(notifications,function(notif){return notif[1].info==="unsubscribe";});if(unsubscribed_notif){notifications=_.reject(notifications,function(notif){return notif[0][1]==="mail.channel"&&notif[0][2]===unsubscribed_notif[1].id;});}
_.each(notifications,function(notification){var model=notification[0][1];if(model==='ir.needaction'){on_needaction_notification(notification[1]);}else if(model==='mail.channel'){on_channel_notification(notification[1]);}else if(model==='res.partner'){on_partner_notification(notification[1]);}else if(model==='bus.presence'){on_presence_notification(notification[1]);}});}
function on_needaction_notification(message){message=add_message(message,{channel_id:'channel_inbox',show_notification:true,increment_unread:true,});invalidate_caches(message.channel_ids);if(message.channel_ids.length!==0){needaction_counter++;}
_.each(message.channel_ids,function(channel_id){var channel=chat_manager.get_channel(channel_id);if(channel){channel.needaction_counter++;}});chat_manager.bus.trigger('update_needaction',needaction_counter);}
function on_channel_notification(message){var def;var channel_already_in_cache=true;if(message.channel_ids.length===1){channel_already_in_cache=!!chat_manager.get_channel(message.channel_ids[0]);def=chat_manager.join_channel(message.channel_ids[0],{autoswitch:false});}else{def=$.when();}
def.then(function(){add_message(message,{show_notification:true,increment_unread:channel_already_in_cache});invalidate_caches(message.channel_ids);});}
function on_partner_notification(data){if(data.info==="unsubscribe"){var channel=chat_manager.get_channel(data.id);if(channel){var msg;if(_.contains(['public','private'],channel.type)){msg=_.str.sprintf(_t('You unsubscribed from <b>%s</b>.'),channel.name);}else{msg=_.str.sprintf(_t('You unpinned your conversation with <b>%s</b>.'),channel.name);}
remove_channel(channel);chat_manager.bus.trigger("unsubscribe_from_channel",data.id);web_client.do_notify(_("Unsubscribed"),msg);}}else if(data.type==='toggle_star'){on_toggle_star_notification(data);}else if(data.type==='mark_as_read'){on_mark_as_read_notification(data);}else if(data.type==='mark_as_unread'){on_mark_as_unread_notification(data);}else if(data.info==='channel_seen'){on_channel_seen_notification(data);}else if(data.info==='transient_message'){on_transient_message_notification(data);}else{on_chat_session_notification(data);}}
function on_toggle_star_notification(data){_.each(data.message_ids,function(msg_id){var message=_.findWhere(messages,{id:msg_id});if(message){invalidate_caches(message.channel_ids);message.is_starred=data.starred;if(!message.is_starred){remove_message_from_channel("channel_starred",message);starred_counter--;}else{add_to_cache(message,[]);var channel_starred=chat_manager.get_channel('channel_starred');channel_starred.cache=_.pick(channel_starred.cache,"[]");starred_counter++;}
chat_manager.bus.trigger('update_message',message);}});chat_manager.bus.trigger('update_starred',starred_counter);}
function on_mark_as_read_notification(data){_.each(data.message_ids,function(msg_id){var message=_.findWhere(messages,{id:msg_id});if(message){invalidate_caches(message.channel_ids);remove_message_from_channel("channel_inbox",message);chat_manager.bus.trigger('update_message',message);}});if(data.channel_ids){_.each(data.channel_ids,function(channel_id){var channel=chat_manager.get_channel(channel_id);if(channel){channel.needaction_counter=Math.max(channel.needaction_counter-data.message_ids.length,0);}});}else{_.each(channels,function(channel){channel.needaction_counter=0;});}
needaction_counter=Math.max(needaction_counter-data.message_ids.length,0);chat_manager.bus.trigger('update_needaction',needaction_counter);}
function on_mark_as_unread_notification(data){_.each(data.message_ids,function(message_id){var message=_.findWhere(messages,{id:message_id});if(message){invalidate_caches(message.channel_ids);add_channel_to_message(message,'channel_inbox');add_to_cache(message,[]);}});var channel_inbox=chat_manager.get_channel('channel_inbox');channel_inbox.cache=_.pick(channel_inbox.cache,"[]");_.each(data.channel_ids,function(channel_id){var channel=chat_manager.get_channel(channel_id);if(channel){channel.needaction_counter+=data.message_ids.length;}});needaction_counter+=data.message_ids.length;chat_manager.bus.trigger('update_needaction',needaction_counter);}
function on_channel_seen_notification(data){var channel=chat_manager.get_channel(data.id);if(channel){channel.last_seen_message_id=data.last_message_id;if(channel.unread_counter){update_channel_unread_counter(channel,0);}}}
function on_chat_session_notification(chat_session){var channel;if((chat_session.channel_type==="channel")&&(chat_session.state==="open")){add_channel(chat_session,{autoswitch:false});if(!chat_session.is_minimized&&chat_session.info!=='creation'){web_client.do_notify(_t("Invitation"),_t("You have been invited to: ")+chat_session.name);}}
if((chat_session.state==="open")||(chat_session.state==="folded")){channel=chat_session.is_minimized&&chat_manager.get_channel(chat_session.id);if(channel){channel.is_detached=true;channel.is_folded=(chat_session.state==="folded");chat_manager.bus.trigger("open_chat",channel);}}else if(chat_session.state==="closed"){channel=chat_manager.get_channel(chat_session.id);if(channel){channel.is_detached=false;chat_manager.bus.trigger("close_chat",channel,{keep_open_if_unread:true});}}}
function on_presence_notification(data){var dm=chat_manager.get_dm_from_partner_id(data.id);if(dm){dm.status=data.im_status;chat_manager.bus.trigger('update_dm_presence',dm);}}
function on_transient_message_notification(data){var last_message=_.last(messages);data.id=(last_message?last_message.id:0)+0.01;data.author_id=data.author_id||ODOOBOT_ID;add_message(data);}
var chat_manager={make_message:make_message,make_channel:make_channel,post_message:function(data,options){options=options||{};var body=utils.parse_and_transform(_.str.trim(data.content),utils.add_link);var msg={partner_ids:data.partner_ids,body:body,attachment_ids:data.attachment_ids,};if('subject'in data){msg.subject=data.subject;}
if('channel_id'in options){return ChannelModel.call(data.command?'execute_command':'message_post',[options.channel_id],_.extend(msg,{message_type:'comment',content_subtype:'html',subtype:'mail.mt_comment',command:data.command,}));}
if('model'in options&&'res_id'in options){_.extend(msg,{content_subtype:data.content_subtype,context:data.context,message_type:data.message_type,subtype:data.subtype,subtype_id:data.subtype_id,});var model=new Model(options.model);return model.call('message_post',[options.res_id],msg).then(function(msg_id){return MessageModel.call('message_format',[msg_id]).then(function(msgs){msgs[0].model=options.model;msgs[0].res_id=options.res_id;add_message(msgs[0]);});});}},get_message:function(id){return _.findWhere(messages,{id:id});},get_messages:function(options){var channel;if('channel_id'in options&&options.load_more){channel=this.get_channel(options.channel_id);return fetch_from_channel(channel,{domain:options.domain||{},load_more:true});}
if('channel_id'in options){channel=this.get_channel(options.channel_id);var channel_cache=get_channel_cache(channel,options.domain);if(channel_cache.loaded){return $.when(channel_cache.messages);}else{return fetch_from_channel(channel,{domain:options.domain});}}
if('ids'in options){return fetch_document_messages(options.ids,options).then(function(result){chat_manager.mark_as_read(options.ids);return result;});}
if('model'in options&&'res_id'in options){var domain=[['model','=',options.model],['res_id','=',options.res_id]];MessageModel.call('message_fetch',[domain],{limit:30}).then(function(msgs){return _.map(msgs,add_message);});}},toggle_star_status:function(message_id){return MessageModel.call('toggle_message_starred',[[message_id]]);},unstar_all:function(){return MessageModel.call('unstar_all',[[]],{});},mark_as_read:function(message_ids){var ids=_.filter(message_ids,function(id){var message=_.findWhere(messages,{id:id});return!message||message.is_needaction;});if(ids.length){return MessageModel.call('set_message_done',[ids]);}else{return $.when();}},mark_all_as_read:function(channel,domain){if((channel.id==="channel_inbox"&&needaction_counter)||(channel&&channel.needaction_counter)){return MessageModel.call('mark_all_as_read',[],{channel_ids:channel.id!=="channel_inbox"?[channel.id]:[],domain:domain});}
return $.when();},undo_mark_as_read:function(message_ids,channel){return MessageModel.call('mark_as_unread',[message_ids,[channel.id]]);},mark_channel_as_seen:function(channel){if(channel.unread_counter>0&&channel.type!=='static'){update_channel_unread_counter(channel,0);channel_seen(channel);}},get_channels:function(){return _.clone(channels);},get_channel:function(id){return _.findWhere(channels,{id:id});},get_dm_from_partner_id:function(partner_id){return _.findWhere(channels,{direct_partner_id:partner_id});},all_history_loaded:function(channel,domain){return get_channel_cache(channel,domain).all_history_loaded;},get_mention_partner_suggestions:function(channel){if(!channel){return mention_partner_suggestions;}
if(!channel.members_deferred){channel.members_deferred=ChannelModel.call("channel_fetch_listeners",[channel.uuid],{},{shadow:true}).then(function(members){var suggestions=[];_.each(mention_partner_suggestions,function(partners){suggestions.push(_.filter(partners,function(partner){return!_.findWhere(members,{id:partner.id});}));});return[members];});}
return channel.members_deferred;},get_commands:function(channel){return _.filter(commands,function(command){return!command.channel_types||_.contains(command.channel_types,channel.server_type);});},get_canned_responses:function(){return canned_responses;},get_emojis:function(){return emojis;},get_needaction_counter:function(){return needaction_counter;},get_starred_counter:function(){return starred_counter;},get_chat_unread_counter:function(){return chat_unread_counter;},get_unread_conversation_counter:function(){return unread_conversation_counter;},get_last_seen_message:function(channel){if(channel.last_seen_message_id){var messages=channel.cache['[]'].messages;var msg=_.findWhere(messages,{id:channel.last_seen_message_id});if(msg){var i=_.sortedIndex(messages,msg,'id')+1;while(i<messages.length&&(messages[i].is_author||messages[i].is_system_notification)){msg=messages[i];i++;}
return msg;}}},get_discuss_menu_id:function(){return discuss_menu_id;},detach_channel:function(channel){return ChannelModel.call("channel_minimize",[channel.uuid,true],{},{shadow:true});},remove_chatter_messages:function(model){messages=_.reject(messages,function(message){return message.channel_ids.length===0&&message.model===model;});},bus:new Bus(),create_channel:function(name,type){var method=type==="dm"?"channel_get":"channel_create";var args=type==="dm"?[[name]]:[name,type];return ChannelModel.call(method,args).then(add_channel);},join_channel:function(channel_id,options){if(channel_id in channel_defs){return channel_defs[channel_id];}
var channel=this.get_channel(channel_id);if(channel){channel_defs[channel_id]=$.when(channel);}else{channel_defs[channel_id]=ChannelModel.call('channel_join_and_get_info',[[channel_id]]).then(function(result){return add_channel(result,options);});}
return channel_defs[channel_id];},open_and_detach_dm:function(partner_id){return ChannelModel.call('channel_get_and_minimize',[[partner_id]]).then(add_channel);},open_channel:function(channel){chat_manager.bus.trigger(client_action_open?'open_channel':'detach_channel',channel);},unsubscribe:function(channel){if(_.contains(['public','private'],channel.type)){return ChannelModel.call('action_unfollow',[[channel.id]]);}else{return ChannelModel.call('channel_pin',[channel.uuid,false]);}},close_chat_session:function(channel_id){var channel=this.get_channel(channel_id);ChannelModel.call("channel_fold",[],{uuid:channel.uuid,state:"closed"},{shadow:true});},fold_channel:function(channel_id,folded){var args={uuid:this.get_channel(channel_id).uuid,};if(_.isBoolean(folded)){args.state=folded?'folded':'open';}
return ChannelModel.call("channel_fold",[],args,{shadow:true});},redirect:function(res_model,res_id,dm_redirection_callback){var self=this;var redirect_to_document=function(res_model,res_id,view_id){web_client.do_action({type:'ir.actions.act_window',view_type:'form',view_mode:'form',res_model:res_model,views:[[view_id||false,'form']],res_id:res_id,});};if(res_model==="res.partner"){var domain=[["partner_id","=",res_id]];UserModel.call("search",[domain]).then(function(user_ids){if(user_ids.length&&user_ids[0]!==session.uid&&dm_redirection_callback){self.create_channel(res_id,'dm').then(dm_redirection_callback);}else{redirect_to_document(res_model,res_id);}});}else{new Model(res_model).call('get_formview_id',[[res_id],session.user_context]).then(function(view_id){redirect_to_document(res_model,res_id,view_id);});}},get_channels_preview:function(channels){var channels_preview=_.map(channels,function(channel){var info=_.pick(channel,'id','is_chat','name','status','unread_counter');info.last_message=_.last(channel.cache['[]'].messages);if(!info.is_chat){info.image_src='/web/image/mail.channel/'+channel.id+'/image_small';}else if(channel.direct_partner_id){info.image_src='/web/image/res.partner/'+channel.direct_partner_id+'/image_small';}else{info.image_src='/mail/static/src/img/smiley/avatar.jpg';}
return info;});var missing_channels=_.where(channels_preview,{last_message:undefined});if(!channels_preview_def){if(missing_channels.length){var missing_channel_ids=_.pluck(missing_channels,'id');channels_preview_def=ChannelModel.call('channel_fetch_preview',[missing_channel_ids],{},{shadow:true});}else{channels_preview_def=$.when();}}
return channels_preview_def.then(function(channels){_.each(missing_channels,function(channel_preview){var channel=_.findWhere(channels,{id:channel_preview.id});if(channel){channel_preview.last_message=add_message(channel.last_message);}});return _.filter(channels_preview,function(channel){return channel.last_message;});});},get_message_body_preview:function(message_body){return utils.parse_and_transform(message_body,utils.inline);},search_partner:function(search_val,limit){var def=$.Deferred();var values=[];var search_regexp=new RegExp(_.str.escapeRegExp(utils.unaccent(search_val)),'i');_.each(mention_partner_suggestions,function(partners){if(values.length<limit){values=values.concat(_.filter(partners,function(partner){return session.partner_id!==partner.id&&search_regexp.test(partner.name);})).splice(0,limit);}});if(!values.length){def=PartnerModel.call('im_search',[search_val,limit||20],{},{shadow:true});}else{def=$.when(values);}
return def.then(function(values){var autocomplete_data=_.map(values,function(value){return{id:value.id,value:value.name,label:value.name};});return _.sortBy(autocomplete_data,'label');});},};chat_manager.bus.on('client_action_open',null,function(open){client_action_open=open;});function init(){add_channel({id:"channel_inbox",name:_lt("Inbox"),type:"static",},{display_needactions:true});add_channel({id:"channel_starred",name:_lt("Starred"),type:"static"});bus.on('notification',null,on_notification);return session.is_bound.then(function(){return session.rpc('/mail/client_action');}).then(function(result){_.each(result.channel_slots,function(channels){_.each(channels,add_channel);});needaction_counter=result.needaction_inbox_counter;starred_counter=result.starred_counter;commands=_.map(result.commands,function(command){return _.extend({id:command.name},command);});mention_partner_suggestions=result.mention_partner_suggestions;discuss_menu_id=result.menu_id;_.each(result.shortcodes,function(s){if(s.shortcode_type==='text'){canned_responses.push(_.pick(s,['id','source','substitution']));}else{emojis.push(_.pick(s,['id','source','substitution','description']));emoji_substitutions[_.escape(s.source)]=s.substitution;}});bus.start_polling();});}
chat_manager.is_ready=init();return chat_manager;});;

/* /mail/static/src/js/chatter.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Chatter',function(require){"use strict";var chat_manager=require('mail.chat_manager');var composer=require('mail.composer');var ChatThread=require('mail.ChatThread');var utils=require('mail.utils');var config=require('web.config');var core=require('web.core');var form_common=require('web.form_common');var framework=require('web.framework');var pyeval=require('web.pyeval');var web_utils=require('web.utils');var _t=core._t;var QWeb=core.qweb;var ChatterComposer=composer.BasicComposer.extend({template:'mail.chatter.ChatComposer',init:function(parent,dataset,options){this._super(parent,options);this.thread_dataset=dataset;this.suggested_partners=[];this.options=_.defaults(this.options,{display_mode:'textarea',record_name:false,is_log:false,});if(this.options.is_log){this.options.send_text=_t('Log');}
this.events=_.extend(this.events,{'click .o_composer_button_full_composer':'on_open_full_composer',});},willStart:function(){if(this.options.is_log){return this._super.apply(this,arguments);}
return $.when(this._super.apply(this,arguments),this.message_get_suggested_recipients());},should_send:function(){return false;},preprocess_message:function(){var self=this;var def=$.Deferred();this._super().then(function(message){message=_.extend(message,{subtype:'mail.mt_comment',message_type:'comment',content_subtype:'html',context:self.context,});if(self.options.is_log){message.subtype='mail.mt_note';}
if(!self.options.is_log){var checked_suggested_partners=self.get_checked_suggested_partners();self.check_suggested_partners(checked_suggested_partners).done(function(partner_ids){message.partner_ids=(message.partner_ids||[]).concat(partner_ids);message.context=_.defaults({},message.context,{mail_post_autofollow:true,});def.resolve(message);});}else{def.resolve(message);}});return def;},prevent_send:function(event){return!event.shiftKey;},message_get_suggested_recipients:function(){var self=this;var email_addresses=_.pluck(this.suggested_partners,'email_address');return this.thread_dataset.call('message_get_suggested_recipients',[[this.context.default_res_id],this.context]).done(function(suggested_recipients){var thread_recipients=suggested_recipients[self.context.default_res_id];_.each(thread_recipients,function(recipient){var parsed_email=utils.parse_email(recipient[1]);if(_.indexOf(email_addresses,parsed_email[1])===-1){self.suggested_partners.push({checked:true,partner_id:recipient[0],full_name:recipient[1],name:parsed_email[0],email_address:parsed_email[1],reason:recipient[2],});}});});},get_checked_suggested_partners:function(){var self=this;var checked_partners=[];this.$('.o_composer_suggested_partners input:checked').each(function(){var full_name=$(this).data('fullname');checked_partners=checked_partners.concat(_.filter(self.suggested_partners,function(item){return full_name===item.full_name;}));});return checked_partners;},check_suggested_partners:function(checked_suggested_partners){var self=this;var check_done=$.Deferred();var recipients=_.filter(checked_suggested_partners,function(recipient){return recipient.checked;});var recipients_to_find=_.filter(recipients,function(recipient){return(!recipient.partner_id);});var names_to_find=_.pluck(recipients_to_find,'full_name');var recipients_to_check=_.filter(recipients,function(recipient){return(recipient.partner_id&&!recipient.email_address);});var recipient_ids=_.pluck(_.filter(recipients,function(recipient){return recipient.partner_id&&recipient.email_address;}),'partner_id');var names_to_remove=[];var recipient_ids_to_remove=[];var find_done=$.Deferred();if(names_to_find.length>0){find_done=self.thread_dataset.call('message_partner_info_from_emails',[[this.context.default_res_id],names_to_find]);}else{find_done.resolve([]);}
$.when(find_done).pipe(function(result){var emails_deferred=[];var recipient_popups=result.concat(recipients_to_check);_.each(recipient_popups,function(partner_info){var deferred=$.Deferred();emails_deferred.push(deferred);var partner_name=partner_info.full_name;var partner_id=partner_info.partner_id;var parsed_email=utils.parse_email(partner_name);var dialog=new form_common.FormViewDialog(self,{res_model:'res.partner',res_id:partner_id,context:{force_email:true,ref:"compound_context",default_name:parsed_email[0],default_email:parsed_email[1],},title:_t("Please complete partner's informations"),disable_multiple_selection:true,}).open();dialog.on('closed',self,function(){deferred.resolve();});dialog.opened().then(function(){dialog.view_form.on('on_button_cancel',self,function(){names_to_remove.push(partner_name);if(partner_id){recipient_ids_to_remove.push(partner_id);}});});});$.when.apply($,emails_deferred).then(function(){var new_names_to_find=_.difference(names_to_find,names_to_remove);find_done=$.Deferred();if(new_names_to_find.length>0){find_done=self.thread_dataset.call('message_partner_info_from_emails',[[self.context.default_res_id],new_names_to_find,true]);}else{find_done.resolve([]);}
$.when(find_done).pipe(function(result){var recipient_popups=result.concat(recipients_to_check);_.each(recipient_popups,function(partner_info){if(partner_info.partner_id&&_.indexOf(partner_info.partner_id,recipient_ids_to_remove)===-1){recipient_ids.push(partner_info.partner_id);}});}).pipe(function(){check_done.resolve(recipient_ids);});});});return check_done;},on_open_full_composer:function(){if(!this.do_check_attachment_upload()){return false;}
var self=this;var recipient_done=$.Deferred();if(this.options.is_log){recipient_done.resolve([]);}else{var checked_suggested_partners=this.get_checked_suggested_partners();recipient_done=this.check_suggested_partners(checked_suggested_partners);}
recipient_done.then(function(partner_ids){var context={default_parent_id:self.id,default_body:utils.get_text2html(self.$input.val()),default_attachment_ids:_.pluck(self.get('attachment_ids'),'id'),default_partner_ids:partner_ids,default_is_log:self.options.is_log,mail_post_autofollow:true,};if(self.context.default_model&&self.context.default_res_id){context.default_model=self.context.default_model;context.default_res_id=self.context.default_res_id;}
self.do_action({type:'ir.actions.act_window',res_model:'mail.compose.message',view_mode:'form',view_type:'form',views:[[false,'form']],target:'new',context:context,},{on_close:function(){self.trigger('need_refresh');var parent=self.getParent();chat_manager.get_messages({model:parent.model,res_id:parent.res_id});},}).then(self.trigger.bind(self,'close_composer'));});}});var Chatter=form_common.AbstractField.extend({template:'mail.Chatter',events:{"click .o_chatter_button_new_message":"on_open_composer_new_message","click .o_chatter_button_log_note":"on_open_composer_log_note",},init:function(){this._super.apply(this,arguments);this.model=this.view.dataset.model;this.res_id=undefined;this.context=this.options.context||{};this.dp=new web_utils.DropPrevious();},willStart:function(){return chat_manager.is_ready;},start:function(){var self=this;this.view.on("change:actual_mode",this,this.check_visibility);this.check_visibility();var $container=this.$el.parent();if($container.hasClass('oe_chatter')){this.$el.addClass($container.attr("class")).unwrap();}
this.followers=this.field_manager.fields.message_follower_ids;if(this.followers){this.$('.o_chatter_topbar').append(this.followers.$el);this.followers.on('redirect',chat_manager,chat_manager.redirect);this.followers.on('followers_update',this,this.on_followers_update);}
this.thread=new ChatThread(this,{display_order:ChatThread.ORDER.DESC,display_document_link:false,display_needactions:false,squash_close_messages:false,});this.thread.on('load_more_messages',this,this.load_more_messages);this.thread.on('toggle_star_status',this,function(message_id){chat_manager.toggle_star_status(message_id);});this.thread.on('redirect',chat_manager,chat_manager.redirect);this.thread.on('redirect_to_channel',this,this.on_channel_redirect);this.ready=$.Deferred();var def1=this._super.apply(this,arguments);var def2=this.thread.appendTo(this.$el);return $.when(def1,def2).then(function(){chat_manager.bus.on('new_message',self,self.on_new_message);chat_manager.bus.on('update_message',self,self.on_update_message);self.ready.resolve();});},check_visibility:function(){this.set({"force_invisible":this.view.get("actual_mode")==="create"});},fetch_and_render_thread:function(ids,options){var self=this;options=options||{};options.ids=ids;var fetch_def=this.dp.add(chat_manager.get_messages(options));this.thread.$el.empty();web_utils.reject_after(web_utils.delay(1000),fetch_def).then(function(){self.thread.$el.append(QWeb.render('Spinner'));});return fetch_def.then(function(raw_messages){self.thread.render(raw_messages,{display_load_more:raw_messages.length<ids.length});});},on_post_message:function(message){var self=this;var options={model:this.model,res_id:this.res_id};chat_manager.post_message(message,options).then(function(){self.close_composer();if(message.partner_ids.length){self.refresh_followers();}}).fail(function(){});},on_new_message:function(message){if(message.model===this.model&&message.res_id===this.res_id){this.msg_ids.unshift(message.id);this.fetch_and_render_thread(this.msg_ids);}},on_update_message:function(message){if(message.model===this.model&&message.res_id===this.res_id){this.fetch_and_render_thread(this.msg_ids);}},on_channel_redirect:function(channel_id){var self=this;var def=chat_manager.join_channel(channel_id);$.when(def).then(function(){self.do_action('mail.mail_channel_action_client_chat',{active_id:channel_id});});},on_followers_update:function(followers){this.mention_suggestions=[];var self=this;var prefetched_partners=chat_manager.get_mention_partner_suggestions();var follower_suggestions=[];_.each(followers,function(follower){if(follower.res_model==='res.partner'){follower_suggestions.push({id:follower.res_id,name:follower.name,email:follower.email,});}});if(follower_suggestions.length){this.mention_suggestions.push(follower_suggestions);}
_.each(prefetched_partners,function(partners){self.mention_suggestions.push(_.filter(partners,function(partner){return!_.findWhere(follower_suggestions,{id:partner.id});}));});},load_more_messages:function(){var self=this;var top_msg_id=this.$('.o_thread_message').first().data('messageId');var top_msg_selector='.o_thread_message[data-message-id="'+top_msg_id+'"]';var offset=-framework.getPosition(document.querySelector(top_msg_selector)).top;this.fetch_and_render_thread(this.msg_ids,{force_fetch:true}).then(function(){offset+=framework.getPosition(document.querySelector(top_msg_selector)).top;self.thread.scroll_to({offset:offset});});},render_value:function(){return this.ready.then(this._render_value.bind(this));},_render_value:function(){var context=_.extend(this.options.context||{},pyeval.eval('contexts',this.build_context()));this.context=_.extend({default_res_id:this.view.datarecord.id||false,default_model:this.view.model||false,},context);this.thread_dataset=this.view.dataset;this.res_id=this.view.datarecord.id;this.record_name=this.view.datarecord.display_name;this.msg_ids=this.get_value()||[];if(this.composer){this.composer.destroy();this.composer=undefined;this.mute_new_message_button(false);}
return this.fetch_and_render_thread(this.msg_ids);},refresh_followers:function(){if(this.followers){this.followers.read_value();}},on_open_composer_new_message:function(){this.open_composer();},on_open_composer_log_note:function(){this.open_composer({is_log:true});},open_composer:function(options){var self=this;var old_composer=this.composer;this.composer=new ChatterComposer(this,this.thread_dataset,{commands_enabled:false,context:this.context,input_min_height:50,input_max_height:Number.MAX_VALUE,input_baseline:14,is_log:options&&options.is_log,record_name:this.record_name,default_body:old_composer&&old_composer.$input&&old_composer.$input.val(),default_mention_selections:old_composer&&old_composer.mention_get_listener_selections(),});this.composer.on('input_focused',this,function(){this.composer.mention_set_prefetched_partners(this.mention_suggestions||[]);});this.composer.insertBefore(this.$('.o_mail_thread')).then(function(){if(old_composer){old_composer.destroy();}
if(!config.device.touch){self.composer.focus();}
self.composer.on('post_message',self,self.on_post_message);self.composer.on('need_refresh',self,self.refresh_followers);self.composer.on('close_composer',null,self.close_composer.bind(self,true));});this.mute_new_message_button(true);},close_composer:function(force){if(this.composer&&(this.composer.is_empty()||force)){this.composer.do_hide();this.composer.$input.val('');this.mute_new_message_button(false);}},mute_new_message_button:function(mute){if(mute){this.$('.o_chatter_button_new_message').removeClass('btn-primary').addClass('btn-default');}else if(!mute){this.$('.o_chatter_button_new_message').removeClass('btn-default').addClass('btn-primary');}},destroy:function(){chat_manager.remove_chatter_messages(this.model);this._super.apply(this,arguments);},});core.form_widget_registry.add('mail_thread',Chatter);return Chatter;});;

/* /mail/static/src/js/followers.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Followers',function(require){"use strict";var ajax=require('web.ajax');var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var form_common=require('web.form_common');var session=require('web.session');var _t=core._t;var qweb=core.qweb;var Followers=form_common.AbstractField.extend({template:'mail.Followers',init:function(){this._super.apply(this,arguments);this.image=this.node.attrs.image||'image_small';this.comment=this.node.attrs.help||false;this.ds_model=new data.DataSetSearch(this,this.view.model);this.value=[];this.followers=[];this.followers_fetched=$.Deferred();this.data_subtype={};this.view_is_editable=this.__parentedParent.is_action_enabled('edit');},start:function(){this.view.on("change:actual_mode",this,this.on_check_visibility_mode);this.on_check_visibility_mode();this.reinit();this.bind_events();return this._super();},on_check_visibility_mode:function(){this.set({"force_invisible":this.view.get("actual_mode")==="create"});},set_value:function(_value){this.value=_value;this._super(_value);},reinit:function(){this.data_subtype={};this.message_is_follower=undefined;this.display_buttons();},bind_events:function(){var self=this;this.$el.on('click','.o_followers_follow_button',function(){if($(this).hasClass('o_followers_notfollow')){self.do_follow();}else{self.do_unfollow({user_ids:[session.uid]});}});this.$el.on('click','.o_subtypes_list input',function(event){event.stopPropagation();self.do_update_subscription(event);var $list=self.$('.o_subtypes_list');if(!$list.hasClass('open')){$list.addClass('open');}
if(self.$('.o_subtypes_list ul')[0].children.length<1){$list.removeClass('open');}});this.$el.on('click','.o_add_follower',function(event){event.preventDefault();self.on_invite_follower(false);});this.$el.on('click','.o_add_follower_channel',function(event){event.preventDefault();self.on_invite_follower(true);});this.$el.on('click','.o_edit_subtype',self.on_edit_subtype);this.$el.on('click','.o_remove_follower',self.on_remove_follower);this.$el.on('click','.o_mail_redirect',self.on_click_redirect);},on_edit_subtype:function(event){var self=this;var $currentTarget=$(event.currentTarget);var follower_id=$currentTarget.data('follower-id');var res_id=$currentTarget.data('oe-id');var is_channel=$currentTarget.data('oe-model')==='mail.channel';self.dialog=new Dialog(this,{size:'medium',title:_t('Edit Subscription of ')+$currentTarget.siblings('a').text(),buttons:[{text:_t("Apply"),classes:'btn-primary',click:function(){self.do_update_subscription(event,res_id,is_channel);},close:true},{text:_t("Cancel"),close:true,},],}).open();return self.fetch_subtypes(follower_id).then(function(data){self.display_subtypes(data,true,is_channel);});},on_invite_follower:function(channel_only){var self=this;var action={type:'ir.actions.act_window',res_model:'mail.wizard.invite',view_mode:'form',view_type:'form',views:[[false,'form']],name:_t('Invite Follower'),target:'new',context:{'default_res_model':this.view.dataset.model,'default_res_id':this.view.datarecord.id,'mail_invite_follower_channel_only':channel_only,},};this.do_action(action,{on_close:function(){self.read_value();},});},on_remove_follower:function(event){var res_model=$(event.target).parent().find('a').data('oe-model');var res_id=$(event.target).parent().find('a').data('oe-id');if(res_model==='res.partner'){return this.do_unfollow({partner_ids:[res_id]});}else{return this.do_unfollow({channel_ids:[res_id]});}},on_click_redirect:function(event){event.preventDefault();var res_id=$(event.target).data('oe-id');var res_model=$(event.target).data('oe-model');this.trigger('redirect',res_model,res_id);},read_value:function(){var self=this;return this.ds_model.read_ids([this.view.datarecord.id],['message_follower_ids']).then(function(results){self.value=results[0].message_follower_ids;self.render_value();});},render_value:function(){var self=this;this.reinit();this.value=this.value||[];return this.fetch_followers().then(function(results){self.display_followers(results.followers);if(results.subtypes){self.display_subtypes(results.subtypes);}
self.display_buttons();}).fail(this.display_generic.bind(this));},fetch_followers:function(){return ajax.jsonRpc('/mail/read_followers','call',{follower_ids:this.value,res_model:this.view.model,});},fetch_subtypes:function(follower_id){return ajax.jsonRpc('/mail/read_subscription_data','call',{res_model:this.view.model,follower_id:follower_id,});},_format_followers:function(count){var str='';if(count<=0){str=_t('No follower');}else if(count===1){str=_t('One follower');}else{str=''+count+' '+_t('followers');}
return str;},display_generic:function(){this.$('.o_followers_actions').hide();this.$('.o_followers_list').hide();this.$('.o_followers_title_box > button').prop('disabled',true);this.$('.o_followers_count').html(this.value.length).parent().attr("title",this._format_followers(this.value.length));},display_followers:function(records){var self=this;this.followers=records||this.followers;this.trigger('followers_update',this.followers);var $followers_list=this.$('.o_followers_list').empty();this.$('.o_followers_count').html(this.value.length).parent().attr("title",this._format_followers(this.value.length));var user_follower=_.filter(this.followers,function(rec){return rec.is_uid;});this.message_is_follower=user_follower.length>=1;this.follower_id=this.message_is_follower?user_follower[0].id:undefined;$(qweb.render('mail.Followers.add_more',{'widget':self})).appendTo($followers_list);var $follower_li;_(this.followers).each(function(record){$follower_li=$(qweb.render('mail.Followers.partner',{'record':_.extend(record,{'avatar_url':'/web/image/'+record.res_model+'/'+record.res_id+'/image_small'}),'widget':self}));$follower_li.appendTo($followers_list);if(record.is_editable){$follower_li.on('mouseenter mouseleave',function(e){$(e.currentTarget).find('.o_edit_subtype').toggleClass('hide',e.type==='mouseleave');});}});},display_buttons:function(){if(this.message_is_follower){this.$('button.o_followers_follow_button').removeClass('o_followers_notfollow').addClass('o_followers_following');this.$('.o_subtypes_list > .dropdown-toggle').attr('disabled',false);this.$('.o_followers_actions .dropdown-toggle').addClass('o_followers_following')}else{this.$('button.o_followers_follow_button').removeClass('o_followers_following').addClass('o_followers_notfollow');this.$('.o_subtypes_list > .dropdown-toggle').attr('disabled',true);this.$('.o_followers_actions .dropdown-toggle').removeClass('o_followers_following')}},display_subtypes:function(data,dialog,display_warning){var old_parent_model;var $list;if(dialog){$list=$('<ul>').appendTo(this.dialog.$el);}else{$list=this.$('.o_subtypes_list ul');}
$list.empty();this.data_subtype=data;_.each(data,function(record){if(old_parent_model!==record.parent_model&&old_parent_model!==undefined){$list.append($('<li>').addClass('divider'));}
old_parent_model=record.parent_model;record.followed=record.followed||undefined;$(qweb.render('mail.Followers.subtype',{'record':record,'dialog':dialog,'display_warning':display_warning&&record.internal})).appendTo($list);});if(display_warning){$(qweb.render('mail.Followers.subtypes.warning')).appendTo(this.dialog.$el);}},do_follow:function(){var context=new data.CompoundContext(this.build_context(),{});this.$('.o_subtypes_list > .dropdown-toggle').attr('disabled',false);this.ds_model.call('message_subscribe_users',[[this.view.datarecord.id],[session.uid],undefined,context]).then(this.proxy('read_value'));_.each(this.$('.o_subtypes_list input'),function(record){$(record).attr('checked','checked');});},do_unfollow:function(ids){if(confirm(_t("Warning! \n If you remove a follower, he won't be notified of any email or discussion on this document. Do you really want to remove this follower ?"))){_(this.$('.o_subtype_checkbox')).each(function(record){$(record).attr('checked',false);});this.$('.o_subtypes_list > .dropdown-toggle').attr('disabled',true);var context=new data.CompoundContext(this.build_context(),{});if(ids.partner_ids||ids.channel_ids){return this.ds_model.call('message_unsubscribe',[[this.view.datarecord.id],ids.partner_ids,ids.channel_ids,context]).then(this.proxy('read_value'));}else{return this.ds_model.call('message_unsubscribe_users',[[this.view.datarecord.id],ids.user_ids,context]).then(this.proxy('read_value'));}}
return false;},do_update_subscription:function(event,follower_id,is_channel){var self=this;var kwargs={};var ids={};var action_subscribe;var subtypes;this.data_subtype={};if(follower_id!==undefined){action_subscribe='message_subscribe';subtypes=this.dialog.$('input[type="checkbox"]');if(is_channel){ids.channel_ids=[follower_id];}else{ids.partner_ids=[follower_id];}}else{action_subscribe='message_subscribe_users';subtypes=this.$('.o_followers_actions input[type="checkbox"]');ids.user_ids=[session.uid];}
kwargs=_.extend(kwargs,ids);var checklist=[];_(subtypes).each(function(record){if($(record).is(':checked')){checklist.push(parseInt($(record).data('id')));}});kwargs.subtype_ids=checklist;if(!checklist.length){if(!this.do_unfollow(ids)){$(event.target).prop("checked",true);}else{self.$('.o_subtypes_list ul').empty();}}else{kwargs.context=new data.CompoundContext(this.build_context(),{});return this.ds_model._model.call(action_subscribe,[[this.view.datarecord.id]],kwargs).then(this.proxy('read_value'));}},});core.form_widget_registry.add('mail_followers',Followers);});;

/* /mail/static/src/js/thread.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ChatThread',function(require){"use strict";var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var ORDER={ASC:1,DESC:-1,};var read_more=_t('read more');var read_less=_t('read less');function time_from_now(date){if(moment().diff(date,'seconds')<45){return _t("now");}
return date.fromNow();}
var Thread=Widget.extend({className:'o_mail_thread',events:{"click a":"on_click_redirect","click img":"on_click_redirect","click strong":"on_click_redirect","click .o_thread_show_more":"on_click_show_more","click .o_thread_message_needaction":function(event){var message_id=$(event.currentTarget).data('message-id');this.trigger("mark_as_read",message_id);},"click .o_thread_message_star":function(event){var message_id=$(event.currentTarget).data('message-id');this.trigger("toggle_star_status",message_id);},"click .o_thread_message_reply":function(event){this.selected_id=$(event.currentTarget).data('message-id');this.$('.o_thread_message').removeClass('o_thread_selected_message');this.$('.o_thread_message[data-message-id="'+this.selected_id+'"]').addClass('o_thread_selected_message');this.trigger('select_message',this.selected_id);event.stopPropagation();},"click .oe_mail_expand":function(event){event.preventDefault();var $message=$(event.currentTarget).parents('.o_thread_message');$message.addClass('o_message_expanded');this.expanded_msg_ids.push($message.data('message-id'));},"click .o_thread_message":function(event){$(event.currentTarget).toggleClass('o_thread_selected_message');},"click":function(){if(this.selected_id){this.unselect();this.trigger('unselect_message');}},},init:function(parent,options){this._super.apply(this,arguments);this.options=_.defaults(options||{},{display_order:ORDER.ASC,display_needactions:true,display_stars:true,display_document_link:true,display_avatar:true,squash_close_messages:true,display_email_icon:true,display_reply_icon:false,});this.expanded_msg_ids=[];this.selected_id=null;},render:function(messages,options){var self=this;var msgs=_.map(messages,this._preprocess_message.bind(this));if(this.options.display_order===ORDER.DESC){msgs.reverse();}
options=_.extend({},this.options,options);var prev_msg;_.each(msgs,function(msg){if(!prev_msg||(Math.abs(msg.date.diff(prev_msg.date))>60000)||prev_msg.message_type!=='comment'||msg.message_type!=='comment'||(prev_msg.author_id[0]!==msg.author_id[0])||prev_msg.model!==msg.model||prev_msg.res_id!==msg.res_id){msg.display_author=true;}else{msg.display_author=!options.squash_close_messages;}
prev_msg=msg;});this.$el.html(QWeb.render('mail.ChatThread',{messages:msgs,options:options,ORDER:ORDER,}));_.each(msgs,function(msg){var $msg=self.$('.o_thread_message[data-message-id="'+msg.id+'"]');$msg.find('.o_mail_timestamp').data('date',msg.date);self.insert_read_more($msg);});if(!this.update_timestamps_interval){this.update_timestamps_interval=setInterval(function(){self.update_timestamps();},1000*60);}},insert_read_more:function($element){var self=this;var groups=[];var read_more_nodes;var $children=$element.contents().filter(function(){return this.nodeType===1||this.nodeType===3&&this.nodeValue.trim();});_.each($children,function(child){var $child=$(child);if(child.nodeType===3&&$child.prevAll("[id*='stopSpelling']").length>0){var $child=$('<span>',{text:child.textContent,"data-o-mail-quote":"1",});child.parentNode.replaceChild($child[0],child);}
if($child.attr('data-o-mail-quote')||($child.get(0).nodeName==='BR'&&$child.prev("[data-o-mail-quote='1']").length>0)){if(!read_more_nodes){read_more_nodes=[];groups.push(read_more_nodes);}
$child.hide();read_more_nodes.push($child);}else{read_more_nodes=undefined;self.insert_read_more($child);}});_.each(groups,function(group){var $read_more=$('<a>',{class:"o_mail_read_more",href:"#",text:read_more,}).insertBefore(group[0]);var is_read_more=true;$read_more.click(function(e){e.preventDefault();is_read_more=!is_read_more;_.each(group,function($child){$child.hide();$child.toggle(!is_read_more);});$read_more.text(is_read_more?read_more:read_less);});});},update_timestamps:function(){this.$('.o_mail_timestamp').each(function(){var date=$(this).data('date');$(this).html(time_from_now(date));});},on_click_redirect:function(event){var id=$(event.target).data('oe-id');if(id){event.preventDefault();var model=$(event.target).data('oe-model');var options=model&&(model!=='mail.channel')?{model:model,id:id}:{channel_id:id};this._redirect(options);}},_redirect:_.debounce(function(options){if('channel_id'in options){this.trigger('redirect_to_channel',options.channel_id);}else{this.trigger('redirect',options.model,options.id);}},200,true),on_click_show_more:function(){this.trigger('load_more_messages');},_preprocess_message:function(message){var msg=_.extend({},message);msg.date=moment.min(msg.date,moment());msg.hour=time_from_now(msg.date);var date=msg.date.format('YYYY-MM-DD');if(date===moment().format('YYYY-MM-DD')){msg.day=_t("Today");}else if(date===moment().subtract(1,'days').format('YYYY-MM-DD')){msg.day=_t("Yesterday");}else{msg.day=msg.date.format('LL');}
if(_.contains(this.expanded_msg_ids,message.id)){msg.expanded=true;}
msg.display_subject=message.subject&&message.message_type!=='notification'&&!(message.model&&(message.model!=='mail.channel'));msg.is_selected=msg.id===this.selected_id;return msg;},remove_message_and_render:function(message_id,messages,options){var self=this;var done=$.Deferred();this.$('.o_thread_message[data-message-id="'+message_id+'"]').fadeOut({done:function(){self.render(messages,options);done.resolve();},duration:200,});return done;},scroll_to:function(options){options=options||{};if(options.id!==undefined){var $target=this.$('.o_thread_message[data-message-id="'+options.id+'"]');if(options.only_if_necessary){var delta=$target.parent().height()-$target.height();var offset=delta<0?0:delta-($target.offset().top-$target.offsetParent().offset().top);offset=-Math.min(offset,0);this.$el.scrollTo("+="+offset+"px",options);}else if($target.length){this.$el.scrollTo($target);}}else if(options.offset!==undefined){this.$el.scrollTop(options.offset);}else{this.$el.scrollTop(this.el.scrollHeight);}},get_scrolltop:function(){return this.$el.scrollTop();},is_at_bottom:function(){return this.el.scrollHeight-this.$el.scrollTop()-this.$el.outerHeight()<5;},unselect:function(){this.$('.o_thread_message').removeClass('o_thread_selected_message');this.selected_id=null;},destroy:function(){clearInterval(this.update_timestamps_interval);},});Thread.ORDER=ORDER;return Thread;});;

/* /mail/static/src/js/systray.js defined in bundle 'web.assets_backend' */
odoo.define('mail.systray',function(require){"use strict";var core=require('web.core');var SystrayMenu=require('web.SystrayMenu');var Widget=require('web.Widget');var chat_manager=require('mail.chat_manager');var QWeb=core.qweb;var InboxItem=Widget.extend({template:'mail.chat.InboxItem',events:{"click":"on_click",},start:function(){this.$needaction_counter=this.$('.o_notification_counter');chat_manager.bus.on("update_needaction",this,this.update_counter);chat_manager.is_ready.then(this.update_counter.bind(this));return this._super();},update_counter:function(){var counter=chat_manager.get_needaction_counter();this.$needaction_counter.text(counter);this.$el.toggleClass('o_no_notification',!counter);},on_click:function(event){event.preventDefault();chat_manager.is_ready.then(this.discuss_redirect.bind(this));},discuss_redirect:_.debounce(function(){var self=this;this.do_action('mail.mail_channel_action_client_chat',{clear_breadcrumbs:true}).then(function(){self.trigger_up('hide_app_switcher');core.bus.trigger('change_menu_section',chat_manager.get_discuss_menu_id());});},1000,true),});var MessagingMenu=Widget.extend({template:'mail.chat.MessagingMenu',events:{"click":"on_click","click .o_filter_button":"on_click_filter_button","click .o_new_message":"on_click_new_message","click .o_mail_channel_preview":"on_click_channel",},start:function(){this.$filter_buttons=this.$('.o_filter_button');this.$channels_preview=this.$('.o_mail_navbar_dropdown_channels');this.filter=false;chat_manager.bus.on("update_channel_unread_counter",this,this.update_counter);chat_manager.is_ready.then(this.update_counter.bind(this));return this._super();},is_open:function(){return this.$el.hasClass('open');},update_counter:function(){var counter=chat_manager.get_unread_conversation_counter();this.$('.o_notification_counter').text(counter);this.$el.toggleClass('o_no_notification',!counter);this.$el.toggleClass('o_unread_chat',!!chat_manager.get_chat_unread_counter());if(this.is_open()){this.update_channels_preview();}},update_channels_preview:function(){var self=this;this.$channels_preview.html(QWeb.render('Spinner'));chat_manager.is_ready.then(function(){var channels=_.filter(chat_manager.get_channels(),function(channel){if(self.filter==='chat'){return channel.is_chat;}else if(self.filter==='channels'){return!channel.is_chat&&channel.type!=='static';}else{return channel.type!=='static';}});chat_manager.get_channels_preview(channels).then(self._render_channels_preview.bind(self));});},_render_channels_preview:function(channels_preview){channels_preview.sort(function(c1,c2){return Math.min(1,c2.unread_counter)-Math.min(1,c1.unread_counter)||c2.is_chat-c1.is_chat||c2.last_message.date.diff(c1.last_message.date);});_.each(channels_preview,function(channel){channel.last_message_preview=chat_manager.get_message_body_preview(channel.last_message.body);if(channel.last_message.date.isSame(new Date(),'d')){channel.last_message_date=channel.last_message.date.format('LT');}else{channel.last_message_date=channel.last_message.date.format('lll');}});this.$channels_preview.html(QWeb.render('mail.chat.ChannelsPreview',{channels:channels_preview,}));},on_click:function(){if(!this.is_open()){this.update_channels_preview();}},on_click_filter_button:function(event){event.stopPropagation();this.$filter_buttons.removeClass('o_selected');var $target=$(event.currentTarget);$target.addClass('o_selected');this.filter=$target.data('filter');this.update_channels_preview();},on_click_new_message:function(){chat_manager.bus.trigger('open_chat');},on_click_channel:function(event){var channel_id=$(event.currentTarget).data('channel_id');var channel=chat_manager.get_channel(channel_id);if(channel){chat_manager.open_channel(channel);}},});SystrayMenu.Items.push(MessagingMenu);SystrayMenu.Items.push(InboxItem);});;

/* /mail/static/src/js/tour.js defined in bundle 'web.assets_backend' */
odoo.define('mail.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('mail_tour',[{trigger:'.o_mail_chat .o_mail_chat_sidebar .o_add[data-type="public"]',content:_t("<p>Channels make it easy to organize information across different topics and groups.</p> <p>Try to <b>create your first channel</b> (e.g. sales, marketing, product XYZ, after work party, etc).</p>"),position:'bottom',},{trigger:'.o_mail_chat .o_composer_text_field',content:_t("<p><b>Write a message</b> to the members of the channel here.</p> <p>You can notify someone with <i>\'@\'</i> or link another channel with <i>\'#\'</i>. Start your message with <i>\'/\'</i> to get the list of possible commands.</p>"),position:"top",width:350,},{trigger:".o_mail_chat .o_mail_thread .o_thread_message_star",content:_t("Messages can be <b>starred</b> to remind you to check back later."),position:"right",},{trigger:'.o_mail_chat .o_mail_chat_channel_item[data-channel-id="channel_starred"]',content:_t("Once a message has been starred, you can come back and review it at any time here."),position:"bottom",},{trigger:'.o_mail_chat .o_mail_chat_sidebar .o_add[data-type="dm"]',content:_t("<p><b>Chat with coworkers</b> in real-time using direct messages.</p><p><i>You might need to invite users from the Settings app first.</i></p>"),position:'bottom',}]);});;

/* /mail/static/src/js/utils.js defined in bundle 'web.assets_backend' */
odoo.define('mail.utils',function(require){"use strict";var bus=require('bus.bus').bus;var session=require('web.session');var web_client=require('web.web_client');function send_notification(title,content){if(Notification&&Notification.permission==="granted"){if(bus.is_master){_send_native_notification(title,content);}}else{web_client.do_notify(title,content);if(bus.is_master){_beep();}}}
function _send_native_notification(title,content){var notification=new Notification(title,{body:content,icon:"/mail/static/src/img/odoo_o.png"});notification.onclick=function(){window.focus();if(this.cancel){this.cancel();}else if(this.close){this.close();}};}
var _beep=(function(){if(typeof(Audio)==="undefined"){return function(){};}
var audio;return function(){if(!audio){audio=new Audio();var ext=audio.canPlayType("audio/ogg; codecs=vorbis")?".ogg":".mp3";audio.src=session.url("/mail/static/src/audio/ting"+ext);}
audio.play();};})();function parse_and_transform(html_string,transform_function){var open_token="OPEN"+Date.now();var string=html_string.replace(/&lt;/g,open_token);var children=$('<div>').html(string).contents();return _parse_and_transform(children,transform_function).replace(new RegExp(open_token,"g"),"&lt;");}
function _parse_and_transform(nodes,transform_function){return _.map(nodes,function(node){return transform_function(node,function(){return _parse_and_transform(node.childNodes,transform_function);});}).join("");}
var url_regexp=/\b(?:https?:\/\/|(www\.))[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,13}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/gi;function linkify(text,attrs){attrs=attrs||{};if(attrs.target===undefined){attrs.target='_blank';}
attrs=_.map(attrs,function(value,key){return key+'="'+_.escape(value)+'"';}).join(' ');return text.replace(url_regexp,function(url){var href=(!/^(f|ht)tps?:\/\//i.test(url))?"http://"+url:url;return'<a '+attrs+' href="'+href+'">'+url+'</a>';});}
function add_link(node,transform_children){if(node.nodeType===3){return linkify(node.data);}
if(node.tagName==="A")return node.outerHTML;node.innerHTML=transform_children();return node.outerHTML;}
function strip_html(node,transform_children){if(node.nodeType===3)return node.data;if(node.tagName==="BR")return"\n";return transform_children();}
function inline(node,transform_children){if(node.nodeType===3)return node.data;if(node.tagName==="BR")return" ";if(node.tagName.match(/^(A|P|DIV|PRE|BLOCKQUOTE)$/))return transform_children();node.innerHTML=transform_children();return node.outerHTML;}
function parse_email(text){var result=text.match(/(.*)<(.*@.*)>/);if(result){return[_.str.trim(result[1]),_.str.trim(result[2])];}
result=text.match(/(.*@.*)/);if(result){return[_.str.trim(result[1]),_.str.trim(result[1])];}
return[text,false];}
function get_text2html(text){return text.replace(/((?:https?|ftp):\/\/[\S]+)/g,'<a href="$1">$1</a> ').replace(/[\n\r]/g,'<br/>');}
var accented_letters_mapping={'a':'[àáâãäå]','ae':'æ','c':'ç','e':'[èéêë]','i':'[ìíîï]','n':'ñ','o':'[òóôõö]','oe':'œ','u':'[ùúûűü]','y':'[ýÿ]',};function unaccent(str){_.each(accented_letters_mapping,function(value,key){str=str.replace(new RegExp(value,'g'),key);});return str;}
return{send_notification:send_notification,parse_and_transform:parse_and_transform,add_link:add_link,linkify:linkify,strip_html:strip_html,inline:inline,parse_email:parse_email,get_text2html:get_text2html,unaccent:unaccent,};});;

/* /mail/static/src/js/window_manager.js defined in bundle 'web.assets_backend' */
odoo.define('mail.window_manager',function(require){"use strict";var chat_manager=require('mail.chat_manager');var ExtendedChatWindow=require('mail.ExtendedChatWindow');var config=require('web.config');var core=require('web.core');var utils=require('web.utils');var web_client=require('web.web_client');var _t=core._t;var QWeb=core.qweb;var CHAT_WINDOW_WIDTH=300+5;var chat_sessions=[];var new_chat_session;var display_state={chat_windows_hidden:false,hidden_sessions:[],hidden_unread_counter:0,nb_slots:0,space_left:0,windows_dropdown_is_open:false,};function add_chat_session(chat_session){compute_available_slots(chat_sessions.length+1);chat_sessions.splice(display_state.nb_slots-1,0,chat_session);}
function open_chat(session,options){if(!session){open_chat_without_session();return;}
options=options||{};var chat_session=_.findWhere(chat_sessions,{id:session.id});if(!chat_session){var prefix=!session.is_chat?"#":"";var window_options={autofocus:!options.passively,input_less:session.mass_mailing,status:session.status,};chat_session={id:session.id,uuid:session.uuid,name:session.name,keep_unread:options.passively,window:new ExtendedChatWindow(web_client,session.id,prefix+session.name,session.is_folded,session.unread_counter,window_options),};chat_session.window.on("close_chat_session",null,function(){close_chat(chat_session);chat_manager.close_chat_session(chat_session.id);});chat_session.window.on("toggle_star_status",null,function(message_id){chat_manager.toggle_star_status(message_id);});chat_session.window.on("fold_channel",null,function(channel_id,folded){chat_manager.fold_channel(channel_id,folded);});chat_session.window.on("post_message",null,function(message,channel_id){chat_manager.post_message(message,{channel_id:channel_id}).then(function(){chat_session.window.thread.scroll_to();});});chat_session.window.on("redirect",null,function(res_model,res_id){chat_manager.redirect(res_model,res_id,open_chat);});chat_session.window.on("redirect_to_channel",null,function(channel_id){var session=_.findWhere(chat_sessions,{id:channel_id});if(!session){chat_manager.join_channel(channel_id).then(function(channel){chat_manager.detach_channel(channel);});}else{session.window.toggle_fold(false);}});var remove_new_chat=false;if(options.passively){chat_sessions.push(chat_session);}else if(new_chat_session&&new_chat_session.partner_id&&new_chat_session.partner_id===session.direct_partner_id){chat_sessions[_.indexOf(chat_sessions,new_chat_session)]=chat_session;remove_new_chat=true;}else{add_chat_session(chat_session);}
chat_session.window.appendTo($('body')).then(function(){reposition_windows({remove_new_chat:remove_new_chat});return chat_manager.get_messages({channel_id:chat_session.id});}).then(function(messages){chat_session.window.render(messages);chat_session.window.thread.scroll_to();setTimeout(function(){chat_session.window.thread.$el.on("scroll",null,_.debounce(function(){if(!chat_session.keep_unread&&chat_session.window.thread.is_at_bottom()){chat_manager.mark_channel_as_seen(session);}},100));},0);if(options.passively){chat_session.window.$('.o_mail_thread, .o_chat_composer').one('click',function(){chat_manager.mark_channel_as_seen(session);});}else if(!display_state.chat_windows_hidden&&!session.is_folded){chat_manager.mark_channel_as_seen(session);}});}else if(!options.passively){if(chat_session.window.is_hidden){make_session_visible(chat_session);}else if(session.is_folded!==chat_session.window.folded){chat_session.window.toggle_fold(session.is_folded);}}}
function open_chat_without_session(){if(!new_chat_session){new_chat_session={id:'_open',window:new ExtendedChatWindow(web_client,undefined,_t('New message'),false,0,{thread_less:true}),};new_chat_session.window.on("close_chat_session",null,close_new_chat);new_chat_session.window.on('open_dm_session',null,function(partner_id){new_chat_session.partner_id=partner_id;var dm=chat_manager.get_dm_from_partner_id(partner_id);if(!dm){chat_manager.open_and_detach_dm(partner_id);}else{var dm_session=_.findWhere(chat_sessions,{id:dm.id});if(!dm_session){chat_manager.detach_channel(dm);}else{close_chat(dm_session);dm.is_folded=false;open_chat(dm);}}});add_chat_session(new_chat_session);new_chat_session.window.appendTo($('body')).then(reposition_windows);}else{if(new_chat_session.window.is_hidden){make_session_visible(new_chat_session);}else if(new_chat_session.window.folded){new_chat_session.window.toggle_fold(false);}}}
function close_chat(chat_session,options){if(options&&options.keep_open_if_unread&&chat_session.keep_unread){return;}
chat_sessions=_.without(chat_sessions,chat_session);chat_session.window.destroy();reposition_windows();}
function close_new_chat(){chat_sessions=_.without(chat_sessions,new_chat_session);reposition_windows({remove_new_chat:true});}
function destroy_new_chat(){new_chat_session.window.destroy();new_chat_session=undefined;}
function toggle_fold_chat(channel){var session=_.find(chat_sessions,{id:channel.id});if(session){session.window.toggle_fold(channel.is_folded);}}
function compute_available_slots(nb_windows){if(config.device.size_class===config.device.SIZES.XS){display_state.nb_slots=1;return;}
var width=window.innerWidth;var nb_slots=Math.floor(width/CHAT_WINDOW_WIDTH);var space_left=width-(Math.min(nb_slots,nb_windows)*CHAT_WINDOW_WIDTH);if(nb_slots<nb_windows&&space_left<50){nb_slots--;space_left+=CHAT_WINDOW_WIDTH;}
display_state.nb_slots=nb_slots;display_state.space_left=space_left;}
var reposition_windows=function(options){if(options&&options.remove_new_chat){destroy_new_chat();}
if(display_state.chat_windows_hidden){return;}
compute_available_slots(chat_sessions.length);var hidden_sessions=[];var hidden_unread_counter=0;var nb_slots=display_state.nb_slots;_.each(chat_sessions,function(session,index){if(index<nb_slots){session.window.$el.css({right:CHAT_WINDOW_WIDTH*index,bottom:0});session.window.do_show();}else{hidden_sessions.push(session);hidden_unread_counter+=session.window.unread_msgs;session.window.do_hide();}});display_state.hidden_sessions=hidden_sessions;display_state.hidden_unread_counter=hidden_unread_counter;if(display_state.$hidden_windows_dropdown){display_state.$hidden_windows_dropdown.remove();}
if(hidden_sessions.length){display_state.$hidden_windows_dropdown=render_hidden_sessions_dropdown();var $hidden_windows_dropdown=display_state.$hidden_windows_dropdown;$hidden_windows_dropdown.css({right:CHAT_WINDOW_WIDTH*nb_slots,bottom:0}).appendTo($('body'));reposition_hidden_sessions_dropdown();display_state.windows_dropdown_is_open=false;$hidden_windows_dropdown.on('click','.o_chat_header',function(event){var session_id=$(event.currentTarget).data('session-id');var session=_.findWhere(hidden_sessions,{id:session_id});if(session){make_session_visible(session);}});$hidden_windows_dropdown.on('click','.o_chat_window_close',function(event){var session_id=$(event.currentTarget).closest('.o_chat_header').data('session-id');var session=_.findWhere(hidden_sessions,{id:session_id});if(session){session.window.on_click_close(event);display_state.windows_dropdown_is_open=true;}});}};function make_session_visible(session){utils.swap(chat_sessions,session,chat_sessions[display_state.nb_slots-1]);reposition_windows();session.window.toggle_fold(false);}
function render_hidden_sessions_dropdown(){var $dropdown=$(QWeb.render("mail.ChatWindowsDropdown",{sessions:display_state.hidden_sessions,open:display_state.windows_dropdown_is_open,unread_counter:display_state.hidden_unread_counter,}));return $dropdown;}
function reposition_hidden_sessions_dropdown(){var $dropdown_ul=display_state.$hidden_windows_dropdown.children('ul');if(display_state.space_left>$dropdown_ul.width()+10){$dropdown_ul.addClass('dropdown-menu-right');}}
function update_sessions(message,scrollBottom){_.each(chat_sessions,function(session){if(_.contains(message.channel_ids,session.id)){var message_visible=!display_state.chat_windows_hidden&&!session.window.folded&&!session.window.is_hidden&&session.window.thread.is_at_bottom();if(message_visible&&!session.keep_unread){chat_manager.mark_channel_as_seen(chat_manager.get_channel(session.id));}
chat_manager.get_messages({channel_id:session.id}).then(function(messages){session.window.render(messages);if(scrollBottom&&message_visible){session.window.thread.scroll_to();}});}});}
core.bus.on('web_client_ready',null,function(){chat_manager.bus.on('open_chat',null,open_chat);chat_manager.bus.on('close_chat',null,function(channel,options){var session=_.find(chat_sessions,{id:channel.id});if(session){close_chat(session,options);}});chat_manager.bus.on('channel_toggle_fold',null,toggle_fold_chat);chat_manager.bus.on('new_message',null,function(message){update_sessions(message,true);});chat_manager.bus.on('update_message',null,function(message){update_sessions(message,false);});chat_manager.bus.on('anyone_listening',null,function(channel,query){_.each(chat_sessions,function(session){if(channel.id===session.id&&session.window.thread.is_at_bottom()&&!session.window.is_hidden){query.is_displayed=true;}});});chat_manager.bus.on('unsubscribe_from_channel',null,function(channel_id){_.each(chat_sessions,function(session){if(channel_id===session.id){close_chat(session);}});});chat_manager.bus.on('update_channel_unread_counter',null,function(channel){display_state.hidden_unread_counter=0;_.each(chat_sessions,function(session){if(channel.id===session.id){session.window.update_unread(channel.unread_counter);if(channel.unread_counter===0){session.keep_unread=false;}}
if(session.window.is_hidden){display_state.hidden_unread_counter+=session.window.unread_msgs;}});if(display_state.$hidden_windows_dropdown){display_state.$hidden_windows_dropdown.html(render_hidden_sessions_dropdown().html());reposition_hidden_sessions_dropdown();}});chat_manager.bus.on('update_dm_presence',null,function(channel){_.each(chat_sessions,function(session){if(channel.id===session.id){session.window.update_status(channel.status);}});});chat_manager.is_ready.then(function(){_.each(chat_manager.get_channels(),function(channel){if(channel.is_detached){open_chat(channel);}});});chat_manager.bus.on('detach_channel',null,function(channel){var chat_session=_.findWhere(chat_sessions,{id:channel.id});if(!chat_session||chat_session.window.folded){chat_manager.detach_channel(channel);}else if(chat_session.window.is_hidden){make_session_visible(chat_session);}else{chat_session.window.focus_input();}});chat_manager.bus.on('client_action_open',null,function(open){display_state.chat_windows_hidden=open;if(open){$('body').addClass('o_no_chat_window');}else{$('body').removeClass('o_no_chat_window');reposition_windows();}});core.bus.on('resize',null,_.debounce(reposition_windows,100));});});;

/* /mass_mailing/static/src/js/mass_mailing.js defined in bundle 'web.assets_backend' */
odoo.define('mass_mailing.mass_mailing',function(require){var FieldTextHtml=require('web_editor.backend').FieldTextHtml;var KanbanRecord=require('web_kanban.Record');var KanbanColumn=require("web_kanban.Column");var KanbanView=require('web_kanban.KanbanView');KanbanRecord.include({on_card_clicked:function(event){if(this.model==='mail.mass_mailing.campaign'){this.$('.oe_mailings').click();}else{this._super.apply(this,arguments);}},});KanbanColumn.include({init:function(){this._super.apply(this,arguments);if(this.dataset.model==='mail.mass_mailing'){this.draggable=false;}},});KanbanView.include({on_groups_started:function(){this._super.apply(this,arguments);if(this.dataset.model==='mail.mass_mailing'){this.$el.find('.oe_kanban_draghandle').removeClass('oe_kanban_draghandle');}},});FieldTextHtml.include({get_datarecord:function(){var datarecord=this._super();if(this.view.model==='mail.mass_mailing'){var blacklist=['mailing_domain','contact_list_ids'];for(var k in blacklist){delete datarecord[blacklist[k]];}
delete datarecord[this.name];}
return datarecord;},});});;

/* /mrp/static/src/js/mrp.js defined in bundle 'web.assets_backend' */
odoo.define('mrp.mrp_state',function(require){"use strict";var core=require('web.core');var common=require('web.form_common');var Model=require('web.Model');var time=require('web.time');var utils=require('web.utils');var FieldBinaryFile=core.form_widget_registry.get('binary');var _t=core._t;var SetBulletStatus=common.AbstractField.extend(common.ReinitializeFieldMixin,{init:function(field_manager,node){this._super(field_manager,node);this.classes=this.options&&this.options.classes||{};},render_value:function(){this._super.apply(this,arguments);if(this.get("effective_readonly")){var bullet_class=this.classes[this.get('value')]||'default';if(this.get('value')){var title=this.get('value')=='waiting'?_t('Waiting Materials'):_t('Ready to produce');this.$el.attr({'title':title,'style':'display:inline'});this.$el.removeClass('text-success text-danger text-default');this.$el.html($('<span>'+title+'</span>').addClass('label label-'+bullet_class));}}},});var TimeCounter=common.AbstractField.extend(common.ReinitializeFieldMixin,{start:function(){this._super();var self=this;this.field_manager.on("view_content_has_changed",this,function(){self.render_value();});},start_time_counter:function(){var self=this;clearTimeout(this.timer);if(this.field_manager.datarecord.is_user_working){this.duration+=1000;this.timer=setTimeout(function(){self.start_time_counter();},1000);}else{clearTimeout(this.timer);}
this.$el.html($('<span>'+moment.utc(this.duration).format("HH:mm:ss")+'</span>'));},render_value:function(){this._super.apply(this,arguments);var self=this;this.duration;var productivity_domain=[['workorder_id','=',this.field_manager.datarecord.id],['user_id','=',self.session.uid]];new Model('mrp.workcenter.productivity').call('search_read',[productivity_domain,[]]).then(function(result){if(self.get("effective_readonly")){self.$el.removeClass('o_form_field_empty');var current_date=new Date();self.duration=0;_.each(result,function(data){self.duration+=data.date_end?self.get_date_difference(data.date_start,data.date_end):self.get_date_difference(time.auto_str_to_date(data.date_start),current_date);});self.start_time_counter();}});},get_date_difference:function(date_start,date_end){var difference=moment(date_end).diff(moment(date_start));return moment.duration(difference);},});var FieldPdfViewer=FieldBinaryFile.extend({template:'FieldPdfViewer',init:function(){this._super.apply(this,arguments);this.PDFViewerApplication=false;},get_uri:function(){var query_obj={model:this.view.dataset.model,field:this.name,id:this.view.datarecord.id};var query_string=$.param(query_obj);var url=encodeURIComponent('/web/image?'+query_string);var viewer_url='/web/static/lib/pdfjs/web/viewer.html?file=';return viewer_url+url;},on_file_change:function(ev){this._super.apply(this,arguments);if(this.PDFViewerApplication){var files=ev.target.files;if(!files||files.length===0){return;}
var file=files[0];this.PDFViewerApplication.open(URL.createObjectURL(file),0);}},render_value:function(){var $pdf_viewer=this.$('.o_form_pdf_controls').children().add(this.$('.o_pdfview_iframe')),$select_upload_el=this.$('.o_select_file_button').first(),$iFrame=this.$('.o_pdfview_iframe'),value=this.get('value'),self=this;var bin_size=utils.is_bin_size(value);$iFrame.on('load',function(){self.PDFViewerApplication=this.contentWindow.window.PDFViewerApplication;self.disable_buttons(this);});if(this.get("effective_readonly")){if(value){this.$el.off('click');$iFrame.attr('src',this.get_uri());}}else{if(value){$pdf_viewer.removeClass('o_hidden');$select_upload_el.addClass('o_hidden');if(bin_size){$iFrame.attr('src',this.get_uri());}}else{$pdf_viewer.addClass('o_hidden');$select_upload_el.removeClass('o_hidden');}}},disable_buttons:function(iframe){if(this.get("effective_readonly")){$(iframe).contents().find('button#download').hide();}
$(iframe).contents().find('button#openFile').hide();}});core.form_widget_registry.add('bullet_state',SetBulletStatus).add('mrp_time_counter',TimeCounter).add('pdf_viewer',FieldPdfViewer);});;

/* /web_planner/static/src/js/web_planner_backend.js defined in bundle 'web.assets_backend' */
odoo.define('web.planner',function(require){"use strict";var core=require('web.core');var Model=require('web.Model');var SystrayMenu=require('web.SystrayMenu');var Widget=require('web.Widget');var planner=require('web.planner.common');var webclient=require('web.web_client');var PlannerDialog=planner.PlannerDialog;var PlannerLauncher=Widget.extend({sequence:100,template:"PlannerLauncher",init:function(parent){this._super(parent);this.planner_by_menu={};this.need_reflow=false;},start:function(){var self=this;core.bus.on("change_menu_section",self,self.on_menu_clicked);var res=self._super.apply(this,arguments).then(function(){self.$el.on('click',self,self.show_dialog.bind(self));return self.fetch_application_planner();}).then(function(apps){self.$('.progress').tooltip({html:true,placement:'bottom',delay:{'show':500}});self.planner_apps=apps;return apps;});return res;},fetch_application_planner:function(){var self=this;var def=$.Deferred();if(!_.isEmpty(this.planner_by_menu)){def.resolve(self.planner_by_menu);}else{(new Model('web.planner')).query().all().then(function(res){_.each(res,function(planner){self.planner_by_menu[planner.menu_id[0]]=planner;self.planner_by_menu[planner.menu_id[0]].data=$.parseJSON(self.planner_by_menu[planner.menu_id[0]].data)||{};});def.resolve(self.planner_by_menu);}).fail(function(){def.reject();});}
return def;},on_menu_clicked:function(menu_id){if(_.contains(_.keys(this.planner_apps),menu_id.toString())){this.setup(this.planner_apps[menu_id]);this.need_reflow=true;}else{this.$el.hide();this.need_reflow=true;}
if(this.need_reflow){core.bus.trigger('resize');this.need_reflow=false;}
if(this.dialog){this.dialog.$el.modal('hide');this.dialog.$el.detach();}},setup:function(planner){var self=this;this.planner=planner;if(this.dialog){this.dialog.$el.modal('hide');this.dialog.destroy();}
this.dialog=new PlannerDialog(this,planner);this.dialog.appendTo($('<div>'));this.$('.progress').attr('data-original-title',this.planner.tooltip_planner);this.$el.filter('.o_planner_help').find('.o_planner_link').show();this.dialog.on("planner_progress_changed",this,function(percent){self.update_parent_progress_bar(percent);});},update_parent_progress_bar:function(percent){if(percent==100){this.$(".progress").hide();}else{this.$(".progress").show();}
this.$el.show();this.$(".progress-bar").css('width',percent+"%");},show_dialog:function(){this.dialog.$el.appendTo(webclient.$el);this.dialog.$el.modal('show');},});SystrayMenu.Items.push(PlannerLauncher);return{PlannerLauncher:PlannerLauncher,};});;

/* /project/static/src/js/project.js defined in bundle 'web.assets_backend' */
odoo.define('project.update_kanban',function(require){'use strict';var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var Model=require('web.Model');var session=require('web.session');var KanbanView=require('web_kanban.KanbanView');var KanbanRecord=require('web_kanban.Record');var QWeb=core.qweb;var _t=core._t;KanbanRecord.include({on_card_clicked:function(){if(this.model==='project.project'){this.$('.o_project_kanban_boxes a').first().click();}else{this._super.apply(this,arguments);}},on_kanban_action_clicked:function(ev){var self=this;if(this.model==='project.task'&&$(ev.currentTarget).data('type')==='set_cover'){ev.preventDefault();new Model('ir.attachment').query(['id','name']).filter([['res_model','=','project.task'],['res_id','=',this.id],['mimetype','ilike','image']]).all().then(open_cover_images_dialog);}else{this._super.apply(this,arguments,ev);}
function open_cover_images_dialog(attachment_ids){var cover_id=self.record.displayed_image_id.raw_value[0];var $content=$(QWeb.render("project.SetCoverModal",{cover_id:cover_id,attachment_ids:attachment_ids,}));var $imgs=$content.find('img');var dialog=new Dialog(self,{title:_t("Set a Cover Image"),buttons:[{text:_t("Select"),classes:'btn-primary',close:true,disabled:!cover_id,click:function(){self.update_record({data:{displayed_image_id:$imgs.filter('.o_selected').data('id')}});}},{text:_t("Remove Cover Image"),close:true,click:function(){self.update_record({data:{displayed_image_id:0}});}},{text:_t("Discard"),close:true}],$content:$content,}).open();var $selectBtn=dialog.$footer.find('.btn-primary');$content.on('click','img',function(ev){$imgs.not(ev.currentTarget).removeClass('o_selected');$selectBtn.prop('disabled',!$(ev.currentTarget).toggleClass('o_selected').hasClass('o_selected'));});$content.on('dblclick','img',function(ev){self.update_record({data:{displayed_image_id:$(ev.currentTarget).data('id')}});dialog.close();});}},});});;

/* /project/static/src/js/tour.js defined in bundle 'web.assets_backend' */
odoo.define('project.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('project_tour',{url:"/web",},[tour.STEPS.MENU_MORE,{trigger:'.o_app[data-menu-xmlid="project.menu_main_pm"], .oe_menu_toggler[data-menu-xmlid="project.menu_main_pm"]',content:_t('Want a better way to <b>manage your projects</b>? <i>It starts here.</i>'),position:'bottom',},{trigger:'.o-kanban-button-new',extra_trigger:'.o_project_kanban',content:_t('Let\'s create your first project.'),position:'right',width:200,},{trigger:'input.o_project_name',content:_t('Choose a <b>project name</b>. (e.g. Website Launch, Product Development, Office Party, etc.)'),position:'right',run:function(actions){actions.auto();actions.auto(".modal:visible .btn.btn-primary");},},{trigger:'.o_project_kanban .o_kanban_record:first-child',content:_t('Click on the card to <b>go to your project</b> and start organizing tasks.'),position:'right',run:function(actions){actions.auto(this.$anchor.find(".o_project_kanban_box:first > a"));},},{trigger:".o_kanban_project_tasks .o_column_quick_create",content:_t("Add columns to configure <b>stages for your tasks</b>.<br/><i>e.g. Specification &gt; Development &gt; Done</i>"),position:"right"},{trigger:".o-kanban-button-new",extra_trigger:'.o_kanban_project_tasks .o_kanban_group:eq(2)',content:_t("Now that the project is set up, <b>create a few tasks</b>."),position:"right"},{trigger:".o_kanban_group:first-child .o_kanban_record:last-child",extra_trigger:'.o_kanban_project_tasks',content:_t("<b>Drag &amp; drop tasks</b> between columns as you work on them."),position:"right",run:"drag_and_drop .o_kanban_group:eq(2) ",},{trigger:".o_kanban_record .o_priority_star",extra_trigger:'.o_kanban_project_tasks',content:_t("<b>Star tasks</b> to mark team priorities."),position:"bottom",},{trigger:".o_kanban_record",extra_trigger:'.o_kanban_project_tasks',content:_t("Click on a card to get the details of the task."),position:"bottom",},{trigger:".o_form_button_edit",extra_trigger:'.o_form_project_tasks',content:_t('Click on this button to modify the task.'),position:"bottom"},{trigger:".o_form_field.o_task_user_field",extra_trigger:'.o_form_project_tasks.o_form_editable',content:_t('<b>Assign the task</b> to someone. <i>You can create and invite a new user on the fly.</i>'),position:"bottom",run:function(actions){actions.text("Demo User",this.$anchor.find("input"));},},{trigger:".ui-autocomplete > li > a",auto:true,},{trigger:".o_form_button_save",extra_trigger:'.o_form_project_tasks.o_form_editable',content:_t('<b>Click the save button</b> to apply your changes to the task.'),position:"bottom"},{trigger:".breadcrumb li:not(.active):last",extra_trigger:'.o_form_project_tasks.o_form_readonly',content:_t("Use the breadcrumbs to <b>go back to your tasks pipeline</b>."),position:"bottom"},tour.STEPS.TOGGLE_APPSWITCHER,tour.STEPS.MENU_MORE,{trigger:'.o_app[data-menu-xmlid="base.menu_administration"], .oe_menu_toggler[data-menu-xmlid="base.menu_administration"]',content:_t("Configuration options are available in the Settings app."),position:"bottom"},{trigger:".o_web_settings_dashboard textarea#user_emails",content:_t("<b>Invite coworkers</b> via email.<br/><i>Enter one email per line.</i>"),position:"right"},tour.STEPS.TOGGLE_APPSWITCHER,tour.STEPS.MENU_MORE,{trigger:'.o_app[data-menu-xmlid="project.menu_main_pm"], .oe_menu_toggler[data-menu-xmlid="project.menu_main_pm"]',content:_t("Good job! Your completed the Project Management tour. You can continue with the <b>implementation guide</b> to help you setup Project Management in your company."),position:'bottom',},{trigger:'.o_planner_systray div.progress',content:_t("Use the <b>implementation guide</b> to setup Project Management in your company."),position:'bottom',}]);});;

/* /project/static/src/js/web_planner_project.js defined in bundle 'web.assets_backend' */
odoo.define('planner_project.planner',function(require){"use strict";var planner=require('web.planner.common');var core=require('web.core');var _t=core._t;planner.PlannerDialog.include({prepare_planner_event:function(){var self=this;this._super.apply(this,arguments);if(self.planner['planner_application']=='planner_project'){var stages={'development_process':{'input_element_stage_0':_t('Specification'),'input_element_stage_1':_t('Validation'),'input_element_stage_2':_t('Development'),'input_element_stage_3':_t('Testing'),'input_element_stage_4':_t('Deployment'),'input_element_stage_5':'','input_element_stage_6':'','input_element_stage_7':_t('Specification of task is written'),'input_element_stage_8':_t('Specification is validated'),'input_element_stage_9':_t('Task is Developed'),'input_element_stage_10':_t('Task is tested'),'input_element_stage_11':_t('Finally task is deployed'),'input_element_stage_12':'','input_element_stage_13':'',},'marketing_department':{'input_element_stage_0':_t('Backlog'),'input_element_stage_1':_t('In progress'),'input_element_stage_2':_t('Copywriting / Design'),'input_element_stage_3':_t('Distribute'),'input_element_stage_4':_t('Done'),'input_element_stage_5':'','input_element_stage_6':'','input_element_stage_7':_t('Action has a clear description'),'input_element_stage_8':_t('Work has started'),'input_element_stage_9':_t('Ready for layout / copywriting'),'input_element_stage_10':_t('Ready to be displayed, published or sent'),'input_element_stage_11':_t('Distribution is completed'),'input_element_stage_12':'','input_element_stage_13':'',},'scrum_methodology':{'input_element_stage_0':_t('Backlog'),'input_element_stage_1':_t('Sprint'),'input_element_stage_2':_t('Test'),'input_element_stage_3':_t('Documentation'),'input_element_stage_4':_t('Release'),'input_element_stage_5':'','input_element_stage_6':'','input_element_stage_7':_t('Clear description and purpose'),'input_element_stage_8':_t('Added in current sprint'),'input_element_stage_9':_t('Ready for testing'),'input_element_stage_10':_t('Test is OK, need to document'),'input_element_stage_11':_t('Ready for release'),'input_element_stage_12':'','input_element_stage_13':'',},'customer_service':{'input_element_stage_0':_t('Backlog'),'input_element_stage_1':_t('New'),'input_element_stage_2':_t('In progress'),'input_element_stage_3':_t('Wait. Customer'),'input_element_stage_4':_t('Wait. Expert'),'input_element_stage_5':_t('Done'),'input_element_stage_6':_t('Cancelled'),'input_element_stage_7':_t('Customer service has found new issue'),'input_element_stage_8':_t('Customer has reported new issue'),'input_element_stage_9':_t('Issue is being worked on'),'input_element_stage_10':_t('Customer feedback has been requested'),'input_element_stage_11':_t('Expert advice has been requested'),'input_element_stage_12':_t('Issue is resolved'),'input_element_stage_13':_t('Reason for cancellation has been documented'),},'repair_workshop':{'input_element_stage_0':_t('Incoming'),'input_element_stage_1':_t('In progress'),'input_element_stage_2':_t('Wait. Customer'),'input_element_stage_3':_t('Wait. Expert'),'input_element_stage_4':_t('Done'),'input_element_stage_5':_t('Cancelled'),'input_element_stage_6':'','input_element_stage_7':_t('New repair added'),'input_element_stage_8':_t('Repair has started'),'input_element_stage_9':_t('Feedback from customer requested'),'input_element_stage_10':_t('Request for parts has been sent'),'input_element_stage_11':_t('Repair is completed'),'input_element_stage_12':_t('Customer has cancelled repair'),'input_element_stage_13':'',},'basic_management':{'input_element_stage_0':_t('Ideas'),'input_element_stage_1':_t('To Do'),'input_element_stage_2':_t('Done'),'input_element_stage_3':_t('Cancelled'),'input_element_stage_4':'','input_element_stage_5':'','input_element_stage_6':'','input_element_stage_7':_t('Idea is fully explained'),'input_element_stage_8':_t('Idea has been transformed into concrete actions'),'input_element_stage_9':_t('Task is completed'),'input_element_stage_10':_t('Reason for cancellation has been documented'),'input_element_stage_11':'','input_element_stage_12':'','input_element_stage_13':'',}};var stage_handler=function(option){if(_.has(stages,option)){var values=stages[option];var keys=_.keys(values);for(var i=0;i<keys.length;i++){self.$('#'+keys[i]).val(values[keys[i]]);self.$('#'+keys[i]+'_user').val(values[keys[i]]);}}};self.$('#input_element_kanban_stage_pipeline').on('change',function(ev){var option=self.$(ev.target).find(":selected").val();stage_handler(option);});self.$(".user_project").on('change',function(){self.$("#"+self.$(this).attr("id")+"_user").val(self.$(this).val());});var first_option=self.$('#input_element_kanban_stage_pipeline').find('option').first().val();stage_handler(first_option);}}});});;

/* /sale/static/src/js/sale.js defined in bundle 'web.assets_backend' */
odoo.define('sale.sales_team_dashboard',function(require){"use strict";var core=require('web.core');var KanbanRecord=require('web_kanban.Record');var Model=require('web.Model');var _t=core._t;KanbanRecord.include({events:_.defaults({'click .sales_team_target_definition':'on_sales_team_target_click',},KanbanRecord.prototype.events),on_sales_team_target_click:function(ev){ev.preventDefault();this.$target_input=$('<input>');this.$('.o_kanban_primary_bottom').html(this.$target_input);this.$('.o_kanban_primary_bottom').prepend(_t("Set an invoicing target: "));this.$target_input.focus();var self=this;this.$target_input.blur(function(){var value=Number(self.$target_input.val());if(isNaN(value)){self.do_warn(_t("Wrong value entered!"),_t("Only Integer Value should be valid."));}else{new Model('crm.team').call('write',[[self.id],{'invoiced_target':value}]).done(function(){self.trigger_up('kanban_record_update',{id:self.id});});}});},});});;

/* /sale/static/src/js/tour.js defined in bundle 'web.assets_backend' */
odoo.define('sale.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('sale_tour',{url:"/web",},[tour.STEPS.MENU_MORE,{trigger:'.o_app[data-menu-xmlid="sales_team.menu_base_partner"], .oe_menu_toggler[data-menu-xmlid="sales_team.menu_base_partner"]',content:_t('Organize your sales activities with the <b>Sales app</b>.'),position:'bottom',},{trigger:".oe_kanban_action_button",extra_trigger:'.o_salesteam_kanban',content:_t("Let\'s have a look at the quotations of this sales team."),position:"bottom",id:"quotation_button_on_dashboard",},{trigger:".o_list_button_add",extra_trigger:".o_sale_order",content:_t("Let's create a new quotation.<br/><i>Note that colored buttons usually points to the next logical actions in any screen.</i>"),position:"right",},{trigger:".o_form_required input",extra_trigger:".o_sale_order",content:_t("Write the name of your customer to create one on the fly, or select an existing one."),position:"top",run:"text Agrolait",},{trigger:".ui-menu-item > a",auto:true,in_modal:false,},{trigger:".o_form_field_x2many_list_row_add > a",extra_trigger:".o_sale_order",content:_t("Click here to add some lines to your quotations."),position:"bottom",},{trigger:".modal-body .o_form_required input, .o_list_editable .o_form_required input",extra_trigger:".o_sale_order",content:_t("Select a product, or create a new one on the fly. The product will define the default sale price (that you can change), taxes and description automatically."),position:"right",run:"text Ipad",},{trigger:".ui-menu-item > a",auto:true,in_modal:false,run:function(actions){actions.auto();actions.auto(".modal-footer .btn-primary");},id:"quotation_product_selected",},{trigger:".o_form_button_save",extra_trigger:".o_sale_order",content:_t("Once your quotation is ready, you can save, print or send it by email."),position:"right",},{trigger:".o_sale_confirm",extra_trigger:".o_sale_order.o_form_readonly",content:_t("<p><b>Confirm the order</b> if the customer purchases.</p>"),position:"bottom"},{trigger:".breadcrumb li:not(.active):last",extra_trigger:".o_sale_order [data-id='sale'].btn-primary, .o_sale_order [data-id='sale'].oe_active",content:_t("Use the breadcrumbs to <b>go back to preceeding screens</b>."),position:"bottom"},{trigger:'li a[data-menu-xmlid="sales_team.menu_sales"], .oe_secondary_menu_section[data-menu-xmlid="sales_team.menu_sales"]',content:_t("Use this menu to access quotations, sales orders and customers."),edition:"enterprise",position:"bottom"},tour.STEPS.TOGGLE_APPSWITCHER,tour.STEPS.MENU_MORE,{trigger:'.o_app[data-menu-xmlid="base.menu_administration"], .oe_menu_toggler[data-menu-xmlid="base.menu_administration"]',content:_t("Configuration options are available in the Settings app."),position:"bottom"},{trigger:".o_web_settings_dashboard textarea#user_emails",content:_t("<b>Invite salespeople or managers</b> via email.<br/><i>Enter one email per line.</i>"),position:"right"}]);});;

/* /sale_crm/static/src/js/tour.js defined in bundle 'web.assets_backend' */
odoo.define('sale_crm.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');require('sale.tour');var _t=core._t;var quotation_button_step_index=_.findIndex(tour.tours.sale_tour.steps,function(step){return(step.id==="quotation_button_on_dashboard");});tour.tours.sale_tour.steps.splice(quotation_button_step_index,1,{trigger:".o_kanban_manage_button_section > a",content:_t("Click here to see more options."),position:"right"},{trigger:".o_quotation_view_button",content:_t("Let's have a look at the quotations of this sales team."),position:"right"});});;

/* /rating/static/src/js/rating.js defined in bundle 'web.assets_backend' */
odoo.define('rating.kanban',function(require){"use strict";var KanbanRecord=require('web_kanban.Record');KanbanRecord.include({on_card_clicked:function(){if(this.model==='rating.rating'){this.$('a').first().click();}else{this._super.apply(this,arguments);}},});});;

/* /report/static/src/js/qwebactionmanager.js defined in bundle 'web.assets_backend' */
odoo.define('report.report',function(require){'use strict';var ActionManager=require('web.ActionManager');var core=require('web.core');var crash_manager=require('web.crash_manager');var framework=require('web.framework');var session=require('web.session');var _t=core._t;var _lt=core._lt;var wkhtmltopdf_state;var WKHTMLTOPDF_MESSAGES={'install':_lt('Unable to find Wkhtmltopdf on this \nsystem. The report will be shown in html.<br><br><a href="http://wkhtmltopdf.org/" target="_blank">\nwkhtmltopdf.org</a>'),'workers':_lt('You need to start OpenERP with at least two \nworkers to print a pdf version of the reports.'),'upgrade':_lt('You should upgrade your version of\nWkhtmltopdf to at least 0.12.0 in order to get a correct display of headers and footers as well as\nsupport for table-breaking between pages.<br><br><a href="http://wkhtmltopdf.org/" \ntarget="_blank">wkhtmltopdf.org</a>'),'broken':_lt('Your installation of Wkhtmltopdf seems to be broken. The report will be shown in html.<br><br><a href="http://wkhtmltopdf.org/" target="_blank">wkhtmltopdf.org</a>')};var trigger_download=function(session,response,c,action,options){session.get_file({url:'/report/download',data:{data:JSON.stringify(response)},complete:framework.unblockUI,error:c.rpc_error.bind(c),success:function(){if(action&&options&&!action.dialog){options.on_close();}},});};var make_report_url=function(action){var report_urls={'qweb-html':'/report/html/'+action.report_name,'qweb-pdf':'/report/pdf/'+action.report_name,'controller':action.report_file,};if(_.isUndefined(action.data)||_.isNull(action.data)||(_.isObject(action.data)&&_.isEmpty(action.data))){if(action.context.active_ids){var active_ids_path='/'+action.context.active_ids.join(',');report_urls=_.mapObject(report_urls,function(value,key){return value+=active_ids_path;});}}else{var serialized_options_path='?options='+encodeURIComponent(JSON.stringify(action.data));serialized_options_path+='&context='+encodeURIComponent(JSON.stringify(action.context));report_urls=_.mapObject(report_urls,function(value,key){return value+=serialized_options_path;});}
return report_urls;};ActionManager.include({ir_actions_report_xml:function(action,options){var self=this;action=_.clone(action);var report_urls=make_report_url(action);if(action.report_type==='qweb-html'){var client_action_options=_.extend({},options,{report_url:report_urls['qweb-html'],report_name:action.report_name,report_file:action.report_file,data:action.data,context:action.context,name:action.name,display_name:action.display_name,});return this.do_action('report.client_action',client_action_options);}else if(action.report_type==='qweb-pdf'){framework.blockUI();(wkhtmltopdf_state=wkhtmltopdf_state||session.rpc('/report/check_wkhtmltopdf')).then(function(state){if(WKHTMLTOPDF_MESSAGES[state]){self.do_notify(_t('Report'),WKHTMLTOPDF_MESSAGES[state],true);}
if(state==='upgrade'||state==='ok'){var response=[report_urls['qweb-pdf'],action.report_type,];var c=crash_manager;return trigger_download(self.session,response,c,action,options);}else{var client_action_options=_.extend({},options,{report_url:report_urls['qweb-html'],report_name:action.report_name,report_file:action.report_file,data:action.data,context:action.context,name:action.name,display_name:action.display_name,});framework.unblockUI();return self.do_action('report.client_action',client_action_options);}});}else if(action.report_type==='controller'){framework.blockUI();var response=[report_urls.controller,action.report_type,];var c=crash_manager;return trigger_download(self.session,response,c,action,options);}else{return self._super(action,options);}}});});;

/* /report/static/src/js/utils.js defined in bundle 'web.assets_backend' */
odoo.define('report.utils',function(require){'use strict';function get_protocol_from_url(url){var a=document.createElement('a');a.href=url;return a.protocol;}
function get_host_from_url(url){var a=document.createElement('a');a.href=url;return a.host;}
function build_origin(protocol,host){return protocol+'//'+host;}
return{'get_protocol_from_url':get_protocol_from_url,'get_host_from_url':get_host_from_url,'build_origin':build_origin,};});;

/* /report/static/src/js/client_action.js defined in bundle 'web.assets_backend' */
odoo.define('report.client_action',function(require){'use strict';var core=require('web.core');var ControlPanelMixin=require('web.ControlPanelMixin');var session=require('web.session');var Widget=require('web.Widget');var utils=require('report.utils');var QWeb=core.qweb;var AUTHORIZED_MESSAGES=['report.editor:save_ok','report.editor:discard_ok','report:do_action',];var ReportAction=Widget.extend(ControlPanelMixin,{template:'report.client_action',init:function(parent,action,options){this._super.apply(this,arguments);options=options||{};this.action_manager=parent;this.title=options.display_name||options.name;this.edit_mode_available=false;this.in_edit_mode=false;this.report_url=options.report_url;this.report_name=options.report_name;this.report_file=options.report_file;this.data=options.data||{};this.context=options.context||{};},start:function(){var self=this;this.set('title',this.title);this.iframe=this.$('iframe')[0];return $.when(this._super.apply(this,arguments),session.is_bound).then(function(){var web_base_url=session['web.base.url'];var trusted_host=utils.get_host_from_url(web_base_url);var trusted_protocol=utils.get_protocol_from_url(web_base_url);self.trusted_origin=utils.build_origin(trusted_protocol,trusted_host);self.$buttons=$(QWeb.render('report.client_action.ControlButtons',{}));self.$buttons.on('click','.o_report_edit',self.on_click_edit);self.$buttons.on('click','.o_report_print',self.on_click_print);self.$buttons.on('click','.o_report_save',self.on_click_save);self.$buttons.on('click','.o_report_discard',self.on_click_discard);self._update_control_panel();self.iframe.src=self.report_url;self.iframe.onload=function(){self._on_iframe_loaded();};});},do_show:function(){this._update_control_panel();return this._super.apply(this,arguments);},on_attach_callback:function(){$(window).on('message',this,this.on_message_received);},on_detach_callback:function(){$(window).off('message',this.on_message_received);},_on_iframe_loaded:function(){var editable=$(this.iframe).contents().find('html').data('editable');if(editable===1){this.edit_mode_available=true;this._update_control_panel();}},_update_control_panel:function(){this.update_control_panel({breadcrumbs:this.action_manager.get_breadcrumbs(),cp_content:{$buttons:this.$buttons,},});this._update_control_panel_buttons();},_update_control_panel_buttons:function(){this.$buttons.filter('div.o_report_edit_mode').toggle(this.in_edit_mode);this.$buttons.filter('div.o_report_no_edit_mode').toggle(!this.in_edit_mode);this.$buttons.filter('div.o_edit_mode_available').toggle(core.debug&&this.edit_mode_available&&!this.in_edit_mode);},on_message_received:function(ev){var message_origin=utils.build_origin(ev.originalEvent.source.location.protocol,ev.originalEvent.source.location.host);if(message_origin===this.trusted_origin){var message=ev.originalEvent.data;if(_.isObject(message)){message=message.message;}
if(!_.isString(message)||(_.isString(message)&&!_.contains(AUTHORIZED_MESSAGES,message))){return;}
switch(message){case'report.editor:save_ok':this.iframe.src=this.report_url;this.in_edit_mode=false;this._update_control_panel_buttons();break;case'report.editor:discard_ok':this.iframe.src=this.report_url;this.in_edit_mode=false;this._update_control_panel_buttons();break;case'report:do_action':return this.do_action(ev.originalEvent.data.action);default:}}},_post_message:function(message){this.iframe.contentWindow.postMessage(message,this.trusted_origin);},on_click_edit:function(){if(this.report_url.indexOf('?')===-1){this.iframe.src=this.report_url+'?enable_editor=1';}else{this.iframe.src=this.report_url+'&enable_editor=1';}
this.in_edit_mode=true;this._update_control_panel_buttons();},on_click_discard:function(){this._post_message('report.editor:ask_discard');},on_click_save:function(){this._post_message('report.editor:ask_save');},on_click_print:function(){var action={'type':'ir.actions.report.xml','report_type':'qweb-pdf','report_name':this.report_name,'report_file':this.report_file,'data':this.data,'context':this.context,'display_name':this.title,};return this.do_action(action);},});core.action_registry.add('report.client_action',ReportAction);return ReportAction;});;

/* /sales_team/static/src/js/sales_team.js defined in bundle 'web.assets_backend' */
odoo.define('sales_team.update_kanban',function(require){"use strict";var KanbanView=require('web_kanban.KanbanView');var KanbanRecord=require('web_kanban.Record');var data=require('web.data');var session=require('web.session');KanbanView.include({crm_display_members_names:function(){var self=this;var members_ids=[];self.$el.find('img[data-member_id]').each(function(){members_ids.push($(this).data('member_id'));});var dataset=new data.DataSetSearch(self,'res.users',session.context,[['id','in',_.uniq(members_ids)]]);dataset.read_slice(['id','name']).done(function(result){_.each(result,function(v){self.$el.find('img[data-member_id='+v.id+']').attr('title',v.name).tooltip();});});},on_groups_started:function(){var self=this;self._super.apply(self,arguments);if(self.dataset.model==='crm.team'){self.crm_display_members_names();}},});KanbanRecord.include({on_card_clicked:function(){if(this.model==='crm.team'){this.$('.oe_kanban_crm_salesteams_list a').first().click();}else{this._super.apply(this,arguments);}},});});;

/* /sales_team/static/src/js/sales_team_dashboard.js defined in bundle 'web.assets_backend' */
odoo.define('sales_team.dashboard',function(require){"use strict";var core=require('web.core');var formats=require('web.formats');var Model=require('web.Model');var session=require('web.session');var KanbanView=require('web_kanban.KanbanView');var QWeb=core.qweb;var _t=core._t;var _lt=core._lt;var SalesTeamDashboardView=KanbanView.extend({display_name:_lt('Dashboard'),icon:'fa-dashboard',searchview_hidden:true,events:{'click .o_dashboard_action':'on_dashboard_action_clicked','click .o_target_to_set':'on_dashboard_target_clicked',},fetch_data:function(){return $.when();},render:function(){var super_render=this._super;var self=this;return this.fetch_data().then(function(result){self.show_demo=result&&result.nb_opportunities===0;var sales_dashboard=QWeb.render('sales_team.SalesDashboard',{widget:self,show_demo:self.show_demo,values:result,});super_render.call(self);$(sales_dashboard).prependTo(self.$el);});},on_dashboard_action_clicked:function(ev){ev.preventDefault();var $action=$(ev.currentTarget);var action_name=$action.attr('name');var action_extra=$action.data('extra');var additional_context={};if(action_name==='calendar.action_calendar_event'){additional_context.search_default_mymeetings=1;}else if(action_name==='crm.crm_lead_action_activities'){if(action_extra==='today'){additional_context.search_default_today=1;}else if(action_extra==='this_week'){additional_context.search_default_this_week=1;}else if(action_extra==='overdue'){additional_context.search_default_overdue=1;}}else if(action_name==='crm.action_your_pipeline'){if(action_extra==='overdue'){additional_context['search_default_overdue']=1;}else if(action_extra==='overdue_opp'){additional_context['search_default_overdue_opp']=1;}}else if(action_name==='crm.crm_opportunity_report_action_graph'){additional_context.search_default_won=1;}
this.do_action(action_name,{additional_context:additional_context});},on_change_input_target:function(e){var self=this;var $input=$(e.target);var target_name=$input.attr('name');var target_value=$input.val();if(isNaN(target_value)){this.do_warn(_t("Wrong value entered!"),_t("Only Integer Value should be valid."));}else{this._updated=new Model('crm.lead').call('modify_target_sales_dashboard',[target_name,parseInt(target_value)]).then(function(){return self.render();});}},on_dashboard_target_clicked:function(ev){if(this.show_demo){return;}
var self=this;var $target=$(ev.currentTarget);var target_name=$target.attr('name');var target_value=$target.attr('value');var $input=$('<input/>',{type:"text"});$input.attr('name',target_name);if(target_value){$input.attr('value',target_value);}
$input.on('keyup input',function(e){if(e.which===$.ui.keyCode.ENTER){self.on_change_input_target(e);}});$input.on('blur',function(e){self.on_change_input_target(e);});$.when(this._updated).then(function(){$input.replaceAll(self.$('.o_target_to_set[name='+target_name+']')).focus().select();});},render_monetary_field:function(value,currency_id){var currency=session.get_currency(currency_id);var digits_precision=currency&&currency.digits;value=formats.format_value(value||0,{type:"float",digits:digits_precision});if(currency){if(currency.position==="after"){value+=currency.symbol;}else{value=currency.symbol+value;}}
return value;},});core.view_registry.add('sales_team_dashboard',SalesTeamDashboardView);return SalesTeamDashboardView;});;

/* /web_tour/static/src/js/debug_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web_tour.DebugManager',function(require){"use strict";var core=require("web.core");var DebugManager=require('web.DebugManager');var Dialog=require("web.Dialog");var Model=require('web.Model');var tour=require('web_tour.tour');function get_active_tours(){return _.difference(_.keys(tour.tours),tour.consumed_tours);}
DebugManager.include({start:function(){this.consume_tours_enabled=get_active_tours().length>0;return this._super.apply(this,arguments);},consume_tours:function(){var active_tours=get_active_tours();if(active_tours.length>0){new Model('web_tour.tour').call('consume',[active_tours]).then(function(){window.location.reload();});}},start_tour:function(){var dialog=new Dialog(this,{title:'Tours',$content:core.qweb.render('WebClient.DebugManager.ToursDialog',{tours:tour.tours}),}).open();dialog.$('.o_start_tour').on('click',function(e){e.preventDefault();tour.run($(e.target).data('name'));});},});});;

/* /web_calendar/static/lib/fullcalendar/js/fullcalendar.js defined in bundle 'web.assets_backend' */
(function($,undefined){;;var defaults={defaultView:'month',aspectRatio:1.35,header:{left:'title',center:'',right:'today prev,next'},weekends:true,weekNumbers:false,weekNumberCalculation:'iso',weekNumberTitle:'W',allDayDefault:true,ignoreTimezone:true,lazyFetching:true,startParam:'start',endParam:'end',titleFormat:{month:'MMMM yyyy',week:"MMM d[ yyyy]{ '&#8212;'[ MMM] d yyyy}",day:'dddd, MMM d, yyyy'},columnFormat:{month:'ddd',week:'ddd M/d',day:'dddd M/d'},timeFormat:{'':'h(:mm)t'},isRTL:false,firstDay:0,monthNames:['January','February','March','April','May','June','July','August','September','October','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],dayNames:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],dayNamesShort:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],buttonText:{prev:"<span class='fc-text-arrow'>&lsaquo;</span>",next:"<span class='fc-text-arrow'>&rsaquo;</span>",prevYear:"<span class='fc-text-arrow'>&laquo;</span>",nextYear:"<span class='fc-text-arrow'>&raquo;</span>",today:'today',month:'month',week:'week',day:'day'},theme:false,buttonIcons:{prev:'circle-triangle-w',next:'circle-triangle-e'},unselectAuto:true,dropAccept:'*',handleWindowResize:true};var rtlDefaults={header:{left:'next,prev today',center:'',right:'title'},buttonText:{prev:"<span class='fc-text-arrow'>&rsaquo;</span>",next:"<span class='fc-text-arrow'>&lsaquo;</span>",prevYear:"<span class='fc-text-arrow'>&raquo;</span>",nextYear:"<span class='fc-text-arrow'>&laquo;</span>"},buttonIcons:{prev:'circle-triangle-e',next:'circle-triangle-w'}};;;var fc=$.fullCalendar={version:"1.6.4"};var fcViews=fc.views={};$.fn.fullCalendar=function(options){if(typeof options=='string'){var args=Array.prototype.slice.call(arguments,1);var res;this.each(function(){var calendar=$.data(this,'fullCalendar');if(calendar&&$.isFunction(calendar[options])){var r=calendar[options].apply(calendar,args);if(res===undefined){res=r;}
if(options=='destroy'){$.removeData(this,'fullCalendar');}}});if(res!==undefined){return res;}
return this;}
options=options||{};var eventSources=options.eventSources||[];delete options.eventSources;if(options.events){eventSources.push(options.events);delete options.events;}
options=$.extend(true,{},defaults,(options.isRTL||options.isRTL===undefined&&defaults.isRTL)?rtlDefaults:{},options);this.each(function(i,_element){var element=$(_element);var calendar=new Calendar(element,options,eventSources);element.data('fullCalendar',calendar);calendar.render();});return this;};function setDefaults(d){$.extend(true,defaults,d);};;function Calendar(element,options,eventSources){var t=this;t.options=options;t.render=render;t.destroy=destroy;t.refetchEvents=refetchEvents;t.reportEvents=reportEvents;t.reportEventChange=reportEventChange;t.rerenderEvents=rerenderEvents;t.changeView=changeView;t.select=select;t.unselect=unselect;t.prev=prev;t.next=next;t.prevYear=prevYear;t.nextYear=nextYear;t.today=today;t.gotoDate=gotoDate;t.incrementDate=incrementDate;t.formatDate=function(format,date){return formatDate(format,date,options)};t.formatDates=function(format,date1,date2){return formatDates(format,date1,date2,options)};t.getDate=getDate;t.getView=getView;t.option=option;t.trigger=trigger;EventManager.call(t,options,eventSources);var isFetchNeeded=t.isFetchNeeded;var fetchEvents=t.fetchEvents;var _element=element[0];var header;var headerElement;var content;var tm;var currentView;var elementOuterWidth;var suggestedViewHeight;var resizeUID=0;var ignoreWindowResize=0;var date=new Date();var events=[];var _dragElement;setYMD(date,options.year,options.month,options.date);function render(inc){if(!content){initialRender();}
else if(elementVisible()){calcSize();_renderView(inc);}}
function initialRender(){tm=options.theme?'ui':'fc';element.addClass('fc');if(options.isRTL){element.addClass('fc-rtl');}
else{element.addClass('fc-ltr');}
if(options.theme){element.addClass('ui-widget');}
content=$("<div class='fc-content' style='position:relative'/>").prependTo(element);header=new Header(t,options);headerElement=header.render();if(headerElement){element.prepend(headerElement);}
changeView(options.defaultView);if(options.handleWindowResize){$(window).resize(windowResize);}
if(!bodyVisible()){lateRender();}}
function lateRender(){setTimeout(function(){if(!currentView.start&&bodyVisible()){renderView();}},0);}
function destroy(){if(currentView){trigger('viewDestroy',currentView,currentView,currentView.element);currentView.triggerEventDestroy();}
$(window).unbind('resize',windowResize);header.destroy();content.remove();element.removeClass('fc fc-rtl ui-widget');}
function elementVisible(){return element.is(':visible');}
function bodyVisible(){return $('body').is(':visible');}
function changeView(newViewName){if(!currentView||newViewName!=currentView.name){_changeView(newViewName);}}
function _changeView(newViewName){ignoreWindowResize++;if(currentView){trigger('viewDestroy',currentView,currentView,currentView.element);unselect();currentView.triggerEventDestroy();freezeContentHeight();currentView.element.remove();header.deactivateButton(currentView.name);}
header.activateButton(newViewName);currentView=new fcViews[newViewName]($("<div class='fc-view fc-view-"+newViewName+"' style='position:relative'/>").appendTo(content),t);renderView();unfreezeContentHeight();ignoreWindowResize--;}
function renderView(inc){if(!currentView.start||inc||date<currentView.start||date>=currentView.end){if(elementVisible()){_renderView(inc);}}}
function _renderView(inc){ignoreWindowResize++;if(currentView.start){trigger('viewDestroy',currentView,currentView,currentView.element);unselect();clearEvents();}
freezeContentHeight();currentView.render(date,inc||0);setSize();unfreezeContentHeight();(currentView.afterRender||noop)();updateTitle();updateTodayButton();trigger('viewRender',currentView,currentView,currentView.element);currentView.trigger('viewDisplay',_element);ignoreWindowResize--;getAndRenderEvents();}
function updateSize(){if(elementVisible()){unselect();clearEvents();calcSize();setSize();renderEvents();}}
function calcSize(){if(options.contentHeight){suggestedViewHeight=options.contentHeight;}
else if(options.height){suggestedViewHeight=options.height-(headerElement?headerElement.height():0)-vsides(content);}
else{suggestedViewHeight=Math.round(content.width()/Math.max(options.aspectRatio,.5));}}
function setSize(){if(suggestedViewHeight===undefined){calcSize();}
ignoreWindowResize++;currentView.setHeight(suggestedViewHeight);currentView.setWidth(content.width());ignoreWindowResize--;elementOuterWidth=element.outerWidth();}
function windowResize(){if(!ignoreWindowResize){if(currentView.start){var uid=++resizeUID;setTimeout(function(){if(uid==resizeUID&&!ignoreWindowResize&&elementVisible()){if(elementOuterWidth!=(elementOuterWidth=element.outerWidth())){ignoreWindowResize++;updateSize();currentView.trigger('windowResize',_element);ignoreWindowResize--;}}},200);}else{lateRender();}}}
function refetchEvents(){clearEvents();fetchAndRenderEvents();}
function rerenderEvents(modifiedEventID){clearEvents();renderEvents(modifiedEventID);}
function renderEvents(modifiedEventID){if(elementVisible()){currentView.setEventData(events);currentView.renderEvents(events,modifiedEventID);currentView.trigger('eventAfterAllRender');}}
function clearEvents(){currentView.triggerEventDestroy();currentView.clearEvents();currentView.clearEventData();}
function getAndRenderEvents(){if(!options.lazyFetching||isFetchNeeded(currentView.visStart,currentView.visEnd)){fetchAndRenderEvents();}
else{renderEvents();}}
function fetchAndRenderEvents(){fetchEvents(currentView.visStart,currentView.visEnd);}
function reportEvents(_events){events=_events;renderEvents();}
function reportEventChange(eventID){rerenderEvents(eventID);}
function updateTitle(){header.updateTitle(currentView.title);}
function updateTodayButton(){var today=new Date();if(today>=currentView.start&&today<currentView.end){header.disableButton('today');}
else{header.enableButton('today');}}
function select(start,end,allDay){currentView.select(start,end,allDay===undefined?true:allDay);}
function unselect(){if(currentView){currentView.unselect();}}
function prev(){renderView(-1);}
function next(){renderView(1);}
function prevYear(){addYears(date,-1);renderView();}
function nextYear(){addYears(date,1);renderView();}
function today(){date=new Date();renderView();}
function gotoDate(year,month,dateOfMonth){if(year instanceof Date){date=cloneDate(year);}else{setYMD(date,year,month,dateOfMonth);}
renderView();}
function incrementDate(years,months,days){if(years!==undefined){addYears(date,years);}
if(months!==undefined){addMonths(date,months);}
if(days!==undefined){addDays(date,days);}
renderView();}
function getDate(){return cloneDate(date);}
function freezeContentHeight(){content.css({width:'100%',height:content.height(),overflow:'hidden'});}
function unfreezeContentHeight(){content.css({width:'',height:'',overflow:''});}
function getView(){return currentView;}
function option(name,value){if(value===undefined){return options[name];}
if(name=='height'||name=='contentHeight'||name=='aspectRatio'){options[name]=value;updateSize();}}
function trigger(name,thisObj){if(options[name]){return options[name].apply(thisObj||_element,Array.prototype.slice.call(arguments,2));}}
if(options.droppable){$(document).bind('dragstart',function(ev,ui){var _e=ev.target;var e=$(_e);if(!e.parents('.fc').length){var accept=options.dropAccept;if($.isFunction(accept)?accept.call(_e,e):e.is(accept)){_dragElement=_e;currentView.dragStart(_dragElement,ev,ui);}}}).bind('dragstop',function(ev,ui){if(_dragElement){currentView.dragStop(_dragElement,ev,ui);_dragElement=null;}});}};;function Header(calendar,options){var t=this;t.render=render;t.destroy=destroy;t.updateTitle=updateTitle;t.activateButton=activateButton;t.deactivateButton=deactivateButton;t.disableButton=disableButton;t.enableButton=enableButton;var element=$([]);var tm;function render(){tm=options.theme?'ui':'fc';var sections=options.header;if(sections){element=$("<table class='fc-header' style='width:100%'/>").append($("<tr/>").append(renderSection('left')).append(renderSection('center')).append(renderSection('right')));return element;}}
function destroy(){element.remove();}
function renderSection(position){var e=$("<td class='fc-header-"+position+"'/>");var buttonStr=options.header[position];if(buttonStr){$.each(buttonStr.split(' '),function(i){if(i>0){e.append("<span class='fc-header-space'/>");}
var prevButton;$.each(this.split(','),function(j,buttonName){if(buttonName=='title'){e.append("<span class='fc-header-title'><h2>&nbsp;</h2></span>");if(prevButton){prevButton.addClass(tm+'-corner-right');}
prevButton=null;}else{var buttonClick;if(calendar[buttonName]){buttonClick=calendar[buttonName];}
else if(fcViews[buttonName]){buttonClick=function(){button.removeClass(tm+'-state-hover');calendar.changeView(buttonName);};}
if(buttonClick){var icon=options.theme?smartProperty(options.buttonIcons,buttonName):null;var text=smartProperty(options.buttonText,buttonName);var button=$("<span class='fc-button fc-button-"+buttonName+" "+tm+"-state-default'>"+
(icon?"<span class='fc-icon-wrap'>"+"<span class='ui-icon ui-icon-"+icon+"'/>"+"</span>":text)+"</span>").click(function(){if(!button.hasClass(tm+'-state-disabled')){buttonClick();}}).mousedown(function(){button.not('.'+tm+'-state-active').not('.'+tm+'-state-disabled').addClass(tm+'-state-down');}).mouseup(function(){button.removeClass(tm+'-state-down');}).hover(function(){button.not('.'+tm+'-state-active').not('.'+tm+'-state-disabled').addClass(tm+'-state-hover');},function(){button.removeClass(tm+'-state-hover').removeClass(tm+'-state-down');}).appendTo(e);disableTextSelection(button);if(!prevButton){button.addClass(tm+'-corner-left');}
prevButton=button;}}});if(prevButton){prevButton.addClass(tm+'-corner-right');}});}
return e;}
function updateTitle(html){element.find('h2').html(html);}
function activateButton(buttonName){element.find('span.fc-button-'+buttonName).addClass(tm+'-state-active');}
function deactivateButton(buttonName){element.find('span.fc-button-'+buttonName).removeClass(tm+'-state-active');}
function disableButton(buttonName){element.find('span.fc-button-'+buttonName).addClass(tm+'-state-disabled');}
function enableButton(buttonName){element.find('span.fc-button-'+buttonName).removeClass(tm+'-state-disabled');}};;fc.sourceNormalizers=[];fc.sourceFetchers=[];var ajaxDefaults={dataType:'json',cache:false};var eventGUID=1;function EventManager(options,_sources){var t=this;t.isFetchNeeded=isFetchNeeded;t.fetchEvents=fetchEvents;t.addEventSource=addEventSource;t.removeEventSource=removeEventSource;t.updateEvent=updateEvent;t.renderEvent=renderEvent;t.removeEvents=removeEvents;t.clientEvents=clientEvents;t.normalizeEvent=normalizeEvent;var trigger=t.trigger;var getView=t.getView;var reportEvents=t.reportEvents;var stickySource={events:[]};var sources=[stickySource];var rangeStart,rangeEnd;var currentFetchID=0;var pendingSourceCnt=0;var loadingLevel=0;var cache=[];for(var i=0;i<_sources.length;i++){_addEventSource(_sources[i]);}
function isFetchNeeded(start,end){return!rangeStart||start<rangeStart||end>rangeEnd;}
function fetchEvents(start,end){rangeStart=start;rangeEnd=end;cache=[];var fetchID=++currentFetchID;var len=sources.length;pendingSourceCnt=len;for(var i=0;i<len;i++){fetchEventSource(sources[i],fetchID);}}
function fetchEventSource(source,fetchID){_fetchEventSource(source,function(events){if(fetchID==currentFetchID){if(events){if(options.eventDataTransform){events=$.map(events,options.eventDataTransform);}
if(source.eventDataTransform){events=$.map(events,source.eventDataTransform);}
for(var i=0;i<events.length;i++){events[i].source=source;normalizeEvent(events[i]);}
cache=cache.concat(events);}
pendingSourceCnt--;if(!pendingSourceCnt){reportEvents(cache);}}});}
function _fetchEventSource(source,callback){var i;var fetchers=fc.sourceFetchers;var res;for(i=0;i<fetchers.length;i++){res=fetchers[i](source,rangeStart,rangeEnd,callback);if(res===true){return;}
else if(typeof res=='object'){_fetchEventSource(res,callback);return;}}
var events=source.events;if(events){if($.isFunction(events)){pushLoading();events(cloneDate(rangeStart),cloneDate(rangeEnd),function(events){callback(events);popLoading();});}
else if($.isArray(events)){callback(events);}
else{callback();}}else{var url=source.url;if(url){var success=source.success;var error=source.error;var complete=source.complete;var customData;if($.isFunction(source.data)){customData=source.data();}
else{customData=source.data;}
var data=$.extend({},customData||{});var startParam=firstDefined(source.startParam,options.startParam);var endParam=firstDefined(source.endParam,options.endParam);if(startParam){data[startParam]=Math.round(+rangeStart/1000);}
if(endParam){data[endParam]=Math.round(+rangeEnd/1000);}
pushLoading();$.ajax($.extend({},ajaxDefaults,source,{data:data,success:function(events){events=events||[];var res=applyAll(success,this,arguments);if($.isArray(res)){events=res;}
callback(events);},error:function(){applyAll(error,this,arguments);callback();},complete:function(){applyAll(complete,this,arguments);popLoading();}}));}else{callback();}}}
function addEventSource(source){source=_addEventSource(source);if(source){pendingSourceCnt++;fetchEventSource(source,currentFetchID);}}
function _addEventSource(source){if($.isFunction(source)||$.isArray(source)){source={events:source};}
else if(typeof source=='string'){source={url:source};}
if(typeof source=='object'){normalizeSource(source);sources.push(source);return source;}}
function removeEventSource(source){sources=$.grep(sources,function(src){return!isSourcesEqual(src,source);});cache=$.grep(cache,function(e){return!isSourcesEqual(e.source,source);});reportEvents(cache);}
function updateEvent(event){var i,len=cache.length,e,defaultEventEnd=getView().defaultEventEnd,startDelta=event.start-event._start,endDelta=event.end?(event.end-(event._end||defaultEventEnd(event))):0;for(i=0;i<len;i++){e=cache[i];if(e._id==event._id&&e!=event){e.start=new Date(+e.start+startDelta);if(event.end){if(e.end){e.end=new Date(+e.end+endDelta);}else{e.end=new Date(+defaultEventEnd(e)+endDelta);}}else{e.end=null;}
e.title=event.title;e.url=event.url;e.allDay=event.allDay;e.className=event.className;e.editable=event.editable;e.color=event.color;e.backgroundColor=event.backgroundColor;e.borderColor=event.borderColor;e.textColor=event.textColor;normalizeEvent(e);}}
normalizeEvent(event);reportEvents(cache);}
function renderEvent(event,stick){normalizeEvent(event);if(!event.source){if(stick){stickySource.events.push(event);event.source=stickySource;}
cache.push(event);}
reportEvents(cache);}
function removeEvents(filter){if(!filter){cache=[];for(var i=0;i<sources.length;i++){if($.isArray(sources[i].events)){sources[i].events=[];}}}else{if(!$.isFunction(filter)){var id=filter+'';filter=function(e){return e._id==id;};}
cache=$.grep(cache,filter,true);for(var i=0;i<sources.length;i++){if($.isArray(sources[i].events)){sources[i].events=$.grep(sources[i].events,filter,true);}}}
reportEvents(cache);}
function clientEvents(filter){if($.isFunction(filter)){return $.grep(cache,filter);}
else if(filter){filter+='';return $.grep(cache,function(e){return e._id==filter;});}
return cache;}
function pushLoading(){if(!loadingLevel++){trigger('loading',null,true,getView());}}
function popLoading(){if(!--loadingLevel){trigger('loading',null,false,getView());}}
function normalizeEvent(event){var source=event.source||{};var ignoreTimezone=firstDefined(source.ignoreTimezone,options.ignoreTimezone);event._id=event._id||(event.id===undefined?'_fc'+eventGUID++:event.id+'');if(event.date){if(!event.start){event.start=event.date;}
delete event.date;}
event._start=cloneDate(event.start=parseDate(event.start,ignoreTimezone));event.end=parseDate(event.end,ignoreTimezone);if(event.end&&event.end<=event.start){event.end=null;}
event._end=event.end?cloneDate(event.end):null;if(event.allDay===undefined){event.allDay=firstDefined(source.allDayDefault,options.allDayDefault);}
if(event.className){if(typeof event.className=='string'){event.className=event.className.split(/\s+/);}}else{event.className=[];}}
function normalizeSource(source){if(source.className){if(typeof source.className=='string'){source.className=source.className.split(/\s+/);}}else{source.className=[];}
var normalizers=fc.sourceNormalizers;for(var i=0;i<normalizers.length;i++){normalizers[i](source);}}
function isSourcesEqual(source1,source2){return source1&&source2&&getSourcePrimitive(source1)==getSourcePrimitive(source2);}
function getSourcePrimitive(source){return((typeof source=='object')?(source.events||source.url):'')||source;}};;fc.addDays=addDays;fc.cloneDate=cloneDate;fc.parseDate=parseDate;fc.parseISO8601=parseISO8601;fc.parseTime=parseTime;fc.formatDate=formatDate;fc.formatDates=formatDates;var dayIDs=['sun','mon','tue','wed','thu','fri','sat'],DAY_MS=86400000,HOUR_MS=3600000,MINUTE_MS=60000;function addYears(d,n,keepTime){d.setFullYear(d.getFullYear()+n);if(!keepTime){clearTime(d);}
return d;}
function addMonths(d,n,keepTime){if(+d){var m=d.getMonth()+n,check=cloneDate(d);check.setDate(1);check.setMonth(m);d.setMonth(m);if(!keepTime){clearTime(d);}
while(d.getMonth()!=check.getMonth()){d.setDate(d.getDate()+(d<check?1:-1));}}
return d;}
function addDays(d,n,keepTime){if(+d){var dd=d.getDate()+n,check=cloneDate(d);check.setHours(9);check.setDate(dd);d.setDate(dd);if(!keepTime){clearTime(d);}
fixDate(d,check);}
return d;}
function fixDate(d,check){if(+d){while(d.getDate()!=check.getDate()){d.setTime(+d+(d<check?1:-1)*HOUR_MS);}}}
function addMinutes(d,n){d.setMinutes(d.getMinutes()+n);return d;}
function clearTime(d){d.setHours(0);d.setMinutes(0);d.setSeconds(0);d.setMilliseconds(0);return d;}
function cloneDate(d,dontKeepTime){if(dontKeepTime){return clearTime(new Date(+d));}
return new Date(+d);}
function zeroDate(){var i=0,d;do{d=new Date(1970,i++,1);}while(d.getHours());return d;}
function dayDiff(d1,d2){return Math.round((cloneDate(d1,true)-cloneDate(d2,true))/DAY_MS);}
function setYMD(date,y,m,d){if(y!==undefined&&y!=date.getFullYear()){date.setDate(1);date.setMonth(0);date.setFullYear(y);}
if(m!==undefined&&m!=date.getMonth()){date.setDate(1);date.setMonth(m);}
if(d!==undefined){date.setDate(d);}}
function parseDate(s,ignoreTimezone){if(typeof s=='object'){return s;}
if(typeof s=='number'){return new Date(s*1000);}
if(typeof s=='string'){if(s.match(/^\d+(\.\d+)?$/)){return new Date(parseFloat(s)*1000);}
if(ignoreTimezone===undefined){ignoreTimezone=true;}
return parseISO8601(s,ignoreTimezone)||(s?new Date(s):null);}
return null;}
function parseISO8601(s,ignoreTimezone){var m=s.match(/^([0-9]{4})(-([0-9]{2})(-([0-9]{2})([T ]([0-9]{2}):([0-9]{2})(:([0-9]{2})(\.([0-9]+))?)?(Z|(([-+])([0-9]{2})(:?([0-9]{2}))?))?)?)?)?$/);if(!m){return null;}
var date=new Date(m[1],0,1);if(ignoreTimezone||!m[13]){var check=new Date(m[1],0,1,9,0);if(m[3]){date.setMonth(m[3]-1);check.setMonth(m[3]-1);}
if(m[5]){date.setDate(m[5]);check.setDate(m[5]);}
fixDate(date,check);if(m[7]){date.setHours(m[7]);}
if(m[8]){date.setMinutes(m[8]);}
if(m[10]){date.setSeconds(m[10]);}
if(m[12]){date.setMilliseconds(Number("0."+m[12])*1000);}
fixDate(date,check);}else{date.setUTCFullYear(m[1],m[3]?m[3]-1:0,m[5]||1);date.setUTCHours(m[7]||0,m[8]||0,m[10]||0,m[12]?Number("0."+m[12])*1000:0);if(m[14]){var offset=Number(m[16])*60+(m[18]?Number(m[18]):0);offset*=m[15]=='-'?1:-1;date=new Date(+date+(offset*60*1000));}}
return date;}
function parseTime(s){if(typeof s=='number'){return s*60;}
if(typeof s=='object'){return s.getHours()*60+s.getMinutes();}
var m=s.match(/(\d+)(?::(\d+))?\s*(\w+)?/);if(m){var h=parseInt(m[1],10);if(m[3]){h%=12;if(m[3].toLowerCase().charAt(0)=='p'){h+=12;}}
return h*60+(m[2]?parseInt(m[2],10):0);}}
function formatDate(date,format,options){return formatDates(date,null,format,options);}
function formatDates(date1,date2,format,options){options=options||defaults;var date=date1,otherDate=date2,i,len=format.length,c,i2,formatter,res='';for(i=0;i<len;i++){c=format.charAt(i);if(c=="'"){for(i2=i+1;i2<len;i2++){if(format.charAt(i2)=="'"){if(date){if(i2==i+1){res+="'";}else{res+=format.substring(i+1,i2);}
i=i2;}
break;}}}
else if(c=='('){for(i2=i+1;i2<len;i2++){if(format.charAt(i2)==')'){var subres=formatDate(date,format.substring(i+1,i2),options);if(parseInt(subres.replace(/\D/,''),10)){res+=subres;}
i=i2;break;}}}
else if(c=='['){for(i2=i+1;i2<len;i2++){if(format.charAt(i2)==']'){var subformat=format.substring(i+1,i2);var subres=formatDate(date,subformat,options);if(subres!=formatDate(otherDate,subformat,options)){res+=subres;}
i=i2;break;}}}
else if(c=='{'){date=date2;otherDate=date1;}
else if(c=='}'){date=date1;otherDate=date2;}
else{for(i2=len;i2>i;i2--){if(formatter=dateFormatters[format.substring(i,i2)]){if(date){res+=formatter(date,options);}
i=i2-1;break;}}
if(i2==i){if(date){res+=c;}}}}
return res;};var dateFormatters={s:function(d){return d.getSeconds()},ss:function(d){return zeroPad(d.getSeconds())},m:function(d){return d.getMinutes()},mm:function(d){return zeroPad(d.getMinutes())},h:function(d){return d.getHours()%12||12},hh:function(d){return zeroPad(d.getHours()%12||12)},H:function(d){return d.getHours()},HH:function(d){return zeroPad(d.getHours())},d:function(d){return d.getDate()},dd:function(d){return zeroPad(d.getDate())},ddd:function(d,o){return o.dayNamesShort[d.getDay()]},dddd:function(d,o){return o.dayNames[d.getDay()]},M:function(d){return d.getMonth()+1},MM:function(d){return zeroPad(d.getMonth()+1)},MMM:function(d,o){return o.monthNamesShort[d.getMonth()]},MMMM:function(d,o){return o.monthNames[d.getMonth()]},yy:function(d){return(d.getFullYear()+'').substring(2)},yyyy:function(d){return d.getFullYear()},t:function(d){return d.getHours()<12?'a':'p'},tt:function(d){return d.getHours()<12?'am':'pm'},T:function(d){return d.getHours()<12?'A':'P'},TT:function(d){return d.getHours()<12?'AM':'PM'},u:function(d){return formatDate(d,"yyyy-MM-dd'T'HH:mm:ss'Z'")},S:function(d){var date=d.getDate();if(date>10&&date<20){return'th';}
return['st','nd','rd'][date%10-1]||'th';},w:function(d,o){return o.weekNumberCalculation(d);},W:function(d){return iso8601Week(d);}};fc.dateFormatters=dateFormatters;function iso8601Week(date){var time;var checkDate=new Date(date.getTime());checkDate.setDate(checkDate.getDate()+4-(checkDate.getDay()||7));time=checkDate.getTime();checkDate.setMonth(0);checkDate.setDate(1);return Math.floor(Math.round((time-checkDate)/86400000)/7)+1;};;fc.applyAll=applyAll;function exclEndDay(event){if(event.end){return _exclEndDay(event.end,event.allDay);}else{return addDays(cloneDate(event.start),1);}}
function _exclEndDay(end,allDay){end=cloneDate(end);return allDay||end.getHours()||end.getMinutes()?addDays(end,1):clearTime(end);}
function lazySegBind(container,segs,bindHandlers){container.unbind('mouseover').mouseover(function(ev){var parent=ev.target,e,i,seg;while(parent!=this){e=parent;parent=parent.parentNode;}
if((i=e._fci)!==undefined){e._fci=undefined;seg=segs[i];bindHandlers(seg.event,seg.element,seg);$(ev.target).trigger(ev);}
ev.stopPropagation();});}
function setOuterWidth(element,width,includeMargins){for(var i=0,e;i<element.length;i++){e=$(element[i]);e.width(Math.max(0,width-hsides(e,includeMargins)));}}
function setOuterHeight(element,height,includeMargins){for(var i=0,e;i<element.length;i++){e=$(element[i]);e.height(Math.max(0,height-vsides(e,includeMargins)));}}
function hsides(element,includeMargins){return hpadding(element)+hborders(element)+(includeMargins?hmargins(element):0);}
function hpadding(element){return(parseFloat($.css(element[0],'paddingLeft',true))||0)+
(parseFloat($.css(element[0],'paddingRight',true))||0);}
function hmargins(element){return(parseFloat($.css(element[0],'marginLeft',true))||0)+
(parseFloat($.css(element[0],'marginRight',true))||0);}
function hborders(element){return(parseFloat($.css(element[0],'borderLeftWidth',true))||0)+
(parseFloat($.css(element[0],'borderRightWidth',true))||0);}
function vsides(element,includeMargins){return vpadding(element)+vborders(element)+(includeMargins?vmargins(element):0);}
function vpadding(element){return(parseFloat($.css(element[0],'paddingTop',true))||0)+
(parseFloat($.css(element[0],'paddingBottom',true))||0);}
function vmargins(element){return(parseFloat($.css(element[0],'marginTop',true))||0)+
(parseFloat($.css(element[0],'marginBottom',true))||0);}
function vborders(element){return(parseFloat($.css(element[0],'borderTopWidth',true))||0)+
(parseFloat($.css(element[0],'borderBottomWidth',true))||0);}
function noop(){}
function dateCompare(a,b){return a-b;}
function arrayMax(a){return Math.max.apply(Math,a);}
function zeroPad(n){return(n<10?'0':'')+n;}
function smartProperty(obj,name){if(obj[name]!==undefined){return obj[name];}
var parts=name.split(/(?=[A-Z])/),i=parts.length-1,res;for(;i>=0;i--){res=obj[parts[i].toLowerCase()];if(res!==undefined){return res;}}
return obj[''];}
function htmlEscape(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/'/g,'&#039;').replace(/"/g,'&quot;').replace(/\n/g,'<br />');}
function disableTextSelection(element){element.attr('unselectable','on').css('MozUserSelect','none').bind('selectstart.ui',function(){return false;});}
function markFirstLast(e){e.children().removeClass('fc-first fc-last').filter(':first-child').addClass('fc-first').end().filter(':last-child').addClass('fc-last');}
function setDayID(cell,date){cell.each(function(i,_cell){_cell.className=_cell.className.replace(/^fc-\w*/,'fc-'+dayIDs[date.getDay()]);});}
function getSkinCss(event,opt){var source=event.source||{};var eventColor=event.color;var sourceColor=source.color;var optionColor=opt('eventColor');var backgroundColor=event.backgroundColor||eventColor||source.backgroundColor||sourceColor||opt('eventBackgroundColor')||optionColor;var borderColor=event.borderColor||eventColor||source.borderColor||sourceColor||opt('eventBorderColor')||optionColor;var textColor=event.textColor||source.textColor||opt('eventTextColor');var statements=[];if(backgroundColor){statements.push('background-color:'+backgroundColor);}
if(borderColor){statements.push('border-color:'+borderColor);}
if(textColor){statements.push('color:'+textColor);}
return statements.join(';');}
function applyAll(functions,thisObj,args){if($.isFunction(functions)){functions=[functions];}
if(functions){var i;var ret;for(i=0;i<functions.length;i++){ret=functions[i].apply(thisObj,args)||ret;}
return ret;}}
function firstDefined(){for(var i=0;i<arguments.length;i++){if(arguments[i]!==undefined){return arguments[i];}}};;fcViews.month=MonthView;function MonthView(element,calendar){var t=this;t.render=render;BasicView.call(t,element,calendar,'month');var opt=t.opt;var renderBasic=t.renderBasic;var skipHiddenDays=t.skipHiddenDays;var getCellsPerWeek=t.getCellsPerWeek;var formatDate=calendar.formatDate;function render(date,delta){if(delta){addMonths(date,delta);date.setDate(1);}
var firstDay=opt('firstDay');var start=cloneDate(date,true);start.setDate(1);var end=addMonths(cloneDate(start),1);var visStart=cloneDate(start);addDays(visStart,-((visStart.getDay()-firstDay+7)%7));skipHiddenDays(visStart);var visEnd=cloneDate(end);addDays(visEnd,(7-visEnd.getDay()+firstDay)%7);skipHiddenDays(visEnd,-1,true);var colCnt=getCellsPerWeek();var rowCnt=Math.round(dayDiff(visEnd,visStart)/7);if(opt('weekMode')=='fixed'){addDays(visEnd,(6-rowCnt)*7);rowCnt=6;}
t.title=formatDate(start,opt('titleFormat'));t.start=start;t.end=end;t.visStart=visStart;t.visEnd=visEnd;renderBasic(rowCnt,colCnt,true);}};;fcViews.basicWeek=BasicWeekView;function BasicWeekView(element,calendar){var t=this;t.render=render;BasicView.call(t,element,calendar,'basicWeek');var opt=t.opt;var renderBasic=t.renderBasic;var skipHiddenDays=t.skipHiddenDays;var getCellsPerWeek=t.getCellsPerWeek;var formatDates=calendar.formatDates;function render(date,delta){if(delta){addDays(date,delta*7);}
var start=addDays(cloneDate(date),-((date.getDay()-opt('firstDay')+7)%7));var end=addDays(cloneDate(start),7);var visStart=cloneDate(start);skipHiddenDays(visStart);var visEnd=cloneDate(end);skipHiddenDays(visEnd,-1,true);var colCnt=getCellsPerWeek();t.start=start;t.end=end;t.visStart=visStart;t.visEnd=visEnd;t.title=formatDates(visStart,addDays(cloneDate(visEnd),-1),opt('titleFormat'));renderBasic(1,colCnt,false);}};;fcViews.basicDay=BasicDayView;function BasicDayView(element,calendar){var t=this;t.render=render;BasicView.call(t,element,calendar,'basicDay');var opt=t.opt;var renderBasic=t.renderBasic;var skipHiddenDays=t.skipHiddenDays;var formatDate=calendar.formatDate;function render(date,delta){if(delta){addDays(date,delta);}
skipHiddenDays(date,delta<0?-1:1);var start=cloneDate(date,true);var end=addDays(cloneDate(start),1);t.title=formatDate(date,opt('titleFormat'));t.start=t.visStart=start;t.end=t.visEnd=end;renderBasic(1,1,false);}};;setDefaults({weekMode:'fixed'});function BasicView(element,calendar,viewName){var t=this;t.renderBasic=renderBasic;t.setHeight=setHeight;t.setWidth=setWidth;t.renderDayOverlay=renderDayOverlay;t.defaultSelectionEnd=defaultSelectionEnd;t.renderSelection=renderSelection;t.clearSelection=clearSelection;t.reportDayClick=reportDayClick;t.dragStart=dragStart;t.dragStop=dragStop;t.defaultEventEnd=defaultEventEnd;t.getHoverListener=function(){return hoverListener};t.colLeft=colLeft;t.colRight=colRight;t.colContentLeft=colContentLeft;t.colContentRight=colContentRight;t.getIsCellAllDay=function(){return true};t.allDayRow=allDayRow;t.getRowCnt=function(){return rowCnt};t.getColCnt=function(){return colCnt};t.getColWidth=function(){return colWidth};t.getDaySegmentContainer=function(){return daySegmentContainer};View.call(t,element,calendar,viewName);OverlayManager.call(t);SelectionManager.call(t);BasicEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var renderOverlay=t.renderOverlay;var clearOverlays=t.clearOverlays;var daySelectionMousedown=t.daySelectionMousedown;var cellToDate=t.cellToDate;var dateToCell=t.dateToCell;var rangeToSegments=t.rangeToSegments;var formatDate=calendar.formatDate;var table;var head;var headCells;var body;var bodyRows;var bodyCells;var bodyFirstCells;var firstRowCellInners;var firstRowCellContentInners;var daySegmentContainer;var viewWidth;var viewHeight;var colWidth;var weekNumberWidth;var rowCnt,colCnt;var showNumbers;var coordinateGrid;var hoverListener;var colPositions;var colContentPositions;var tm;var colFormat;var showWeekNumbers;var weekNumberTitle;var weekNumberFormat;disableTextSelection(element.addClass('fc-grid'));function renderBasic(_rowCnt,_colCnt,_showNumbers){rowCnt=_rowCnt;colCnt=_colCnt;showNumbers=_showNumbers;updateOptions();if(!body){buildEventContainer();}
buildTable();}
function updateOptions(){tm=opt('theme')?'ui':'fc';colFormat=opt('columnFormat');showWeekNumbers=opt('weekNumbers');weekNumberTitle=opt('weekNumberTitle');if(opt('weekNumberCalculation')!='iso'){weekNumberFormat="w";}
else{weekNumberFormat="W";}}
function buildEventContainer(){daySegmentContainer=$("<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(element);}
function buildTable(){var html=buildTableHTML();if(table){table.remove();}
table=$(html).appendTo(element);head=table.find('thead');headCells=head.find('.fc-day-header');body=table.find('tbody');bodyRows=body.find('tr');bodyCells=body.find('.fc-day');bodyFirstCells=bodyRows.find('td:first-child');firstRowCellInners=bodyRows.eq(0).find('.fc-day > div');firstRowCellContentInners=bodyRows.eq(0).find('.fc-day-content > div');markFirstLast(head.add(head.find('tr')));markFirstLast(bodyRows);bodyRows.eq(0).addClass('fc-first');bodyRows.filter(':last').addClass('fc-last');bodyCells.each(function(i,_cell){var date=cellToDate(Math.floor(i/colCnt),i%colCnt);trigger('dayRender',t,date,$(_cell));});dayBind(bodyCells);}
function buildTableHTML(){var html="<table class='fc-border-separate' style='width:100%' cellspacing='0'>"+
buildHeadHTML()+
buildBodyHTML()+"</table>";return html;}
function buildHeadHTML(){var headerClass=tm+"-widget-header";var html='';var col;var date;html+="<thead><tr>";if(showWeekNumbers){html+="<th class='fc-week-number "+headerClass+"'>"+
htmlEscape(weekNumberTitle)+"</th>";}
for(col=0;col<colCnt;col++){date=cellToDate(0,col);html+="<th class='fc-day-header fc-"+dayIDs[date.getDay()]+" "+headerClass+"'>"+
htmlEscape(formatDate(date,colFormat))+"</th>";}
html+="</tr></thead>";return html;}
function buildBodyHTML(){var contentClass=tm+"-widget-content";var html='';var row;var col;var date;html+="<tbody>";for(row=0;row<rowCnt;row++){html+="<tr class='fc-week'>";if(showWeekNumbers){date=cellToDate(row,0);html+="<td class='fc-week-number "+contentClass+"'>"+"<div>"+
htmlEscape(formatDate(date,weekNumberFormat))+"</div>"+"</td>";}
for(col=0;col<colCnt;col++){date=cellToDate(row,col);html+=buildCellHTML(date);}
html+="</tr>";}
html+="</tbody>";return html;}
function buildCellHTML(date){var contentClass=tm+"-widget-content";var month=t.start.getMonth();var today=clearTime(new Date());var html='';var classNames=['fc-day','fc-'+dayIDs[date.getDay()],contentClass];if(date.getMonth()!=month){classNames.push('fc-other-month');}
if(+date==+today){classNames.push('fc-today',tm+'-state-highlight');}
else if(date<today){classNames.push('fc-past');}
else{classNames.push('fc-future');}
html+="<td"+" class='"+classNames.join(' ')+"'"+" data-date='"+formatDate(date,'yyyy-MM-dd')+"'"+">"+"<div>";if(showNumbers){html+="<div class='fc-day-number'>"+date.getDate()+"</div>";}
html+="<div class='fc-day-content'>"+"<div style='position:relative'>&nbsp;</div>"+"</div>"+"</div>"+"</td>";return html;}
function setHeight(height){viewHeight=height;var bodyHeight=viewHeight-head.height();var rowHeight;var rowHeightLast;var cell;if(opt('weekMode')=='variable'){rowHeight=rowHeightLast=Math.floor(bodyHeight/(rowCnt==1?2:6));}else{rowHeight=Math.floor(bodyHeight/rowCnt);rowHeightLast=bodyHeight-rowHeight*(rowCnt-1);}
bodyFirstCells.each(function(i,_cell){if(i<rowCnt){cell=$(_cell);cell.find('> div').css('min-height',(i==rowCnt-1?rowHeightLast:rowHeight)-vsides(cell));}});}
function setWidth(width){viewWidth=width;colPositions.clear();colContentPositions.clear();weekNumberWidth=0;if(showWeekNumbers){weekNumberWidth=head.find('th.fc-week-number').outerWidth();}
colWidth=Math.floor((viewWidth-weekNumberWidth)/colCnt);setOuterWidth(headCells.slice(0,-1),colWidth);}
function dayBind(days){days.click(dayClick).mousedown(daySelectionMousedown);}
function dayClick(ev){if(!opt('selectable')){var date=parseISO8601($(this).data('date'));trigger('dayClick',this,date,true,ev);}}
function renderDayOverlay(overlayStart,overlayEnd,refreshCoordinateGrid){if(refreshCoordinateGrid){coordinateGrid.build();}
var segments=rangeToSegments(overlayStart,overlayEnd);for(var i=0;i<segments.length;i++){var segment=segments[i];dayBind(renderCellOverlay(segment.row,segment.leftCol,segment.row,segment.rightCol));}}
function renderCellOverlay(row0,col0,row1,col1){var rect=coordinateGrid.rect(row0,col0,row1,col1,element);return renderOverlay(rect,element);}
function defaultSelectionEnd(startDate,allDay){return cloneDate(startDate);}
function renderSelection(startDate,endDate,allDay){renderDayOverlay(startDate,addDays(cloneDate(endDate),1),true);}
function clearSelection(){clearOverlays();}
function reportDayClick(date,allDay,ev){var cell=dateToCell(date);var _element=bodyCells[cell.row*colCnt+cell.col];trigger('dayClick',_element,date,allDay,ev);}
function dragStart(_dragElement,ev,ui){hoverListener.start(function(cell){clearOverlays();if(cell){renderCellOverlay(cell.row,cell.col,cell.row,cell.col);}},ev);}
function dragStop(_dragElement,ev,ui){var cell=hoverListener.stop();clearOverlays();if(cell){var d=cellToDate(cell);trigger('drop',_dragElement,d,true,ev,ui);}}
function defaultEventEnd(event){return cloneDate(event.start);}
coordinateGrid=new CoordinateGrid(function(rows,cols){var e,n,p;headCells.each(function(i,_e){e=$(_e);n=e.offset().left;if(i){p[1]=n;}
p=[n];cols[i]=p;});p[1]=n+e.outerWidth();bodyRows.each(function(i,_e){if(i<rowCnt){e=$(_e);n=e.offset().top;if(i){p[1]=n;}
p=[n];rows[i]=p;}});p[1]=n+e.outerHeight();});hoverListener=new HoverListener(coordinateGrid);colPositions=new HorizontalPositionCache(function(col){return firstRowCellInners.eq(col);});colContentPositions=new HorizontalPositionCache(function(col){return firstRowCellContentInners.eq(col);});function colLeft(col){return colPositions.left(col);}
function colRight(col){return colPositions.right(col);}
function colContentLeft(col){return colContentPositions.left(col);}
function colContentRight(col){return colContentPositions.right(col);}
function allDayRow(i){return bodyRows.eq(i);}};;function BasicEventRenderer(){var t=this;t.renderEvents=renderEvents;t.clearEvents=clearEvents;DayEventRenderer.call(t);function renderEvents(events,modifiedEventId){t.renderDayEvents(events,modifiedEventId);}
function clearEvents(){t.getDaySegmentContainer().empty();}};;fcViews.agendaWeek=AgendaWeekView;function AgendaWeekView(element,calendar){var t=this;t.render=render;AgendaView.call(t,element,calendar,'agendaWeek');var opt=t.opt;var renderAgenda=t.renderAgenda;var skipHiddenDays=t.skipHiddenDays;var getCellsPerWeek=t.getCellsPerWeek;var formatDates=calendar.formatDates;function render(date,delta){if(delta){addDays(date,delta*7);}
var start=addDays(cloneDate(date),-((date.getDay()-opt('firstDay')+7)%7));var end=addDays(cloneDate(start),7);var visStart=cloneDate(start);skipHiddenDays(visStart);var visEnd=cloneDate(end);skipHiddenDays(visEnd,-1,true);var colCnt=getCellsPerWeek();t.title=formatDates(visStart,addDays(cloneDate(visEnd),-1),opt('titleFormat'));t.start=start;t.end=end;t.visStart=visStart;t.visEnd=visEnd;renderAgenda(colCnt);}};;fcViews.agendaDay=AgendaDayView;function AgendaDayView(element,calendar){var t=this;t.render=render;AgendaView.call(t,element,calendar,'agendaDay');var opt=t.opt;var renderAgenda=t.renderAgenda;var skipHiddenDays=t.skipHiddenDays;var formatDate=calendar.formatDate;function render(date,delta){if(delta){addDays(date,delta);}
skipHiddenDays(date,delta<0?-1:1);var start=cloneDate(date,true);var end=addDays(cloneDate(start),1);t.title=formatDate(date,opt('titleFormat'));t.start=t.visStart=start;t.end=t.visEnd=end;renderAgenda(1);}};;setDefaults({allDaySlot:true,allDayText:'all-day',firstHour:6,slotMinutes:30,defaultEventMinutes:120,axisFormat:'h(:mm)tt',timeFormat:{agenda:'h:mm{ - h:mm}'},dragOpacity:{agenda:.5},minTime:0,maxTime:24,slotEventOverlap:true});function AgendaView(element,calendar,viewName){var t=this;t.renderAgenda=renderAgenda;t.setWidth=setWidth;t.setHeight=setHeight;t.afterRender=afterRender;t.defaultEventEnd=defaultEventEnd;t.timePosition=timePosition;t.getIsCellAllDay=getIsCellAllDay;t.allDayRow=getAllDayRow;t.getCoordinateGrid=function(){return coordinateGrid};t.getHoverListener=function(){return hoverListener};t.colLeft=colLeft;t.colRight=colRight;t.colContentLeft=colContentLeft;t.colContentRight=colContentRight;t.getDaySegmentContainer=function(){return daySegmentContainer};t.getSlotSegmentContainer=function(){return slotSegmentContainer};t.getMinMinute=function(){return minMinute};t.getMaxMinute=function(){return maxMinute};t.getSlotContainer=function(){return slotContainer};t.getRowCnt=function(){return 1};t.getColCnt=function(){return colCnt};t.getColWidth=function(){return colWidth};t.getSnapHeight=function(){return snapHeight};t.getSnapMinutes=function(){return snapMinutes};t.defaultSelectionEnd=defaultSelectionEnd;t.renderDayOverlay=renderDayOverlay;t.renderSelection=renderSelection;t.clearSelection=clearSelection;t.reportDayClick=reportDayClick;t.dragStart=dragStart;t.dragStop=dragStop;View.call(t,element,calendar,viewName);OverlayManager.call(t);SelectionManager.call(t);AgendaEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var renderOverlay=t.renderOverlay;var clearOverlays=t.clearOverlays;var reportSelection=t.reportSelection;var unselect=t.unselect;var daySelectionMousedown=t.daySelectionMousedown;var slotSegHtml=t.slotSegHtml;var cellToDate=t.cellToDate;var dateToCell=t.dateToCell;var rangeToSegments=t.rangeToSegments;var formatDate=calendar.formatDate;var dayTable;var dayHead;var dayHeadCells;var dayBody;var dayBodyCells;var dayBodyCellInners;var dayBodyCellContentInners;var dayBodyFirstCell;var dayBodyFirstCellStretcher;var slotLayer;var daySegmentContainer;var allDayTable;var allDayRow;var slotScroller;var slotContainer;var slotSegmentContainer;var slotTable;var selectionHelper;var viewWidth;var viewHeight;var axisWidth;var colWidth;var gutterWidth;var slotHeight;var snapMinutes;var snapRatio;var snapHeight;var colCnt;var slotCnt;var coordinateGrid;var hoverListener;var colPositions;var colContentPositions;var slotTopCache={};var tm;var rtl;var minMinute,maxMinute;var colFormat;var showWeekNumbers;var weekNumberTitle;var weekNumberFormat;disableTextSelection(element.addClass('fc-agenda'));function renderAgenda(c){colCnt=c;updateOptions();if(!dayTable){buildSkeleton();}
else{buildDayTable();}}
function updateOptions(){tm=opt('theme')?'ui':'fc';rtl=opt('isRTL')
minMinute=parseTime(opt('minTime'));maxMinute=parseTime(opt('maxTime'));colFormat=opt('columnFormat');showWeekNumbers=opt('weekNumbers');weekNumberTitle=opt('weekNumberTitle');if(opt('weekNumberCalculation')!='iso'){weekNumberFormat="w";}
else{weekNumberFormat="W";}
snapMinutes=opt('snapMinutes')||opt('slotMinutes');}
function buildSkeleton(){var headerClass=tm+"-widget-header";var contentClass=tm+"-widget-content";var s;var d;var i;var maxd;var minutes;var slotNormal=opt('slotMinutes')%15==0;buildDayTable();slotLayer=$("<div style='position:absolute;z-index:2;left:0;width:100%'/>").appendTo(element);if(opt('allDaySlot')){daySegmentContainer=$("<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(slotLayer);s="<table style='width:100%' class='fc-agenda-allday' cellspacing='0'>"+"<tr>"+"<th class='"+headerClass+" fc-agenda-axis'>"+opt('allDayText')+"</th>"+"<td>"+"<div class='fc-day-content'><div style='position:relative'/></div>"+"</td>"+"<th class='"+headerClass+" fc-agenda-gutter'>&nbsp;</th>"+"</tr>"+"</table>";allDayTable=$(s).appendTo(slotLayer);allDayRow=allDayTable.find('tr');dayBind(allDayRow.find('td'));slotLayer.append("<div class='fc-agenda-divider "+headerClass+"'>"+"<div class='fc-agenda-divider-inner'/>"+"</div>");}else{daySegmentContainer=$([]);}
slotScroller=$("<div style='position:absolute;width:100%;overflow-x:hidden;overflow-y:auto'/>").appendTo(slotLayer);slotContainer=$("<div style='position:relative;width:100%;overflow:hidden'/>").appendTo(slotScroller);slotSegmentContainer=$("<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(slotContainer);s="<table class='fc-agenda-slots' style='width:100%' cellspacing='0'>"+"<tbody>";d=zeroDate();maxd=addMinutes(cloneDate(d),maxMinute);addMinutes(d,minMinute);slotCnt=0;for(i=0;d<maxd;i++){minutes=d.getMinutes();s+="<tr class='fc-slot"+i+' '+(!minutes?'':'fc-minor')+"'>"+"<th class='fc-agenda-axis "+headerClass+"'>"+
((!slotNormal||!minutes)?formatDate(d,opt('axisFormat')):'&nbsp;')+"</th>"+"<td class='"+contentClass+"'>"+"<div style='position:relative'>&nbsp;</div>"+"</td>"+"</tr>";addMinutes(d,opt('slotMinutes'));slotCnt++;}
s+="</tbody>"+"</table>";slotTable=$(s).appendTo(slotContainer);slotBind(slotTable.find('td'));}
function buildDayTable(){var html=buildDayTableHTML();if(dayTable){dayTable.remove();}
dayTable=$(html).appendTo(element);dayHead=dayTable.find('thead');dayHeadCells=dayHead.find('th').slice(1,-1);dayBody=dayTable.find('tbody');dayBodyCells=dayBody.find('td').slice(0,-1);dayBodyCellInners=dayBodyCells.find('> div');dayBodyCellContentInners=dayBodyCells.find('.fc-day-content > div');dayBodyFirstCell=dayBodyCells.eq(0);dayBodyFirstCellStretcher=dayBodyCellInners.eq(0);markFirstLast(dayHead.add(dayHead.find('tr')));markFirstLast(dayBody.add(dayBody.find('tr')));}
function buildDayTableHTML(){var html="<table style='width:100%' class='fc-agenda-days fc-border-separate' cellspacing='0'>"+
buildDayTableHeadHTML()+
buildDayTableBodyHTML()+"</table>";return html;}
function buildDayTableHeadHTML(){var headerClass=tm+"-widget-header";var date;var html='';var weekText;var col;html+="<thead>"+"<tr>";if(showWeekNumbers){date=cellToDate(0,0);weekText=formatDate(date,weekNumberFormat);if(rtl){weekText+=weekNumberTitle;}
else{weekText=weekNumberTitle+weekText;}
html+="<th class='fc-agenda-axis fc-week-number "+headerClass+"'>"+
htmlEscape(weekText)+"</th>";}
else{html+="<th class='fc-agenda-axis "+headerClass+"'>&nbsp;</th>";}
for(col=0;col<colCnt;col++){date=cellToDate(0,col);html+="<th class='fc-"+dayIDs[date.getDay()]+" fc-col"+col+' '+headerClass+"'>"+
htmlEscape(formatDate(date,colFormat))+"</th>";}
html+="<th class='fc-agenda-gutter "+headerClass+"'>&nbsp;</th>"+"</tr>"+"</thead>";return html;}
function buildDayTableBodyHTML(){var headerClass=tm+"-widget-header";var contentClass=tm+"-widget-content";var date;var today=clearTime(new Date());var col;var cellsHTML;var cellHTML;var classNames;var html='';html+="<tbody>"+"<tr>"+"<th class='fc-agenda-axis "+headerClass+"'>&nbsp;</th>";cellsHTML='';for(col=0;col<colCnt;col++){date=cellToDate(0,col);classNames=['fc-col'+col,'fc-'+dayIDs[date.getDay()],contentClass];if(+date==+today){classNames.push(tm+'-state-highlight','fc-today');}
else if(date<today){classNames.push('fc-past');}
else{classNames.push('fc-future');}
cellHTML="<td class='"+classNames.join(' ')+"'>"+"<div>"+"<div class='fc-day-content'>"+"<div style='position:relative'>&nbsp;</div>"+"</div>"+"</div>"+"</td>";cellsHTML+=cellHTML;}
html+=cellsHTML;html+="<td class='fc-agenda-gutter "+contentClass+"'>&nbsp;</td>"+"</tr>"+"</tbody>";return html;}
function setHeight(height){if(height===undefined){height=viewHeight;}
viewHeight=height;slotTopCache={};var headHeight=dayBody.position().top;var allDayHeight=slotScroller.position().top;var bodyHeight=Math.min(height-headHeight,slotTable.height()+allDayHeight+1);dayBodyFirstCellStretcher.height(bodyHeight-vsides(dayBodyFirstCell));slotLayer.css('top',headHeight);slotScroller.height(bodyHeight-allDayHeight-1);slotHeight=slotTable.find('tr:first').height()+1;snapRatio=opt('slotMinutes')/snapMinutes;snapHeight=slotHeight/snapRatio;}
function setWidth(width){viewWidth=width;colPositions.clear();colContentPositions.clear();var axisFirstCells=dayHead.find('th:first');if(allDayTable){axisFirstCells=axisFirstCells.add(allDayTable.find('th:first'));}
axisFirstCells=axisFirstCells.add(slotTable.find('th:first'));axisWidth=0;setOuterWidth(axisFirstCells.width('').each(function(i,_cell){axisWidth=Math.max(axisWidth,$(_cell).outerWidth());}),axisWidth);var gutterCells=dayTable.find('.fc-agenda-gutter');if(allDayTable){gutterCells=gutterCells.add(allDayTable.find('th.fc-agenda-gutter'));}
var slotTableWidth=slotScroller[0].clientWidth;gutterWidth=slotScroller.width()-slotTableWidth;if(gutterWidth){setOuterWidth(gutterCells,gutterWidth);gutterCells.show().prev().removeClass('fc-last');}else{gutterCells.hide().prev().addClass('fc-last');}
colWidth=Math.floor((slotTableWidth-axisWidth)/colCnt);setOuterWidth(dayHeadCells.slice(0,-1),colWidth);}
function resetScroll(){var d0=zeroDate();var scrollDate=cloneDate(d0);scrollDate.setHours(opt('firstHour'));var top=timePosition(d0,scrollDate)+1;function scroll(){slotScroller.scrollTop(top);}
scroll();setTimeout(scroll,0);}
function afterRender(){resetScroll();}
function dayBind(cells){cells.click(slotClick).mousedown(daySelectionMousedown);}
function slotBind(cells){cells.click(slotClick).mousedown(slotSelectionMousedown);}
function slotClick(ev){if(!opt('selectable')){var col=Math.min(colCnt-1,Math.floor((ev.pageX-dayTable.offset().left-axisWidth)/colWidth));var date=cellToDate(0,col);var rowMatch=this.parentNode.className.match(/fc-slot(\d+)/);if(rowMatch){var mins=parseInt(rowMatch[1])*opt('slotMinutes');var hours=Math.floor(mins/60);date.setHours(hours);date.setMinutes(mins%60+minMinute);trigger('dayClick',dayBodyCells[col],date,false,ev);}else{trigger('dayClick',dayBodyCells[col],date,true,ev);}}}
function renderDayOverlay(overlayStart,overlayEnd,refreshCoordinateGrid){if(refreshCoordinateGrid){coordinateGrid.build();}
var segments=rangeToSegments(overlayStart,overlayEnd);for(var i=0;i<segments.length;i++){var segment=segments[i];dayBind(renderCellOverlay(segment.row,segment.leftCol,segment.row,segment.rightCol));}}
function renderCellOverlay(row0,col0,row1,col1){var rect=coordinateGrid.rect(row0,col0,row1,col1,slotLayer);return renderOverlay(rect,slotLayer);}
function renderSlotOverlay(overlayStart,overlayEnd){for(var i=0;i<colCnt;i++){var dayStart=cellToDate(0,i);var dayEnd=addDays(cloneDate(dayStart),1);var stretchStart=new Date(Math.max(dayStart,overlayStart));var stretchEnd=new Date(Math.min(dayEnd,overlayEnd));if(stretchStart<stretchEnd){var rect=coordinateGrid.rect(0,i,0,i,slotContainer);var top=timePosition(dayStart,stretchStart);var bottom=timePosition(dayStart,stretchEnd);rect.top=top;rect.height=bottom-top;slotBind(renderOverlay(rect,slotContainer));}}}
coordinateGrid=new CoordinateGrid(function(rows,cols){var e,n,p;dayHeadCells.each(function(i,_e){e=$(_e);n=e.offset().left;if(i){p[1]=n;}
p=[n];cols[i]=p;});p[1]=n+e.outerWidth();if(opt('allDaySlot')){e=allDayRow;n=e.offset().top;rows[0]=[n,n+e.outerHeight()];}
var slotTableTop=slotContainer.offset().top;var slotScrollerTop=slotScroller.offset().top;var slotScrollerBottom=slotScrollerTop+slotScroller.outerHeight();function constrain(n){return Math.max(slotScrollerTop,Math.min(slotScrollerBottom,n));}
for(var i=0;i<slotCnt*snapRatio;i++){rows.push([constrain(slotTableTop+snapHeight*i),constrain(slotTableTop+snapHeight*(i+1))]);}});hoverListener=new HoverListener(coordinateGrid);colPositions=new HorizontalPositionCache(function(col){return dayBodyCellInners.eq(col);});colContentPositions=new HorizontalPositionCache(function(col){return dayBodyCellContentInners.eq(col);});function colLeft(col){return colPositions.left(col);}
function colContentLeft(col){return colContentPositions.left(col);}
function colRight(col){return colPositions.right(col);}
function colContentRight(col){return colContentPositions.right(col);}
function getIsCellAllDay(cell){return opt('allDaySlot')&&!cell.row;}
function realCellToDate(cell){var d=cellToDate(0,cell.col);var slotIndex=cell.row;if(opt('allDaySlot')){slotIndex--;}
if(slotIndex>=0){addMinutes(d,minMinute+slotIndex*snapMinutes);}
return d;}
function timePosition(day,time){day=cloneDate(day,true);if(time<addMinutes(cloneDate(day),minMinute)){return 0;}
if(time>=addMinutes(cloneDate(day),maxMinute)){return slotTable.height();}
var slotMinutes=opt('slotMinutes'),minutes=time.getHours()*60+time.getMinutes()-minMinute,slotI=Math.floor(minutes/slotMinutes),slotTop=slotTopCache[slotI];if(slotTop===undefined){slotTop=slotTopCache[slotI]=slotTable.find('tr').eq(slotI).find('td div')[0].offsetTop;}
return Math.max(0,Math.round(slotTop-1+slotHeight*((minutes%slotMinutes)/slotMinutes)));}
function getAllDayRow(index){return allDayRow;}
function defaultEventEnd(event){var start=cloneDate(event.start);if(event.allDay){return start;}
return addMinutes(start,opt('defaultEventMinutes'));}
function defaultSelectionEnd(startDate,allDay){if(allDay){return cloneDate(startDate);}
return addMinutes(cloneDate(startDate),opt('slotMinutes'));}
function renderSelection(startDate,endDate,allDay){if(allDay){if(opt('allDaySlot')){renderDayOverlay(startDate,addDays(cloneDate(endDate),1),true);}}else{renderSlotSelection(startDate,endDate);}}
function renderSlotSelection(startDate,endDate){var helperOption=opt('selectHelper');coordinateGrid.build();if(helperOption){var col=dateToCell(startDate).col;if(col>=0&&col<colCnt){var rect=coordinateGrid.rect(0,col,0,col,slotContainer);var top=timePosition(startDate,startDate);var bottom=timePosition(startDate,endDate);if(bottom>top){rect.top=top;rect.height=bottom-top;rect.left+=2;rect.width-=5;if($.isFunction(helperOption)){var helperRes=helperOption(startDate,endDate);if(helperRes){rect.position='absolute';selectionHelper=$(helperRes).css(rect).appendTo(slotContainer);}}else{rect.isStart=true;rect.isEnd=true;selectionHelper=$(slotSegHtml({title:'',start:startDate,end:endDate,className:['fc-select-helper'],editable:false},rect));selectionHelper.css('opacity',opt('dragOpacity'));}
if(selectionHelper){slotBind(selectionHelper);slotContainer.append(selectionHelper);setOuterWidth(selectionHelper,rect.width,true);setOuterHeight(selectionHelper,rect.height,true);}}}}else{renderSlotOverlay(startDate,endDate);}}
function clearSelection(){clearOverlays();if(selectionHelper){selectionHelper.remove();selectionHelper=null;}}
function slotSelectionMousedown(ev){if(ev.which==1&&opt('selectable')){unselect(ev);var dates;hoverListener.start(function(cell,origCell){clearSelection();if(cell&&cell.col==origCell.col&&!getIsCellAllDay(cell)){var d1=realCellToDate(origCell);var d2=realCellToDate(cell);dates=[d1,addMinutes(cloneDate(d1),snapMinutes),d2,addMinutes(cloneDate(d2),snapMinutes)].sort(dateCompare);renderSlotSelection(dates[0],dates[3]);}else{dates=null;}},ev);$(document).one('mouseup',function(ev){hoverListener.stop();if(dates){if(+dates[0]==+dates[1]){reportDayClick(dates[0],false,ev);}
reportSelection(dates[0],dates[3],false,ev);}});}}
function reportDayClick(date,allDay,ev){trigger('dayClick',dayBodyCells[dateToCell(date).col],date,allDay,ev);}
function dragStart(_dragElement,ev,ui){hoverListener.start(function(cell){clearOverlays();if(cell){if(getIsCellAllDay(cell)){renderCellOverlay(cell.row,cell.col,cell.row,cell.col);}else{var d1=realCellToDate(cell);var d2=addMinutes(cloneDate(d1),opt('defaultEventMinutes'));renderSlotOverlay(d1,d2);}}},ev);}
function dragStop(_dragElement,ev,ui){var cell=hoverListener.stop();clearOverlays();if(cell){trigger('drop',_dragElement,realCellToDate(cell),getIsCellAllDay(cell),ev,ui);}}};;function AgendaEventRenderer(){var t=this;t.renderEvents=renderEvents;t.clearEvents=clearEvents;t.slotSegHtml=slotSegHtml;DayEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var isEventDraggable=t.isEventDraggable;var isEventResizable=t.isEventResizable;var eventEnd=t.eventEnd;var eventElementHandlers=t.eventElementHandlers;var setHeight=t.setHeight;var getDaySegmentContainer=t.getDaySegmentContainer;var getSlotSegmentContainer=t.getSlotSegmentContainer;var getHoverListener=t.getHoverListener;var getMaxMinute=t.getMaxMinute;var getMinMinute=t.getMinMinute;var timePosition=t.timePosition;var getIsCellAllDay=t.getIsCellAllDay;var colContentLeft=t.colContentLeft;var colContentRight=t.colContentRight;var cellToDate=t.cellToDate;var getColCnt=t.getColCnt;var getColWidth=t.getColWidth;var getSnapHeight=t.getSnapHeight;var getSnapMinutes=t.getSnapMinutes;var getSlotContainer=t.getSlotContainer;var reportEventElement=t.reportEventElement;var showEvents=t.showEvents;var hideEvents=t.hideEvents;var eventDrop=t.eventDrop;var eventResize=t.eventResize;var renderDayOverlay=t.renderDayOverlay;var clearOverlays=t.clearOverlays;var renderDayEvents=t.renderDayEvents;var calendar=t.calendar;var formatDate=calendar.formatDate;var formatDates=calendar.formatDates;t.draggableDayEvent=draggableDayEvent;function renderEvents(events,modifiedEventId){var i,len=events.length,dayEvents=[],slotEvents=[];for(i=0;i<len;i++){if(events[i].allDay){dayEvents.push(events[i]);}else{slotEvents.push(events[i]);}}
if(opt('allDaySlot')){renderDayEvents(dayEvents,modifiedEventId);setHeight();}
renderSlotSegs(compileSlotSegs(slotEvents),modifiedEventId);}
function clearEvents(){getDaySegmentContainer().empty();getSlotSegmentContainer().empty();}
function compileSlotSegs(events){var colCnt=getColCnt(),minMinute=getMinMinute(),maxMinute=getMaxMinute(),d,visEventEnds=$.map(events,slotEventEnd),i,j,seg,colSegs,segs=[];for(i=0;i<colCnt;i++){d=cellToDate(0,i);addMinutes(d,minMinute);colSegs=sliceSegs(events,visEventEnds,d,addMinutes(cloneDate(d),maxMinute-minMinute));colSegs=placeSlotSegs(colSegs);for(j=0;j<colSegs.length;j++){seg=colSegs[j];seg.col=i;segs.push(seg);}}
return segs;}
function sliceSegs(events,visEventEnds,start,end){var segs=[],i,len=events.length,event,eventStart,eventEnd,segStart,segEnd,isStart,isEnd;for(i=0;i<len;i++){event=events[i];eventStart=event.start;eventEnd=visEventEnds[i];if(eventEnd>start&&eventStart<end){if(eventStart<start){segStart=cloneDate(start);isStart=false;}else{segStart=eventStart;isStart=true;}
if(eventEnd>end){segEnd=cloneDate(end);isEnd=false;}else{segEnd=eventEnd;isEnd=true;}
segs.push({event:event,start:segStart,end:segEnd,isStart:isStart,isEnd:isEnd});}}
return segs.sort(compareSlotSegs);}
function slotEventEnd(event){if(event.end){return cloneDate(event.end);}else{return addMinutes(cloneDate(event.start),opt('defaultEventMinutes'));}}
function renderSlotSegs(segs,modifiedEventId){var i,segCnt=segs.length,seg,event,top,bottom,columnLeft,columnRight,columnWidth,width,left,right,html='',eventElements,eventElement,triggerRes,titleElement,height,slotSegmentContainer=getSlotSegmentContainer(),isRTL=opt('isRTL');for(i=0;i<segCnt;i++){seg=segs[i];event=seg.event;top=timePosition(seg.start,seg.start);bottom=timePosition(seg.start,seg.end);columnLeft=colContentLeft(seg.col);columnRight=colContentRight(seg.col);columnWidth=columnRight-columnLeft;columnRight-=columnWidth*.025;columnWidth=columnRight-columnLeft;width=columnWidth*(seg.forwardCoord-seg.backwardCoord);if(opt('slotEventOverlap')){width=Math.max((width-(20/2))*2,width);}
if(isRTL){right=columnRight-seg.backwardCoord*columnWidth;left=right-width;}
else{left=columnLeft+seg.backwardCoord*columnWidth;right=left+width;}
left=Math.max(left,columnLeft);right=Math.min(right,columnRight);width=right-left;seg.top=top;seg.left=left;seg.outerWidth=width;seg.outerHeight=bottom-top;html+=slotSegHtml(event,seg);}
slotSegmentContainer[0].innerHTML=html;eventElements=slotSegmentContainer.children();for(i=0;i<segCnt;i++){seg=segs[i];event=seg.event;eventElement=$(eventElements[i]);triggerRes=trigger('eventRender',event,event,eventElement);if(triggerRes===false){eventElement.remove();}else{if(triggerRes&&triggerRes!==true){eventElement.remove();eventElement=$(triggerRes).css({position:'absolute',top:seg.top,left:seg.left}).appendTo(slotSegmentContainer);}
seg.element=eventElement;if(event._id===modifiedEventId){bindSlotSeg(event,eventElement,seg);}else{eventElement[0]._fci=i;}
reportEventElement(event,eventElement);}}
lazySegBind(slotSegmentContainer,segs,bindSlotSeg);for(i=0;i<segCnt;i++){seg=segs[i];if(eventElement=seg.element){seg.vsides=vsides(eventElement,true);seg.hsides=hsides(eventElement,true);titleElement=eventElement.find('.fc-event-title');if(titleElement.length){seg.contentTop=titleElement[0].offsetTop;}}}
for(i=0;i<segCnt;i++){seg=segs[i];if(eventElement=seg.element){eventElement[0].style.width=Math.max(0,seg.outerWidth-seg.hsides)+'px';height=Math.max(0,seg.outerHeight-seg.vsides);eventElement[0].style.height=height+'px';event=seg.event;if(seg.contentTop!==undefined&&height-seg.contentTop<10){eventElement.find('div.fc-event-time').text(formatDate(event.start,opt('timeFormat'))+' - '+event.title);eventElement.find('div.fc-event-title').remove();}
trigger('eventAfterRender',event,event,eventElement);}}}
function slotSegHtml(event,seg){var html="<";var url=event.url;var skinCss=getSkinCss(event,opt);var classes=['fc-event','fc-event-vert'];if(isEventDraggable(event)){classes.push('fc-event-draggable');}
if(seg.isStart){classes.push('fc-event-start');}
if(seg.isEnd){classes.push('fc-event-end');}
classes=classes.concat(event.className);if(event.source){classes=classes.concat(event.source.className||[]);}
if(url){html+="a href='"+htmlEscape(event.url)+"'";}else{html+="div";}
html+=" class='"+classes.join(' ')+"'"+" style="+"'"+"position:absolute;"+"top:"+seg.top+"px;"+"left:"+seg.left+"px;"+
skinCss+"'"+">"+"<div class='fc-event-inner'>"+"<div class='fc-event-time'>"+
htmlEscape(formatDates(event.start,event.end,opt('timeFormat')))+"</div>"+"<div class='fc-event-title'>"+
htmlEscape(event.title||'')+"</div>"+"</div>"+"<div class='fc-event-bg'></div>";if(seg.isEnd&&isEventResizable(event)){html+="<div class='ui-resizable-handle ui-resizable-s'>=</div>";}
html+="</"+(url?"a":"div")+">";return html;}
function bindSlotSeg(event,eventElement,seg){var timeElement=eventElement.find('div.fc-event-time');if(isEventDraggable(event)){draggableSlotEvent(event,eventElement,timeElement);}
if(seg.isEnd&&isEventResizable(event)){resizableSlotEvent(event,eventElement,timeElement);}
eventElementHandlers(event,eventElement);}
function draggableDayEvent(event,eventElement,seg){var isStart=seg.isStart;var origWidth;var revert;var allDay=true;var dayDelta;var hoverListener=getHoverListener();var colWidth=getColWidth();var snapHeight=getSnapHeight();var snapMinutes=getSnapMinutes();var minMinute=getMinMinute();eventElement.draggable({opacity:opt('dragOpacity','month'),revertDuration:opt('dragRevertDuration'),start:function(ev,ui){trigger('eventDragStart',eventElement,event,ev,ui);hideEvents(event,eventElement);origWidth=eventElement.width();hoverListener.start(function(cell,origCell){clearOverlays();if(cell){revert=false;var origDate=cellToDate(0,origCell.col);var date=cellToDate(0,cell.col);dayDelta=dayDiff(date,origDate);if(!cell.row){renderDayOverlay(addDays(cloneDate(event.start),dayDelta),addDays(exclEndDay(event),dayDelta));resetElement();}else{if(isStart){if(allDay){eventElement.width(colWidth-10);setOuterHeight(eventElement,snapHeight*Math.round((event.end?((event.end-event.start)/MINUTE_MS):opt('defaultEventMinutes'))/snapMinutes));eventElement.draggable('option','grid',[colWidth,1]);allDay=false;}}else{revert=true;}}
revert=revert||(allDay&&!dayDelta);}else{resetElement();revert=true;}
eventElement.draggable('option','revert',revert);},ev,'drag');},stop:function(ev,ui){hoverListener.stop();clearOverlays();trigger('eventDragStop',eventElement,event,ev,ui);if(revert){resetElement();eventElement.css('filter','');showEvents(event,eventElement);}else{var minuteDelta=0;if(!allDay){minuteDelta=Math.round((eventElement.offset().top-getSlotContainer().offset().top)/snapHeight)*snapMinutes
+minMinute
-(event.start.getHours()*60+event.start.getMinutes());}
eventDrop(this,event,dayDelta,minuteDelta,allDay,ev,ui);}}});function resetElement(){if(!allDay){eventElement.width(origWidth).height('').draggable('option','grid',null);allDay=true;}}}
function draggableSlotEvent(event,eventElement,timeElement){var coordinateGrid=t.getCoordinateGrid();var colCnt=getColCnt();var colWidth=getColWidth();var snapHeight=getSnapHeight();var snapMinutes=getSnapMinutes();var origPosition;var origCell;var isInBounds,prevIsInBounds;var isAllDay,prevIsAllDay;var colDelta,prevColDelta;var dayDelta;var minuteDelta,prevMinuteDelta;eventElement.draggable({scroll:false,grid:[colWidth,snapHeight],axis:colCnt==1?'y':false,opacity:opt('dragOpacity'),revertDuration:opt('dragRevertDuration'),start:function(ev,ui){trigger('eventDragStart',eventElement,event,ev,ui);hideEvents(event,eventElement);coordinateGrid.build();origPosition=eventElement.position();origCell=coordinateGrid.cell(ev.pageX,ev.pageY);isInBounds=prevIsInBounds=true;isAllDay=prevIsAllDay=getIsCellAllDay(origCell);colDelta=prevColDelta=0;dayDelta=0;minuteDelta=prevMinuteDelta=0;},drag:function(ev,ui){var cell=coordinateGrid.cell(ev.pageX,ev.pageY);isInBounds=!!cell;if(isInBounds){isAllDay=getIsCellAllDay(cell);colDelta=Math.round((ui.position.left-origPosition.left)/colWidth);if(colDelta!=prevColDelta){var origDate=cellToDate(0,origCell.col);var col=origCell.col+colDelta;col=Math.max(0,col);col=Math.min(colCnt-1,col);var date=cellToDate(0,col);dayDelta=dayDiff(date,origDate);}
if(!isAllDay){minuteDelta=Math.round((ui.position.top-origPosition.top)/snapHeight)*snapMinutes;}}
if(isInBounds!=prevIsInBounds||isAllDay!=prevIsAllDay||colDelta!=prevColDelta||minuteDelta!=prevMinuteDelta){updateUI();prevIsInBounds=isInBounds;prevIsAllDay=isAllDay;prevColDelta=colDelta;prevMinuteDelta=minuteDelta;}
eventElement.draggable('option','revert',!isInBounds);},stop:function(ev,ui){clearOverlays();trigger('eventDragStop',eventElement,event,ev,ui);if(isInBounds&&(isAllDay||dayDelta||minuteDelta)){eventDrop(this,event,dayDelta,isAllDay?0:minuteDelta,isAllDay,ev,ui);}
else{isInBounds=true;isAllDay=false;colDelta=0;dayDelta=0;minuteDelta=0;updateUI();eventElement.css('filter','');eventElement.css(origPosition);showEvents(event,eventElement);}}});function updateUI(){clearOverlays();if(isInBounds){if(isAllDay){timeElement.hide();eventElement.draggable('option','grid',null);renderDayOverlay(addDays(cloneDate(event.start),dayDelta),addDays(exclEndDay(event),dayDelta));}
else{updateTimeText(minuteDelta);timeElement.css('display','');eventElement.draggable('option','grid',[colWidth,snapHeight]);}}}
function updateTimeText(minuteDelta){var newStart=addMinutes(cloneDate(event.start),minuteDelta);var newEnd;if(event.end){newEnd=addMinutes(cloneDate(event.end),minuteDelta);}
timeElement.text(formatDates(newStart,newEnd,opt('timeFormat')));}}
function resizableSlotEvent(event,eventElement,timeElement){var snapDelta,prevSnapDelta;var snapHeight=getSnapHeight();var snapMinutes=getSnapMinutes();eventElement.resizable({handles:{s:'.ui-resizable-handle'},grid:snapHeight,start:function(ev,ui){snapDelta=prevSnapDelta=0;hideEvents(event,eventElement);trigger('eventResizeStart',this,event,ev,ui);},resize:function(ev,ui){snapDelta=Math.round((Math.max(snapHeight,eventElement.height())-ui.originalSize.height)/snapHeight);if(snapDelta!=prevSnapDelta){timeElement.text(formatDates(event.start,(!snapDelta&&!event.end)?null:addMinutes(eventEnd(event),snapMinutes*snapDelta),opt('timeFormat')));prevSnapDelta=snapDelta;}},stop:function(ev,ui){trigger('eventResizeStop',this,event,ev,ui);if(snapDelta){eventResize(this,event,0,snapMinutes*snapDelta,ev,ui);}else{showEvents(event,eventElement);}}});}}
function placeSlotSegs(segs){var levels=buildSlotSegLevels(segs);var level0=levels[0];var i;computeForwardSlotSegs(levels);if(level0){for(i=0;i<level0.length;i++){computeSlotSegPressures(level0[i]);}
for(i=0;i<level0.length;i++){computeSlotSegCoords(level0[i],0,0);}}
return flattenSlotSegLevels(levels);}
function buildSlotSegLevels(segs){var levels=[];var i,seg;var j;for(i=0;i<segs.length;i++){seg=segs[i];for(j=0;j<levels.length;j++){if(!computeSlotSegCollisions(seg,levels[j]).length){break;}}
(levels[j]||(levels[j]=[])).push(seg);}
return levels;}
function computeForwardSlotSegs(levels){var i,level;var j,seg;var k;for(i=0;i<levels.length;i++){level=levels[i];for(j=0;j<level.length;j++){seg=level[j];seg.forwardSegs=[];for(k=i+1;k<levels.length;k++){computeSlotSegCollisions(seg,levels[k],seg.forwardSegs);}}}}
function computeSlotSegPressures(seg){var forwardSegs=seg.forwardSegs;var forwardPressure=0;var i,forwardSeg;if(seg.forwardPressure===undefined){for(i=0;i<forwardSegs.length;i++){forwardSeg=forwardSegs[i];computeSlotSegPressures(forwardSeg);forwardPressure=Math.max(forwardPressure,1+forwardSeg.forwardPressure);}
seg.forwardPressure=forwardPressure;}}
function computeSlotSegCoords(seg,seriesBackwardPressure,seriesBackwardCoord){var forwardSegs=seg.forwardSegs;var i;if(seg.forwardCoord===undefined){if(!forwardSegs.length){seg.forwardCoord=1;}
else{forwardSegs.sort(compareForwardSlotSegs);computeSlotSegCoords(forwardSegs[0],seriesBackwardPressure+1,seriesBackwardCoord);seg.forwardCoord=forwardSegs[0].backwardCoord;}
seg.backwardCoord=seg.forwardCoord-
(seg.forwardCoord-seriesBackwardCoord)/(seriesBackwardPressure+1);for(i=0;i<forwardSegs.length;i++){computeSlotSegCoords(forwardSegs[i],0,seg.forwardCoord);}}}
function flattenSlotSegLevels(levels){var segs=[];var i,level;var j;for(i=0;i<levels.length;i++){level=levels[i];for(j=0;j<level.length;j++){segs.push(level[j]);}}
return segs;}
function computeSlotSegCollisions(seg,otherSegs,results){results=results||[];for(var i=0;i<otherSegs.length;i++){if(isSlotSegCollision(seg,otherSegs[i])){results.push(otherSegs[i]);}}
return results;}
function isSlotSegCollision(seg1,seg2){return seg1.end>seg2.start&&seg1.start<seg2.end;}
function compareForwardSlotSegs(seg1,seg2){return seg2.forwardPressure-seg1.forwardPressure||(seg1.backwardCoord||0)-(seg2.backwardCoord||0)||compareSlotSegs(seg1,seg2);}
function compareSlotSegs(seg1,seg2){return seg1.start-seg2.start||(seg2.end-seg2.start)-(seg1.end-seg1.start)||(seg1.event.title||'').localeCompare(seg2.event.title);};;function View(element,calendar,viewName){var t=this;t.element=element;t.calendar=calendar;t.name=viewName;t.opt=opt;t.trigger=trigger;t.isEventDraggable=isEventDraggable;t.isEventResizable=isEventResizable;t.setEventData=setEventData;t.clearEventData=clearEventData;t.eventEnd=eventEnd;t.reportEventElement=reportEventElement;t.triggerEventDestroy=triggerEventDestroy;t.eventElementHandlers=eventElementHandlers;t.showEvents=showEvents;t.hideEvents=hideEvents;t.eventDrop=eventDrop;t.eventResize=eventResize;var defaultEventEnd=t.defaultEventEnd;var normalizeEvent=calendar.normalizeEvent;var reportEventChange=calendar.reportEventChange;var eventsByID={};var eventElementsByID={};var eventElementCouples=[];var options=calendar.options;function opt(name,viewNameOverride){var v=options[name];if($.isPlainObject(v)){return smartProperty(v,viewNameOverride||viewName);}
return v;}
function trigger(name,thisObj){return calendar.trigger.apply(calendar,[name,thisObj||t].concat(Array.prototype.slice.call(arguments,2),[t]));}
function isEventDraggable(event){var source=event.source||{};return firstDefined(event.startEditable,source.startEditable,opt('eventStartEditable'),event.editable,source.editable,opt('editable'))&&!opt('disableDragging');}
function isEventResizable(event){var source=event.source||{};return firstDefined(event.durationEditable,source.durationEditable,opt('eventDurationEditable'),event.editable,source.editable,opt('editable'))&&!opt('disableResizing');}
function setEventData(events){eventsByID={};var i,len=events.length,event;for(i=0;i<len;i++){event=events[i];if(eventsByID[event._id]){eventsByID[event._id].push(event);}else{eventsByID[event._id]=[event];}}}
function clearEventData(){eventsByID={};eventElementsByID={};eventElementCouples=[];}
function eventEnd(event){return event.end?cloneDate(event.end):defaultEventEnd(event);}
function reportEventElement(event,element){eventElementCouples.push({event:event,element:element});if(eventElementsByID[event._id]){eventElementsByID[event._id].push(element);}else{eventElementsByID[event._id]=[element];}}
function triggerEventDestroy(){$.each(eventElementCouples,function(i,couple){t.trigger('eventDestroy',couple.event,couple.event,couple.element);});}
function eventElementHandlers(event,eventElement){eventElement.click(function(ev){if(!eventElement.hasClass('ui-draggable-dragging')&&!eventElement.hasClass('ui-resizable-resizing')){return trigger('eventClick',this,event,ev);}}).hover(function(ev){trigger('eventMouseover',this,event,ev);},function(ev){trigger('eventMouseout',this,event,ev);});}
function showEvents(event,exceptElement){eachEventElement(event,exceptElement,'show');}
function hideEvents(event,exceptElement){eachEventElement(event,exceptElement,'hide');}
function eachEventElement(event,exceptElement,funcName){var elements=eventElementsByID[event._id],i,len=elements.length;for(i=0;i<len;i++){if(!exceptElement||elements[i][0]!=exceptElement[0]){elements[i][funcName]();}}}
function eventDrop(e,event,dayDelta,minuteDelta,allDay,ev,ui){var oldAllDay=event.allDay;var eventId=event._id;moveEvents(eventsByID[eventId],dayDelta,minuteDelta,allDay);trigger('eventDrop',e,event,dayDelta,minuteDelta,allDay,function(){moveEvents(eventsByID[eventId],-dayDelta,-minuteDelta,oldAllDay);reportEventChange(eventId);},ev,ui);reportEventChange(eventId);}
function eventResize(e,event,dayDelta,minuteDelta,ev,ui){var eventId=event._id;elongateEvents(eventsByID[eventId],dayDelta,minuteDelta);trigger('eventResize',e,event,dayDelta,minuteDelta,function(){elongateEvents(eventsByID[eventId],-dayDelta,-minuteDelta);reportEventChange(eventId);},ev,ui);reportEventChange(eventId);}
function moveEvents(events,dayDelta,minuteDelta,allDay){minuteDelta=minuteDelta||0;for(var e,len=events.length,i=0;i<len;i++){e=events[i];if(allDay!==undefined){e.allDay=allDay;}
addMinutes(addDays(e.start,dayDelta,true),minuteDelta);if(e.end){e.end=addMinutes(addDays(e.end,dayDelta,true),minuteDelta);}
normalizeEvent(e,options);}}
function elongateEvents(events,dayDelta,minuteDelta){minuteDelta=minuteDelta||0;for(var e,len=events.length,i=0;i<len;i++){e=events[i];e.end=addMinutes(addDays(eventEnd(e),dayDelta,true),minuteDelta);normalizeEvent(e,options);}}
t.isHiddenDay=isHiddenDay;t.skipHiddenDays=skipHiddenDays;t.getCellsPerWeek=getCellsPerWeek;t.dateToCell=dateToCell;t.dateToDayOffset=dateToDayOffset;t.dayOffsetToCellOffset=dayOffsetToCellOffset;t.cellOffsetToCell=cellOffsetToCell;t.cellToDate=cellToDate;t.cellToCellOffset=cellToCellOffset;t.cellOffsetToDayOffset=cellOffsetToDayOffset;t.dayOffsetToDate=dayOffsetToDate;t.rangeToSegments=rangeToSegments;var hiddenDays=opt('hiddenDays')||[];var isHiddenDayHash=[];var cellsPerWeek;var dayToCellMap=[];var cellToDayMap=[];var isRTL=opt('isRTL');(function(){if(opt('weekends')===false){hiddenDays.push(0,6);}
for(var dayIndex=0,cellIndex=0;dayIndex<7;dayIndex++){dayToCellMap[dayIndex]=cellIndex;isHiddenDayHash[dayIndex]=$.inArray(dayIndex,hiddenDays)!=-1;if(!isHiddenDayHash[dayIndex]){cellToDayMap[cellIndex]=dayIndex;cellIndex++;}}
cellsPerWeek=cellIndex;if(!cellsPerWeek){throw'invalid hiddenDays';}})();function isHiddenDay(day){if(typeof day=='object'){day=day.getDay();}
return isHiddenDayHash[day];}
function getCellsPerWeek(){return cellsPerWeek;}
function skipHiddenDays(date,inc,isExclusive){inc=inc||1;while(isHiddenDayHash[(date.getDay()+(isExclusive?inc:0)+7)%7]){addDays(date,inc);}}
function cellToDate(){var cellOffset=cellToCellOffset.apply(null,arguments);var dayOffset=cellOffsetToDayOffset(cellOffset);var date=dayOffsetToDate(dayOffset);return date;}
function cellToCellOffset(row,col){var colCnt=t.getColCnt();var dis=isRTL?-1:1;var dit=isRTL?colCnt-1:0;if(typeof row=='object'){col=row.col;row=row.row;}
var cellOffset=row*colCnt+(col*dis+dit);return cellOffset;}
function cellOffsetToDayOffset(cellOffset){var day0=t.visStart.getDay();cellOffset+=dayToCellMap[day0];return Math.floor(cellOffset/cellsPerWeek)*7
+cellToDayMap[(cellOffset%cellsPerWeek+cellsPerWeek)%cellsPerWeek]
-day0;}
function dayOffsetToDate(dayOffset){var date=cloneDate(t.visStart);addDays(date,dayOffset);return date;}
function dateToCell(date){var dayOffset=dateToDayOffset(date);var cellOffset=dayOffsetToCellOffset(dayOffset);var cell=cellOffsetToCell(cellOffset);return cell;}
function dateToDayOffset(date){return dayDiff(date,t.visStart);}
function dayOffsetToCellOffset(dayOffset){var day0=t.visStart.getDay();dayOffset+=day0;return Math.floor(dayOffset/7)*cellsPerWeek
+dayToCellMap[(dayOffset%7+7)%7]
-dayToCellMap[day0];}
function cellOffsetToCell(cellOffset){var colCnt=t.getColCnt();var dis=isRTL?-1:1;var dit=isRTL?colCnt-1:0;var row=Math.floor(cellOffset/colCnt);var col=((cellOffset%colCnt+colCnt)%colCnt)*dis+dit;return{row:row,col:col};}
function rangeToSegments(startDate,endDate){var rowCnt=t.getRowCnt();var colCnt=t.getColCnt();var segments=[];var rangeDayOffsetStart=dateToDayOffset(startDate);var rangeDayOffsetEnd=dateToDayOffset(endDate);var rangeCellOffsetFirst=dayOffsetToCellOffset(rangeDayOffsetStart);var rangeCellOffsetLast=dayOffsetToCellOffset(rangeDayOffsetEnd)-1;for(var row=0;row<rowCnt;row++){var rowCellOffsetFirst=row*colCnt;var rowCellOffsetLast=rowCellOffsetFirst+colCnt-1;var segmentCellOffsetFirst=Math.max(rangeCellOffsetFirst,rowCellOffsetFirst);var segmentCellOffsetLast=Math.min(rangeCellOffsetLast,rowCellOffsetLast);if(segmentCellOffsetFirst<=segmentCellOffsetLast){var segmentCellFirst=cellOffsetToCell(segmentCellOffsetFirst);var segmentCellLast=cellOffsetToCell(segmentCellOffsetLast);var cols=[segmentCellFirst.col,segmentCellLast.col].sort();var isStart=cellOffsetToDayOffset(segmentCellOffsetFirst)==rangeDayOffsetStart;var isEnd=cellOffsetToDayOffset(segmentCellOffsetLast)+1==rangeDayOffsetEnd;segments.push({row:row,leftCol:cols[0],rightCol:cols[1],isStart:isStart,isEnd:isEnd});}}
return segments;}};;function DayEventRenderer(){var t=this;t.renderDayEvents=renderDayEvents;t.draggableDayEvent=draggableDayEvent;t.resizableDayEvent=resizableDayEvent;var opt=t.opt;var trigger=t.trigger;var isEventDraggable=t.isEventDraggable;var isEventResizable=t.isEventResizable;var eventEnd=t.eventEnd;var reportEventElement=t.reportEventElement;var eventElementHandlers=t.eventElementHandlers;var showEvents=t.showEvents;var hideEvents=t.hideEvents;var eventDrop=t.eventDrop;var eventResize=t.eventResize;var getRowCnt=t.getRowCnt;var getColCnt=t.getColCnt;var getColWidth=t.getColWidth;var allDayRow=t.allDayRow;var colLeft=t.colLeft;var colRight=t.colRight;var colContentLeft=t.colContentLeft;var colContentRight=t.colContentRight;var dateToCell=t.dateToCell;var getDaySegmentContainer=t.getDaySegmentContainer;var formatDates=t.calendar.formatDates;var renderDayOverlay=t.renderDayOverlay;var clearOverlays=t.clearOverlays;var clearSelection=t.clearSelection;var getHoverListener=t.getHoverListener;var rangeToSegments=t.rangeToSegments;var cellToDate=t.cellToDate;var cellToCellOffset=t.cellToCellOffset;var cellOffsetToDayOffset=t.cellOffsetToDayOffset;var dateToDayOffset=t.dateToDayOffset;var dayOffsetToCellOffset=t.dayOffsetToCellOffset;function renderDayEvents(events,modifiedEventId){var segments=_renderDayEvents(events,false,true);segmentElementEach(segments,function(segment,element){reportEventElement(segment.event,element);});attachHandlers(segments,modifiedEventId);segmentElementEach(segments,function(segment,element){trigger('eventAfterRender',segment.event,segment.event,element);});}
function renderTempDayEvent(event,adjustRow,adjustTop){var segments=_renderDayEvents([event],true,false);var elements=[];segmentElementEach(segments,function(segment,element){if(segment.row===adjustRow){element.css('top',adjustTop);}
elements.push(element[0]);});return elements;}
function _renderDayEvents(events,doAppend,doRowHeights){var finalContainer=getDaySegmentContainer();var renderContainer=doAppend?$("<div/>"):finalContainer;var segments=buildSegments(events);var html;var elements;calculateHorizontals(segments);html=buildHTML(segments);renderContainer[0].innerHTML=html;elements=renderContainer.children();if(doAppend){finalContainer.append(elements);}
resolveElements(segments,elements);segmentElementEach(segments,function(segment,element){segment.hsides=hsides(element,true);});segmentElementEach(segments,function(segment,element){element.width(Math.max(0,segment.outerWidth-segment.hsides));});segmentElementEach(segments,function(segment,element){segment.outerHeight=element.outerHeight(true);});setVerticals(segments,doRowHeights);return segments;}
function buildSegments(events){var segments=[];for(var i=0;i<events.length;i++){var eventSegments=buildSegmentsForEvent(events[i]);segments.push.apply(segments,eventSegments);}
return segments;}
function buildSegmentsForEvent(event){var startDate=event.start;var endDate=exclEndDay(event);var segments=rangeToSegments(startDate,endDate);for(var i=0;i<segments.length;i++){segments[i].event=event;}
return segments;}
function calculateHorizontals(segments){var isRTL=opt('isRTL');for(var i=0;i<segments.length;i++){var segment=segments[i];var leftFunc=(isRTL?segment.isEnd:segment.isStart)?colContentLeft:colLeft;var rightFunc=(isRTL?segment.isStart:segment.isEnd)?colContentRight:colRight;var left=leftFunc(segment.leftCol);var right=rightFunc(segment.rightCol);segment.left=left;segment.outerWidth=right-left;}}
function buildHTML(segments){var html='';for(var i=0;i<segments.length;i++){html+=buildHTMLForSegment(segments[i]);}
return html;}
function buildHTMLForSegment(segment){var html='';var isRTL=opt('isRTL');var event=segment.event;var url=event.url;var classNames=['fc-event','fc-event-hori'];if(isEventDraggable(event)){classNames.push('fc-event-draggable');}
if(segment.isStart){classNames.push('fc-event-start');}
if(segment.isEnd){classNames.push('fc-event-end');}
classNames=classNames.concat(event.className);if(event.source){classNames=classNames.concat(event.source.className||[]);}
var skinCss=getSkinCss(event,opt);if(url){html+="<a href='"+htmlEscape(url)+"'";}else{html+="<div";}
html+=" class='"+classNames.join(' ')+"'"+" style="+"'"+"position:absolute;"+"left:"+segment.left+"px;"+
skinCss+"'"+">"+"<div class='fc-event-inner'>";if(!event.allDay&&segment.isStart){html+="<span class='fc-event-time'>"+
htmlEscape(formatDates(event.start,event.end,opt('timeFormat')))+"</span>";}
html+="<span class='fc-event-title'>"+
htmlEscape(event.title||'')+"</span>"+"</div>";if(segment.isEnd&&isEventResizable(event)){html+="<div class='ui-resizable-handle ui-resizable-"+(isRTL?'w':'e')+"'>"+"&nbsp;&nbsp;&nbsp;"+"</div>";}
html+="</"+(url?"a":"div")+">";return html;}
function resolveElements(segments,elements){for(var i=0;i<segments.length;i++){var segment=segments[i];var event=segment.event;var element=elements.eq(i);var triggerRes=trigger('eventRender',event,event,element);if(triggerRes===false){element.remove();}
else{if(triggerRes&&triggerRes!==true){triggerRes=$(triggerRes).css({position:'absolute',left:segment.left});element.replaceWith(triggerRes);element=triggerRes;}
segment.element=element;}}}
function setVerticals(segments,doRowHeights){var rowContentHeights=calculateVerticals(segments);var rowContentElements=getRowContentElements();var rowContentTops=[];if(doRowHeights){for(var i=0;i<rowContentElements.length;i++){rowContentElements[i].height(rowContentHeights[i]);}}
for(var i=0;i<rowContentElements.length;i++){rowContentTops.push(rowContentElements[i].position().top);}
segmentElementEach(segments,function(segment,element){element.css('top',rowContentTops[segment.row]+segment.top);});}
function calculateVerticals(segments){var rowCnt=getRowCnt();var colCnt=getColCnt();var rowContentHeights=[];var segmentRows=buildSegmentRows(segments);for(var rowI=0;rowI<rowCnt;rowI++){var segmentRow=segmentRows[rowI];var colHeights=[];for(var colI=0;colI<colCnt;colI++){colHeights.push(0);}
for(var segmentI=0;segmentI<segmentRow.length;segmentI++){var segment=segmentRow[segmentI];segment.top=arrayMax(colHeights.slice(segment.leftCol,segment.rightCol+1));for(var colI=segment.leftCol;colI<=segment.rightCol;colI++){colHeights[colI]=segment.top+segment.outerHeight;}}
rowContentHeights.push(arrayMax(colHeights));}
return rowContentHeights;}
function buildSegmentRows(segments){var rowCnt=getRowCnt();var segmentRows=[];var segmentI;var segment;var rowI;for(segmentI=0;segmentI<segments.length;segmentI++){segment=segments[segmentI];rowI=segment.row;if(segment.element){if(segmentRows[rowI]){segmentRows[rowI].push(segment);}
else{segmentRows[rowI]=[segment];}}}
for(rowI=0;rowI<rowCnt;rowI++){segmentRows[rowI]=sortSegmentRow(segmentRows[rowI]||[]);}
return segmentRows;}
function sortSegmentRow(segments){var sortedSegments=[];var subrows=buildSegmentSubrows(segments);for(var i=0;i<subrows.length;i++){sortedSegments.push.apply(sortedSegments,subrows[i]);}
return sortedSegments;}
function buildSegmentSubrows(segments){segments.sort(compareDaySegments);var subrows=[];for(var i=0;i<segments.length;i++){var segment=segments[i];for(var j=0;j<subrows.length;j++){if(!isDaySegmentCollision(segment,subrows[j])){break;}}
if(subrows[j]){subrows[j].push(segment);}
else{subrows[j]=[segment];}}
return subrows;}
function getRowContentElements(){var i;var rowCnt=getRowCnt();var rowDivs=[];for(i=0;i<rowCnt;i++){rowDivs[i]=allDayRow(i).find('div.fc-day-content > div');}
return rowDivs;}
function attachHandlers(segments,modifiedEventId){var segmentContainer=getDaySegmentContainer();segmentElementEach(segments,function(segment,element,i){var event=segment.event;if(event._id===modifiedEventId){bindDaySeg(event,element,segment);}else{element[0]._fci=i;}});lazySegBind(segmentContainer,segments,bindDaySeg);}
function bindDaySeg(event,eventElement,segment){if(isEventDraggable(event)){t.draggableDayEvent(event,eventElement,segment);}
if(segment.isEnd&&isEventResizable(event)){t.resizableDayEvent(event,eventElement,segment);}
eventElementHandlers(event,eventElement);}
function draggableDayEvent(event,eventElement){var hoverListener=getHoverListener();var dayDelta;eventElement.draggable({delay:50,opacity:opt('dragOpacity'),revertDuration:opt('dragRevertDuration'),start:function(ev,ui){trigger('eventDragStart',eventElement,event,ev,ui);hideEvents(event,eventElement);hoverListener.start(function(cell,origCell,rowDelta,colDelta){eventElement.draggable('option','revert',!cell||!rowDelta&&!colDelta);clearOverlays();if(cell){var origDate=cellToDate(origCell);var date=cellToDate(cell);dayDelta=dayDiff(date,origDate);renderDayOverlay(addDays(cloneDate(event.start),dayDelta),addDays(exclEndDay(event),dayDelta));}else{dayDelta=0;}},ev,'drag');},stop:function(ev,ui){hoverListener.stop();clearOverlays();trigger('eventDragStop',eventElement,event,ev,ui);if(dayDelta){eventDrop(this,event,dayDelta,0,event.allDay,ev,ui);}else{eventElement.css('filter','');showEvents(event,eventElement);}}});}
function resizableDayEvent(event,element,segment){var isRTL=opt('isRTL');var direction=isRTL?'w':'e';var handle=element.find('.ui-resizable-'+direction);var isResizing=false;disableTextSelection(element);element.mousedown(function(ev){ev.preventDefault();}).click(function(ev){if(isResizing){ev.preventDefault();ev.stopImmediatePropagation();}});handle.mousedown(function(ev){if(ev.which!=1){return;}
isResizing=true;var hoverListener=getHoverListener();var rowCnt=getRowCnt();var colCnt=getColCnt();var elementTop=element.css('top');var dayDelta;var helpers;var eventCopy=$.extend({},event);var minCellOffset=dayOffsetToCellOffset(dateToDayOffset(event.start));clearSelection();$('body').css('cursor',direction+'-resize').one('mouseup',mouseup);trigger('eventResizeStart',this,event,ev);hoverListener.start(function(cell,origCell){if(cell){var origCellOffset=cellToCellOffset(origCell);var cellOffset=cellToCellOffset(cell);cellOffset=Math.max(cellOffset,minCellOffset);dayDelta=cellOffsetToDayOffset(cellOffset)-
cellOffsetToDayOffset(origCellOffset);if(dayDelta){eventCopy.end=addDays(eventEnd(event),dayDelta,true);var oldHelpers=helpers;helpers=renderTempDayEvent(eventCopy,segment.row,elementTop);helpers=$(helpers);helpers.find('*').css('cursor',direction+'-resize');if(oldHelpers){oldHelpers.remove();}
hideEvents(event);}
else{if(helpers){showEvents(event);helpers.remove();helpers=null;}}
clearOverlays();renderDayOverlay(event.start,addDays(exclEndDay(event),dayDelta));}},ev);function mouseup(ev){trigger('eventResizeStop',this,event,ev);$('body').css('cursor','');hoverListener.stop();clearOverlays();if(dayDelta){eventResize(this,event,dayDelta,0,ev);}
setTimeout(function(){isResizing=false;},0);}});}}
function isDaySegmentCollision(segment,otherSegments){for(var i=0;i<otherSegments.length;i++){var otherSegment=otherSegments[i];if(otherSegment.leftCol<=segment.rightCol&&otherSegment.rightCol>=segment.leftCol){return true;}}
return false;}
function segmentElementEach(segments,callback){for(var i=0;i<segments.length;i++){var segment=segments[i];var element=segment.element;if(element){callback(segment,element,i);}}}
function compareDaySegments(a,b){return(b.rightCol-b.leftCol)-(a.rightCol-a.leftCol)||b.event.allDay-a.event.allDay||a.event.start-b.event.start||(a.event.title||'').localeCompare(b.event.title)};;function SelectionManager(){var t=this;t.select=select;t.unselect=unselect;t.reportSelection=reportSelection;t.daySelectionMousedown=daySelectionMousedown;var opt=t.opt;var trigger=t.trigger;var defaultSelectionEnd=t.defaultSelectionEnd;var renderSelection=t.renderSelection;var clearSelection=t.clearSelection;var selected=false;if(opt('selectable')&&opt('unselectAuto')){$(document).mousedown(function(ev){var ignore=opt('unselectCancel');if(ignore){if($(ev.target).parents(ignore).length){return;}}
unselect(ev);});}
function select(startDate,endDate,allDay){unselect();if(!endDate){endDate=defaultSelectionEnd(startDate,allDay);}
renderSelection(startDate,endDate,allDay);reportSelection(startDate,endDate,allDay);}
function unselect(ev){if(selected){selected=false;clearSelection();trigger('unselect',null,ev);}}
function reportSelection(startDate,endDate,allDay,ev){selected=true;trigger('select',null,startDate,endDate,allDay,ev);}
function daySelectionMousedown(ev){var cellToDate=t.cellToDate;var getIsCellAllDay=t.getIsCellAllDay;var hoverListener=t.getHoverListener();var reportDayClick=t.reportDayClick;if(ev.which==1&&opt('selectable')){unselect(ev);var _mousedownElement=this;var dates;hoverListener.start(function(cell,origCell){clearSelection();if(cell&&getIsCellAllDay(cell)){dates=[cellToDate(origCell),cellToDate(cell)].sort(dateCompare);renderSelection(dates[0],dates[1],true);}else{dates=null;}},ev);$(document).one('mouseup',function(ev){hoverListener.stop();if(dates){if(+dates[0]==+dates[1]){reportDayClick(dates[0],true,ev);}
reportSelection(dates[0],dates[1],true,ev);}});}}};;function OverlayManager(){var t=this;t.renderOverlay=renderOverlay;t.clearOverlays=clearOverlays;var usedOverlays=[];var unusedOverlays=[];function renderOverlay(rect,parent){var e=unusedOverlays.shift();if(!e){e=$("<div class='fc-cell-overlay' style='position:absolute;z-index:3'/>");}
if(e[0].parentNode!=parent[0]){e.appendTo(parent);}
usedOverlays.push(e.css(rect).show());return e;}
function clearOverlays(){var e;while(e=usedOverlays.shift()){unusedOverlays.push(e.hide().unbind());}}};;function CoordinateGrid(buildFunc){var t=this;var rows;var cols;t.build=function(){rows=[];cols=[];buildFunc(rows,cols);};t.cell=function(x,y){var rowCnt=rows.length;var colCnt=cols.length;var i,r=-1,c=-1;for(i=0;i<rowCnt;i++){if(y>=rows[i][0]&&y<rows[i][1]){r=i;break;}}
for(i=0;i<colCnt;i++){if(x>=cols[i][0]&&x<cols[i][1]){c=i;break;}}
return(r>=0&&c>=0)?{row:r,col:c}:null;};t.rect=function(row0,col0,row1,col1,originElement){var origin=originElement.offset();return{top:rows[row0][0]-origin.top,left:cols[col0][0]-origin.left,width:cols[col1][1]-cols[col0][0],height:rows[row1][1]-rows[row0][0]};};};;function HoverListener(coordinateGrid){var t=this;var bindType;var change;var firstCell;var cell;t.start=function(_change,ev,_bindType){change=_change;firstCell=cell=null;coordinateGrid.build();mouse(ev);bindType=_bindType||'mousemove';$(document).bind(bindType,mouse);};function mouse(ev){_fixUIEvent(ev);var newCell=coordinateGrid.cell(ev.pageX,ev.pageY);if(!newCell!=!cell||newCell&&(newCell.row!=cell.row||newCell.col!=cell.col)){if(newCell){if(!firstCell){firstCell=newCell;}
change(newCell,firstCell,newCell.row-firstCell.row,newCell.col-firstCell.col);}else{change(newCell,firstCell);}
cell=newCell;}}
t.stop=function(){$(document).unbind(bindType,mouse);return cell;};}
function _fixUIEvent(event){if(event.pageX===undefined){event.pageX=event.originalEvent.pageX;event.pageY=event.originalEvent.pageY;}};;function HorizontalPositionCache(getElement){var t=this,elements={},lefts={},rights={};function e(i){return elements[i]=elements[i]||getElement(i);}
t.left=function(i){return lefts[i]=lefts[i]===undefined?e(i).position().left:lefts[i];};t.right=function(i){return rights[i]=rights[i]===undefined?t.left(i)+e(i).width():rights[i];};t.clear=function(){elements={};lefts={};rights={};};};;})(jQuery);;

/* /web_calendar/static/src/js/widgets.js defined in bundle 'web.assets_backend' */
odoo.define('web_calendar.widgets',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var form_common=require('web.form_common');var Widget=require('web.Widget');var _t=core._t;var QWeb=core.qweb;var QuickCreate=Dialog.extend({init:function(parent,dataset,buttons,options,data_template){this.dataset=dataset;this._buttons=buttons||false;this.options=options;this.data_template=data_template||{};this.$input=$();var self=this;this._super(parent,{title:this.get_title(),size:'small',buttons:this._buttons?[{text:_t("Create"),classes:'btn-primary',click:function(){if(!self.quick_add()){self.focus();}}},{text:_t("Edit"),click:function(){self.slow_add();}},{text:_t("Cancel"),close:true},]:[],$content:QWeb.render('CalendarView.quick_create',{widged:this})});},get_title:function(){var parent=this.getParent();if(_.isUndefined(parent)){return _t("Create");}
var title=(_.isUndefined(parent.field_widget))?(parent.title||parent.string||parent.name):(parent.field_widget.string||parent.field_widget.name||'');return _t("Create: ")+title;},start:function(){var self=this;if(this.options.disable_quick_create){this.slow_create();return;}
this.on('added',this,function(){self.close();});this.$input=this.$('input').keyup(function enterHandler(e){if(e.keyCode===$.ui.keyCode.ENTER){self.$input.off('keyup',enterHandler);if(!self.quick_add()){self.$input.on('keyup',enterHandler);}}else if(e.keyCode===$.ui.keyCode.ESCAPE&&self._buttons){self.close();}});return this._super();},focus:function(){this.$input.focus();},quick_add:function(){var val=this.$input.val().trim();return(val)?this.quick_create({'name':val}):false;},slow_add:function(){var val=this.$input.val().trim();this.slow_create(_.isEmpty(val)?{}:{'name':val});},quick_create:function(data,options){var self=this;return this.dataset.create($.extend({},this.data_template,data),options).then(function(id){self.trigger('added',id);self.$input.val("");},function(r,event){event.preventDefault();self.slow_create(data);});},slow_create:function(_data){var self=this;var def=$.Deferred();var defaults={};var created=false;_.each($.extend({},this.data_template,_data),function(val,field_name){defaults['default_'+field_name]=val;});var pop=new form_common.FormViewDialog(this,{res_model:this.dataset.model,context:this.dataset.get_context(defaults),title:this.get_title(),disable_multiple_selection:true,create_function:function(data,options){return self.dataset.create(data,options).fail(function(r){if(!r.data.message){throw new Error(r);}});},read_function:function(){return self.dataset.read_ids.apply(self.dataset,arguments).fail(function(r){if(!r.data.message){throw new Error(r);}});}}).open();pop.on('closed',self,function(){if(def.state()==="pending"){def.resolve();}});pop.on('create_completed',self,function(){created=true;self.trigger('slowadded');});def.then(function(){if(created){var parent=self.getParent();parent.$calendar.fullCalendar('refetchEvents');}
self.close();self.trigger("closed");});return def;},});var Sidebar=Widget.extend({template:'CalendarView.sidebar',start:function(){this.filter=new SidebarFilter(this,this.getParent());return $.when(this._super(),this.filter.appendTo(this.$el));}});var SidebarFilter=Widget.extend({events:{'click .o_calendar_contact':'on_click',},template:'CalendarView.sidebar.filters',init:function(parent,view){this._super(parent);this.view=view;},render:function(){var self=this;var filters=_.filter(this.view.get_all_filters_ordered(),function(filter){return _.contains(self.view.now_filter_ids,filter.value);});this.$('.o_calendar_contacts').html(QWeb.render('CalendarView.sidebar.contacts',{filters:filters}));},on_click:function(e){if(e.target.tagName!=='INPUT'){$(e.currentTarget).find('input').click();return;}
this.view.all_filters[e.target.value].is_checked=e.target.checked;this.trigger_up('reload_events');},});return{QuickCreate:QuickCreate,Sidebar:Sidebar,SidebarFilter:SidebarFilter};});;

/* /web_calendar/static/src/js/web_calendar.js defined in bundle 'web.assets_backend' */
odoo.define('web_calendar.CalendarView',function(require){"use strict";var core=require('web.core');var data=require('web.data');var form_common=require('web.form_common');var formats=require('web.formats');var Model=require('web.DataModel');var time=require('web.time');var utils=require('web.utils');var View=require('web.View');var widgets=require('web_calendar.widgets');var local_storage=require('web.local_storage');var CompoundDomain=data.CompoundDomain;var _t=core._t;var _lt=core._lt;var QWeb=core.qweb;function get_fc_defaultOptions(){var dateFormat=time.strftime_to_moment_format(_t.database.parameters.date_format);var timeFormat=time.strftime_to_moment_format(_t.database.parameters.time_format).replace('A','TT');var conversions=[['YYYY','yyyy'],['YY','y'],['DDDD','dddd'],['DD','dd']];_.each(conversions,function(conv){dateFormat=dateFormat.replace(conv[0],conv[1]);});var hourFormat=function(timeFormat){if(/H/.test(timeFormat))
return'HH:mm';return'hh TT';};return{weekNumberTitle:_t("W"),allDayText:_t("All day"),monthNames:moment.months(),monthNamesShort:moment.monthsShort(),dayNames:moment.weekdays(),dayNamesShort:moment.weekdaysShort(),firstDay:moment._locale._week.dow,weekNumberCalculation:function(date){return moment(date).week();},axisFormat:hourFormat(timeFormat),timeFormat:timeFormat+' {- '+timeFormat+'}',weekNumbers:true,titleFormat:{month:'MMMM yyyy',week:"w",day:dateFormat,},columnFormat:{month:'ddd',week:'ddd '+dateFormat,day:'dddd '+dateFormat,},weekMode:'liquid',snapMinutes:15,};}
function is_virtual_id(id){return typeof id==="string"&&id.indexOf('-')>=0;}
function isNullOrUndef(value){return _.isUndefined(value)||_.isNull(value);}
var CalendarView=View.extend({custom_events:{reload_events:function(){this.$calendar.fullCalendar('refetchEvents');},},defaults:_.extend({},View.prototype.defaults,{confirm_on_delete:true,}),display_name:_lt('Calendar'),events:{'click .o_calendar_sidebar_toggler':'toggle_full_width',},icon:'fa-calendar',quick_create_instance:widgets.QuickCreate,template:"CalendarView",init:function(){this._super.apply(this,arguments);this.color_map={};this.range_start=null;this.range_stop=null;this.selected_filters=[];this.info_fields=[];this.title=(this.options.action)?this.options.action.name:'';this.shown=$.Deferred();this.current_start=null;this.current_end=null;this.previous_ids=[];var attrs=this.fields_view.arch.attrs;if(!attrs.date_start){throw new Error(_t("Calendar view has not defined 'date_start' attribute."));}
this.fields=this.fields_view.fields;this.name=this.fields_view.name||attrs.string;this.mode=attrs.mode;this.date_start=attrs.date_start;this.date_delay=attrs.date_delay;this.date_stop=attrs.date_stop;this.all_day=attrs.all_day;this.how_display_event='';this.attendee_people=attrs.attendee;this.editable=!this.options.read_only_mode&&!this.fields[this.date_start].readonly;this.quick_add_pop=(isNullOrUndef(attrs.quick_add)||utils.toBoolElse(attrs.quick_add,true));if(!isNullOrUndef(attrs.display)){this.how_display_event=attrs.display;}
if(isNullOrUndef(attrs.event_open_popup)||!utils.toBoolElse(attrs.event_open_popup,true)){this.open_popup_action=false;}else{this.open_popup_action=attrs.event_open_popup;}
this.useContacts=!isNullOrUndef(attrs.use_contacts)&&_.str.toBool(attrs.use_contacts);this.colorIsAttendee=!(isNullOrUndef(attrs.color_is_attendee)||!utils.toBoolElse(attrs.color_is_attendee,true));if(isNullOrUndef(this.options.sidebar)){this.useContacts=false;this.colorIsAttendee=false;this.attendee_people=undefined;}
if(isNullOrUndef(attrs.avatar_model)){this.avatar_model=null;}else{this.avatar_model=attrs.avatar_model;}
if(isNullOrUndef(attrs.avatar_title)){this.avatar_title=this.avatar_model;}else{this.avatar_title=attrs.avatar_title;}
if(isNullOrUndef(attrs.avatar_filter)){this.avatar_filter=this.avatar_model;}else{this.avatar_filter=attrs.avatar_filter;}
this.color_field=attrs.color;if(this.color_field&&this.selected_filters.length===0){var default_filter;if((default_filter=this.dataset.context['calendar_default_'+this.color_field])){this.selected_filters.push(default_filter+'');}}
for(var fld=0;fld<this.fields_view.arch.children.length;fld++){this.info_fields.push(this.fields_view.arch.children[fld].attrs.name);}},willStart:function(){var self=this;var write_def=this.dataset.call("check_access_rights",["write",false]);var create_def=this.dataset.call("check_access_rights",["create",false]);return $.when(write_def,create_def,this._super()).then(function(write,create){self.write_right=write;self.create_right=create;});},start:function(){this.$calendar=this.$(".o_calendar_widget");this.$sidebar_container=this.$(".o_calendar_sidebar_container");this.$el.addClass(this.fields_view.arch.attrs.class);this.shown.done(this._do_show_init.bind(this));return this._super();},destroy:function(){if(this.$calendar){this.$calendar.fullCalendar('destroy');}
if(this.$small_calendar){this.$small_calendar.datepicker('destroy');}
this._super.apply(this,arguments);},_do_show_init:function(){this.init_calendar().then(function(){$(window).trigger('resize');});},render_buttons:function($node){var self=this;this.$buttons=$(QWeb.render("CalendarView.buttons",{'widget':this}));this.$buttons.on('click','button.o_calendar_button_new',function(){self.dataset.index=null;self.do_switch_view('form');});var bindCalendarButton=function(selector,arg1,arg2){self.$buttons.on('click',selector,_.bind(self.$calendar.fullCalendar,self.$calendar,arg1,arg2));};bindCalendarButton('.o_calendar_button_prev','prev');bindCalendarButton('.o_calendar_button_today','today');bindCalendarButton('.o_calendar_button_next','next');bindCalendarButton('.o_calendar_button_day','changeView','agendaDay');bindCalendarButton('.o_calendar_button_week','changeView','agendaWeek');bindCalendarButton('.o_calendar_button_month','changeView','month');this.$buttons.find('.o_calendar_button_'+this.mode).addClass('active');if($node){this.$buttons.appendTo($node);}else{this.$('.o_calendar_buttons').replaceWith(this.$buttons);}},toggle_full_width:function(){var full_width=(local_storage.getItem('web_calendar_full_width')!=='true');local_storage.setItem('web_calendar_full_width',full_width);this.toggle_sidebar(!full_width);this.$calendar.fullCalendar('render');},toggle_sidebar:function(display){this.sidebar.do_toggle(display);this.$('.o_calendar_sidebar_toggler').toggleClass('fa-close',display).toggleClass('fa-chevron-left',!display).attr('title',display?_('Close Sidebar'):_('Open Sidebar'));this.$sidebar_container.toggleClass('o_sidebar_hidden',!display);},get_fc_init_options:function(){var self=this;return $.extend({},get_fc_defaultOptions(),{defaultView:(this.mode=="month")?"month":((this.mode=="week")?"agendaWeek":((this.mode=="day")?"agendaDay":"agendaWeek")),header:false,selectable:!this.options.read_only_mode&&this.create_right,selectHelper:true,editable:this.editable,droppable:true,viewRender:function(view){var mode=(view.name=="month")?"month":((view.name=="agendaWeek")?"week":"day");if(self.$buttons!==undefined){self.$buttons.find('.active').removeClass('active');self.$buttons.find('.o_calendar_button_'+mode).addClass('active');}
var title=self.title+' ('+((mode==="week")?_t("Week "):"")+view.title+")";self.set({'title':title});self.$calendar.fullCalendar('option','height',Math.max(290,parseInt(self.$('.o_calendar_view').height())));setTimeout(function(){var $fc_view=self.$calendar.find('.fc-view');var width=$fc_view.find('> table').width();$fc_view.find('> div').css('width',(width>$fc_view.width())?width:'100%');},0);},windowResize:function(){self.$calendar.fullCalendar('render');},eventDrop:function(event,_day_delta,_minute_delta,_all_day,_revertFunc){var data=self.get_event_data(event);self.proxy('update_record')(event._id,data);},eventResize:function(event,_day_delta,_minute_delta,_revertFunc){var data=self.get_event_data(event);self.proxy('update_record')(event._id,data);},eventRender:function(event,element,view){element.find('.fc-event-title').html(event.title);},eventAfterRender:function(event,element,view){if((view.name!=='month')&&(((event.end-event.start)/60000)<=30)){var current_title=$(element.find('.fc-event-time')).text();var new_title=current_title.substr(0,current_title.indexOf("<img")>0?current_title.indexOf("<img"):current_title.length);element.find('.fc-event-time').html(new_title);}},eventClick:function(event){self.open_event(event._id,event.title);},select:function(start_date,end_date,all_day,_js_event,_view){var data_template=self.get_event_data({start:start_date,end:end_date,allDay:all_day,});self.open_quick_create(data_template);},unselectAuto:false,});},calendarMiniChanged:function(context){return function(datum,obj){var curView=context.$calendar.fullCalendar('getView');var curDate=new Date(obj.currentYear,obj.currentMonth,obj.currentDay);if(curView.name=="agendaWeek"){if(curDate<=curView.end&&curDate>=curView.start){context.$calendar.fullCalendar('changeView','agendaDay');}}
else if(curView.name!="agendaDay"||(curView.name=="agendaDay"&&moment(curDate).diff(moment(curView.start))===0)){context.$calendar.fullCalendar('changeView','agendaWeek');}
context.$calendar.fullCalendar('gotoDate',obj.currentYear,obj.currentMonth,obj.currentDay);};},init_calendar:function(){var defs=[];if(!this.sidebar){var translate=get_fc_defaultOptions();this.sidebar=new widgets.Sidebar(this);defs.push(this.sidebar.appendTo(this.$sidebar_container));this.$small_calendar=this.$(".o_calendar_mini");this.$small_calendar.datepicker({onSelect:this.calendarMiniChanged(this),dayNamesMin:translate.dayNamesShort,monthNames:translate.monthNamesShort,firstDay:translate.firstDay,});defs.push(this.extraSideBar());this.$sidebar_container.append($('<i>').addClass('o_calendar_sidebar_toggler fa'));this.toggle_sidebar((local_storage.getItem('web_calendar_full_width')!=='true'));}
this.$calendar.fullCalendar(this.get_fc_init_options());return $.when.apply($,defs);},extraSideBar:function(){return $.when();},get_quick_create_class:function(){return widgets.QuickCreate;},open_quick_create:function(data_template){if(!isNullOrUndef(this.quick)){return this.quick.close();}
var QuickCreate=this.get_quick_create_class();this.options.disable_quick_create=this.options.disable_quick_create||!this.quick_add_pop;this.quick=new QuickCreate(this,this.dataset,true,this.options,data_template);this.quick.on('added',this,this.quick_created).on('slowadded',this,this.slow_created).on('closed',this,function(){delete this.quick;this.$calendar.fullCalendar('unselect');});if(!this.options.disable_quick_create){this.quick.open();this.quick.focus();}else{this.quick.start();}},refresh_event:function(id){var self=this;if(is_virtual_id(id)){console.warn("Unwise use of refresh_event on a virtual ID.");}
this.dataset.read_ids([id],_.keys(this.fields)).done(function(incomplete_records){self.perform_necessary_name_gets(incomplete_records).then(function(records){var new_event=self.event_data_transform(records[0]);var event_objs=self.$calendar.fullCalendar('clientEvents',id);if(event_objs.length==1){var event_obj=event_objs[0];_(new_event).each(function(value,key){event_obj[key]=value;});self.$calendar.fullCalendar('updateEvent',event_obj);}else{var $fc_view=self.$calendar.find('.fc-view');var scrollPosition=$fc_view.scrollLeft();$fc_view.scrollLeft(0);self.$calendar.fullCalendar('renderEvent',new_event);$fc_view.scrollLeft(scrollPosition);self.$calendar.fullCalendar('clientEvents',id)[0].source=self.event_source;}});});},get_color:function(key){if(this.color_map[key]){return this.color_map[key];}
var index=(((_.keys(this.color_map).length+1)*5)%24)+1;this.color_map[key]=index;return index;},perform_necessary_name_gets:function(evts){var def=$.Deferred();var self=this;var to_get={};_(this.info_fields).each(function(fieldname){if(!_(["many2one"]).contains(self.fields[fieldname].type))
return;to_get[fieldname]=[];_(evts).each(function(evt){var value=evt[fieldname];if(value===false||(value instanceof Array)){return;}
to_get[fieldname].push(value);});if(to_get[fieldname].length===0){delete to_get[fieldname];}});var defs=_(to_get).map(function(ids,fieldname){return(new Model(self.fields[fieldname].relation)).call('name_get',ids).then(function(vals){return[fieldname,vals];});});$.when.apply(this,defs).then(function(){var values=arguments;_(values).each(function(value){var fieldname=value[0];var name_gets=value[1];_(name_gets).each(function(name_get){_(evts).chain().filter(function(e){return e[fieldname]==name_get[0];}).each(function(evt){evt[fieldname]=name_get;});});});def.resolve(evts);});return def;},event_data_transform:function(evt){var self=this;var date_start;var date_stop;var date_delay=evt[this.date_delay]||1.0,all_day=this.all_day?evt[this.all_day]:false,res_computed_text='',the_title='',attendees=[];if(!all_day){date_start=time.auto_str_to_date(evt[this.date_start]);date_stop=this.date_stop?time.auto_str_to_date(evt[this.date_stop]):null;}else{date_start=time.auto_str_to_date(evt[this.date_start].split(' ')[0],'start');date_stop=this.date_stop?time.auto_str_to_date(evt[this.date_stop].split(' ')[0],'start'):null;}
if(this.info_fields){var temp_ret={};res_computed_text=this.how_display_event;_.each(this.info_fields,function(fieldname){var value=evt[fieldname];if(_.contains(["many2one"],self.fields[fieldname].type)){if(value===false){temp_ret[fieldname]=null;}
else if(value instanceof Array){temp_ret[fieldname]=value[1];}
else if(_.contains(["date","datetime"],self.fields[fieldname].type)){temp_ret[fieldname]=formats.format_value(value,self.fields[fieldname]);}
else{throw new Error("Incomplete data received from dataset for record "+evt.id);}}
else if(_.contains(["one2many","many2many"],self.fields[fieldname].type)){if(value===false){temp_ret[fieldname]=null;}
else if(value instanceof Array){temp_ret[fieldname]=value;}
else{throw new Error("Incomplete data received from dataset for record "+evt.id);}}
else{temp_ret[fieldname]=value;}
res_computed_text=res_computed_text.replace("["+fieldname+"]",temp_ret[fieldname]);});if(res_computed_text.length){the_title=res_computed_text;}
else{var res_text=[];_.each(temp_ret,function(val,key){if(typeof(val)==='boolean'&&val===false){}
else{res_text.push(val);}});the_title=res_text.join(', ');}
the_title=_.escape(the_title);var the_title_avatar='';if(!_.isUndefined(this.attendee_people)){var MAX_ATTENDEES=3;var attendee_showed=0;var attendee_other='';_.each(temp_ret[this.attendee_people],function(the_attendee_people){attendees.push(the_attendee_people);attendee_showed+=1;if(attendee_showed<=MAX_ATTENDEES){if(self.avatar_model!==null){the_title_avatar+='<img title="'+_.escape(self.all_attendees[the_attendee_people])+'" class="o_attendee_head"  \
                                                        src="/web/image/'+self.avatar_model+'/'+the_attendee_people+'/image_small"></img>';}
else{if(!self.colorIsAttendee||the_attendee_people!=temp_ret[self.color_field]){var tempColor=(self.all_filters[the_attendee_people]!==undefined)?self.all_filters[the_attendee_people].color:(self.all_filters[-1]?self.all_filters[-1].color:1);the_title_avatar+='<i class="fa fa-user o_attendee_head o_underline_color_'+tempColor+'" title="'+_.escape(self.all_attendees[the_attendee_people])+'" ></i>';}}}
else{attendee_other+=_.escape(self.all_attendees[the_attendee_people])+", ";}});if(attendee_other.length>2){the_title_avatar+='<span class="o_attendee_head" title="'+attendee_other.slice(0,-2)+'">+</span>';}
the_title=the_title_avatar+the_title;}}
if(!date_stop&&date_delay){var m_start=moment(date_start).add(date_delay,'hours');date_stop=m_start.toDate();}
var r={'start':moment(date_start).toISOString(),'end':moment(date_stop).toISOString(),'title':the_title,'allDay':(this.fields[this.date_start].type=='date'||(this.all_day&&evt[this.all_day])||false),'id':evt.id,'attendees':attendees};var color_key=evt[this.color_field];if(!self.useContacts||self.all_filters[color_key]!==undefined){if(color_key){if(typeof color_key==="object"){color_key=color_key[0];}
r.className='o_calendar_color_'+this.get_color(color_key);}}else{r.className='o_calendar_color_'+(self.all_filters[-1]?self.all_filters[-1].color:1);}
return r;},get_event_data:function(event){var date_start_day;var date_stop_day;var diff_seconds;var data={name:event.title};var event_end=event.end;if(event_end===null){var m_date=moment(event.start).add(2,'hours');event_end=m_date.toDate();}
if(event.allDay){if(event_end===null||_.isUndefined(event_end)){event_end=new Date(event.start);}
if(this.all_day){date_start_day=new Date(Date.UTC(event.start.getFullYear(),event.start.getMonth(),event.start.getDate()));date_stop_day=new Date(Date.UTC(event_end.getFullYear(),event_end.getMonth(),event_end.getDate()));}
else{date_start_day=new Date(event.start.getFullYear(),event.start.getMonth(),event.start.getDate(),7);date_stop_day=new Date(event_end.getFullYear(),event_end.getMonth(),event_end.getDate(),19);}
data[this.date_start]=time.datetime_to_str(date_start_day);if(this.date_stop){data[this.date_stop]=time.datetime_to_str(date_stop_day);}
diff_seconds=Math.round((date_stop_day.getTime()-date_start_day.getTime())/1000);}
else{data[this.date_start]=time.datetime_to_str(event.start);if(this.date_stop){data[this.date_stop]=time.datetime_to_str(event_end);}
diff_seconds=Math.round((event_end.getTime()-event.start.getTime())/1000);}
if(this.all_day){data[this.all_day]=event.allDay;}
if(this.date_delay){data[this.date_delay]=diff_seconds/3600;}
return data;},do_search:function(domain,context,_group_by){var self=this;this.shown.done(function(){self._do_search(domain,context,_group_by);});},_do_search:function(domain,context,_group_by){var self=this;if(!self.all_filters){self.all_filters={};}
if(!_.isUndefined(this.event_source)){this.$calendar.fullCalendar('removeEventSource',this.event_source);}
this.event_source={events:function(start,end,callback){if(isNaN(start)||isNaN(end)){return;}
var current_event_source=self.event_source;var event_domain=self.get_range_domain(domain,start,end);if(self.useContacts&&(!self.all_filters[-1]||!self.all_filters[-1].is_checked)){var partner_ids=$.map(self.all_filters,function(o){if(o.is_checked){return o.value;}});if(!_.isEmpty(partner_ids)){event_domain=new data.CompoundDomain(event_domain,[[self.attendee_people,'in',partner_ids]]);}}
self.current_start=start;self.current_end=end;self.dataset.read_slice(_.keys(self.fields),{offset:0,domain:event_domain,context:context,}).done(function(events){if(self.current_start.getTime()!=start.getTime()||self.current_end.getTime()!=end.getTime()){self.dataset.ids=self.previous_ids;return;}
self.previous_ids=self.dataset.ids.slice();if(self.dataset.index===null){if(events.length){self.dataset.index=0;}}else if(self.dataset.index>=events.length){self.dataset.index=events.length?0:null;}
if(self.event_source!==current_event_source){console.log("Consecutive ``do_search`` called. Cancelling.");return;}
if(!self.useContacts){var filter_item;self.now_filter_ids=[];var color_field=self.fields[self.color_field];_.each(events,function(e){var key,val=null;if(color_field.type=="selection"){key=e[self.color_field];val=_.find(color_field.selection,function(name){return name[0]===key;});}else{key=e[self.color_field][0];val=e[self.color_field];}
if(!self.all_filters[key]){filter_item={value:key,label:val[1],color:self.get_color(key),avatar_model:(utils.toBoolElse(self.avatar_filter,true)?self.avatar_filter:false),is_checked:true};self.all_filters[key]=filter_item;}
if(!_.contains(self.now_filter_ids,key)){self.now_filter_ids.push(key);}});if(self.sidebar){self.sidebar.filter.render();events=$.map(events,function(e){var key=color_field.type=="selection"?e[self.color_field]:e[self.color_field][0];if(_.contains(self.now_filter_ids,key)&&self.all_filters[key].is_checked){return e;}
return null;});}}
var all_attendees=$.map(events,function(e){return e[self.attendee_people];});all_attendees=_.chain(all_attendees).flatten().uniq().value();self.all_attendees={};if(self.avatar_title!==null){new Model(self.avatar_title).query(["name"]).filter([["id","in",all_attendees]]).all().then(function(result){_.each(result,function(item){self.all_attendees[item.id]=item.name;});}).done(function(){return self.perform_necessary_name_gets(events).then(callback);});}
else{_.each(all_attendees,function(item){self.all_attendees[item]='';});return self.perform_necessary_name_gets(events).then(callback);}});},eventDataTransform:function(event){return self.event_data_transform(event);},};this.$calendar.fullCalendar('addEventSource',this.event_source);},get_range_domain:function(domain,start,end){var format=time.datetime_to_str;var extend_domain=[[this.date_start,'<=',format(end)]];if(this.date_stop){extend_domain.push([this.date_stop,'>=',format(start)]);}else if(!this.date_delay){extend_domain.push([this.date_start,'>=',format(start)]);}
return new CompoundDomain(domain,extend_domain);},get_all_filters_ordered:function(){return _.values(this.all_filters).sort(function(f1,f2){return _.string.naturalCmp(f1.label,f2.label);});},update_record:function(id,data){var self=this;var event_id;delete(data.name);var index=this.dataset.get_id_index(id);if(index!==null){event_id=this.dataset.ids[index];this.dataset.write(event_id,data,{}).always(function(){if(is_virtual_id(event_id)){self.$calendar.fullCalendar('refetchEvents');}else{self.refresh_event(event_id);}});}
return false;},open_event:function(id,title){var self=this;if(!this.open_popup_action){var index=this.dataset.get_id_index(id);this.dataset.index=index;if(this.write_right){this.do_switch_view('form',{mode:"edit"});}else{this.do_switch_view('form',{mode:"view"});}}
else{new form_common.FormViewDialog(this,{res_model:this.model,res_id:parseInt(id).toString()===id?parseInt(id):id,context:this.dataset.get_context(),title:title,view_id:+this.open_popup_action,readonly:true,buttons:[{text:_t("Edit"),classes:'btn-primary',close:true,click:function(){self.dataset.index=self.dataset.get_id_index(id);self.do_switch_view('form',{mode:"edit"});}},{text:_t("Delete"),close:true,click:function(){self.remove_event(id);}},{text:_t("Close"),close:true}]}).open();}
return false;},do_show:function(){this.do_push_state({});this.shown.resolve();return this._super();},is_action_enabled:function(action){if(action==='create'&&!this.options.creatable){return false;}
return this._super(action);},quick_created:function(id){this.dataset.ids=this.dataset.ids.concat([id]);this.dataset.trigger("dataset_changed",id);this.refresh_event(id);},slow_created:function(){var self=this;if(self.sidebar){self.sidebar.filter.is_loaded=false;}
self.$calendar.fullCalendar('refetchEvents');},remove_event:function(id){var self=this;function do_it(){return $.when(self.dataset.unlink([id])).then(function(){self.$calendar.fullCalendar('removeEvents',id);});}
if(this.options.confirm_on_delete){if(confirm(_t("Are you sure you want to delete this record ?"))){return do_it();}}else
return do_it();},});core.view_registry.add('calendar',CalendarView);return CalendarView;});;

/* /web_diagram/static/src/js/vec2.js defined in bundle 'web.assets_backend' */
(function(window){function Vec2(x,y){this.x=x;this.y=y;}
window.Vec2=Vec2;var rad2deg=57.29577951308232;var deg2rad=0.017453292519943295;var epsilon=0.0000001;Vec2.new_polar_deg=function(len,angle){var v=new Vec2(len,0);return v.rotate_deg(angle);};Vec2.new_polar=function(len,angle){var v=new Vec2(len,0);v.rotate(angle);return v;};Vec2.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y);};Vec2.prototype.len_sq=function(){return this.x*this.x+this.y*this.y;};Vec2.prototype.dist=function(v){var dx=this.x-v.x;var dy=this.y-v.y;return Math.sqrt(dx*dx+dy*dy);};Vec2.prototype.dist_xy=function(x,y){var dx=this.x-x;var dy=this.y-y;return Math.sqrt(dx*dx+dy*dy);};Vec2.prototype.dist_sq=function(v){var dx=this.x-v.x;var dy=this.y-v.y;return dx*dx+dy*dy;};Vec2.prototype.dist_sq_xy=function(x,y){var dx=this.x-x;var dy=this.y-y;return dx*dx+dy*dy;};Vec2.prototype.dot=function(v){return this.x*v.x+this.y*v.y;};Vec2.prototype.dot_xy=function(x,y){return this.x*x+this.y*y;};Vec2.prototype.clone=function(){return new Vec2(this.x,this.y);};Vec2.prototype.add=function(v){return new Vec2(this.x+v.x,this.y+v.y);};Vec2.prototype.add_xy=function(x,y){return new Vec2(this.x+x,this.y+y);};Vec2.prototype.sub=function(v){return new Vec2(this.x-v.x,this.y-v.y);};Vec2.prototype.sub_xy=function(x,y){return new Vec2(this.x-x,this.y-y);};Vec2.prototype.mult=function(v){return new Vec2(this.x*v.x,this.y*v.y);};Vec2.prototype.mult_xy=function(x,y){return new Vec2(this.x*x,this.y*y);};Vec2.prototype.scale=function(f){return new Vec2(this.x*f,this.y*f);};Vec2.prototype.neg=function(f){return new Vec2(-this.x,-this.y);};Vec2.prototype.normalize=function(){var len=this.len();if(len==0){return new Vec2(0,1);}else if(len!=1){return this.scale(1.0/len);}
return new Vec2(this.x,this.y);};Vec2.prototype.set_len=function(l){return this.normalize().scale(l);};Vec2.prototype.project=function(v){return v.set_len(this.dot(v));};Vec2.prototype.toString=function(){var str="";str+="[";str+=this.x;str+=",";str+=this.y;str+="]";return str;};Vec2.prototype.rotate=function(rad){var c=Math.cos(rad);var s=Math.sin(rad);var px=this.x*c-this.y*s;var py=this.x*s+this.y*c;return new Vec2(px,py);};Vec2.prototype.rotate_deg=function(deg){return this.rotate(deg*deg2rad);};Vec2.prototype.lerp=function(v,alpha){var inv_alpha=1-alpha;return new Vec2(this.x*inv_alpha+v.x*alpha,this.y*inv_alpha+v.y*alpha);};Vec2.prototype.angle=function(){return Math.atan2(this.y,this.x);};Vec2.prototype.angle_deg=function(){return Math.atan2(this.y,this.x)*rad2deg;};Vec2.prototype.equals=function(v){if(Math.abs(this.x-v.x)>epsilon){return false;}else if(Math.abs(this.y-v.y)>epsilon){return false;}
return true;};Vec2.prototype.equals_xy=function(x,y){if(Math.abs(this.x-x)>epsilon){return false;}else if(Math.abs(this.y-y)>epsilon){return false;}
return true;};})(window);(function(window){function BEllipse(cx,cy,rx,ry){this.type='ellipse';this.x=cx-rx;this.y=cy-ry;this.sx=2*rx;this.sy=2*ry;this.hx=rx;this.hy=ry;this.cx=cx;this.cy=cy;this.mx=cx+rx;this.my=cy+ry;}
window.BEllipse=BEllipse;BEllipse.prototype.collide_segment=function(a,b){var collisions=[];if(a.equals(b)){return collisions;}
var c=new Vec2(this.cx,this.cy);a=a.sub(c).mult_xy(1/this.hx,1/this.hy);b=b.sub(c).mult_xy(1/this.hx,1/this.hy);if(a.len_sq()<1&&b.len_sq()<1){return collisions;}
var ab=b.sub(a);var A=(ab.x*ab.x+ab.y*ab.y);var B=2*(ab.x*a.x+ab.y*a.y);var C=a.x*a.x+a.y*a.y-1;var u=B*B-4*A*C;if(u<0){return collisions;}
u=Math.sqrt(u);var u1=(-B+u)/(2*A);var u2=(-B-u)/(2*A);if(u1>=0&&u1<=1){var pos=a.add(ab.scale(u1));collisions.push(pos);}
if(u1!=u2&&u2>=0&&u2<=1){var pos=a.add(ab.scale(u2));collisions.push(pos);}
for(var i=0;i<collisions.length;i++){collisions[i]=collisions[i].mult_xy(this.hx,this.hy);collisions[i]=collisions[i].add_xy(this.cx,this.cy);}
return collisions;};function BRect(x,y,sx,sy){this.type='rect';this.x=x;this.y=y;this.sx=sx;this.sy=sy;this.hx=sx/2;this.hy=sy/2;this.cx=x+this.hx;this.cy=y+this.hy;this.mx=x+sx;this.my=y+sy;}
window.BRect=BRect;BRect.new_centered=function(cx,cy,sx,sy){return new BRect(cx-sx/2,cy-sy/2,sx,sy);};function line_intersect(a,b,c,d){var f=((d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y));if(f==0){return null;}
f=1/f;var fab=((d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x))*f;if(fab<0||fab>1){return null;}
var fcd=((b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x))*f;if(fcd<0||fcd>1){return null;}
return new Vec2(a.x+fab*(b.x-a.x),a.y+fab*(b.y-a.y));}
BRect.prototype.collide_segment=function(a,b){var collisions=[];var corners=[new Vec2(this.x,this.y),new Vec2(this.x,this.my),new Vec2(this.mx,this.my),new Vec2(this.mx,this.y)];var pos=line_intersect(a,b,corners[0],corners[1]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[1],corners[2]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[2],corners[3]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[3],corners[0]);if(pos)collisions.push(pos);return collisions;};BRect.prototype.contains_vec=function(vec){return(vec.x>=this.x&&vec.x<=this.mx&&vec.y>=this.y&&vec.y<=this.my);};BRect.prototype.contains_xy=function(x,y){return(x>=this.x&&x<=this.mx&&y>=this.y&&y<=this.my);};BEllipse.prototype.contains_vec=function(v){v=v.mult_xy(this.hx,this.hy);return v.len_sq()<=1;};BEllipse.prototype.contains_xy=function(x,y){return this.contains(new Vec2(x,y));};})(window);;

/* /web_diagram/static/src/js/graph.js defined in bundle 'web.assets_backend' */
(function(window){function EdgeEnd(pos_x,pos_y){this.x=pos_x;this.y=pos_y;this.get_pos=function(){return new Vec2(this.x,this.y);}}
function CloseButton(graph,entity,entity_type,pos_x,pos_y){var self=this;var visible=false;var close_button_radius=graph.style.close_button_radius||8;var close_circle=graph.r.circle(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,close_button_radius);close_circle.attr({'opacity':0,'fill':graph.style.close_button_color||"black",'cursor':'pointer','stroke':'none'});close_circle.transform(graph.get_transform());graph.set_scrolling(close_circle);var close_label=graph.r.text(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,"x");close_label.attr({'fill':graph.style.close_button_x_color||"white",'font-size':close_button_radius,'cursor':'pointer'});close_label.transform(graph.get_transform());graph.set_scrolling(close_label);var dummy_circle=graph.r.circle(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,close_button_radius);dummy_circle.attr({'opacity':1,'fill':'transparent','stroke':'none','cursor':'pointer'});dummy_circle.transform(graph.get_transform());graph.set_scrolling(dummy_circle);this.get_pos=function(){return entity.get_pos().add_xy(pos_x,pos_y);};this.update_pos=function(){var pos=self.get_pos();close_circle.attr({'cx':pos.x,'cy':pos.y});dummy_circle.attr({'cx':pos.x,'cy':pos.y});close_label.attr({'x':pos.x,'y':pos.y});};function hover_in(){if(!visible){return;}
close_circle.animate({'r':close_button_radius*1.5},300,'elastic');dummy_circle.animate({'r':close_button_radius*1.5},300,'elastic');}
function hover_out(){if(!visible){return;}
close_circle.animate({'r':close_button_radius},400,'linear');dummy_circle.animate({'r':close_button_radius},400,'linear');}
dummy_circle.hover(hover_in,hover_out);close_circle.hover(hover_in,hover_out);close_label.hover(hover_in,hover_out);function click_action(){if(!visible){return;}
close_circle.attr({'r':close_button_radius*2});dummy_circle.attr({'r':close_button_radius*2});close_circle.animate({'r':close_button_radius},400,'linear');dummy_circle.animate({'r':close_button_radius},400,'linear');if(entity_type=="node"){$.when(GraphNode.destruction_callback(entity)).done(function(){entity.remove();});}else if(entity_type=="edge"){$.when(GraphEdge.destruction_callback(entity)).done(function(){entity.remove();});}}
dummy_circle.click(click_action);close_circle.click(click_action);close_label.click(click_action);this.show=function(){if(!visible){close_circle.animate({'opacity':1},100,'linear');close_label.animate({'opacity':1},100,'linear');visible=true;}}
this.hide=function(){if(visible){close_circle.animate({'opacity':0},100,'linear');close_label.animate({'opacity':0},100,'linear');visible=false;}}
this.remove=function(){if(visible){visible=false;close_circle.animate({'opacity':0},100,'linear');close_label.animate({'opacity':0},100,'linear',self.remove);}else{close_circle.remove();close_label.remove();dummy_circle.remove();}}}
function Connector(graph,node,pos_x,pos_y){var visible=false;var conn_circle=graph.r.circle(node.get_pos().x+pos_x,node.get_pos().y+pos_y,4);conn_circle.attr({'opacity':0,'fill':graph.style.node_outline_color,'stroke':'none'});conn_circle.transform(graph.get_transform());graph.set_scrolling(conn_circle);var self=this;this.update_pos=function(){conn_circle.attr({'cx':node.get_pos().x+pos_x,'cy':node.get_pos().y+pos_y});};this.get_pos=function(){return new node.get_pos().add_xy(pos_x,pos_y);};this.remove=function(){conn_circle.remove();}
function hover_in(){if(!visible){return;}
conn_circle.animate({'r':8},300,'elastic');if(graph.creating_edge){graph.target_node=node;conn_circle.animate({'fill':graph.style.connector_active_color,'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_selected_width,},100,'linear');}}
function hover_out(){if(!visible){return;}
conn_circle.animate({'r':graph.style.connector_radius,'fill':graph.style.node_outline_color,'stroke':'none'},400,'linear');graph.target_node=null;}
conn_circle.hover(hover_in,hover_out);var drag_down=function(){if(!visible){return;}
self.ox=conn_circle.attr("cx");self.oy=conn_circle.attr("cy");self.edge_start=new EdgeEnd(self.ox,self.oy);self.edge_end=new EdgeEnd(self.ox,self.oy);self.edge_tmp=new GraphEdge(graph,'',self.edge_start,self.edge_end,true);graph.creating_edge=true;};var drag_move=function(dx,dy){if(!visible){return;}
self.edge_end.x=self.ox+dx;self.edge_end.y=self.oy+dy;self.edge_tmp.update();};var drag_up=function(){if(!visible){return;}
graph.creating_edge=false;self.edge_tmp.remove();if(graph.target_node){var edge_prop=GraphEdge.creation_callback(node,graph.target_node);if(edge_prop){var new_edge=new GraphEdge(graph,edge_prop.label,node,graph.target_node);GraphEdge.new_edge_callback(new_edge);}}};conn_circle.drag(drag_move,drag_down,drag_up);function show(){if(!visible){conn_circle.animate({'opacity':1},100,'linear');visible=true;}}
function hide(){if(visible){conn_circle.animate({'opacity':0},100,'linear');visible=false;}}
this.show=show;this.hide=hide;}
function Graph(r,style,viewport){var self=this;var nodes=[];var edges=[];var graph={};var links={};var uid=1;var selected_entity=null;self.creating_edge=false;self.target_node=null;self.r=r;self.style=style;var tr_x=0,tr_y=0;var background=r.rect(0,0,'100%','100%').attr({'fill':'white','stroke':'none','opacity':0,'cursor':'move'});this.get_transform=function(){return"T"+tr_x+","+tr_y};var translate_all=function(dx,dy){tr_x+=dx;tr_y+=dy;var tstr=self.get_transform();r.forEach(function(el){if(el!=background){el.transform(tstr);}});};var get_bounds=function(){var minx=Number.MAX_VALUE;var miny=Number.MAX_VALUE;var maxx=Number.MIN_VALUE;var maxy=Number.MIN_VALUE;for(var i=0;i<nodes.length;i++){var pos=nodes[i].get_pos();minx=Math.min(minx,pos.x);miny=Math.min(miny,pos.y);maxx=Math.max(maxx,pos.x);maxy=Math.max(maxy,pos.y);}
minx=minx-style.node_size_x/2+tr_x;miny=miny-style.node_size_y/2+tr_y;maxx=maxx+style.node_size_x/2+tr_x;maxy=maxy+style.node_size_y/2+tr_y;return{minx:minx,miny:miny,maxx:maxx,maxy:maxy};};var translation_respects_viewport=function(dx,dy,margin){if(!viewport){return true;}
margin=margin||0;var b=get_bounds();var width=viewport.offsetWidth;var height=viewport.offsetHeight;if((dy<0&&b.maxy+dy<margin)||(dy>0&&b.miny+dy>height-margin)||(dx<0&&b.maxx+dx<margin)||(dx>0&&b.minx+dx>width-margin)){return false;}
return true;}
this.set_scrolling=function(raph_element){$(raph_element.node).bind('mousewheel',function(event,delta){var dy=delta*20;if(translation_respects_viewport(0,dy,style.viewport_margin)){translate_all(0,dy);}});};var px,py;var bg_drag_down=function(){px=py=0;};var bg_drag_move=function(x,y){var dx=x-px;var dy=y-py;px=x;py=y;if(translation_respects_viewport(dx,dy,style.viewport_margin)){translate_all(dx,dy);}};var bg_drag_up=function(){};background.drag(bg_drag_move,bg_drag_down,bg_drag_up);this.set_scrolling(background);this.add_node=function(n){nodes.push(n);n.uid=uid++;};this.get_node_list=function(){return nodes;};this.add_edge=function(n1,n2,e){edges.push(e);e.uid=uid++;if(!graph[n1.uid])graph[n1.uid]={};if(!graph[n1.uid][n2.uid])graph[n1.uid][n2.uid]=[];if(!links[n1.uid])links[n1.uid]=[];if(!links[n2.uid])links[n2.uid]=[];graph[n1.uid][n2.uid].push(e);links[n1.uid].push(e);if(n1!=n2){links[n2.uid].push(e);}};this.remove_edge=function(edge){edges=_.without(edges,edge);var n1=edge.get_start();var n2=edge.get_end();links[n1.uid]=_.without(links[n1.uid],edge);links[n2.uid]=_.without(links[n2.uid],edge);graph[n1.uid][n2.uid]=_.without(graph[n1.uid][n2.uid],edge);if(selected_entity==edge){selected_entity=null;}};this.remove_node=function(node){var linked_edges=self.get_linked_edge_list(node);for(var i=0;i<linked_edges.length;i++){linked_edges[i].remove();}
nodes=_.without(nodes,node);if(selected_entity==node){selected_entity=null;}}
this.get_edge_list=function(n1,n2){var list=[];if(!graph[n1.uid])return list;if(!graph[n1.uid][n2.uid])return list;return graph[n1.uid][n2.uid];};this.get_linked_edge_list=function(n){if(!links[n.uid])return[];return links[n.uid];};this.get_edge_curvature=function(n1,n2,e){var el_12=this.get_edge_list(n1,n2);var c12=el_12.length;var el_21=this.get_edge_list(n2,n1);var c21=el_21.length;if(c12+c21==1){return 0;}else{var index=0;for(var i=0;i<c12;i++){if(el_12[i].uid<e.uid){index++;}}
if(c21==0){return index-(c12-1)/2.0;}else{return index+0.5;}}};this.get_loop_angle=function(n,e){var loop_list=this.get_edge_list(n,n);var slots=[];for(var angle=0;angle<360;angle+=45){slots.push(Vec2.new_polar_deg(1,angle));}
var links=this.get_linked_edge_list(n);for(var i=0;i<links.length;i++){var edge=links[i];if(!edge.is_loop||edge.is_loop()){continue;}
var end=edge.get_end();if(end==n){end=edge.get_start();}
var dir=end.get_pos().sub(n.get_pos()).normalize();for(var s=0;s<slots.length;s++){var score=slots[s].dot(dir);if(score<0){score=-0.2*Math.pow(score,2);}else{score=Math.pow(score,2);}
if(!slots[s].score){slots[s].score=score;}else{slots[s].score+=score;}}}
slots.sort(function(a,b){return a.score<b.score?-1:1;});var index=0;for(var i=0;i<links.length;i++){var edge=links[i];if(!edge.is_loop||!edge.is_loop()){continue;}
if(edge.uid<e.uid){index++;}}
index%=slots.length;return slots[index].angle_deg();}
this.select=function(entity){if(selected_entity){if(selected_entity==entity){return;}else{if(selected_entity.set_not_selected){selected_entity.set_not_selected();}
selected_entity=null;}}
selected_entity=entity;if(entity&&entity.set_selected){entity.set_selected();}};}
function GraphNode(graph,pos_x,pos_y,label,type,color){var self=this;var r=graph.r;var sy=graph.style.node_size_y;var sx=graph.style.node_size_x;var node_fig=null;var selected=false;this.connectors=[];this.close_button=null;this.uid=0;graph.add_node(this);if(type=='circle'){node_fig=r.ellipse(pos_x,pos_y,sx/2,sy/2);}else{node_fig=r.rect(pos_x-sx/2,pos_y-sy/2,sx,sy);}
node_fig.attr({'fill':color,'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_outline_width,'cursor':'pointer'});node_fig.transform(graph.get_transform());graph.set_scrolling(node_fig);var node_label=r.text(pos_x,pos_y,label);node_label.attr({'fill':graph.style.node_label_color,'font-size':graph.style.node_label_font_size,'cursor':'pointer'});node_label.transform(graph.get_transform());graph.set_scrolling(node_label);var update_linked_edges=function(){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].update();}};var set_pos=function(pos){if(type=='circle'){node_fig.attr({'cx':pos.x,'cy':pos.y});}else{node_fig.attr({'x':pos.x-sx/2,'y':pos.y-sy/2});}
node_label.attr({'x':pos.x,'y':pos.y});for(var i=0;i<self.connectors.length;i++){self.connectors[i].update_pos();}
if(self.close_button){self.close_button.update_pos();}
update_linked_edges();};var get_fig=function(){return node_fig;};var get_pos=function(){if(type=='circle'){return new Vec2(node_fig.attr('cx'),node_fig.attr('cy'));}else{return new Vec2(node_fig.attr('x')+sx/2,node_fig.attr('y')+sy/2);}};var get_label=function(){return node_label.attr("text");};var set_label=function(text){node_label.attr({'text':text});};var get_bound=function(){if(type=='circle'){return new BEllipse(get_pos().x,get_pos().y,sx/2,sy/2);}else{return BRect.new_centered(get_pos().x,get_pos().y,sx,sy);}};var set_selected=function(){if(!selected){selected=true;node_fig.attr({'stroke':graph.style.node_selected_color,'stroke-width':graph.style.node_selected_width});if(!self.close_button){self.close_button=new CloseButton(graph,self,"node",sx/2,-sy/2);self.close_button.show();}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].show();}}};var set_not_selected=function(){if(selected){node_fig.animate({'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_outline_width},100,'linear');if(self.close_button){self.close_button.remove();self.close_button=null;}
selected=false;}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].hide();}};var remove=function(){if(self.close_button){self.close_button.remove();}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].remove();}
graph.remove_node(self);node_fig.remove();node_label.remove();}
this.set_pos=set_pos;this.get_pos=get_pos;this.set_label=set_label;this.get_label=get_label;this.get_bound=get_bound;this.get_fig=get_fig;this.set_selected=set_selected;this.set_not_selected=set_not_selected;this.update_linked_edges=update_linked_edges;this.remove=remove;var click_action=function(){if(type=='circle'){node_fig.attr({'rx':sx/2+3,'ry':sy/2+3});node_fig.animate({'rx':sx/2,'ry':sy/2},500,'elastic');}else{var cx=get_pos().x;var cy=get_pos().y;node_fig.attr({'x':cx-(sx/2)-3,'y':cy-(sy/2)-3,'ẃidth':sx+6,'height':sy+6});node_fig.animate({'x':cx-sx/2,'y':cy-sy/2,'ẃidth':sx,'height':sy},500,'elastic');}
graph.select(self);};node_fig.click(click_action);node_label.click(click_action);var drag_down=function(){this.opos=get_pos();};var drag_move=function(dx,dy){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].label_disable();}
if(self.close_button){self.close_button.hide();}
set_pos(this.opos.add_xy(dx,dy));};var drag_up=function(){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].label_enable();}
if(self.close_button){self.close_button.show();}};node_fig.drag(drag_move,drag_down,drag_up);node_label.drag(drag_move,drag_down,drag_up);function hover_in(){if(graph.creating_edge){graph.target_node=self;}}
function hover_out(){graph.target_node=null;}
node_fig.hover(hover_in,hover_out);node_label.hover(hover_in,hover_out);function double_click(){GraphNode.double_click_callback(self);}
node_fig.dblclick(double_click);node_label.dblclick(double_click);this.connectors.push(new Connector(graph,this,-sx/2,0));this.connectors.push(new Connector(graph,this,sx/2,0));this.connectors.push(new Connector(graph,this,0,-sy/2));this.connectors.push(new Connector(graph,this,0,sy/2));this.close_button=new CloseButton(graph,this,"node",sx/2,-sy/2);}
GraphNode.double_click_callback=function(node){console.log("double click from node:",node);};GraphNode.destruction_callback=function(node){return true;};function GraphEdge(graph,label,start,end,tmp){var self=this;var r=graph.r;var curvature=0;var s,e;var mc;var mc1,mc2;var elfs=graph.style.edge_label_font_size||10;var label_enabled=true;this.uid=0;var edge_path="";var selected=false;if(!tmp){graph.add_edge(start,end,this);}
function get_label_pos(path){var cpos=path.getTotalLength()*0.5;var cindex=Math.abs(Math.floor(curvature));var mod=((cindex%3))*(elfs*3.1)-(elfs*0.5);var verticality=Math.abs(end.get_pos().sub(start.get_pos()).normalize().dot_xy(0,1));verticality=Math.max(verticality-0.5,0)*2;var lpos=path.getPointAtLength(cpos+mod*verticality);return new Vec2(lpos.x,lpos.y-elfs*(1-verticality));}
this.get_pos=function(){if(!edge){return start.get_pos().lerp(end.get_pos(),0.5);}
return get_label_pos(edge);}
function make_line(){return"M"+s.x+","+s.y+"L"+e.x+","+e.y;}
function make_curve(){return"M"+s.x+","+s.y+"Q"+mc.x+","+mc.y+" "+e.x+","+e.y;}
function make_loop(){return"M"+s.x+" "+s.y+"C"+mc1.x+" "+mc1.y+" "+mc2.x+" "+mc2.y+" "+e.x+" "+e.y;}
function update_curve(){if(start!=end){if(!tmp){curvature=graph.get_edge_curvature(start,end,self);}else{curvature=0;}
s=start.get_pos();e=end.get_pos();mc=s.lerp(e,0.5);var se=e.sub(s);se=se.normalize();se=se.rotate_deg(-90);se=se.scale(curvature*graph.style.edge_spacing);mc=mc.add(se);if(start.get_bound){var col=start.get_bound().collide_segment(s,mc);if(col.length>0){s=col[0];}}
if(end.get_bound){var col=end.get_bound().collide_segment(mc,e);if(col.length>0){e=col[0];}}
if(curvature!=0){edge_path=make_curve();}else{edge_path=make_line();}}else{var rad=graph.style.edge_loop_radius||100;s=start.get_pos();e=end.get_pos();var r=Vec2.new_polar_deg(rad,graph.get_loop_angle(start,self));mc=s.add(r);var p=r.rotate_deg(90);mc1=mc.add(p.set_len(rad*0.5));mc2=mc.add(p.set_len(-rad*0.5));if(start.get_bound){var col=start.get_bound().collide_segment(s,mc1);if(col.length>0){s=col[0];}
var col=start.get_bound().collide_segment(e,mc2);if(col.length>0){e=col[0];}}
edge_path=make_loop();}}
update_curve();var edge=r.path(edge_path).attr({'stroke':graph.style.edge_color,'stroke-width':graph.style.edge_width,'arrow-end':'block-wide-long','cursor':'pointer'}).insertBefore(graph.get_node_list()[0].get_fig());var labelpos=get_label_pos(edge);var edge_label=r.text(labelpos.x,labelpos.y-elfs,label).attr({'fill':graph.style.edge_label_color,'cursor':'pointer','font-size':elfs});edge.transform(graph.get_transform());graph.set_scrolling(edge);edge_label.transform(graph.get_transform());graph.set_scrolling(edge_label);if(!tmp){var edges_start=graph.get_linked_edge_list(start);var edges_end=graph.get_linked_edge_list(end);var edges=edges_start.length<edges_end.length?edges_start:edges_end;for(var i=0;i<edges.length;i++){if(edges[i]!=self){edges[i].update();}}}
function label_enable(){if(!label_enabled){label_enabled=true;edge_label.animate({'opacity':1},100,'linear');if(self.close_button){self.close_button.show();}
self.update();}}
function label_disable(){if(label_enabled){label_enabled=false;edge_label.animate({'opacity':0},100,'linear');if(self.close_button){self.close_button.hide();}}}
function update(){update_curve();edge.attr({'path':edge_path});if(label_enabled){var labelpos=get_label_pos(edge);edge_label.attr({'x':labelpos.x,'y':labelpos.y-14});}}
function remove(){edge.remove();edge_label.remove();if(!tmp){graph.remove_edge(self);}
if(start.update_linked_edges){start.update_linked_edges();}
if(start!=end&&end.update_linked_edges){end.update_linked_edges();}
if(self.close_button){self.close_button.remove();}}
this.set_selected=function(){if(!selected){selected=true;edge.attr({'stroke':graph.style.node_selected_color,'stroke-width':graph.style.node_selected_width});edge_label.attr({'fill':graph.style.node_selected_color});if(!self.close_button){self.close_button=new CloseButton(graph,self,"edge",0,30);self.close_button.show();}}};this.set_not_selected=function(){if(selected){selected=false;edge.animate({'stroke':graph.style.edge_color,'stroke-width':graph.style.edge_width},100,'linear');edge_label.animate({'fill':graph.style.edge_label_color},100,'linear');if(self.close_button){self.close_button.remove();self.close_button=null;}}};function click_action(){graph.select(self);}
edge.click(click_action);edge_label.click(click_action);function double_click_action(){GraphEdge.double_click_callback(self);}
edge.dblclick(double_click_action);edge_label.dblclick(double_click_action);this.label_enable=label_enable;this.label_disable=label_disable;this.update=update;this.remove=remove;this.is_loop=function(){return start==end;};this.get_start=function(){return start;};this.get_end=function(){return end;};}
GraphEdge.double_click_callback=function(edge){console.log("double click from edge:",edge);};GraphEdge.creation_callback=function(start,end){var edge_prop={};edge_prop.label='new edge!';return edge_prop;};GraphEdge.new_edge_callback=function(new_edge){};GraphEdge.destruction_callback=function(edge){return true;};function wordwrap(str,width){width=width||32;var cut=true;var brk='\n';if(!str){return str;}
var regex='.{1,'+width+'}(\\s|$)'+(cut?'|.{'+width+'}|.+$':'|\\S+?(\\s|$)');return str.match(new RegExp(regex,'g')).join(brk);}
window.CuteGraph=Graph;window.CuteNode=GraphNode;window.CuteEdge=GraphEdge;window.CuteGraph.wordwrap=wordwrap;})(window);;

/* /web_diagram/static/src/js/diagram.js defined in bundle 'web.assets_backend' */
odoo.define('web_diagram.DiagramView',function(require){"use strict";var core=require('web.core');var data=require('web.data');var form_common=require('web.form_common');var Pager=require('web.Pager');var View=require('web.View');var ajax=require('web.ajax');var _t=core._t;var _lt=core._lt;var QWeb=core.qweb;var DiagramView=View.extend({display_name:_lt('Diagram'),icon:'fa-code-fork',multi_record:false,searchable:false,init:function(){this._super.apply(this,arguments);this.domain=this.dataset._domain||[];this.context={};this.ids=this.dataset.ids;if(this.ids&&this.ids.length){this.id=this.ids[this.dataset.index||0];}
this.fields=this.fields_view.fields;this.nodes=this.fields_view.arch.children[0];this.connectors=this.fields_view.arch.children[1];this.node=this.nodes.attrs.object;this.connector=this.connectors.attrs.object;this.labels=_.filter(this.fields_view.arch.children,function(label){return label.tag==="label";});},willStart:function(){if(window.Raphael){return $.when();}
return $.when(ajax.loadJS('/web_diagram/static/lib/js/jquery.mousewheel.js'),ajax.loadJS('/web_diagram/static/lib/js/raphael.js'));},start:function(){var self=this;this.$el.html(QWeb.render("DiagramView",{'widget':this}));this.$el.addClass('o_diagram_view').addClass(this.fields_view.arch.attrs.class);_.each(this.labels,function(label){self.$('.o_diagram_header').append($('<span>').html(label.attrs.string));});var diagram_info;if(this.id){diagram_info=this.get_diagram_info();}
return $.when(this._super(),diagram_info);},toTitleCase:function(str){return str.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase();});},get_diagram_info:function(){var self=this;var params={'id':this.id,'model':this.model,'node':this.node,'connector':this.connector,'bgcolor':this.nodes.attrs.bgcolor,'shape':this.nodes.attrs.shape,'src_node':this.connectors.attrs.source,'des_node':this.connectors.attrs.destination,'label':this.connectors.attrs.label||false,'visible_nodes':[],'invisible_nodes':[],'node_fields':[],'connectors':[],'connectors_fields':[]};_.each(this.nodes.children,function(child){if(child.attrs.invisible==='1')
params.invisible_nodes.push(child.attrs.name);else{params.visible_nodes.push(child.attrs.name);params.node_fields.push(self.fields[child.attrs.name]['string']||this.toTitleCase(child.attrs.name));}});_.each(this.connectors.children,function(conn){params.connectors_fields.push(self.fields[conn.attrs.name]['string']||this.toTitleCase(conn.attrs.name));params.connectors.push(conn.attrs.name);});return this.rpc('/web_diagram/diagram/get_diagram_info',params).done(function(result){self.draw_diagram(result);});},on_diagram_loaded:function(record){this.set({'title':record.id?record.name:_t("New")});var id_record=record['id'];if(id_record){this.id=id_record;this.get_diagram_info();this.do_push_state({id:id_record});}else{this.do_push_state({});}},do_load_state:function(state,warm){if(state&&state.id){if(!this.dataset.get_id_index(state.id)){this.dataset.ids.push(state.id);}
this.dataset.select_id(state.id);if(warm){this.do_show();}}},draw_diagram:function(result){var self=this;var res_nodes=result['nodes'];var res_edges=result['conn'];this.parent_field=result.parent_field;var id_to_node={};var style={edge_color:"#A0A0A0",edge_label_color:"#555",edge_label_font_size:10,edge_width:2,edge_spacing:100,edge_loop_radius:100,node_label_color:"#333",node_label_font_size:12,node_outline_color:"#333",node_outline_width:1,node_selected_color:"#0097BE",node_selected_width:2,node_size_x:110,node_size_y:80,connector_active_color:"#FFF",connector_radius:4,close_button_radius:8,close_button_color:"#333",close_button_x_color:"#FFF",gray:"#DCDCDC",white:"#FFF",viewport_margin:50};var canvas=self.$('.o_diagram').empty().get(0);var r=new Raphael(canvas,'100%','100%');var graph=new CuteGraph(r,style,canvas.parentNode);_.each(res_nodes,function(node){var n=new CuteNode(graph,node.x+50,node.y+50,CuteGraph.wordwrap(node.name,14),node.shape==='rectangle'?'rect':'circle',node.color==='white'?style.white:style.gray);n.id=node.id;id_to_node[node.id]=n;});_.each(res_edges,function(edge){var e=new CuteEdge(graph,CuteGraph.wordwrap(edge.signal,32),id_to_node[edge.s_id],id_to_node[edge.d_id]||id_to_node[edge.s_id]);e.id=edge.id;});CuteNode.double_click_callback=function(cutenode){self.edit_node(cutenode.id);};CuteNode.destruction_callback=function(cutenode){if(!confirm(_t("Deleting this node cannot be undone.\nIt will also delete all connected transitions.\n\nAre you sure ?"))){return $.Deferred().reject().promise();}
return new data.DataSet(self,self.node).unlink([cutenode.id]);};CuteEdge.double_click_callback=function(cuteedge){self.edit_connector(cuteedge.id);};CuteEdge.creation_callback=function(node_start,node_end){return{label:''};};CuteEdge.new_edge_callback=function(cuteedge){self.add_connector(cuteedge.get_start().id,cuteedge.get_end().id,cuteedge);};CuteEdge.destruction_callback=function(cuteedge){if(!confirm(_t("Deleting this transition cannot be undone.\n\nAre you sure ?"))){return $.Deferred().reject().promise();}
return new data.DataSet(self,self.connector).unlink([cuteedge.id]);};},edit_node:function(node_id){var self=this;var title=_t('Activity');var pop=new form_common.FormViewDialog(self,{res_model:self.node,res_id:node_id,context:self.context||self.dataset.context,title:_t("Open: ")+title}).open();pop.on('write_completed',self,function(){self.dataset.read_index(_.keys(self.fields_view.fields)).then(self.on_diagram_loaded);});pop.opened().then(function(){var form_controller=pop.view_form;var field=form_controller.fields[self.parent_field];if(field){field.$input.prop('disabled',true);field.$dropdown.unbind();}});},add_node:function(){var self=this;var title=_t('Activity');var pop=new form_common.FormViewDialog(self,{res_model:self.node,domain:self.domain,context:self.context||self.dataset.context,title:_t("Create:")+title,disable_multiple_selection:true,on_selected:function(element_ids){self.dataset.read_index(_.keys(self.fields_view.fields)).then(self.on_diagram_loaded);}}).open();pop.opened().then(function(){var form_controller=pop.view_form;var field=form_controller.fields[self.parent_field];if(field){field.set_value(self.id);field.dirty=true;}});},edit_connector:function(connector_id){var self=this;var title=_t('Transition');var pop=new form_common.FormViewDialog(self,{res_model:self.connector,res_id:parseInt(connector_id,10),context:self.context||self.dataset.context,title:_t("Open: ")+title}).open();pop.on('write_completed',self,function(){self.dataset.read_index(_.keys(self.fields_view.fields)).then(self.on_diagram_loaded);});},add_connector:function(node_source_id,node_dest_id,dummy_cuteedge){var self=this;var title=_t('Transition');var pop=new form_common.FormViewDialog(self,{res_model:self.connector,domain:this.domain,context:this.context||this.dataset.context,title:_t("Create:")+title,disable_multiple_selection:true,on_selected:function(element_ids){self.dataset.read_index(_.keys(self.fields_view.fields)).then(self.on_diagram_loaded);}}).open();pop.$el.parents('.modal').on('hidden.bs.modal',function(e){if(dummy_cuteedge){dummy_cuteedge.remove();}});pop.opened().then(function(){var form_controller=pop.view_form;var source_field=form_controller.fields[self.connectors.attrs.source];var destination_field=form_controller.fields[self.connectors.attrs.destination];source_field.set_value(node_source_id);source_field.dirty=true;destination_field.set_value(node_dest_id);destination_field.dirty=true;});},render_buttons:function($node){var self=this;this.$buttons=$(QWeb.render("DiagramView.buttons",{'widget':this}));this.$buttons.on('click','.o_diagram_new_button',function(){self.add_node();});this.$buttons.appendTo($node);},render_pager:function($node){var self=this;this.pager=new Pager(this,this.dataset.ids.length,this.dataset.index+1,1);this.pager.appendTo($node||this.options.$pager);this.pager.on('pager_changed',this,function(new_state){this.pager.disable();this.dataset.index=new_state.current_min-1;$.when(this.reload()).then(function(){self.pager.enable();});});},update_pager:function(){if(this.pager){this.pager.update_state({size:this.dataset.ids.length,current_min:this.dataset.index+1,});}},reload:function(){return this.dataset.read_index(_.keys(this.fields_view.fields)).then(this.on_diagram_loaded).then(this.proxy('update_pager'));},do_show:function(){this.do_push_state({});return $.when(this._super(),this.reload());}});core.view_registry.add('diagram',DiagramView);return DiagramView;});;

/* /web_editor/static/src/js/backend.js defined in bundle 'web.assets_backend' */
odoo.define('web_editor.backend',function(require){'use strict';var core=require('web.core');var session=require('web.session');var Model=require('web.DataModel');var common=require('web.form_common');var base=require('web_editor.base');var editor=require('web_editor.editor');var summernote=require('web_editor.summernote');var transcoder=require('web_editor.transcoder');var QWeb=core.qweb;var _t=core._t;var widget=common.AbstractField.extend(common.ReinitializeFieldMixin);var FieldTextHtmlSimple=widget.extend({template:'web_editor.FieldTextHtmlSimple',_config:function(){var self=this;var config={'focus':false,'height':180,'toolbar':[['style',['style']],['font',['bold','italic','underline','clear']],['fontsize',['fontsize']],['color',['color']],['para',['ul','ol','paragraph']],['table',['table']],['insert',['link','picture']],['history',['undo','redo']]],'prettifyHtml':false,'styleWithSpan':false,'inlinemedia':['p'],'lang':"odoo",'onChange':function(value){self.internal_set_value(value);self.trigger('changed_value');}};if(session.debug){config.toolbar.splice(7,0,['view',['codeview']]);}
return config;},start:function(){var def=this._super.apply(this,arguments);this.$translate.remove();this.$translate=$();this.$content.trigger('mouseup');return def;},initialize_content:function(){var self=this;this.$textarea=this.$("textarea").val(this.get('value')||"<p><br/></p>");this.$content=$();if(this.get("effective_readonly")){if(this.options['style-inline']){var $iframe=$('<iframe class="o_readonly"/>');this.$textarea.hide().after($iframe);var load=function(){self.$content=$($iframe.contents()[0]).find("body");self.$content.html(self.text_to_html(self.get('value')));self.resize();};setTimeout(load);$iframe.on('load',load);}else{this.$content=$('<div class="o_readonly"/>');this.$textarea.hide().after(this.$content);}}else{this.$textarea.summernote(this._config());if(this.field.translate&&this.view){$(QWeb.render('web_editor.FieldTextHtml.button.translate',{'widget':this})).appendTo(this.$('.note-toolbar')).on('click',this.on_translate);}
var reset=_.bind(this.reset_history,this);this.view.on('load_record',this,reset);setTimeout(reset,0);this.$content=this.$('.note-editable:first');if(this.options['style-inline']){transcoder.style_to_class(this.$content);}}
$(".oe-view-manager-content").on("scroll",function(){$('.o_table_handler').remove();});this._super();},reset_history:function(){var history=this.$content.data('NoteHistory');if(history){history.reset();self.$('.note-toolbar').find('button[data-event="undo"]').attr('disabled',true);}},text_to_html:function(text){var value=text||"";try{$(text)[0].innerHTML;return text;}catch(e){if(value.match(/^\s*$/)){value='<p><br/></p>';}else{value="<p>"+value.split(/<br\/?>/).join("<br/></p><p>")+"</p>";value=value.replace(/<p><\/p>/g,'').replace('<p><p>','<p>').replace('<p><p ','<p ').replace('</p></p>','</p>');}}
return value;},focus:function(){if(!(!this.get("effective_readonly")&&this.$textarea)){return false;}
try{return this.$textarea.focusInEnd();}catch(e){return this.$textarea.focus();}},resize:function(){this.$('iframe').css('height','0px').css('height',Math.max(30,Math.min(this.$content[0]?this.$content[0].scrollHeight:0,500))+'px');},render_value:function(){var value=this.get('value');this.$textarea.val(value||'');this.$content.html(this.text_to_html(value));if(this.get("effective_readonly")){this.resize();}else{transcoder.style_to_class(this.$content);}
if(this.$content.is(document.activeElement)){this.focus();}
var history=this.$content.data('NoteHistory');if(history&&history.recordUndo()){this.$('.note-toolbar').find('button[data-event="undo"]').attr('disabled',false);}},is_false:function(){return!this.get('value')||this.get('value')==="<p><br/></p>"||!this.get('value').match(/\S/);},commit_value:function(){if(session.debug){var layoutInfo=this.$textarea.data('layoutInfo');$.summernote.pluginEvents.codeview(undefined,undefined,layoutInfo,false);}
if(this.options['style-inline']){transcoder.class_to_style(this.$content);transcoder.font_to_img(this.$content);}
this.internal_set_value(this.$content.html());},destroy_content:function(){$(".oe-view-manager-content").off("scroll");this.$textarea.destroy();this._super();}});var FieldTextHtml=widget.extend({template:'web_editor.FieldTextHtml',willStart:function(){var self=this;return new Model('res.lang').call("search_read",[[['code','!=','en_US']],["name","code"]]).then(function(res){self.languages=res;});},start:function(){var self=this;this.callback=_.uniqueId('FieldTextHtml_');window.odoo[this.callback+"_editor"]=function(EditorBar){setTimeout(function(){self.on_editor_loaded(EditorBar);},0);};window.odoo[this.callback+"_content"]=function(EditorBar){self.on_content_loaded();};window.odoo[this.callback+"_updown"]=null;window.odoo[this.callback+"_downup"]=function(value){self.internal_set_value(value);self.trigger('changed_value');self.resize();};window.odoo[this.callback+"_do_action"]=function(){self.do_action.apply(self,arguments);};this.$iframe=this.$el.find('iframe');this.document=null;this.$body=$();this.$content=$();this.$iframe.css('min-height','calc(100vh - 360px)');this.resize=function resize(){if(self.get('effective_readonly')){return;}
if($("body").hasClass("o_form_FieldTextHtml_fullscreen")){self.$iframe.css('height',(document.body.clientHeight-self.$iframe.offset().top)+'px');}else{self.$iframe.css("height",(self.$body.find("#oe_snippets").length?500:300)+"px");}};$(window).on('resize',this.resize);var def=this._super.apply(this,arguments);this.$translate.remove();this.$translate=$();return def;},get_datarecord:function(){return this.view.get_fields_values();},get_url:function(_attr){var src=this.options.editor_url||"/web_editor/field/html";var datarecord=this.get_datarecord();var attr={'model':this.view.model,'field':this.name,'res_id':datarecord.id||'','callback':this.callback};_attr=_attr||{};if(this.options['style-inline']){attr.inline_mode=1;}
if(this.options.snippets){attr.snippets=this.options.snippets;}
if(this.options.template){attr.template=this.options.template;}
if(!this.get("effective_readonly")){attr.enable_editor=1;}
if(this.field.translate){attr.translatable=1;}
if(session.debug){attr.debug=session.debug;}
attr.lang=attr.enable_editor?'en_US':this.session.user_context.lang;for(var k in _attr){attr[k]=_attr[k];}
if(src.indexOf('?')===-1){src+="?";}
for(var k in attr){if(attr[k]!==null){src+="&"+k+"="+(_.isBoolean(attr[k])?+attr[k]:attr[k]);}}
delete datarecord[this.name];src+="&datarecord="+encodeURIComponent(JSON.stringify(datarecord));return src;},initialize_content:function(){var self=this;this.$el.closest('.modal-body').css('max-height','none');this.$iframe=this.$el.find('iframe');this.document=null;this.$body=$();this.$content=$();this.editor=false;window.odoo[this.callback+"_updown"]=null;this.$iframe.attr("src",this.get_url());this.view.on("load_record",this,function(r){if(!self.$body.find('.o_dirty').length){var url=self.get_url();if(url!==self.$iframe.attr("src")){self.$iframe.attr("src",url);}}});},on_content_loaded:function(){var self=this;this.document=this.$iframe.contents()[0];this.$body=$("body",this.document);this.$content=this.$body.find("#editable_area");this._toggle_label();this.lang=this.$iframe.attr('src').match(/[?&]lang=([^&]+)/);this.lang=this.lang?this.lang[1]:this.view.dataset.context.lang;this._dirty_flag=false;this.render_value();setTimeout(function(){self.add_button();setTimeout(self.resize,0);},0);},on_editor_loaded:function(EditorBar){var self=this;this.editor=EditorBar;if(this.get('value')&&window.odoo[self.callback+"_updown"]&&!(this.$content.html()||"").length){this.render_value();}
setTimeout(function(){setTimeout(self.resize,0);},0);},add_button:function(){var self=this;var $to=this.$body.find("#web_editor-top-edit, #wrapwrap").first();$(QWeb.render('web_editor.FieldTextHtml.translate',{'widget':this})).appendTo($to).on('change','select',function(){var lang=$(this).val();var edit=!self.get("effective_readonly");var trans=lang!=='en_US';self.$iframe.attr("src",self.get_url({'edit_translations':edit&&trans,'enable_editor':edit&&!trans,'lang':lang}));});$(QWeb.render('web_editor.FieldTextHtml.fullscreen')).appendTo($to).on('click','.o_fullscreen',function(){$("body").toggleClass("o_form_FieldTextHtml_fullscreen");var full=$("body").hasClass("o_form_FieldTextHtml_fullscreen");self.$iframe.parents().toggleClass('o_form_fullscreen_ancestor',full);$(window).trigger("resize");});this.$body.on('click','[data-action="cancel"]',function(event){event.preventDefault();self.initialize_content();});},render_value:function(){if(this.lang!==this.view.dataset.context.lang||this.$iframe.attr('src').match(/[?&]edit_translations=1/)){return;}
var value=(this.get('value')||"").replace(/^<p[^>]*>(\s*|<br\/?>)<\/p>$/,'');if(!this.$content){return;}
if(!this.get("effective_readonly")){if(window.odoo[this.callback+"_updown"]){window.odoo[this.callback+"_updown"](value,this.view.get_fields_values(),this.name);this.resize();}}else{this.$content.html(value);if(this.$iframe[0].contentWindow){this.$iframe.css("height",(this.$body.height()+20)+"px");}}},is_false:function(){return this.get('value')===false||!this.$content.html()||!this.$content.html().match(/\S/);},commit_value:function(){if(this.lang!=='en_US'&&this.$body.find('.o_dirty').length){this.internal_set_value(this.view.datarecord[this.name]);this._dirty_flag=false;return this.editor.save();}else if(this._dirty_flag&&this.editor&&this.editor.buildingBlock){if(session.debug){var layoutInfo=this.editor.rte.editable().data('layoutInfo');$.summernote.pluginEvents.codeview(undefined,undefined,layoutInfo,false);}
this.editor.buildingBlock.clean_for_save();this.internal_set_value(this.$content.html());}},destroy:function(){$(window).off('resize',this.resize);delete window.odoo[this.callback+"_editor"];delete window.odoo[this.callback+"_content"];delete window.odoo[this.callback+"_updown"];delete window.odoo[this.callback+"_downup"];delete window.odoo[this.callback+"_do_action"];}});core.form_widget_registry.add('html',FieldTextHtmlSimple).add('html_frame',FieldTextHtml);return{FieldTextHtmlSimple:FieldTextHtmlSimple,FieldTextHtml:FieldTextHtml,};});;

/* /web_kanban/static/src/js/kanban_record.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban.Record',function(require){"use strict";var core=require('web.core');var data=require('web.data');var formats=require('web.formats');var framework=require('web.framework');var session=require('web.session');var time=require('web.time');var utils=require('web.utils');var Widget=require('web.Widget');var kanban_widgets=require('web_kanban.widgets');var QWeb=core.qweb;var fields_registry=kanban_widgets.registry;var KanbanRecord=Widget.extend({template:'KanbanView.record',events:{'click .oe_kanban_action':'on_kanban_action_clicked','click .o_kanban_manage_toggle_button':'toggle_manage_pane',},custom_events:{'kanban_update_record':'update_record',},init:function(parent,record,options){this._super(parent);this.fields=options.fields;this.editable=options.editable;this.deletable=options.deletable;this.draggable=options.draggable;this.read_only_mode=options.read_only_mode;this.model=options.model;this.group_info=options.group_info;this.qweb=options.qweb;this.sub_widgets=[];this.init_content(record);},init_content:function(record){var self=this;this.id=record.id;this.values={};_.each(record,function(v,k){self.values[k]={value:v};});this.record=this.transform_record(record);var qweb_context={record:this.record,widget:this,read_only_mode:this.read_only_mode,user_context:session.user_context,formats:formats,};for(var p in this){if(_.str.startsWith(p,'kanban_')){qweb_context[p]=_.bind(this[p],this);}}
this.qweb_context=qweb_context;this.content=this.qweb.render('kanban-box',qweb_context);},add_widgets:function(){var self=this;this.$("field").each(function(){var $field=$(this);var field=self.record[$field.attr("name")];var type=$field.attr("widget")||field.type;var Widget=fields_registry.get(type);var widget=new Widget(self,field,$field);widget.replace($field);self.sub_widgets.push(widget);});},start:function(){var self=this;this.add_widgets();this.$('[tooltip]').each(function(){var $el=$(this);var tooltip=$el.attr('tooltip');if(tooltip){$el.tooltip({'html':true,'title':self.qweb.render(tooltip,self.qweb_context)});}});},renderElement:function(){this._super();this.setup_color_picker();this.$el.addClass('o_kanban_record');this.$el.data('record',this);if(this.$el.hasClass('oe_kanban_global_click')||this.$el.hasClass('oe_kanban_global_click_edit')){this.$el.on('click',this.proxy('on_global_click'));}},transform_record:function(record){var self=this;var new_record={};_.each(_.extend(_.object(_.keys(this.fields),[]),record),function(value,name){var r=_.clone(self.fields[name]||{});if((r.type==='date'||r.type==='datetime')&&value){r.raw_value=time.auto_str_to_date(value);}else{r.raw_value=value;}
r.value=formats.format_value(value,r);new_record[name]=r;});return new_record;},update:function(record){_.invoke(this.sub_widgets,'destroy');this.sub_widgets=[];this.init_content(record);this.renderElement();this.add_widgets();},kanban_image:function(model,field,id,cache,options){options=options||{};var url;if(this.record[field]&&this.record[field].value&&!utils.is_bin_size(this.record[field].value)){url='data:image/png;base64,'+this.record[field].value;}else if(this.record[field]&&!this.record[field].value){url="/web/static/src/img/placeholder.png";}else{if(_.isArray(id)){id=id[0];}
if(!id){id=undefined;}
if(options.preview_image)
field=options.preview_image;var unique=this.record.__last_update&&this.record.__last_update.value.replace(/[^0-9]/g,'');url=session.url('/web/image',{model:model,field:field,id:id,unique:unique});if(cache!==undefined){url+='&cache='+parseInt(cache,10);}}
return url;},kanban_getcolor:function(variable){if(typeof(variable)==='number'){return Math.round(variable)%10;}
if(typeof(variable)==='string'){var index=0;for(var i=0;i<variable.length;i++){index+=variable.charCodeAt(i);}
return index%10;}
return 0;},kanban_color:function(variable){var color=this.kanban_getcolor(variable);return'oe_kanban_color_'+color;},on_global_click:function(ev){if($(ev.target).parents('.o_dropdown_kanban').length){return;}
if(!ev.isTrigger){var trigger=true;var elem=ev.target;var ischild=true;var children=[];while(elem){var events=$._data(elem,'events');if(elem==ev.currentTarget){ischild=false;}
var test_event=events&&events.click&&(events.click.length>1||events.click[0].namespace!=="tooltip");if(ischild){children.push(elem);if(test_event){trigger=false;}}
if(trigger&&test_event){_.each(events.click,function(click_event){if(click_event.selector){_.each(children,function(child){if($(child).is(click_event.selector)){trigger=false;}});}});}
elem=elem.parentElement;}
if(trigger){this.on_card_clicked(ev);}}},on_card_clicked:function(){if(this.$el.hasClass('oe_kanban_global_click_edit')&&this.$el.data('routing')){framework.redirect(this.$el.data('routing')+"/"+this.id);}else if(this.$el.hasClass('oe_kanban_global_click_edit')){this.trigger_up('kanban_record_edit',{id:this.id});}else{this.trigger_up('kanban_record_open',{id:this.id});}},toggle_manage_pane:function(event){event.preventDefault();this.$('.o_kanban_card_content').toggleClass('o_visible o_invisible');this.$('.o_kanban_card_manage_pane').toggleClass('o_visible o_invisible');this.$('.o_kanban_manage_button_section').toggleClass(this.kanban_color((this.values['color']&&this.values['color'].value)||0));},on_kanban_action_clicked:function(ev){ev.preventDefault();var $action=$(ev.currentTarget);var type=$action.data('type')||'button';switch(type){case'edit':this.trigger_up('kanban_record_edit',{id:this.id});break;case'open':this.trigger_up('kanban_record_open',{id:this.id});break;case'delete':this.trigger_up('kanban_record_delete',{record:this});break;case'action':case'object':this.trigger_up('kanban_do_action',$action.data());break;default:this.do_warn("Kanban: no action for type : "+type);}},kanban_compute_domain:function(domain){return data.compute_domain(domain,this.values);},update_record:function(event){this.trigger_up('kanban_record_update',event.data);},setup_color_picker:function(){var self=this;var $colorpicker=this.$('ul.oe_kanban_colorpicker');if(!$colorpicker.length){return;}
$colorpicker.html(QWeb.render('KanbanColorPicker',{widget:this}));$colorpicker.on('click','a',function(ev){ev.preventDefault();var color_field=$colorpicker.data('field')||'color';var data={};data[color_field]=$(this).data('color');self.trigger_up('kanban_record_update',data);});},});return KanbanRecord;});;

/* /web_kanban/static/src/js/kanban_relational.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban.Many2ManyKanbanView',function(require){"use strict";var common=require('web.form_common');var core=require('web.core');var data=require('web.data');var KanbanView=require('web_kanban.KanbanView');var _t=core._t;var X2ManyKanbanView=KanbanView.extend({render_pager:function($node,options){options=_.extend(options||{},{single_page_hidden:true,});this._super($node,options);},});var One2ManyKanbanView=X2ManyKanbanView.extend({add_record:function(){var self=this;new common.FormViewDialog(this,{res_model:self.x2m.field.relation,domain:self.x2m.build_domain(),context:self.x2m.build_context(),title:_t("Create: ")+self.x2m.string,initial_view:"form",alternative_form_view:self.x2m.field.views?self.x2m.field.views.form:undefined,create_function:function(data,options){return self.x2m.data_create(data,options);},read_function:function(ids,fields,options){return self.x2m.data_read(ids,fields,options);},parent_view:self.x2m.view,child_name:self.x2m.name,form_view_options:{'not_interactible_on_create':true},on_selected:function(){self.x2m.reload_current_view();}}).open();},});var Many2ManyKanbanView=X2ManyKanbanView.extend({add_record:function(){var self=this;new common.SelectCreateDialog(this,{res_model:this.x2m.field.relation,domain:new data.CompoundDomain(this.x2m.build_domain(),["!",["id","in",this.dataset.ids]]),context:this.x2m.build_context(),title:_t("Add: ")+this.x2m.string,on_selected:function(element_ids){return self.x2m.data_link_multi(element_ids).then(function(){self.x2m.reload_current_view();});}}).open();},open_record:function(event){var self=this;new common.FormViewDialog(this,{res_model:this.x2m.field.relation,res_id:event.data.id,context:this.x2m.build_context(),title:_t("Open: ")+this.x2m.string,write_function:function(id,data,options){return self.x2m.data_update(id,data,options).done(function(){self.x2m.reload_current_view();});},alternative_form_view:this.x2m.field.views?this.x2m.field.views.form:undefined,parent_view:this.x2m.view,child_name:this.x2m.name,read_function:function(ids,fields,options){return self.x2m.data_read(ids,fields,options);},form_view_options:{'not_interactible_on_create':true},readonly:!this.is_action_enabled('edit')||this.x2m.get("effective_readonly")}).open();},});core.view_registry.add('one2many_kanban',One2ManyKanbanView);core.view_registry.add('many2many_kanban',Many2ManyKanbanView);});;

/* /web_kanban/static/src/js/kanban_quick_create.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban.quick_create',function(require){"use strict";var Widget=require('web.Widget');var RecordQuickCreate=Widget.extend({template:"KanbanView.QuickCreate",events:{'click .o_kanban_cancel':function(event){this.cancel();},'click .o_kanban_add':function(event){this.add_record();},'keypress input':function(event){if(event.keyCode===13){this.add_record();}},'keydown':function(event){if(event.keyCode===27){this.cancel();}},'mousedown .o_kanban_add':'suppress','mousedown .o_kanban_cancel':'suppress',},init:function(parent,width){this._super(parent);this.width=width;},start:function(){this.$el.css({width:this.width});this.$input=this.$('input');this.$input.focus();},cancel:function(){this.trigger_up('cancel_quick_create');},add_record:function(){var value=this.$input.val();this.$input.val('');if(/^\s*$/.test(value)){return;}
this.trigger_up('quick_create_add_record',{value:value});this.$input.focus();},suppress:function(e){e.preventDefault();},});var ColumnQuickCreate=Widget.extend({template:'KanbanView.ColumnQuickCreate',events:{'click':'toggle','click .o_kanban_add':function(event){event.stopPropagation();this.add_column();},'click .o_kanban_cancel':function(event){this.folded=true;this.update();},'click .o_kanban_quick_create':function(event){event.stopPropagation();},'keypress input':function(event){if(event.keyCode===13){this.add_column();}},'keydown':function(event){if(event.keyCode===27){this.folded=true;this.update();}},'focusout':function(){var hasFocus=this.$(':focus').length>0;if(hasFocus){return;}
this.folded=true;this.$input.val('');this.update();},'mousedown .o_kanban_add':'suppress','mousedown .o_kanban_cancel':'suppress',},init:function(parent){this._super(parent);this.folded=true;},start:function(){this.$header=this.$('.o_column_header');this.$quick_create=this.$('.o_kanban_quick_create');this.$input=this.$('input');},toggle:function(){this.folded=!this.folded;this.update();if(!this.folded){this.$input.focus();this.trigger_up('scrollTo',{selector:'.o_column_quick_create'});}},update:function(){this.$header.toggle(this.folded);this.$quick_create.toggle(!this.folded);},add_column:function(){var name=this.$input.val();this.$input.val('');if(/^\s*$/.test(name)){return;}
this.trigger_up('quick_create_add_column',{value:name});this.$input.focus();},suppress:function(e){e.preventDefault();},});return{RecordQuickCreate:RecordQuickCreate,ColumnQuickCreate:ColumnQuickCreate,};});;

/* /web_kanban/static/src/js/kanban_column.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban.Column',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var form_common=require('web.form_common');var Widget=require('web.Widget');var quick_create=require('web_kanban.quick_create');var KanbanRecord=require('web_kanban.Record');var _t=core._t;var QWeb=core.qweb;var RecordQuickCreate=quick_create.RecordQuickCreate;var KanbanColumn=Widget.extend({template:"KanbanView.Group",events:{'click .o_kanban_toggle_fold':function(e){e.preventDefault();e.stopPropagation();this.folded=true;this.update_column();},'click .o_column_edit':'edit_column','click .o_column_delete':'delete_column','click .o_column_archive':'archive_records','click .o_column_unarchive':'unarchive_records','click .o_kanban_quick_add':'add_quick_create','click .o_kanban_load_more':'load_more',},custom_events:{'kanban_record_delete':'delete_record','cancel_quick_create':'cancel_quick_create','quick_create_add_record':'quick_create_add_record',},init:function(parent,group_data,options,record_options){this._super(parent);this.data_records=group_data.records;this.dataset=group_data.dataset;this.records=[];this.title=group_data.title;this.id=group_data.id;this.folded=group_data.attributes.folded;this.fields=options.fields;this.values=group_data.values;this.quick_create=options.quick_create;this.grouped_by_m2o=options.grouped_by_m2o;this.editable=options.editable;this.deletable=options.deletable;this.draggable=record_options.draggable;this.has_active_field=options.has_active_field;this.records_editable=options.records_editable;this.records_deletable=options.records_deletable;this.relation=options.relation;this.offset=0;this.remaining=this.dataset.size()-this.data_records.length;this.record_options=_.extend(_.clone(record_options),{group_info:this.values,});var self=this;if(group_data.options&&group_data.options.group_by_tooltip){this.tooltip_info=_.map(group_data.options.group_by_tooltip,function(key,value,list){return(self.values&&self.values[value]&&"<div>"+key+"<br>"+self.values[value]+"</div>")||'';}).join('');}else{this.tooltip_info="";}},start:function(){var self=this;this.$header=this.$('.o_kanban_header');for(var i=0;i<this.data_records.length;i++){this.add_record(this.data_records[i],{no_update:true});}
this.$header.tooltip();if(config.device.size_class>config.device.SIZES.XS&&this.draggable!==false){this.$el.sortable({connectWith:'.o_kanban_group',revert:0,delay:0,items:'> .o_kanban_record:not(.o_updating)',helper:'clone',cursor:'move',over:function(){self.$el.addClass('o_kanban_hover');self.update_column();},out:function(){self.$el.removeClass('o_kanban_hover');},update:function(event,ui){var record=ui.item.data('record');var index=self.records.indexOf(record);var test2=$.contains(self.$el[0],record.$el[0]);record.$el.removeAttr('style');if(index>=0&&test2){self.trigger_up('kanban_column_resequence');}else if(index>=0&&!test2){self.records.splice(self.records.indexOf(record),1);self.dataset.remove_ids([record.id]);}else{self.records.push(record);self.dataset.add_ids([record.id]);record.setParent(self);ui.item.addClass('o_updating');self.trigger_up('kanban_column_add_record',{record:record});}
self.update_column();}});}
this.update_column();this.$el.click(function(event){if(self.$el.hasClass('o_column_folded')){event.preventDefault();self.folded=false;self.update_column();}});},is_empty:function(){return!this.records.length;},add_record:function(data,options){var record=new KanbanRecord(this,data,this.record_options);this.records.push(record);this.dataset.ids=_.uniq(this.dataset.ids.concat(record.id));if(options.position==='before'){record.insertAfter(this.quick_create_widget?this.quick_create_widget.$el:this.$header);}else{var $load_more=this.$('.o_kanban_load_more');if($load_more.length){record.insertBefore($load_more);}else{record.appendTo(this.$el);}}
if(!options.no_update){this.update_column();}},get_ids:function(){var ids=[];this.$('.o_kanban_record').each(function(index,r){ids.push($(r).data('record').id);});return ids;},update_column:function(){var title=this.folded?this.title+' ('+this.dataset.size()+')':this.title;this.$header.find('.o_column_title').text(title);this.$header.find('.o-kanban-count').text(this.records.length);this.$el.toggleClass('o_column_folded',this.folded);var tooltip;if(this.remaining){tooltip=this.records.length+'/'+this.dataset.size()+_t(' records');}else{tooltip=this.records.length+_t(' records');}
tooltip='<p>'+tooltip+'</p>'+this.tooltip_info;this.$header.tooltip({html:true}).attr('data-original-title',tooltip);if(!this.remaining){this.$('.o_kanban_load_more').remove();}else{this.$('.o_kanban_load_more').html(QWeb.render('KanbanView.LoadMore',{widget:this}))}},archive_records:function(event){event.preventDefault();this.trigger_up('kanban_column_archive_records',{archive:true});},unarchive_records:function(event){event.preventDefault();this.trigger_up('kanban_column_archive_records',{archive:false});},delete_column:function(event){event.preventDefault();var buttons=[{text:_t("Ok"),classes:'btn-primary',close:true,click:this.trigger_up.bind(this,'kanban_column_delete')},{text:_t("Cancel"),close:true}];new Dialog(this,{size:'medium',buttons:buttons,$content:$('<div>',{text:_t("Are you sure that you want to remove this column ?")}),}).open();},edit_column:function(event){event.preventDefault();var dialog=new form_common.FormViewDialog(this,{res_model:this.relation,res_id:this.id,title:_t("Edit Column"),}).open();dialog.on('record_saved',this,function(){this.trigger_up('kanban_reload');});},delete_record:function(event){event.stopped=false;var self=this;event.data.after=function cleanup(){var index=self.records.indexOf(event.data.record);self.records.splice(index,1);self.update_column();};},add_quick_create:function(){if(this.quick_create_widget){return;}
var self=this;var width=this.records.length?this.records[0].$el.innerWidth():this.$el.width()-8;this.quick_create_widget=new RecordQuickCreate(this,width);this.quick_create_widget.insertAfter(this.$header);this.quick_create_widget.$el.focusout(function(){var hasFocus=(self.quick_create_widget.$(':focus').length>0);if(!hasFocus&&self.quick_create_widget){self.cancel_quick_create();}});},cancel_quick_create:function(){this.quick_create_widget.destroy();this.quick_create_widget=undefined;},quick_create_add_record:function(event){this.trigger_up('column_add_record',event.data);},load_more:function(event){event.preventDefault();this.trigger_up('kanban_load_more');},});return KanbanColumn;});;

/* /web_kanban/static/src/js/kanban_view.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban.KanbanView',function(require){"use strict";var core=require('web.core');var data=require('web.data');var data_manager=require('web.data_manager');var Model=require('web.DataModel');var Dialog=require('web.Dialog');var form_common=require('web.form_common');var Pager=require('web.Pager');var pyeval=require('web.pyeval');var QWeb=require('web.QWeb');var session=require('web.session');var utils=require('web.utils');var View=require('web.View');var KanbanColumn=require('web_kanban.Column');var quick_create=require('web_kanban.quick_create');var KanbanRecord=require('web_kanban.Record');var kanban_widgets=require('web_kanban.widgets');var qweb=core.qweb;var _lt=core._lt;var _t=core._t;var ColumnQuickCreate=quick_create.ColumnQuickCreate;var fields_registry=kanban_widgets.registry;var KanbanView=View.extend({accesskey:"k",className:"o_kanban_view",custom_events:{'kanban_record_open':'open_record','kanban_record_edit':'edit_record','kanban_record_delete':'delete_record','kanban_do_action':'open_action','kanban_reload':'do_reload','kanban_column_resequence':function(event){this.resequence_column(event.target);},'kanban_record_update':'update_record','kanban_column_add_record':'add_record_to_column','kanban_column_delete':'delete_column','kanban_column_archive_records':'archive_records','column_add_record':'column_add_record','quick_create_add_column':'add_new_column','kanban_load_more':'load_more','kanban_call_method':'call_method',},defaults:_.extend(View.prototype.defaults,{quick_creatable:true,creatable:true,create_text:undefined,read_only_mode:false,confirm_on_delete:true,}),display_name:_lt("Kanban"),icon:'fa-th-large',mobile_friendly:true,init:function(){this._super.apply(this,arguments);this.qweb=new QWeb(session.debug,{_s:session.origin});this.limit=this.options.limit||parseInt(this.fields_view.arch.attrs.limit,10)||40;this.fields=this.fields_view.fields;this.fields_keys=_.keys(this.fields_view.fields);this.grouped=undefined;this.group_by_field=undefined;this.default_group_by=this.fields_view.arch.attrs.default_group_by;this.on_create=this.fields_view.arch.attrs.on_create;this.grouped_by_m2o=undefined;this.relation=undefined;this.is_empty=undefined;this.many2manys=this.fields_view.many2manys||[];this.m2m_context={};this.widgets=[];this.data=undefined;this.quick_creatable=this.options.quick_creatable;this.no_content_msg=this.options.action&&(this.options.action.get_empty_list_help||this.options.action.help);this.search_orderer=new utils.DropMisordered();var default_order=this.fields_view.arch.attrs.default_order;if(!this.dataset._sort.length&&default_order){this.dataset.set_sort(default_order.split(','));}},willStart:function(){for(var i=0,ii=this.fields_view.arch.children.length;i<ii;i++){var child=this.fields_view.arch.children[i];if(child.tag==="templates"){transform_qweb_template(child,this.fields_view,this.many2manys);this.fields_view.many2manys=this.many2manys;this.qweb.add_template(utils.json_node_to_xml(child));break;}else if(child.tag==='field'){var ftype=child.attrs.widget||this.fields[child.attrs.name].type;if(ftype==="many2many"&&"context"in child.attrs){this.m2m_context[child.attrs.name]=child.attrs.context;}}}
return this._super();},start:function(){this.$el.addClass(this.fields_view.arch.attrs.class);return this._super();},do_search:function(domain,context,group_by){var self=this;var group_by_field=group_by[0]||this.default_group_by;var field=this.fields[group_by_field];var options={};var fields_def;if(field===undefined){fields_def=data_manager.load_fields(this.dataset).then(function(fields){self.fields=fields;field=self.fields[group_by_field];});}
var load_def=$.when(fields_def).then(function(){var grouped_by_m2o=field&&(field.type==='many2one');options=_.extend(options,{search_domain:domain,search_context:context,group_by_field:group_by_field,grouped:group_by.length||self.default_group_by,grouped_by_m2o:grouped_by_m2o,relation:(grouped_by_m2o?field.relation:undefined),});return options.grouped?self.load_groups(options):self.load_records();});return this.search_orderer.add(load_def).then(function(data){_.extend(self,options);if(options.grouped){var new_ids=_.union.apply(null,_.map(data.groups,function(group){return group.dataset.ids;}));self.dataset.alter_ids(new_ids);}
self.data=data;}).then(this.proxy('render')).then(this.proxy('update_buttons')).then(this.proxy('update_pager'));},do_show:function(){this.do_push_state({});return this._super();},do_reload:function(){var group_by=this.group_by_field?[this.group_by_field]:[];this.do_search(this.search_domain,this.search_context,group_by);},load_records:function(offset,dataset){var options={'limit':this.limit,'offset':offset,};dataset=dataset||this.dataset;return dataset.read_slice(this.fields_keys.concat(['__last_update']),options).then(function(records){return{records:records,is_empty:!records.length,grouped:false,};});},load_groups:function(options){var self=this;var group_by_field=options.group_by_field;var fields_keys=_.uniq(this.fields_keys.concat(group_by_field));return new Model(this.model,options.search_context,options.search_domain).query(fields_keys).group_by([group_by_field]).then(function(groups){var group_by_fields_to_read=[];var group_options={};var recurse=function(node){if(node.tag==="field"&&node.attrs&&node.attrs.options&&node.attrs.name===group_by_field){var options=pyeval.py_eval(node.attrs.options);group_options=options;var states_fields_to_read=_.map(options&&options.states_legend||{},function(value,key,list){return value;});var tooltip_fields_to_read=_.map(options&&options.group_by_tooltip||{},function(value,key,list){return key;});group_by_fields_to_read=_.union(group_by_fields_to_read,states_fields_to_read,tooltip_fields_to_read);return;}
_.each(node.children,function(child){recurse(child);});};recurse(self.fields_view.arch);var group_ids=_.without(_.map(groups,function(elem){return elem.attributes.value[0];}),undefined);if(options.grouped_by_m2o&&group_ids.length){return new data.DataSet(self,options.relation).read_ids(group_ids,_.union(['display_name'],group_by_fields_to_read)).then(function(results){_.each(groups,function(group){var group_id=group.attributes.value[0];var result=_.find(results,function(data){return group_id===data.id;});group.title=result?result.display_name:_t("Undefined");group.values=result;group.id=group_id;group.options=group_options;});return groups;});}else{_.each(groups,function(group){var value=group.attributes.value;group.id=value instanceof Array?value[0]:value;var field=self.fields[options.group_by_field];if(field&&field.type==="selection"){value=_.find(field.selection,function(s){return s[0]===group.id;});}
group.title=(value instanceof Array?value[1]:value)||_t("Undefined");group.values={};});return $.when(groups);}}).then(function(groups){var undef_index=_.findIndex(groups,function(g){return g.title===_t("Undefined");});if(undef_index>=1){var undef_group=groups[undef_index];groups.splice(undef_index,1);groups.unshift(undef_group);}
return groups;}).then(function(groups){var is_empty=true;return $.when.apply(null,_.map(groups,function(group){var def=$.when([]);var dataset=new data.DataSetSearch(self,self.model,new data.CompoundContext(self.dataset.get_context(),group.model.context()),group.model.domain());if(self.dataset._sort){dataset.set_sort(self.dataset._sort);}
if(group.attributes.length>=1){def=dataset.read_slice(self.fields_keys.concat(['__last_update']),{'limit':self.limit});}
return def.then(function(records){self.dataset.ids.push.apply(self.dataset.ids,_.difference(dataset.ids,self.dataset.ids));group.records=records;group.dataset=dataset;is_empty=is_empty&&!records.length;return group;});})).then(function(){return{groups:Array.prototype.slice.call(arguments,0),is_empty:is_empty,grouped:true,};});});},is_action_enabled:function(action){if(action==='create'&&!this.options.creatable){return false;}
return this._super(action);},has_active_field:function(){return this.fields.active;},_is_quick_create_enabled:function(){if(!this.quick_creatable||!this.is_action_enabled('create'))
return false;if(this.fields_view.arch.attrs.quick_create!==undefined)
return JSON.parse(this.fields_view.arch.attrs.quick_create);return!!this.grouped;},render_buttons:function($node){var self=this;if(this.options.action_buttons!==false&&this.is_action_enabled('create')){this.$buttons=$(qweb.render("KanbanView.buttons",{'widget':this}));this.$buttons.on('click','button.o-kanban-button-new',function(){if(self.grouped&&self.widgets.length&&self.on_create==='quick_create'){self.widgets[0].add_quick_create();}else if(self.on_create&&self.on_create!=='quick_create'){self.do_action(self.on_create,{on_close:self.do_reload.bind(self),additional_context:self.search_context,});}else{self.add_record();}});this.update_buttons();this.$buttons.appendTo($node);}},update_buttons:function(){if(this.$buttons){var create_muted=!!this.grouped&&this.widgets.length===0&&this.is_action_enabled('group_create')&&this.grouped_by_m2o;this.$buttons.find('.o-kanban-button-new').toggleClass('btn-primary',!create_muted).toggleClass('btn-default',create_muted);}},render_pager:function($node,options){var self=this;this.pager=new Pager(this,this.dataset.size(),1,this.limit,options);this.pager.appendTo($node);this.pager.on('pager_changed',this,function(state){var limit_changed=(self.limit!==state.limit);self.limit=state.limit;self.load_records(state.current_min-1).then(function(data){self.data=data;if(!limit_changed){self.scrollTop=0;self.trigger_up('scrollTo',{offset:0});}}).done(this.proxy('render'));});this.update_pager();},update_pager:function(){if(this.pager){if(this.grouped){this.pager.do_hide();}else{this.pager.update_state({size:this.dataset.size(),current_min:1});}}},render:function(){this.$el.css({display:'-webkit-flex'});this.$el.css({display:'flex'});this.$el.removeClass('o_kanban_ungrouped o_kanban_grouped o_kanban_nocontent');_.invoke(this.widgets,'destroy');this.$el.empty();this.widgets=[];if(this.column_quick_create){this.column_quick_create.destroy();this.column_quick_create=undefined;}
this.record_options={editable:this.is_action_enabled('edit'),deletable:this.is_action_enabled('delete'),fields:this.fields_view.fields,qweb:this.qweb,model:this.model,read_only_mode:this.options.read_only_mode,};var fragment=document.createDocumentFragment();if(this.data.grouped){this.$el.addClass('o_kanban_grouped');this.render_grouped(fragment);}else{this.$el.addClass('o_kanban_ungrouped');this.render_ungrouped(fragment);}
if(this.data.is_empty&&this.widgets.length===0&&(!this.data.grouped||!this.is_action_enabled('group_create')||!this.grouped_by_m2o)){this.$el.css("display","block");this.$el.addClass("o_kanban_nocontent");this.render_no_content(fragment);}
this.$el.append(fragment);},render_no_content:function(fragment){var content=qweb.render('KanbanView.nocontent',{content:this.no_content_msg});$(content).appendTo(fragment);},render_ungrouped:function(fragment){var self=this;var options=_.clone(this.record_options);_.each(this.data.records,function(record){var kanban_record=new KanbanRecord(self,record,options);self.widgets.push(kanban_record);kanban_record.appendTo(fragment);});for(var i=0,ghost_div;i<6;i++){ghost_div=$("<div>").addClass("o_kanban_record o_kanban_ghost");ghost_div.appendTo(fragment);}
this.postprocess_m2m_tags();},get_column_options:function(){return{editable:this.is_action_enabled('group_edit'),deletable:this.is_action_enabled('group_delete'),has_active_field:this.has_active_field(),grouped_by_m2o:this.grouped_by_m2o,relation:this.relation,qweb:this.qweb,fields:this.fields_view.fields,quick_create:this._is_quick_create_enabled(),};},render_grouped:function(fragment){var self=this;var group_by_field_attrs=this.fields[this.group_by_field];var draggable=true;if(group_by_field_attrs){if(group_by_field_attrs.type==="date"||group_by_field_attrs.type==="datetime"){var draggable=false;}
else if(group_by_field_attrs.readonly!==undefined){var draggable=!(group_by_field_attrs.readonly);}}
var record_options=_.extend(this.record_options,{draggable:draggable,});var column_options=this.get_column_options();_.each(this.data.groups,function(group){var column=new KanbanColumn(self,group,column_options,record_options);column.appendTo(fragment);self.widgets.push(column);});this.$el.sortable({axis:'x',items:'> .o_kanban_group',handle:'.o_kanban_header',cursor:'move',revert:150,delay:100,tolerance:'pointer',forcePlaceholderSize:true,stop:function(){var ids=[];self.$('.o_kanban_group').each(function(index,u){ids.push($(u).data('id'));});self.resequence(ids);},});if(this.is_action_enabled('group_create')&&this.grouped_by_m2o){this.column_quick_create=new ColumnQuickCreate(this);this.column_quick_create.appendTo(fragment);}
this.postprocess_m2m_tags();},add_record:function(){this.dataset.index=null;this.do_switch_view('form');},open_record:function(event,options){if(this.dataset.select_id(event.data.id)){this.do_switch_view('form',options);}else{this.do_warn("Kanban: could not find id#"+event.data.id);}},edit_record:function(event){this.open_record(event,{mode:'edit'});},delete_record:function(event){var self=this;var record=event.data.record;function do_it(){return $.when(self.dataset.unlink([record.id])).done(function(){record.destroy();if(event.data.after){event.data.after();}});}
if(this.options.confirm_on_delete){Dialog.confirm(this,_t("Are you sure you want to delete this record ?"),{confirm_callback:do_it});}else{do_it();}},open_action:function(event){var self=this;if(event.data.context){event.data.context=new data.CompoundContext(event.data.context).set_eval_context({active_id:event.target.id,active_ids:[event.target.id],active_model:this.model,});}
this.do_execute_action(event.data,this.dataset,event.target.id,_.bind(self.reload_record,this,event.target));},postprocess_m2m_tags:function(records){var self=this;if(!this.many2manys.length){return;}
var relations={};records=records?(records instanceof Array?records:[records]):this.grouped?Array.prototype.concat.apply([],_.pluck(this.widgets,'records')):this.widgets;records.forEach(function(record){self.many2manys.forEach(function(name){var field=record.record[name];var $el=record.$('.oe_form_field.o_form_field_many2manytags[name='+name+']');if(!$el[0]){return;}
if(!relations[field.relation]){relations[field.relation]={ids:[],elements:{},context:self.m2m_context[name]};}
var rel=relations[field.relation];field.raw_value.forEach(function(id){rel.ids.push(id);if(!rel.elements[id]){rel.elements[id]=[];}
rel.elements[id].push($el[0]);});});});_.each(relations,function(rel,rel_name){var dataset=new data.DataSetSearch(self,rel_name,self.dataset.get_context(rel.context));dataset.read_ids(_.uniq(rel.ids),['name','color']).done(function(result){result.forEach(function(record){if(typeof record.color!=='undefined'&&record.color!=10){var $tag=$('<span>').addClass('o_tag o_tag_color_'+record.color).attr('title',_.str.escapeHTML(record.name));$(rel.elements[record.id]).append($tag);}});self.$('span.o_tag').tooltip({delay:{'show':50}});});});},resequence:function(ids){if((ids.length<=1)||!this.relation){return;}
new data.DataSet(this,this.relation).resequence(ids).done(function(r){if(!r){console.warn('Resequence could not be complete. '+'Maybe the model does not have a "sequence" field?');}});},resequence_column:function(col){if(_.indexOf(this.fields_keys,'sequence')>-1){this.dataset.resequence(col.get_ids());}},delete_column:function(event){var self=this;var column=event.target;(new data.DataSet(this,this.relation)).unlink([column.id]).done(function(){if(column.is_empty()){var index=self.widgets.indexOf(column);self.widgets.splice(index,1);column.destroy();self.update_buttons();}else{self.do_reload();}});},archive_records:function(event){if(!this.has_active_field()){return;}
var active_value=!event.data.archive;var record_ids=[];_.each(event.target.records,function(kanban_record){if(kanban_record.record.active.value!=active_value){record_ids.push(kanban_record.id);}});if(record_ids.length){this.dataset.call('write',[record_ids,{active:active_value}]).done(this.do_reload);}},reload_record:function(record){var self=this;this.dataset.read_ids([record.id],this.fields_keys.concat(['__last_update'])).done(function(records){if(records.length){record.update(records[0]);self.postprocess_m2m_tags(record);}else{record.destroy();}});},add_record_to_column:function(event){var self=this;var column=event.target;var record=event.data.record;var data={};data[this.group_by_field]=event.target.id;this.dataset.write(record.id,data,{}).done(function(){if(!self.isDestroyed()){self.reload_record(record);self.resequence_column(column);}}).fail(this.do_reload);},update_record:function(event){var self=this;var record=event.target;return this.dataset.write(record.id,event.data).done(function(){if(!self.isDestroyed()){self.reload_record(record);}});},column_add_record:function(event){var self=this;var column=event.target;var context={};context['default_'+this.group_by_field]=column.id;var name=event.data.value;this.dataset.name_create(name,context).done(function(data){add_record(data[0]);}).fail(function(error,event){event.preventDefault();var dialog=new form_common.FormViewDialog(self,{res_model:self.model,context:_.extend({"default_name":name},context),title:_t("Create"),disable_multiple_selection:true,on_selected:function(element_ids){add_record(element_ids[0]);}}).open();});function add_record(id){self.dataset.add_ids([id],-1);self.dataset.read_ids([id],self.fields_keys.concat(['__last_update'])).done(function(record){column.add_record(record[0],{position:'before'});});}},add_new_column:function(event){var self=this;var model=new Model(this.relation,this.search_context);model.call('create',[{name:event.data.value}],{context:this.search_context,}).then(function(id){var dataset=new data.DataSetSearch(self,self.model,self.dataset.get_context(),[]);var group_data={records:[],title:event.data.value,id:id,attributes:{folded:false},dataset:dataset,values:{},};var options=self.get_column_options();var record_options=_.clone(self.record_options);var column=new KanbanColumn(self,group_data,options,record_options);column.insertBefore(self.$('.o_column_quick_create'));self.widgets.push(column);self.update_buttons();self.trigger_up('scrollTo',{selector:'.o_column_quick_create'});});},load_more:function(event){var self=this;var column=event.target;var offset=column.offset+this.limit;return this.load_records(offset,column.dataset).then(function(result){_.each(result.records,function(r){column.add_record(r,{no_update:true});self.dataset.add_ids([r.id]);});column.offset+=self.limit;column.remaining=Math.max(column.remaining-self.limit,0);column.update_column();self.postprocess_m2m_tags(column.records.slice(column.offset));});},call_method:function(event){var data=event.data;this.dataset.call(data.method,data.params).then(function(){if(data.callback){data.callback();}});}});function qweb_add_if(node,condition){if(node.attrs[qweb.prefix+'-if']){condition=_.str.sprintf("(%s) and (%s)",node.attrs[qweb.prefix+'-if'],condition);}
node.attrs[qweb.prefix+'-if']=condition;}
function transform_qweb_template(node,fvg,many2manys){if(node.tag&&node.attrs.modifiers){var modifiers=JSON.parse(node.attrs.modifiers||'{}');if(modifiers.invisible){qweb_add_if(node,_.str.sprintf("!kanban_compute_domain(%s)",JSON.stringify(modifiers.invisible)));}}
switch(node.tag){case'field':var ftype=fvg.fields[node.attrs.name].type;ftype=node.attrs.widget?node.attrs.widget:ftype;if(ftype==='many2many'){if(_.indexOf(many2manys,node.attrs.name)<0){many2manys.push(node.attrs.name);}
node.tag='div';node.attrs['class']=(node.attrs['class']||'')+' oe_form_field o_form_field_many2manytags o_kanban_tags';}else if(fields_registry.contains(ftype)){}else{node.tag=qweb.prefix;node.attrs[qweb.prefix+'-esc']='record.'+node.attrs.name+'.value';}
break;case'button':case'a':var type=node.attrs.type||'';if(_.indexOf('action,object,edit,open,delete,url,set_cover'.split(','),type)!==-1){_.each(node.attrs,function(v,k){if(_.indexOf('icon,type,name,args,string,context,states,kanban_states'.split(','),k)!=-1){node.attrs['data-'+k]=v;delete(node.attrs[k]);}});if(node.attrs['data-string']){node.attrs.title=node.attrs['data-string'];}
if(node.tag=='a'&&node.attrs['data-type']!="url"){node.attrs.href='#';}else{node.attrs.type='button';}
var action_classes=" oe_kanban_action oe_kanban_action_"+node.tag;if(node.attrs['t-attf-class']){node.attrs['t-attf-class']+=action_classes;}else if(node.attrs['t-att-class']){node.attrs['t-att-class']+=" + '"+action_classes+"'";}else{node.attrs['class']=(node.attrs['class']||'')+action_classes;}}
break;}
if(node.children){for(var i=0,ii=node.children.length;i<ii;i++){transform_qweb_template(node.children[i],fvg,many2manys);}}}
core.view_registry.add('kanban',KanbanView);return KanbanView;});;

/* /web_kanban/static/src/js/kanban_widgets.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban.widgets',function(require){"use strict";var core=require('web.core');var formats=require('web.formats');var Priority=require('web.Priority');var ProgressBar=require('web.ProgressBar');var pyeval=require('web.pyeval');var Registry=require('web.Registry');var session=require('web.session');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var FieldInterface={init:function(parent,field,$node){},};var AbstractField=Widget.extend(FieldInterface,{init:function(parent,field,$node){this._super(parent);this.field=field;this.$node=$node;this.options=pyeval.py_eval(this.$node.attr("options")||'{}');this.set("value",field.raw_value);},});var FormatChar=AbstractField.extend({tagName:'span',init:function(parent,field,$node){this._super.apply(this,arguments);this.format_descriptor=_.extend({},this.field,{'widget':this.$node.attr('widget')});},renderElement:function(){this.$el.text(formats.format_value(this.field.raw_value,this.format_descriptor));}});var KanbanPriority=AbstractField.extend({init:function(parent,field,$node){this._super.apply(this,arguments);this.name=$node.attr('name');},renderElement:function(){this._super();this.set('readonly',!!(this.field&&this.field.readonly));},start:function(){this.priority=new Priority(this,{readonly:this.get('readonly'),value:this.get('value'),values:this.field.selection||[],});this.priority.on('update',this,function(update){var data={};data[this.name]=update.value;this.trigger_up('kanban_update_record',data);});this.on('change:readonly',this,function(){this.priority.readonly=this.get('readonly');var $div=$('<div/>').insertAfter(this.$el);this.priority.replace($div);this.setElement(this.priority.$el);});var self=this;return $.when(this._super(),this.priority.appendTo('<div>').done(function(){self.priority.$el.addClass(self.$el.attr('class'));self.replaceElement(self.priority.$el);}));},});var KanbanSelection=AbstractField.extend({init:function(parent,field,$node){this._super.apply(this,arguments);this.name=$node.attr('name');this.parent=parent;},prepare_dropdown_selection:function(){var self=this;var _data=[];var stage_id=self.parent.values.stage_id.value[0];var stage_data={id:stage_id,legend_normal:self.parent.values.legend_normal?self.parent.values.legend_normal.value:undefined,legend_blocked:self.parent.values.legend_blocked?self.parent.values.legend_blocked.value:undefined,legend_done:self.parent.values.legend_done?self.parent.values.legend_done.value:undefined,};_.map(self.field.selection||[],function(res){var value={'name':res[0],'tooltip':res[1],};if(res[0]==='normal'){value.state_name=stage_data.legend_normal?stage_data.legend_normal:res[1];}else if(res[0]==='done'){value.state_class='oe_kanban_status_green';value.state_name=stage_data.legend_done?stage_data.legend_done:res[1];}else{value.state_class='oe_kanban_status_red';value.state_name=stage_data.legend_blocked?stage_data.legend_blocked:res[1];}
_data.push(value);});return _data;},renderElement:function(){var self=this;var state;self.states=this.prepare_dropdown_selection();var current_state=_.find(this.states,function(state){return state.name===self.get('value');})||{state_class:''};self.$el=$(QWeb.render("KanbanSelection",{current_state_class:current_state.state_class,states:_.without(this.states,current_state)}));self.$('a').click(function(ev){ev.preventDefault();});self.$('a').click(self.set_kanban_selection.bind(self));},set_kanban_selection:function(e){e.preventDefault();var self=this;var $li=$(e.target).closest("li");if($li.length){var value={};value[self.name]=String($li.data('value'));this.trigger_up('kanban_update_record',value,this);}},});var KanbanLabelSelection=AbstractField.extend({init:function(parent,field,$node){this._super.apply(this,arguments);this.classes=this.options&&this.options.classes||{};},renderElement:function(){this._super.apply(this,arguments);var lbl_class=this.classes[this.field.raw_value]||'primary';this.$el.addClass('label label-'+lbl_class).text(this.field.value);},});var KanbanAttachmentImage=AbstractField.extend({template:'KanbanAttachmentImage',});var KanbanProgressBar=AbstractField.extend({events:{'click':function(){if(!this.readonly&&this.progressbar.readonly){this.toggle_progressbar();}}},init:function(parent,field,node){this._super(parent,field,node);var record=this.getParent().record;this.progressbar=new ProgressBar(this,{readonly:true,value:record[this.options.current_value].raw_value,max_value:record[this.options.max_value].raw_value,title:_t(node&&node[0].title||this.options.title),edit_max_value:this.options.edit_max_value,});this.readonly=!this.options.editable;this.on_change=this.options.on_change;},start:function(){var self=this;var def=this.progressbar.appendTo('<div>').done(function(){self.progressbar.$el.addClass(self.$el.attr('class'));self.replaceElement(self.progressbar.$el);});return $.when(this._super(),def).then(function(){if(!self.readonly){var parent=self.getParent();self.progressbar.on('update',self,function(update){var value=update.changed_value;if(!isNaN(value)){var data={method:this.on_change,params:[parent.id,value],callback:self.proxy('toggle_progressbar'),};self.trigger_up('kanban_call_method',data);}});}});},toggle_progressbar:function(){this.progressbar.readonly=!this.progressbar.readonly;var $div=$('<div/>').insertAfter(this.$el);this.progressbar.replace($div);this.setElement(this.progressbar.$el);},});var KanbanMonetary=AbstractField.extend({tagName:'span',renderElement:function(){var kanban_view=this.getParent();var currency_field=(this.options&&this.options.currency_field)||'currency_id';var currency_id=kanban_view.values[currency_field].value[0];var currency=session.get_currency(currency_id);var digits_precision=this.options.digits||(currency&&currency.digits);var value=formats.format_value(this.field.raw_value||0,{type:this.field.type,digits:digits_precision});if(currency){if(currency.position==="after"){value+=currency.symbol;}else{value=currency.symbol+value;}}
this.$el.text(value);}});var fields_registry=new Registry();fields_registry.add('priority',KanbanPriority).add('kanban_state_selection',KanbanSelection).add("attachment_image",KanbanAttachmentImage).add('progress',KanbanProgressBar).add('float_time',FormatChar).add('monetary',KanbanMonetary).add('kanban_label_selection',KanbanLabelSelection);return{AbstractField:AbstractField,registry:fields_registry,};});;

/* /web_kanban/static/src/js/compatibility.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban.compatibility',function(require){"use strict";var kanban_widgets=require('web_kanban.widgets');var KanbanRecord=require('web_kanban.Record');var KanbanColumn=require('web_kanban.Column');var KanbanView=require('web_kanban.KanbanView');return;openerp=window.openerp||{};openerp.web_kanban=openerp.web_kanban||{};openerp.web_kanban.AbstractField=kanban_widgets.AbstractField;openerp.web_kanban.KanbanGroup=KanbanColumn;openerp.web_kanban.KanbanRecord=KanbanRecord;openerp.web_kanban.KanbanView=KanbanView;});;

/* /web_kanban_gauge/static/src/js/kanban_gauge.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban_gauge.widget',function(require){"use strict";var core=require('web.core');var kanban_widgets=require('web_kanban.widgets');var utils=require('web.utils');var AbstractField=kanban_widgets.AbstractField;var fields_registry=kanban_widgets.registry;var _t=core._t;var GaugeWidget=AbstractField.extend({className:"oe_gauge",start:function(){var self=this;var parent=this.getParent();var max_value=this.options.max_value||100;if(this.options.max_field){max_value=this.getParent().record[this.options.max_field].raw_value;}
var label=this.options.label||"";if(this.options.label_field){label=this.getParent().record[this.options.label_field].raw_value;}
var title=this.$node.html()||this.field.string;var val=this.field.raw_value;if(_.isArray(JSON.parse(val))){val=JSON.parse(val);}
var value=_.isArray(val)&&val.length?val[val.length-1]['value']:val;var gauge_value=value;if(this.options.gauge_value_field){gauge_value=this.getParent().record[this.options.gauge_value_field].raw_value;}
var degree=Math.PI/180,width=200,height=150,outerRadius=Math.min(width,height)*0.5,innerRadius=outerRadius*0.7,fontSize=height/7;this.$el.empty().attr('style',this.$node.attr('style')+';position:relative; display:inline-block;');var arc=d3.svg.arc().innerRadius(innerRadius).outerRadius(outerRadius).startAngle(-90*degree);var svg=d3.select(this.$el[0]).append("svg").attr("width",'100%').attr("height",'100%').attr('viewBox','0 0 '+width+' '+height).attr('preserveAspectRatio','xMinYMin').append("g").attr("transform","translate("+(width/2)+","+(height-(width-height)/2-12)+")");function addText(text,fontSize,dx,dy){return svg.append("text").attr("text-anchor","middle").style("font-size",fontSize+'px').attr("dy",dy).attr("dx",dx).text(text);}
addText(title,16,0,-outerRadius-16).style("font-weight",'bold');var text=addText(utils.human_number(value,1),fontSize,0,-2).style("font-weight",'bold');addText(0,8,-(outerRadius+innerRadius)/2,12);addText(label,8,0,12);addText(utils.human_number(max_value,1),8,(outerRadius+innerRadius)/2,12);svg.append("path").datum({endAngle:Math.PI/2}).style("fill","#ddd").attr("d",arc);var foreground=svg.append("path").datum({endAngle:0}).style("fill","hsl(0,80%,50%)").attr("d",arc);var ratio=max_value?value/max_value:0;var hue=Math.round(ratio*120);foreground.transition().style("fill","hsl("+hue+",80%,50%)").duration(1500).call(arcTween,(ratio-0.5)*Math.PI);function arcTween(transition,newAngle){transition.attrTween("d",function(d){var interpolate=d3.interpolate(d.endAngle,newAngle);return function(t){d.endAngle=interpolate(t);return arc(d);};});}
var flag_open=false;if(this.options.on_change){var $svg=this.$el.find('svg');this.$el.click(function(event){event.stopPropagation();flag_open=false;if(!parent.view.is_action_enabled('edit')){return;}
$svg.fadeTo(0,0.2);if(!self.$el.find(".o_gauge_edit").size()){var $div=$('<div class="o_gauge_edit" style="z-index:1"/>');$div.css({'text-align':'center','position':'absolute','width':self.$el.outerWidth()+'px','top':(self.$el.outerHeight()/2-5)+'px'});var $input=$('<input/>').val(gauge_value);$input.css({'text-align':'center','margin':'auto','width':($svg.outerWidth()-40)+'px'});$div.append($input);if(self.options.on_click_label){var $post_input=$('<span style="color: #000000;">'+self.options.on_click_label+'</span>');$div.append($post_input);}
self.$el.prepend($div);$input.focus().keydown(function(event){event.stopPropagation();if(isNaN($input.val())){self.do_warn(_t("Wrong value entered!"),_t("Only Integer Value should be valid."));$div.remove();$svg.fadeTo(0,1);}else{if(event.keyCode==13||event.keyCode==9){if($input.val()!=value){$svg.fadeTo(0,1);parent.view.dataset.call(self.options.on_change,[parent.id,$input.val()]).then(function(){parent.do_reload();});}else{$svg.fadeTo(0,1);$div.remove();}}}}).click(function(event){event.stopPropagation();flag_open=false;}).blur(function(){if(!flag_open){self.$el.find(".o_gauge_edit").remove();$svg.fadeTo(0,1);}else{$svg.fadeTo(0,1);flag_open=false;setTimeout(function(){$input.focus();},0);}});}}).mousedown(function(){flag_open=true;});if(this.options.force_set&&!+input_value){$svg.fadeTo(0,0.3);var $div=$('<div/>').text(_t("Click to change value"));$div.css(css);this.$el.append($div);}}},});fields_registry.add("gauge",GaugeWidget);});;

/* /web_settings_dashboard/static/src/js/dashboard.js defined in bundle 'web.assets_backend' */
odoo.define('web_settings_dashboard',function(require){"use strict";var core=require('web.core');var Widget=require('web.Widget');var Model=require('web.Model');var session=require('web.session');var PlannerCommon=require('web.planner.common');var framework=require('web.framework');var webclient=require('web.web_client');var PlannerDialog=PlannerCommon.PlannerDialog;var QWeb=core.qweb;var _t=core._t;var Dashboard=Widget.extend({template:'DashboardMain',init:function(parent,data){this.all_dashboards=['apps','invitations','planner','share'];return this._super.apply(this,arguments);},start:function(){return this.load(this.all_dashboards);},load:function(dashboards){var self=this;var loading_done=new $.Deferred();session.rpc("/web_settings_dashboard/data",{}).then(function(data){var all_dashboards_defs=[];_.each(dashboards,function(dashboard){var dashboard_def=self['load_'+dashboard](data);if(dashboard_def){all_dashboards_defs.push(dashboard_def);}});$.when.apply($,all_dashboards_defs).then(function(){loading_done.resolve();});});return loading_done;},load_apps:function(data){return new DashboardApps(this,data.apps).replace(this.$('.o_web_settings_dashboard_apps'));},load_share:function(data){return new DashboardShare(this,data.share).replace(this.$('.o_web_settings_dashboard_share'));},load_invitations:function(data){return new DashboardInvitations(this,data.users_info).replace(this.$('.o_web_settings_dashboard_invitations'));},load_planner:function(data){return new DashboardPlanner(this,data.planner).replace(this.$('.o_web_settings_dashboard_planner'));},});var DashboardInvitations=Widget.extend({template:'DashboardInvitations',events:{'click .o_web_settings_dashboard_invitations':'send_invitations','click .o_web_settings_dashboard_access_rights':'on_access_rights_clicked','click .o_web_settings_dashboard_user':'on_user_clicked','click .o_web_settings_dashboard_more':'on_more',},init:function(parent,data){this.data=data;this.parent=parent;return this._super.apply(this,arguments);},send_invitations:function(e){var self=this;var $target=$(e.currentTarget);var user_emails=_.filter($(e.delegateTarget).find('#user_emails').val().split(/[\n, ]/),function(email){return email!=="";});var re=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,63}(?:\.[a-z]{2})?)$/i;var is_valid_emails=_.every(user_emails,function(email){return re.test(email);});if(is_valid_emails){$target.prop('disabled',true);$target.find('i.fa-cog').removeClass('hidden');new Model("res.users").call("web_dashboard_create_users",[user_emails]).then(function(){self.reload();}).always(function(){$(e.delegateTarget).find('.o_web_settings_dashboard_invitations').prop('disabled',false);$(e.delegateTarget).find('i.fa-cog').addClass('hidden');});}
else{this.do_warn(_t("Please provide valid email addresses"),"");}},on_access_rights_clicked:function(e){var self=this;e.preventDefault();this.do_action('base.action_res_users',{on_reverse_breadcrumb:function(){return self.reload();}});},on_user_clicked:function(e){var self=this;e.preventDefault();var user_id=$(e.currentTarget).data('user-id');var action={type:'ir.actions.act_window',view_type:'form',view_mode:'form',res_model:'res.users',views:[[this.data.user_form_view_id,'form']],res_id:user_id,};this.do_action(action,{on_reverse_breadcrumb:function(){return self.reload();}});},on_more:function(e){var self=this;e.preventDefault();var action={type:'ir.actions.act_window',view_type:'form',view_mode:'tree,form',res_model:'res.users',domain:[['log_ids','=',false]],views:[[false,'list'],[false,'form']],};this.do_action(action,{on_reverse_breadcrumb:function(){return self.reload();}});},reload:function(){return this.parent.load(['invitations']);},});var DashboardPlanner=Widget.extend({template:'DashboardPlanner',events:{'click .o_web_settings_dashboard_progress_title,.progress':'on_planner_clicked',},init:function(parent,data){this.data=data;this.parent=parent;this.planner_by_menu={};this._super.apply(this,arguments);},willStart:function(){var self=this;return new Model('web.planner').query().all().then(function(res){self.planners=res;_.each(self.planners,function(planner){self.planner_by_menu[planner.menu_id[0]]=planner;self.planner_by_menu[planner.menu_id[0]].data=$.parseJSON(planner.data)||{};});self.set_overall_progress();});},update_planner_progress:function(){this.set_overall_progress();this.$('.o_web_settings_dashboard_planners_list').replaceWith(QWeb.render("DashboardPlanner.PlannersList",{'planners':this.planners}));},set_overall_progress:function(){var self=this;this.sort_planners_list();var average=_.reduce(self.planners,function(memo,planner){return planner.progress+memo;},0)/(self.planners.length||1);self.overall_progress=Math.floor(average);self.$('.o_web_settings_dashboard_planner_overall_progress').text(self.overall_progress);},sort_planners_list:function(){this.planners=_.sortBy(this.planners,function(planner){return(planner.progress==100)+planner.name;});},on_planner_clicked:function(e){var menu_id=$(e.currentTarget).attr('data-menu-id');if(this.planner&&this.planner.menu_id[0]==menu_id){this.dialog.$el.modal('show');}
else{this.setup_planner(menu_id);}},setup_planner:function(menu_id){var self=this;this.planner=self.planner_by_menu[menu_id];if(this.dialog){this.dialog.destroy();}
this.dialog=new PlannerDialog(this,this.planner);this.dialog.on("planner_progress_changed",this,function(percent){self.planner.progress=percent;self.update_planner_progress();});this.dialog.appendTo(webclient.$el).then(function(){self.dialog.$el.modal('show');});}});var DashboardApps=Widget.extend({template:'DashboardApps',events:{'click .o_browse_apps':'on_new_apps','click .o_confirm_upgrade':'confirm_upgrade',},init:function(parent,data){this.data=data;this.parent=parent;return this._super.apply(this,arguments);},start:function(){this._super.apply(this,arguments);if(odoo.db_info&&_.last(odoo.db_info.server_version_info)!=='e'){$(QWeb.render("DashboardEnterprise")).appendTo(this.$el);}},on_new_apps:function(){this.do_action('base.open_module_tree');},confirm_upgrade:function(){framework.redirect("https://www.odoo.com/odoo-enterprise/upgrade?num_users="+(this.data.enterprise_users||1));},});var DashboardShare=Widget.extend({template:'DashboardShare',events:{'click .tw_share':'share_twitter','click .fb_share':'share_facebook','click .li_share':'share_linkedin',},init:function(parent,data){this.data=data;this.parent=parent;this.share_url='https://www.odoo.com';this.share_text=encodeURIComponent("I am using #Odoo - Awesome open source business apps.");},share_twitter:function(){var popup_url=_.str.sprintf('https://twitter.com/intent/tweet?tw_p=tweetbutton&text=%s %s',this.share_text,this.share_url);this.sharer(popup_url);},share_facebook:function(){var popup_url=_.str.sprintf('https://www.facebook.com/sharer/sharer.php?u=%s',encodeURIComponent(this.share_url));this.sharer(popup_url);},share_linkedin:function(){var popup_url=_.str.sprintf('http://www.linkedin.com/shareArticle?mini=true&url=%s&title=I am using odoo&summary=%s&source=www.odoo.com',encodeURIComponent(this.share_url),this.share_text);this.sharer(popup_url);},sharer:function(popup_url){window.open(popup_url,'Share Dialog','width=600,height=400');}});core.action_registry.add('web_settings_dashboard.main',Dashboard);return{Dashboard:Dashboard,DashboardInvitations:DashboardInvitations,DashboardPlanner:DashboardPlanner,DashboardShare:DashboardShare,};});